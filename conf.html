
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="altanai">
    <title>WebRTC Call</title>
    <meta name="google-site-verification" content="8NqEkVsX8mkRCn13Qov4K0njgF0T6t97_a-NZNIXkpE" />
    <link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/jpcjjkpbiepbmhklnjoahacppaemhmpd">
    <link rel=stylesheet href="node_modules/webrtcdevelopment/client/build/minScripts/webrtcdevelopment_header.css">
    <script src="node_modules/webrtcdevelopment/client/build/minScripts/webrtcdevelopment_header.js"> </script>
    <link rel=stylesheet href="node_modules/webrtcdevelopment/client/build/minScripts/webrtcdevelopment.css">
    <link href="css/mainstyle.css" rel="stylesheet">
    <script src="property.js"></script>
</head>

<body>

  <div class="row alertDiv" id="alertBox" hidden="true"></div>

    <section id="mainDiv" class="video-section mainContainer">
        <div class="container-fluid">
            <div class="row">
        
                <!-- Left Div -->
                <div id="leftDiv1" class="col-md-2 leftDiv-class" hidden="true">
                    <div class="left-section">

                        <div class="main-block">

                            <!-- when remotes are connected -->
                            <div id="confVideoContainer" style="display: block;">

                                <!-- Remotes video -->
                                <div class="video-container-class-remote">
                                    <div class="video-header">
                                        <div class="text-center">Remote</div>
                                    </div>

                                    <div class="block-section">
                                        <video controls="" class="video-class" name="otherConferenceVideo2" hidden></video>
                                    </div>

                                    <div class="block-section">
                                        <video controls="" class="video-block" name="otherConferenceVideo3" hidden></video>
                                    </div>

                                    <br><br>
                                </div> 

                            </div>
                        </div>  
                    </div>
                </div>

                <div id="leftDiv2" class="col-md-2 leftDiv-class" hidden="true">
                    <div class="left-section">
                        <div class="main-block">
                            <!-- when remotes are connected -->
                            <div id="confVideoContainer" style="display: block;">
                                <!-- Remotes video -->
                                <div class="video-container-class-remote">
                                    <div class="video-header">
                                        <div class="text-center">Remote</div>
                                    </div>
                                    <div class="block-section">
                                        <video controls="" class="video-class" name="otherConferenceVideo4" hidden></video>
                                    </div>
                                    <div class="block-section">
                                        <video controls="" class="video-block" name="otherConferenceVideo5" hidden></video>
                                    </div>
                                    <br><br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Centre Div -->
                <div id="centreDiv" class="col-md-10 centreDiv-class">
                    <div id="screenShareRow" style="margin: 10px;"></div>
                    <div id="screenRecordRow" style="margin: 10px;" hidden></div>
                    <div id="drawBoardRow" style="margin: 10px;"></div>
                    <div id="fileSharingRow" style="margin: 10px;"></div>
                    <div id="fileListingRow" style="margin: 10px;"></div>
                </div>

                <!-- Right Div -->
                <div id="rightDiv" class="col-md-2 rightDiv-class">
                    <div class="right-section">

                        <div class="container-fluid header-part">
                            <div class="row" style="height:100px">
                              <div class="col-md-12 text-center">
                                <div class="logo"> <img class="logoClass" src="images/villagexpertslogo2.png" alt="logo" > </div>
                                    <div class="over-lap">
                                        <div class="profile pull-left"> <img hidden style="visibility: hidden !important;" src="images/img-3.jpg" class="img-responsive"> </div>
                                        <div class="profile pull-right">
                                            <p id="loginname" class="loginname">...</p>
                                            <button id="logoutBtn" class="btn btn-info bg-blue">End Session</button>
                                        </div>
                                    <div class="clearfix"></div>
                                </div>
                              </div>
                            </div>
                        </div>

                        <div class="main-block">

                            <div class="panel-seassion" style="padding:0px 2px;color:white"> Conference </div>

                            <!-- Timer and monitization -->
                            <div class="panel-seassion">
                                <div class="timer">
                                    <div class="col-xs-8 text-center" > 
                                        Timer <i class="fa fa-clock-o" aria-hidden="true"></i>
                                    </div>
                                    <div class="col-xs-2 text-center minTimerBtn" >
                                        <button id="minimizeTimerButton" class="btn btn-modify-video2" title="Minimize"><i class="fa fa-minus"></i></button>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="timer-block" id="timeContainer" hidden>
                                    <div id="localtime" class="timer-panel row">
                                        <span id="currentTimeZoneArea" class="time-function" title="Time Zone"></span>
                                        <span id="currentTimeArea" class="time-function" title="Current Local Time"></span>
                                        <!--                             
                                        <div class="col-xs-6">
                                          <p class="time-function" data-placement="top" data-toggle="tooltip" title="Elapsed Time ">12:15 mins</p>
                                          <p class="time-function" data-placement="top" data-toggle="tooltip" title="Alloted Time">45:00 mins</p>
                                        </div>
                                        <div class="col-xs-6">
                                            <p class="time-function" data-placement="top" data-toggle="tooltip" title="Current Session Charges">$14.80</p>
                                            <p class="time-function" data-placement="top" data-toggle="tooltip" title="Session Allocated Charges">$150.00</p>
                                        </div> -->
                                    </div>

                                    <div id="remotetime" class="timer-panel row">
                                        <span id="remoteTimeZoneArea" class="time-function" title="Time Zone"></span>
                                        <span id="remoteTimeArea" class="time-function" title="Time of Remote"></span>
                                    </div>

                                    <div id="countdown" class="timer-panel row">
                                        <span id="countdownHours" class="time-function" title="Hours">0</span>
                                        <span id="countdownMinutes" class="time-function" title="Minutes">0</span>
                                        <span id="countdownSeconds" class="time-function" title="Seconds">0</span>
                                    </div>

                                </div>
                            </div>

                            <!-- Bandwidth and Network stats -->
                            <div class="panel-seassion" hidden>
                                <div class="timer">
                                    <div class="col-xs-8 text-center" > Network stats </div>
                                    <div class="col-xs-2 text-center minTimerBtn">
                                        <button id="minimizeBandwidthButton" class="btn btn-modify-video2" title="Minimize"><i class="fa fa-minus-square"></i></button>
                                    </div>
                                  <div class="clearfix"></div>
                                </div>
                                <div class="timer-block" id="bandwidthContainer" hidden>
                                    <div class="panel-seassion">
                                        <div class="col-xs-6">
                                          <p id="outgoingbandwidth" class="time-function" >1Mbps</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">

                                <!-- Recording -->
                                <div class="col-md-6 panel-seassion">
                                    <div class="widgetBtnClass">
                                        <div id="scrRecordBtn" class="col-xs-8 text-center screenRecordBtnClass Off">Session Record <i class='fa fa-circle'></i></div>
                                    </div>
                                </div>

                                <!-- File share -->
                                <div class="col-md-6 panel-seassion">
                                    <div class="widgetBtnClass">
                                        <input id="fileshareBtn" class="col-xs-8 text-center fileshareclass" value="SHARE A FILE" title="Select Files to Upload">
                                        <!-- <i class="fa fa-file" aria-hidden="true"></i> -->
                                    </div>
                                </div>
                            </div>

                            <div class="row">

                                <!-- Screenshare -->
                                <div class="col-md-6 panel-seassion">
                                    <div class="widgetBtnClass">
                                        <div id="scrShareButton" class="col-xs-8 text-center screen-btn off" title="Screen Share" > Screen Share </div>
                                        <div id="scrInstallButton" class="col-xs-8 text-center screenInstall-btn off" title="Install Screen Share" display="none" >Install Screenshare </div>
                                        <div id="scrViewButton" class="col-xs-8 text-center" display="none" hidden> Screen View </div>
                                    </div>
                                </div>

                                <!-- Reconnect Button -->
                                <div class="col-md-6 panel-seassion">
                                    <div class="widgetBtnClass">
                                        <div id="reconnectBtn" class="col-xs-8 text-center" title="Reconnect if session is lost" style="padding:0px 2px">Reconnect <span class="fa fa-refresh"> </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">

                                <!-- Listen In -->
                                <div class="col-md-6 panel-seassion">
                                    <div class="widgetBtnClass">
                                        <div id="ListenInButton" class="col-xs-8 text-center screen-btn off" title="show listen In Link in popup Window" style="padding:0px 2px">Listen In </div>
                                    </div>
                                </div>
                            </div>

                            <!-- when no remote -->
                            <div id="singleVideoContainer" class="row" hidden>
                                  <video name="myAloneVideo" autoplay="autoplay" muted="true" />
                            </div>

                            <!-- when remotes are connected -->
                            <div id="confVideoContainer">

                                <!-- local video -->
                                <div class="video-container-class-local">
                                    <div class="video-header">
                                        <div class="text-center">Local</div>
                                    </div>
                                    <div class="block-section">
                                        <video class="video-block" controls name="myConferenceVideo"></video>
                                    </div>
                                    <br/><br/>
                                </div>

                                <!-- chat -->
                                <div class="chat-class border-radius">
                                    <div class="send-chat-header-class row" id="chatHeader">
                                        <div class="col-xs-8 text-center" style="padding:0px 2px; width:60% ; float:left">
                                            <input id="chatInputText" type="text" class="form-control send-mesg" placeholder="Send Message">
                                        </div>
                                   
                                        <div class="col-xs-2 text-center" style="padding:0px 2px ;">
                                            <button id="chatSendButton" class="btn btn-modify-video2" title="Sent"><i class="fa fa-paper-plane"></i></button>
                                        </div>
                                      
                                        <div class="col-xs-2 text-center" style="padding:0px 2px ; float:right">
                                            <button id="minimizeChatButton" class="btn btn-modify-video2" title="Minimize"><i class="fa fa-minus-square"></i></button>
                                        </div>
                                    </div>

                                    <div class="sent-message-block-class" id="chatContainer" style="background-color: white;">
                                        <div class="panel-seassion">
                                            <div class="chating-area" id="chatBoard"> </div>
                                            <div id="whoTyping" hidden></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Remotes video -->
                                <div class="video-container-class-remote">
                                    <div class="video-header">
                                        <div class="text-center">Remote</div>
                                    </div>

                                    <div class="block-section">
                                        <video controls class="video-block" name="otherConferenceVideo" hidden></video>
                                    </div>

                                    <br/><br/>
                                </div> 

                                 <!-- Drawboard  -->
                                <div class="panel-seassion">
                                    <div id="drawButton" class="timer icon-markup-block"> 
                                        <div class="col-xs-2 text-center" style="padding:0px;">
                                          <button class="icon-markup-btn btn-modify-chat" title="Demo"><img src="images/14.png"></button>
                                        </div>
                                        <div class="col-xs-2 text-center" style="padding:0px;">
                                          <button class="icon-markup-btn btn-modify-chat" title="Demo"><img src="images/15.png"></button>
                                        </div>
                                        <div class="col-xs-2 text-center" style="padding:0px;">
                                          <button class="icon-markup-btn btn-modify-chat" title="Demo"><img src="images/16.png"></button>
                                        </div>
                                        <div class="col-xs-2 text-center" style="padding:0px;">
                                          <button class="icon-markup-btn btn-modify-chat" title="Demo"><img src="images/17.png"></button>
                                        </div>
                                        <div class="col-xs-2 text-center" style="padding:0px;">
                                          <button class="icon-markup-btn btn-modify-chat" title="Demo"><img src="images/18.png"></button>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                </div>

                            </div>
                        </div>  

                    </div>
                </div>

            </div>
        </div>
    </section>

    <script src="node_modules/webrtcdevelopment/client/build/minScripts/webrtcdevelopment.js"></script>
    <script src="js/ve.js"> </script>

<script>

    //$('video' ).css('cursor', 'move').draggable().resizable();


  $('document').ready(function(){

    adjustelement();

    init(true , function (sessionid){

        var searchParams = new URLSearchParams(window.location);
        var role="participant",out_A=true, out_V=true ;

        if(searchParams.get('audio')=="0"){
          out_A=false;
        }

        if(searchParams.get('video')=="0"){
          out_V=false;
        }

        if(searchParams.get('name')){
          username=searchParams.get('name');
        }else{
          username="Expert";
        }

        if(searchParams.get('email')){
          useremail=searchParams.get('email');
        }else{
          useremail="abc@gmail.com";
        }

        if(searchParams.get('role')){
           role=searchParams.get('role');
        }else{
           role="participant";
        }

        var webrtcdomobj;

        console.log("searchParams" , searchParams);

        var local={
            video: "myAloneVideo",
            videoClass:"video-class",
            videoContainer : "singleVideoContainer",
            userDisplay:false,
            userMetaDisplay:false,
            userdetails:{
                username: username,
                usercolor: '#c7c2e6',
                useremail: useremail,
                role: role
            }
        };

        var remote={
            videoarr: ["myConferenceVideo", "otherConferenceVideo", "otherConferenceVideo2", "otherConferenceVideo3", "otherConferenceVideo4", "otherConferenceVideo5"],
            videoClass:"video-class",
            maxAllowed: 8,
            videoContainer : "confVideoContainer",
            userDisplay:false,
            userMetaDisplay:false,
            dynamicVideos: false ,
            userdetails:{
                username: 'REMOTE',
                usercolor: '#a69afe',
                useremail: 'unknown'
            }
        };

        var incoming={
          audio:  true,
          video:  true,
          data:   true,
          screen: true
        };

        var outgoing={
          audio:  true,
          video:  true,
          data:   true,
          screen: true
        };

        webrtcdomobj= new WebRTCdom(
          local, remote, incoming, outgoing
        );

        var session = {
            sessionid : sessionid,
            socketAddr: props.signaller,
            turn:{ 
                  username    : props.xirsys.username,
                  secretkey   : props.xirsys.secretkey,
                  domain      : props.xirsys.domain,
                  application : props.xirsys.application,
                  room        : props.xirsys.room,
                  secure      : props.xirsys.secure
            }
        };

        var widgets={
            debug       : false,
            reconnect   :{
                        active: true,
                        button:{
                            id: "reconnectBtn",
                            class:"btn btn-success glyphicon glyphicon-refresh topPanelButton",
                            html:"Reconnect",
                            resyncfiles:false
                        }
                    },
            timer   :{
                        active:true,
                        type: "backward",
                        counter:{
                            hours: "countdownHours",
                            minutes:"countdownMinutes",
                            seconds :"countdownSeconds"
                        },
                        upperlimit: {
                            hour:0 , 
                            min: 3 , 
                            sec: 60 
                        },
                        span:{
                            currentTime_id:"currentTimeArea",
                            currentTimeZone_id:"currentTimeZoneArea",
                            remoteTime_id :"remoteTimeArea",
                            remoteTimeZone_id:"remoteTimeZoneArea",
                            class_on:""
                        },
                        container:{
                            id:'timeContainer',
                            minbutton_id:'minimizeTimerButton'
                        }
                    },
            chat    :{
                        active: true,
                        container: {
                            id: "chatContainer"
                        },
                        inputBox:{
                            text_id:"chatInputText",
                            sendbutton_id:"chatSendButton",
                            minbutton_id:"minimizeChatButton"
                        },
                        chatBox:{
                            id: "chatBoard"
                        },
                        button:{
                            class_on:"btn btn-warning glyphicon glyphicon-font topPanelButton",
                            html_on:"Chat",
                            class_off:"btn btn-success glyphicon glyphicon-font topPanelButton",
                            html_off:"Chat"
                        }
                    },
            fileShare :{
                        active : true,
                        fileShareContainer : "fileSharingRow",
                        fileListContainer : "fileListingRow",
                        button:{
                          id: "fileshareBtn",
                          class:"btn btn-success glyphicon glyphicon-file topPanelButton",
                          html:"File"
                        },
                        props:{
                          fileShare:"single",   //Can be divided , chatpreview  , single   , hidden 
                          fileList:"single"     //Can be divided , single   , hidden
                        }
                      },
            mute    :{
                        active: true,
                        audio   :{
                                active: true,
                                button:{
                                    class_on:"pull-right btn btn-modify-video2 videoButtonClass on",
                                    html_on:"<i class='fa fa-microphone'></i>",
                                    class_off:"pull-right btn btn-modify-video2 videoButtonClass off",
                                    html_off:"<i class='fa fa-microphone'></i>"
                                }
                            },
                        video : {
                                active: true,
                                button:{
                                    class_on:"pull-right btn btn-modify-video2 videoButtonClass on",
                                    html_on:"<i class='fa fa-video-camera'></i>",
                                    class_off:"pull-right btn btn-modify-video2 videoButtonClass off",
                                    html_off:"<i class='fa fa-video-camera'></i>"
                                }
                            }
                    },
            videoRecord :{
                            active: true,
                            videoRecordContainer: true,
                            button:{
                                class_on:"pull-right btn btn-modify-video2 videoButtonClass on",
                                html_on:"<i class='fa fa-circle' title='Stop recording this Video'></i>",
                                class_off:"pull-right btn btn-modify-video2 videoButtonClass off",
                                html_off:"<i class='fa fa-circle' title='Record this Video'></i>"
                            }
                        },
            snapshot :{
                            active: true,
                            snapshotContainer: true,
                            button:{
                                class_on:"pull-right btn btn-modify-video2 videoButtonClass",
                                html_on:"<i class='fa fa-th-large' title='Take a snapshot'></i>"
                            }
                        }, 
            cursor :{
                        active : false,
                        button:{
                            id: 'shareCursorButton',
                            class_on:"pull-right btn btn-modify-video2 videoButtonClass On",
                            html_on:"<i class='fa fa-hand-o-up' title='Cursor'></i>",
                            class_off:"pull-right btn btn-modify-video2 videoButtonClass Off",
                            html_off:"<i class='fa fa-hand-o-up' title='Cursor'></i>"
                        }                   
                    },
            fullscreen :{
                        active : true,
                        pointer:{
                            class_on: "fa fa-hand-o-up fa-3x"
                        },
                        button:{
                            id: 'fullScreenButton',
                            class_on:"pull-right btn btn-modify-video2 videoButtonClass On",
                            html_on:"<i class='fa fa-laptop' title='full Screen'></i>",
                            class_off:"pull-right btn btn-modify-video2 videoButtonClass Off",
                            html_off:"<i class=' fa fa-laptop' title='full Screen'></i>"
                        }                   
                    },

            screenrecord:{
                        active : true,
                        videoRecordContainer: true,
                            button:{
                                id: "scrRecordBtn",
                                class_on:"col-xs-8 text-center On",
                                html_on:"Session is Recording <i class='fa fa-stop'></i>",
                                class_off:"col-xs-8 text-center Off",
                                html_off:"Session Record <i class='fa fa-circle'></i>"
                            }
                    },
                    
            screenshare : {
                            active:true,
                            screenshareContainer: "screenShareRow",
                            extensionID: props.extensionID,
                            button:{
                                installButton:{
                                    id:"scrInstallButton",
                                    class_on:"screeninstall-btn on",
                                    html_on:"Stop Install",
                                    class_off:"screeninstall-btn off",
                                    html_off:"Install Screen Share"
                                },
                                shareButton:{
                                    id:"scrShareButton",
                                    class_on:"screen-btn on",
                                    html_on:"Stop Sharing",
                                    class_off:"screen-btn off",
                                    html_off:"ScreenShare"
                                },
                                viewButton:{
                                    id:"scrViewButton",
                                    class_on:"btn btn-warning  glyphicon glyphicon-expand topPanelButton on",
                                    html_on:"Stop Viewing",
                                    class_off:"btn btn-success glyphicon glyphicon-expand topPanelButton off",
                                    html_off:"View Screen"
                                }
                            }
                    }
            };

            var webrtcdevobj = new WebRTCdev ( 
                session, widgets
            );

            startCall(webrtcdevobj);

            onSessionConnect=function(){
                adjustelement();
            };

        });

        document.getElementById(timerobj.container.id).hidden=true;

        onSessionConnect=function(){
            // Peer has connected 
            var allvids = document.getElementsByTagName("video");
            for (x in allvids) {
                if (document.getElementsByName(x) && document.getElementsByName(x).length>0 && document.getElementsByName(x)[0].src) {
                    console.log(" videoss.......................", document.getElementsByName(x)[0]);
                    //document.getElementsByName(x)[0].onplay = function(){
                            var count=0;
                            for (x in allvids) {
                                if (document.getElementsByName(x) && document.getElementsByName(x).length>0 && document.getElementsByName(x)[0].src) 
                                    count++;
                            }

                            if (count > 3) {
                                document.getElementsByClassName("leftDiv1").hidden = false;
                                //document.getElementById("leftDiv1").removeAttribute("hidden");
                                if(document.getElementById("centreDiv").classList.contains('col-md-10') )
                                {
                                    document.getElementById("centreDiv").classList.remove('col-md-10');
                                    document.getElementById("centreDiv").classList.add('col-md-8');
                                }
                            }
                            if (count > 5) {
                                document.getElementById("leftDiv2").hidden = false;
                                if(document.getElementById("centreDiv").classList.contains('col-md-8') )
                                {
                                    document.getElementById("centreDiv").classList.remove('col-md-8');
                                    document.getElementById("centreDiv").classList.add('col-md-6');
                                }
                            }

                            console.log("/////////////////////" , count);
                    //};
                }
            }
            
        };


    });


</script>

<!--  glyphicon glyphicon-hand-left-->
</body>
</html>
