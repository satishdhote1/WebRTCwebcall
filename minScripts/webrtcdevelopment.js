function init(e){var t;return e&&!location.hash.replace("#","").length?(location.href=location.href.split("#")[0]+"#"+(100*Math.random()).toString().replace(".",""),location.reload()):t=e&&location.hash.replace("#","").length?location.href.substring(0,location.href.indexOf("?")).replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""):prompt("Enter session ",""),t}function loadjscssfile(e,t){if("js"==t){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e)}else if("css"==t){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e)}"undefined"!=typeof n&&document.getElementsByTagName("head")[0].appendChild(n)}function loadScript(e,t){var n=document.createElement("script");n.src=e,n.async=!0,document.documentElement.appendChild(n)}function isData(e){return!e.audio&&!e.video&&!e.screen&&e.data}function isNull(e){return"undefined"==typeof e}function isString(e){return"string"==typeof e}function isEmpty(e){var t=0;for(var n in e)t++;return 0==t}function ab2str(e){var t="";try{t=String.fromCharCode.apply(null,new Uint16Array(e))}catch(n){}return t}function str2ab(e){isString(e)||(e=JSON.stringify(e));for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),r=0,o=e.length;r<o;r++)n[r]=e.charCodeAt(r);return t}function toStr(e){return JSON.stringify(e,function(e,t){return t&&t.sdp?(log(t.sdp.type,"\t",t.sdp.sdp),""):t},"\t")}function getLength(e){var t=0;for(var n in e)n&&t++;return t}function log(){console.log(arguments)}function error(){console.error(arguments)}function warn(){console.warn(arguments)}var t=" ",e=null,n="tara181989@gmail.com",selfuserid=null,remoteUserId=null,containerDiv,webcallpeers=[],sessions={},repeatFlagShowButton=null,repeatFlagHideButton=null,repeatFlagRemoveButton=null,localVideo=null,selfVideo=null,remoteVideos=[],localobj,remoteobj,selfusername="",selfemail="",selfcolor="",latitude="",longitude="",operatingsystem="",autoload=!0,sessionid=null,socketAddr="/",turn=null,webrtcdevIceServers,localStream,localStreamId,remoteStream,remoteStreamId,incomingAudio=!0,incomingVideo=!0,incomingData=!0,outgoingAudio=!0,outgoingVideo=!0,outgoingData=!0,debug=!1,chatobj=!1,chatContainer=null,fileshareobj=!1,screenrecordobj=!1,snapshotobj=!1,videoRecordobj=!1,videoRecordContainer=null,drawCanvasobj=!1,texteditorobj=!1,codeeditorobj=!1,editor=null,reconnectobj=!1,muteobj=!1,screenshareobj=!1,screen,isScreenOn=0,screen_roomid,screen_userid,role="participant";
"use strict";!function(){function e(e,o){function c(e){w.deletePeer(e)}function f(e){if(w.socketAutoReConnect=!0,w.socket)return void(e&&e(w.socket));if("undefined"==typeof n)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new n(w,function(n){e&&e(w.socket)})}function l(e,n){w.closeBeforeUnload&&(w.isInitiator===!0&&w.dontMakeMeModerator(),w.peers.getAllParticipants().forEach(function(e){S.onNegotiationNeeded({userLeft:!0},e),w.peers[e]&&w.peers[e].peer&&w.peers[e].peer.close(),delete w.peers[e]}),n||w.closeSocket(),w.broadcasters=[],w.isInitiator=!1)}function v(e,n){return e?(n.audio&&e.getAudioTracks().forEach(function(e){e.applyConstraints(n.audio)}),void(n.video&&e.getVideoTracks().forEach(function(e){e.applyConstraints(n.video)}))):void(w.enableLogs&&console.error("No stream to applyConstraints."))}function g(e,n,t){return n?void S.replaceTrack(e,n,t):void w.peers.getAllParticipants().forEach(function(n){S.replaceTrack(e,n,t)})}function h(){if(w.isInitiator&&!w.session.oneway&&!w.session.broadcast&&"many-to-many"===w.direction){var e=w.broadcasters[0],n=[];w.broadcasters.forEach(function(t){t!==e&&n.push(t)}),w.autoCloseEntireSession||w.shiftModerationControl(e,n,!0)}}o=o||{useDefaultDevices:!0};var w=this;w.channel=w.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var S=new t(w);S.onGettingLocalMedia=function(e){e.type="local",w.setStreamEndHandler(e),s(e,function(n){n.id=e.streamid,n.muted=!0,n.volume=0,-1===w.attachStreams.indexOf(e)&&w.attachStreams.push(e),"undefined"!=typeof K&&K.setHandlers(e,!0,w),w.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:n,userid:w.userid,extra:w.extra,streamid:e.streamid,blobURL:n.src||URL.createObjectURL(e),isAudioMuted:!0},i(w,w.streamEvents[e.streamid]),r(w,w.streamEvents[e.streamid]),w.onstream(w.streamEvents[e.streamid])},w)},S.onGettingRemoteMedia=function(e,n){e.type="remote",w.setStreamEndHandler(e,"remote-stream"),s(e,function(t){t.id=e.streamid,"undefined"!=typeof K&&K.setHandlers(e,!1,w),w.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:w.peers[n]?w.peers[n].extra:{},mediaElement:t,streamid:e.streamid,blobURL:t.src||URL.createObjectURL(e)},r(w,w.streamEvents[e.streamid]),w.onstream(w.streamEvents[e.streamid])},w)},S.onRemovingRemoteMedia=function(e,n){var t=w.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:w.peers[n]?w.peers[n].extra:{},streamid:e.streamid,mediaElement:w.streamEvents[e.streamid]?w.streamEvents[e.streamid].mediaElement:null}),w.onstreamended(t),delete w.streamEvents[e.streamid]},S.onNegotiationNeeded=function(e,n,t){f(function(){w.socket.emit(w.socketMessageEvent,"password"in e?e:{remoteUserId:e.remoteUserId||n,message:e,sender:w.userid},t||function(){})})},S.onUserLeft=c,S.disconnectWith=function(e,n){w.socket&&w.socket.emit("disconnect-with",e,n||function(){}),w.deletePeer(e)},w.broadcasters=[],w.socketOptions={transport:"polling"},w.openOrJoin=function(e,n){w.checkPresence(e,function(t,o){if("function"==typeof n&&(n(t,o),n=null),t){w.sessionid=o;var i=!1,r=!1,a=!!w.session.oneway,s=u(w.session);r={OfferToReceiveAudio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:w.sdpConstraints.mandatory.OfferToReceiveVideo},i={OfferToReceiveAudio:a?!!w.session.audio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:a?!!w.session.video||!!w.session.screen:w.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:w.sessionid,message:{newParticipationRequest:!0,isOneWay:a,isDataOnly:s,localPeerSdpConstraints:i,remotePeerSdpConstraints:r},sender:w.userid,password:n||!1};return void S.onNegotiationNeeded(d)}w.userid,w.userid=w.sessionid=e||w.sessionid,w.userid+="",w.socket.emit("changed-uuid",w.userid),n&&w.socket.emit("set-password",n),w.isInitiator=!0,u(w.session)||w.captureUserMedia()})},w.open=function(e,n){return w.userid,w.userid=w.sessionid=e||w.sessionid,w.userid+="",w.isInitiator=!0,f(function(){w.socket.emit("changed-uuid",w.userid),1==n&&w.becomePublicModerator()}),u(w.session)?void("function"==typeof n&&n()):void w.captureUserMedia("function"==typeof n?n:null)},w.becomePublicModerator=function(){w.isInitiator&&w.socket.emit("become-a-public-moderator")},w.dontMakeMeModerator=function(){w.socket.emit("dont-make-me-moderator")},w.deletePeer=function(e){if(e){if(w.onleave({userid:e,extra:w.peers[e]?w.peers[e].extra:{}}),w.peers[e]){w.peers[e].streams.forEach(function(e){e.stop()});var n=w.peers[e].peer;if(n&&"closed"!==n.iceConnectionState)try{n.close()}catch(t){}w.peers[e]&&(w.peers[e].peer=null,delete w.peers[e])}if(-1!==w.broadcasters.indexOf(e)){var o=[];w.broadcasters.forEach(function(n){n!==e&&o.push(n)}),w.broadcasters=o,h()}}},w.rejoin=function(e){if(!w.isInitiator&&e&&Object.keys(e).length){var n={};w.peers[e.remoteUserId]&&(n=w.peers[e.remoteUserId].extra,w.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(w.join(e.remoteUserId),w.onReConnecting({userid:e.remoteUserId,extra:n}))}},w.join=w.connect=function(e,n){w.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||w.sessionid,w.sessionid+="";var t=!1,o=!1,i=!1,r=!1;if(e&&e.session||!e||"string"==typeof e){var a=e?e.session||w.session:w.session;i=!!a.oneway,r=u(a),o={OfferToReceiveAudio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:w.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:i?!!w.session.audio:w.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i?!!w.session.video||!!w.session.screen:w.sdpConstraints.mandatory.OfferToReceiveVideo}}n=n||{};var s=function(){};"function"==typeof n&&(s=n,n={}),"undefined"!=typeof n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),"undefined"!=typeof n.remotePeerSdpConstraints&&(o=n.remotePeerSdpConstraints),"undefined"!=typeof n.isOneWay&&(i=n.isOneWay),"undefined"!=typeof n.isDataOnly&&(r=n.isDataOnly);var d={remoteUserId:w.sessionid,message:{newParticipationRequest:!0,isOneWay:i,isDataOnly:r,localPeerSdpConstraints:t,remotePeerSdpConstraints:o},sender:w.userid,password:!1};return f(function(){w.peers[w.sessionid]||(S.onNegotiationNeeded(d),s())}),d},w.connectWithAllParticipants=function(e){S.onNegotiationNeeded("connectWithAllParticipants",e||w.sessionid)},w.removeFromBroadcastersList=function(e){S.onNegotiationNeeded("removeFromBroadcastersList",e||w.sessionid),w.peers.getAllParticipants(e||w.sessionid).forEach(function(e){S.onNegotiationNeeded("dropPeerConnection",e),w.deletePeer(e)}),w.attachStreams.forEach(function(e){e.stop()})},w.getUserMedia=w.captureUserMedia=function(e,n){e=e||function(){};var t=n||w.session;return w.dontCaptureUserMedia||u(t)?void e():void((t.audio||t.video||t.screen)&&(t.screen?w.getScreenConstraints(function(o,i){if(o)throw o;alert("connection get user media screen_constraints"),w.invokeGetUserMedia({audio:!!m(w)&&p(i),video:i,isScreen:!0},function(o){if((t.audio||t.video)&&!m(w)){var i={};for(var r in t)"screen"!==r&&(i[r]=t[r]);return void w.invokeGetUserMedia(n,e,i)}e(o)})}):(t.audio||t.video)&&w.invokeGetUserMedia(n,e,t)))},w.closeBeforeUnload=!0,window.addEventListener("beforeunload",l,!1),w.userid=a(),w.changeUserId=function(e,n){w.userid=e||a(),w.socket.emit("changed-uuid",w.userid,n||function(){})},w.extra={},w.attachStreams=[],w.session={audio:!0,video:!0},w.enableFileSharing=!1,w.bandwidth={screen:512,audio:128,video:512},w.codecs={audio:"opus",video:"VP9"},w.processSdp=function(e){return L||A?e:(e=_.setApplicationSpecificBandwidth(e,w.bandwidth,!!w.session.screen),e=_.setVideoBitrates(e,{min:8*w.bandwidth.video*1024,max:8*w.bandwidth.video*1024}),e=_.setOpusAttributes(e,{maxaveragebitrate:8*w.bandwidth.audio*1024,maxplaybackrate:8*w.bandwidth.audio*1024,stereo:1,maxptime:3}),"VP9"===w.codecs.video&&(e=_.preferVP9(e)),"H264"===w.codecs.video&&(e=_.removeVPX(e)),"G722"===w.codecs.audio&&(e=_.removeNonG722(e)),e)},"undefined"!=typeof _&&(w.BandwidthHandler=w.CodecsHandler=_),w.mediaConstraints={audio:{mandatory:{},optional:[{bandwidth:8*w.bandwidth.audio*1024||1048576}]},video:{mandatory:{},optional:[{bandwidth:8*w.bandwidth.video*1024||1048576},{facingMode:"user"}]}},A&&(w.mediaConstraints={audio:!0,video:!0}),o.useDefaultDevices||L||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(t){"audioinput"===t.kind&&w.mediaConstraints.audio!==!1&&(e=t),"videoinput"===t.kind&&w.mediaConstraints.video!==!1&&(n=t)}),e){if(A)return void(w.mediaConstraints.audio!==!0?w.mediaConstraints.audio.deviceId=e.id:w.mediaConstraints.audio={deviceId:e.id});1==w.mediaConstraints.audio&&(w.mediaConstraints.audio={mandatory:{},optional:[]}),w.mediaConstraints.audio.optional||(w.mediaConstraints.audio.optional=[]);var t=[{sourceId:e.id}];w.mediaConstraints.audio.optional=t.concat(w.mediaConstraints.audio.optional)}if(n){if(A)return void(w.mediaConstraints.video!==!0?w.mediaConstraints.video.deviceId=n.id:w.mediaConstraints.video={deviceId:n.id});1==w.mediaConstraints.video&&(w.mediaConstraints.video={mandatory:{},optional:[]}),w.mediaConstraints.video.optional||(w.mediaConstraints.video.optional=[]);var t=[{sourceId:n.id}];w.mediaConstraints.video.optional=t.concat(w.mediaConstraints.video.optional)}}),w.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},w.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},w.iceServers=$.getIceServers(w),w.candidates={host:!0,stun:!0,turn:!0},w.iceProtocols={tcp:!0,udp:!0},w.onopen=function(e){w.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},w.onclose=function(e){w.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},w.onerror=function(e){w.enableLogs&&console.error(e.userid,"data-error",e)},w.onmessage=function(e){w.enableLogs&&console.debug("data-message",e.userid,e.data)},w.send=function(e,n){w.peers.send(e,n)},w.close=w.disconnect=w.leave=function(){l(!1,!0)},w.closeEntireSession=function(e){e=e||function(){},w.socket.emit("close-entire-session",function n(){return w.getAllParticipants().length?void setTimeout(n,100):(w.onEntireSessionClosed({sessionid:w.sessionid,userid:w.userid,extra:w.extra}),void w.changeUserId(null,function(){w.close(),e()}))})},w.onEntireSessionClosed=function(e){w.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},w.onstream=function(e){var n=w.videosContainer;n.insertBefore(e.mediaElement,n.firstChild),e.mediaElement.play(),setTimeout(function(){e.mediaElement.play()},5e3)},w.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},w.direction="many-to-many",w.removeStream=function(e){var n;return w.attachStreams.forEach(function(t){t.id===e&&(n=t)}),n?(w.peers.getAllParticipants().forEach(function(e){var t=w.peers[e];try{t.peer.removeStream(n)}catch(o){}}),void w.renegotiate()):void console.warn("No such stream exists.",e)},w.addStream=function(e,n){function t(t){e.streamCallback&&e.streamCallback(t),w.renegotiate(n)}return e.getAudioTracks?(-1===w.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),w.attachStreams.push(e)),void w.renegotiate(n)):u(e)?void w.renegotiate(n):void((e.audio||e.video||e.screen)&&(e.screen?w.getScreenConstraints(function(n,o){return n?alert(n):void w.invokeGetUserMedia({audio:!!m(w)&&p(o),video:o,isScreen:!0},!e.audio&&!e.video||m(w)?t:w.invokeGetUserMedia(null,t))}):(e.audio||e.video)&&w.invokeGetUserMedia(null,t)))},w.invokeGetUserMedia=function(e,n,t){t||(t=w.session),e||(e=w.mediaConstraints),k({onGettingLocalMedia:function(t){var o=e.video;o&&(o.mediaSource||o.mozMediaSource?t.isScreen=!0:o.mandatory&&o.mandatory.chromeMediaSource&&(t.isScreen=!0)),t.isScreen||(t.isVideo=t.getVideoTracks().length,t.isAudio=!t.isVideo&&t.getAudioTracks().length),S.onGettingLocalMedia(t),n&&n(t)},onLocalMediaError:function(e,n){S.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!t.audio&&e.audio,video:!!t.video&&e.video}})},w.applyConstraints=function(e,n){if(!H||!H.prototype.applyConstraints)return void alert("track.applyConstraints is NOT supported in your browser.");if(n){var t;return w.streamEvents[n]&&(t=w.streamEvents[n].stream),void v(t,e)}w.attachStreams.forEach(function(n){v(n,e)})},w.replaceTrack=function(e,n,t){function o(o){w.replaceTrack(o,n,t||e.video||e.screen)}if(e=e||{},!G.prototype.getSenders)return void w.addStream(e);if(e instanceof H)return void g(e,n,t);if(e instanceof F)return e.getVideoTracks().length&&g(e.getVideoTracks()[0],n,!0),void(e.getAudioTracks().length&&g(e.getAudioTracks()[0],n,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?w.getScreenConstraints(function(n,t){return n?alert(n):void w.invokeGetUserMedia({audio:!!m(w)&&p(t),video:t,isScreen:!0},!e.audio&&!e.video||m(w)?o:w.invokeGetUserMedia(null,o))}):(e.audio||e.video)&&w.invokeGetUserMedia(null,o))},w.resetTrack=function(e,n){e||(e=w.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var t=w.peers[e].peer;"undefined"!=typeof n&&n!==!0||!t.lastVideoTrack||w.replaceTrack(t.lastVideoTrack,e,!0),"undefined"!=typeof n&&n!==!1||!t.lastAudioTrack||w.replaceTrack(t.lastAudioTrack,e,!1)})},w.renegotiate=function(e){return e?void S.renegotiatePeer(e):void w.peers.getAllParticipants().forEach(function(e){S.renegotiatePeer(e)})},w.setStreamEndHandler=function(e,n){e&&e.addEventListener&&(n=!!n,e.alreadySetEndHandler||(e.alreadySetEndHandler=!0,e.addEventListener("ended",function(){e.idInstance&&Y.remove(e.idInstance),n||delete w.attachStreams[w.attachStreams.indexOf(e)];var t=w.streamEvents[e.streamid];t||(t={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:w.userid,extra:w.extra,mediaElement:w.streamEvents[e.streamid]?w.streamEvents[e.streamid].mediaElement:null}),(t.userid!==w.userid||"remote"!==t.type)&&(w.onstreamended(t),delete w.streamEvents[e.streamid])},!1)))},w.onMediaError=function(e,n){w.enableLogs&&console.error(e,n)},w.addNewBroadcaster=function(e,n){w.broadcasters.length&&setTimeout(function(){S.connectNewParticipantWithAllBroadcasters(e,n,w.broadcasters.join("|-,-|"))},1e4),w.session.oneway||w.session.broadcast||"many-to-many"!==w.direction||-1!==w.broadcasters.indexOf(e)||(w.broadcasters.push(e),h())},w.autoCloseEntireSession=!1,w.filesContainer=w.videosContainer=document.body||document.documentElement,w.isInitiator=!1,w.shareFile=S.shareFile,"undefined"!=typeof te&&te.handle(w),"undefined"!=typeof oe&&oe.handle(w),w.token=a,w.onNewParticipant=function(e,n){w.acceptParticipationRequest(e,n)},w.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),S.createNewPeer(e,n)},w.onShiftedModerationControl=function(e,n){w.acceptModerationControl(e,n)},w.acceptModerationControl=function(e,n){w.isInitiator=!0,w.broadcasters=n,w.peers.getAllParticipants().forEach(function(n){S.onNegotiationNeeded({changedUUID:e,oldUUID:w.userid,newUUID:e},n)}),w.userid=e,w.socket.emit("changed-uuid",w.userid)},w.shiftModerationControl=function(e,n,t){S.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:n,firedOnLeave:!!t},e)},"undefined"!=typeof K&&(w.StreamsHandler=K),w.onleave=function(e){},w.invokeSelectFileDialog=function(e){var n=new FileSelector;n.selectSingleFile(e)},w.getPublicModerators=function(e,n){"function"==typeof e&&(n=e),f(function(){w.socket.emit("get-public-moderators","string"==typeof e?e:"",n)})},w.onmute=function(e){e&&e.mediaElement&&("both"===e.muteType||"video"===e.muteType?(e.mediaElement.src=null,e.mediaElement.pause(),e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"):"audio"===e.muteType&&(e.mediaElement.muted=!0))},w.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.src=URL.createObjectURL(e.stream),e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},w.onExtraDataUpdated=function(e){e.status="online",w.onUserStatusChanged(e,!0)},w.onJoinWithPassword=function(e){console.warn(e,"is password protected. Please join with password.")},w.onInvalidPassword=function(e,n){console.warn(e,"is password protected. Please join with valid password. Your old password",n,"is wrong.")},w.onPasswordMaxTriesOver=function(e){console.warn(e,"is password protected. Your max password tries exceeded the limit.")},w.getAllParticipants=function(e){return w.peers.getAllParticipants(e)},"undefined"!=typeof K&&(K.onSyncNeeded=function(e,n,t){w.peers.getAllParticipants().forEach(function(o){S.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:t||"both"},o)})}),w.connectSocket=function(e){f(e)},w.socketAutoReConnect=!0,w.closeSocket=function(){try{io.sockets={}}catch(e){}w.socket&&(w.socketAutoReConnect=!1,"function"==typeof w.socket.disconnect&&w.socket.disconnect(),w.socket=null)},w.getSocket=function(e){return w.socket?e&&e(w.socket):f(e),w.socket},w.getRemoteStreams=S.getRemoteStreams;var C=["selectFirst","selectAll","forEach"];if(w.streamEvents={selectFirst:function(e){if(!e){var n;for(var t in w.streamEvents)-1!==C.indexOf(t)||n||(n=w.streamEvents[t]);return n}},selectAll:function(){}},w.socketURL="/",w.socketMessageEvent="RTCMultiConnection-Message",w.socketCustomEvent="RTCMultiConnection-Custom-Message",w.DetectRTC=DetectRTC,w.setCustomSocketEvent=function(e){e&&(w.socketCustomEvent=e),w.socket&&w.socket.emit("set-custom-socket-event-listener",w.socketCustomEvent)},w.getNumberOfBroadcastViewers=function(e,n){w.socket&&e&&n&&w.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},w.onNumberOfBroadcastViewersUpdated=function(e){w.enableLogs&&w.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},w.onUserStatusChanged=function(e,n){w.enableLogs&&!n&&console.info(e.userid,e.status)},w.getUserMediaHandler=k,w.multiPeersHandler=S,w.enableLogs=!0,w.setCustomSocketHandler=function(e){"undefined"!=typeof n&&(n=e)},w.chunkSize=65e3,w.maxParticipantsAllowed=1e3,w.disconnectWith=S.disconnectWith,w.checkPresence=function(e,n){return w.socket?void w.socket.emit("check-presence",(e||w.sessionid)+"",n):void w.connectSocket(function(){w.checkPresence(e,n)})},w.onReadyForOffer=function(e,n){w.multiPeersHandler.createNewPeer(e,n)},w.setUserPreferences=function(e){return w.dontAttachStream&&(e.dontAttachLocalStream=!0),w.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},w.updateExtraData=function(){w.socket.emit("extra-data-updated",w.extra)},w.enableScalableBroadcast=!1,w.maxRelayLimitPerUser=3,w.dontCaptureUserMedia=!1,w.dontAttachStream=!1,w.dontGetRemoteStream=!1,w.onReConnecting=function(e){w.enableLogs&&console.info("ReConnecting with",e.userid,"...")},w.beforeAddingStream=function(e){return e},w.beforeRemovingStream=function(e){return e},"undefined"!=typeof P&&(w.checkIfChromeExtensionAvailable=P),"undefined"!=typeof R&&(w.checkIfChromeExtensionAvailable=R),"undefined"!=typeof E&&(w.getChromeExtensionStatus=E),w.getScreenConstraints=function(e,n){m(w,n)&&(n=!0),O(function(n,t){n||(t=w.modifyScreenConstraints(t),e(n,t))},n)},w.modifyScreenConstraints=function(e){return e},w.onPeerStateChanged=function(e){w.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},w.isOnline=!0,d("online",function(){w.isOnline=!0}),d("offline",function(){w.isOnline=!1}),w.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(w.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),w.isLowBandwidth)){if(w.bandwidth={audio:30,video:30,screen:30},w.mediaConstraints.audio&&w.mediaConstraints.audio.optional&&w.mediaConstraints.audio.optional.length){var y=[];w.mediaConstraints.audio.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&y.push(e)}),w.mediaConstraints.audio.optional=y}if(w.mediaConstraints.video&&w.mediaConstraints.video.optional&&w.mediaConstraints.video.optional.length){var y=[];w.mediaConstraints.video.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&y.push(e)}),w.mediaConstraints.video.optional=y}}w.getExtraData=function(e){if(!e)throw"remoteUserId is required.";return w.peers[e]?w.peers[e].extra:{}},o.autoOpenOrJoin&&w.openOrJoin(w.sessionid),w.onUserIdAlreadyTaken=function(e,n){w.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",n),w.join(e)},w.trickleIce=!0}function n(e,n){var t="";t+="?userid="+e.userid,t+="&msgEvent="+e.socketMessageEvent,t+="&socketCustomEvent="+e.socketCustomEvent,e.enableScalableBroadcast&&(t+="&enableScalableBroadcast=true",t+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),e.socketCustomParameters&&(t+=e.socketCustomParameters);try{io.sockets={}}catch(o){}try{e.socket=io((e.socketURL||"/")+t)}catch(o){e.socket=io.connect((e.socketURL||"/")+t,e.socketOptions)}var i=e.multiPeersHandler;e.socket.on("extra-data-updated",function(n,t){e.peers[n]&&(e.peers[n].extra=t,e.onExtraDataUpdated({userid:n,extra:t}))}),e.socket.on(e.socketMessageEvent,function(n){if(n.remoteUserId==e.userid){if(e.peers[n.sender]&&e.peers[n.sender].extra!=n.message.extra&&(e.peers[n.sender].extra=n.extra,e.onExtraDataUpdated({userid:n.sender,extra:n.extra})),n.message.streamSyncNeeded&&e.peers[n.sender]){var t=e.streamEvents[n.message.streamid];if(!t||!t.stream)return;var o=n.message.action;if("ended"===o||"stream-removed"===o)return void e.onstreamended(t);var r="both"!=n.message.type?n.message.type:null;return void t.stream[o](r)}if("connectWithAllParticipants"===n.message)return-1===e.broadcasters.indexOf(n.sender)&&e.broadcasters.push(n.sender),void i.onNegotiationNeeded({allParticipants:e.getAllParticipants(n.sender)},n.sender);if("removeFromBroadcastersList"===n.message)return void(-1!==e.broadcasters.indexOf(n.sender)&&(delete e.broadcasters[e.broadcasters.indexOf(n.sender)],e.broadcasters=c(e.broadcasters)));if("dropPeerConnection"===n.message)return void e.deletePeer(n.sender);if(n.message.allParticipants)return-1===n.message.allParticipants.indexOf(n.sender)&&n.message.allParticipants.push(n.sender),void n.message.allParticipants.forEach(function(n){i[e.peers[n]?"renegotiatePeer":"createNewPeer"](n,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:u(e.session)})});if(n.message.newParticipant){if(n.message.newParticipant==e.userid)return;if(e.peers[n.message.newParticipant])return;return void i.createNewPeer(n.message.newParticipant,n.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:u(e.session)})}if((n.message.readyForOffer||n.message.addMeAsBroadcaster)&&e.addNewBroadcaster(n.sender),n.message.newParticipationRequest&&n.sender!==e.userid){e.peers[n.sender]&&e.deletePeer(n.sender);var a={extra:n.extra||{},localPeerSdpConstraints:n.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:n.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:"undefined"!=typeof n.message.isDataOnly?n.message.isDataOnly:u(e.session),dontGetRemoteStream:"undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!n.message.dontGetRemoteStream,connectionDescription:n,successCallback:function(){("undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction)&&e.addNewBroadcaster(n.sender,a),(e.session.oneway||"one-way"===e.direction||u(e.session))&&e.addNewBroadcaster(n.sender,a)}};return void e.onNewParticipant(n.sender,a)}return n.message.shiftedModerationControl?void e.onShiftedModerationControl(n.sender,n.message.broadcasters):(n.message.changedUUID&&e.peers[n.message.oldUUID]&&(e.peers[n.message.newUUID]=e.peers[n.message.oldUUID],delete e.peers[n.message.oldUUID]),n.message.userLeft?(i.onUserLeft(n.sender),void(n.message.autoCloseEntireSession&&e.leave())):void i.addNegotiatedMessage(n.message,n.sender))}}),e.socket.on("user-left",function(n){onUserLeft(n),e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]?e.peers[n].extra||{}:{}}),e.onleave({userid:n,extra:{}})}),e.socket.on("connect",function(){return e.socketAutoReConnect?(e.enableLogs&&console.info("socket.io connection is opened."),e.socket.emit("extra-data-updated",e.extra),void(n&&n(e.socket))):void(e.socket=null)}),e.socket.on("disconnect",function(){return e.socketAutoReConnect?void(e.enableLogs&&(console.info("socket.io connection is closed"),console.warn("socket.io reconnecting"))):void(e.socket=null)}),e.socket.on("join-with-password",function(n){e.onJoinWithPassword(n)}),e.socket.on("invalid-password",function(n,t){e.onInvalidPassword(n,t)}),e.socket.on("password-max-tries-over",function(n){e.onPasswordMaxTriesOver(n)}),e.socket.on("user-disconnected",function(n){n!==e.userid&&(e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]?e.peers[n].extra||{}:{}}),e.deletePeer(n))}),e.socket.on("user-connected",function(n){n!==e.userid&&e.onUserStatusChanged({userid:n,status:"online",extra:e.peers[n]?e.peers[n].extra||{}:{}})}),e.socket.on("closed-entire-session",function(n,t){e.leave(),e.onEntireSessionClosed({sessionid:n,userid:n,extra:t})}),e.socket.on("userid-already-taken",function(n,t){e.isInitiator=!1,e.userid=t,e.onUserIdAlreadyTaken(n,t)}),e.socket.on("logs",function(n){e.enableLogs&&console.debug("server-logs",n)}),e.socket.on("number-of-broadcast-viewers-updated",function(n){e.onNumberOfBroadcastViewersUpdated(n)})}function t(e){function n(n,t,i){var r={};e.attachStreams.forEach(function(e){r[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=r,o.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},i)}function t(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}var o=this,i=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var e=0;for(var n in this)-1==i.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==i.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var t in this)-1==i.indexOf(t)&&t!=e&&n.push(t);return n},forEach:function(n){this.getAllParticipants().forEach(function(t){n(e.peers[t])})},send:function(n,t){var i=this;if(!f(n.size)&&!f(n.type))return void o.shareFile(n,t);if(!("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView))return void ne.send({text:n,channel:this,connection:e,remoteUserId:t});if("text"===n.type&&(n=JSON.stringify(n)),t){var r=e.peers[t];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(n)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){i.send(n,t)},3e3))}this.getAllParticipants().forEach(function(t){return i[t].channels.length?void i[t].channels.forEach(function(e){e.send(n)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){i[t].channels.forEach(function(e){e.send(n)})},3e3))})}},this.uuid=e.userid,this.getLocalConfig=function(n,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){o.onNegotiationNeeded(e,i)},onLocalCandidate:function(n){n=J.processCandidates(e,n),n&&o.onNegotiationNeeded(n,i)},remoteSdp:n,onDataChannelMessage:function(n){if(!e.fbr&&e.enableFileSharing&&t(),"string"==typeof n||!e.enableFileSharing)return void o.onDataChannelMessage(n,i);var r=this;return n instanceof ArrayBuffer||n instanceof DataView?void e.fbr.convertToObject(n,function(e){r.onDataChannelMessage(e)}):n.readyForNextChunk?void e.fbr.getNextChunk(n.uuid,function(n,t){e.peers[i].channels.forEach(function(e){e.send(n)})},i):void e.fbr.addChunk(n,function(n){e.peers[i].peer.channel.send(n)})},onDataChannelError:function(e){o.onDataChannelError(e,i)},onDataChannelOpened:function(e){o.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){o.onDataChannelClosed(e,i)},onRemoteStream:function(n){if(e.peers[i].streams.push(n),N&&window.PluginRTC){var t=document.createElement("video"),r=e.videosContainer;return r.insertBefore(t,r.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(t,n)},3e3)}o.onGettingRemoteMedia(n,i)},onRemoteStreamRemoved:function(e){o.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){o.onPeerStateChanged(e),"new"===e.iceConnectionState&&o.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&o.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(o.onUserLeft(i),o.disconnectWith(i))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!t.streamsToShare&&(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n);var o=this.getLocalConfig(null,n,t);e.peers[n]=new h(o)}},this.createAnsweringPeer=function(n,t,o){o=e.setUserPreferences(o||{},t);var i=this.getLocalConfig(n,t,o);e.peers[t]=new h(i)},this.renegotiatePeer=function(n,t,o){if(!e.peers[n])return void(e.enableLogs&&console.error("This peer ("+n+") does not exists. Renegotiation skipped."));t||(t={}),t.renegotiatingPeer=!0,t.peerRef=e.peers[n].peer,t.channels=e.peers[n].channels;var i=this.getLocalConfig(o,n,t);e.peers[n]=new h(i)},this.replaceTrack=function(n,t,o){if(!e.peers[t])throw"This peer ("+t+") does not exists.";var i=e.peers[t].peer;return i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?void i.getSenders().forEach(function(i){o&&i.track instanceof VideoStreamTrack&&(e.peers[t].peer.lastVideoTrack=i.track,i.replaceTrack(n)),!o&&i.track instanceof AudioStreamTrack&&(e.peers[t].peer.lastAudioTrack=i.track,
i.replaceTrack(n))}):(console.warn("RTPSender.replaceTrack is NOT supported."),void this.renegotiatePeer(t))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(t,i){function r(e){n(e,t,i)}if(t.type&&t.sdp)return"answer"==t.type&&e.peers[i]&&e.peers[i].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(i,null,t):this.createAnsweringPeer(t,i)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[i]&&e.peers[i].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));if(t.enableMedia){if(e.attachStreams.length||e.dontCaptureUserMedia){var a={};return e.attachStreams.forEach(function(e){a[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=a,void o.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},i)}var s={},d=t.userPreferences;d.localPeerSdpConstraints.OfferToReceiveAudio&&(s.audio=e.mediaConstraints.audio),d.localPeerSdpConstraints.OfferToReceiveVideo&&(s.video=e.mediaConstraints.video);var c=d.session||e.session;c.oneway&&c.audio&&"two-way"===c.audio&&(c={audio:!0}),(c.audio||c.video||c.screen)&&(c.screen?e.getScreenConstraints(function(n,t){e.invokeGetUserMedia({audio:!!m(e)&&p(t),video:t,isScreen:!0},!c.audio&&!c.video||m(e)?r:e.invokeGetUserMedia(null,r))}):(c.audio||c.video)&&e.invokeGetUserMedia(null,r,c))}t.readyForOffer&&e.onReadyForOffer(i,t.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(e,n,t){if(t=t.split("|-,-|"),t.length){var i=t[0];o.onNegotiationNeeded({newParticipant:e,userPreferences:n||!1},i),delete t[0];var r=[];t.forEach(function(e){e&&r.push(e)}),setTimeout(function(){o.connectNewParticipantWithAllBroadcasters(e,n,r.join("|-,-|"))},1e4)}},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(n,t){e.onMediaError(n,t)},this.shareFile=function(n,o){if(!e.enableFileSharing)throw'"connection.enableFileSharing" is false.';t(),e.fbr.readAsArrayBuffer(n,function(n){var t=e.getAllParticipants();o&&(t=[o]),t.forEach(function(t){e.fbr.getNextChunk(n,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:A?15e3:e.chunkSize||0})};var r=new x(e);this.onDataChannelMessage=function(n,t){r.receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(n,t){n.userid=t,n.extra=e.peers[t]?e.peers[t].extra:{},e.onclose(n)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){return e.peers[t].channels.length?void(e.peers[t].channels=[n]):(e.peers[t].channels.push(n),void e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]},this.isPluginRTC=e.isPluginRTC=N}function o(e,n,t){if("undefined"!=typeof CustomEvent){var o={arguments:t,__exposedProps__:t},i=new CustomEvent(n,o);e.dispatchEvent(i)}}function i(e,n){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(t,o){e.onvolumechange&&e.onvolumechange(merge({volume:t,threshold:o},n))}})}}function r(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(t){t=e.streamEvents[n.streamid],t.session={audio:"audio"===t.muteType,video:"video"===t.muteType},e.onmute(t)},!1),n.stream.addEventListener("unmute",function(t){t=e.streamEvents[n.streamid],t.session={audio:"audio"===t.unmuteType,video:"video"===t.unmuteType},e.onunmute(t)},!1))}function a(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,o=e.length;o>t;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function s(e,n,t){var o=!1;e.getVideoTracks&&!e.getVideoTracks().length&&(o=!0);var i=document.createElement(o?"audio":"video");return N&&window.PluginRTC?(t.videosContainer.insertBefore(i,t.videosContainer.firstChild),void setTimeout(function(){window.PluginRTC.attachMediaStream(i,e),n(i)},1e3)):(i[A?"mozSrcObject":"src"]=A?e:window.URL.createObjectURL(e),i.controls=!0,A&&i.addEventListener("ended",function(){if(Y.remove(e.idInstance),"local"===e.type){K.onSyncNeeded(e.streamid,"ended"),t.attachStreams.forEach(function(n,o){e.streamid===n.streamid&&delete t.attachStreams[o]});var n=[];t.attachStreams.forEach(function(e){e&&n.push(e)}),t.attachStreams=n;var o=t.streamEvents[e.streamid];if(o)return void t.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}},!1),i.play(),void n(i))}function d(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function c(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function f(e){return"undefined"==typeof e}function l(e){return"string"==typeof e}function m(e,n){return(!e.session.audio||"two-way"!==e.session.audio)&&(!(!A||n===!1)||!(!D||50>W)&&(typeof n===!0||!("undefined"!=typeof n||!e.session.audio||!e.session.screen||e.session.video)&&(n=!0,!0)))}function p(e){return!!A||!!D&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function v(){if("iOS"===DetectRTC.osName&&"undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),e.registerGlobals()}}function g(e){var n,t={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return n={mandatory:t,optional:[{VoiceActivityDetection:!1}]},navigator.mozGetUserMedia&&B>34&&(n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}),n}function h(e){function n(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},s.channel=n}function t(n){s[n](function(n){n.sdp=i.processSdp(n.sdp),s.setLocalDescription(n,function(){i.trickleIce&&e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:i?i.extra:{},streamsToShare:p,isFirefoxOffered:A})},function(e){i.enableLogs&&console.error("setLocalDescription error",e)})},function(e){i.enableLogs&&console.error("sdp-error",e)},q.sdpConstraints)}if(!G)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var i=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:i.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription;var r=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var a={};q.sdpConstraints=g({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var s,d=!!e.renegotiatingPeer;e.remoteSdp&&(d=!!e.remoteSdp.renegotiatingPeer);var c=[];if(i.attachStreams.forEach(function(e){e&&c.push(e)}),d)s=e.peerRef;else{var u="all";(i.candidates.turn||i.candidates.relay)&&(i.candidates.stun||i.candidates.reflexive||i.candidates.host||(u="relay")),s=new G(navigator.onLine?{iceServers:i.iceServers,iceTransports:u}:null,window.PluginRTC?null:i.optionalArgument)}s.onicecandidate=function(n){if(n.candidate)i.trickleIce&&e.onLocalCandidate({candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex});else if(!i.trickleIce){var t=s.localDescription;e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:r.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:i?i.extra:{},streamsToShare:p,isFirefoxOffered:A})}};var f=!A;e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.isFirefoxOffered&&(f=!0),c.forEach(function(n){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(n=i.beforeAddingStream(n),n&&(s.getLocalStreams().forEach(function(e){e.id==n.id&&(n=null)}),n&&s.addStream(n)))}),s.oniceconnectionstatechange=s.onsignalingstatechange=function(){var n=r.extra;i.peers[r.userid]&&(n=i.peers[r.userid].extra||n),s&&e.onPeerStateChanged({iceConnectionState:s.iceConnectionState,iceGatheringState:s.iceGatheringState,signalingState:s.signalingState,extra:n,userid:r.userid})};var l={OfferToReceiveAudio:!!c.length,OfferToReceiveVideo:!!c.length};e.localPeerSdpConstraints&&(l=e.localPeerSdpConstraints),q.sdpConstraints=g(l),s.onaddstream=function(n){var t={};e.remoteSdp&&e.remoteSdp.streamsToShare?t=e.remoteSdp.streamsToShare:e.streamsToShare&&(t=e.streamsToShare);var i=t[n.stream.id];i&&(n.stream.isAudio=i.isAudio,n.stream.isVideo=i.isVideo,n.stream.isScreen=i.isScreen),n.stream.streamid=n.stream.id,n.stream.stop||(n.stream.stop=function(){A&&o(this,"ended")}),a[n.stream.id]=n.stream,e.onRemoteStream(n.stream)},s.onremovestream=function(n){n.stream.streamid=n.stream.id,a[n.stream.id]&&delete a[n.stream.id],e.onRemoteStreamRemoved(n.stream)},this.addRemoteCandidate=function(e){s.addIceCandidate(new z(e))},this.addRemoteSdp=function(e,n){e.sdp=i.processSdp(e.sdp),s.setRemoteDescription(new j(e),n||function(){},function(n){i.enableLogs&&console.error(JSON.stringify(n,null,"   "),"\n",e.type,e.sdp)})};var m=!0;e.remoteSdp&&(m=!1),this.createDataChannel=function(){var e=s.createDataChannel("sctp",{});n(e)},i.session.data!==!0||d||(m?this.createDataChannel():s.ondatachannel=function(e){var t=e.channel;n(t)}),e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(l=e.remoteSdp.remotePeerSdpConstraints),q.sdpConstraints=g(l),this.addRemoteSdp(e.remoteSdp,function(){t("createAnswer")})),("two-way"==i.session.audio||"two-way"==i.session.video||"two-way"==i.session.screen)&&(q.sdpConstraints=g({OfferToReceiveAudio:"two-way"==i.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==i.session.video||"two-way"==i.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var p={};s.getLocalStreams().forEach(function(e){p[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),m&&t("createOffer"),s.nativeClose=s.close,s.close=function(){if(s){try{-1===s.iceConnectionState.search(/closed|failed/gi)&&s.getRemoteStreams().forEach(function(e){e.stop()}),s.nativeClose()}catch(e){}s=null,r.peer=null}},this.peer=s}function w(e,n){if(!X){if(!n)return w(e,!0);X=!0;var t=document.createElement("iframe");t.onload=function(){function n(t){t.data&&t.data.iceServers&&(e(t.data.iceServers),window.removeEventListener("message",n))}t.isLoaded=!0,d("message",n),t.contentWindow.postMessage("get-ice-servers","*")},t.src="https://cdn.webrtc-experiment.com/getIceServers/",t.style.display="none",(document.body||document.documentElement).appendChild(t)}}function S(e){var n="urls";N&&(n="url");var t={};return t[n]=e,t}function C(e,n,t){var o="urls";N&&(o="url");var i={username:n,credential:t};return i[o]=e,i}function y(){var e=[];return window.RMCExternalIceServers.forEach(function(n){n.urls||(n.urls=n.url),-1!==n.urls.search("stun|stuns")&&e.push(S(n.urls)),-1!==n.urls.search("turn|turns")&&e.push(C(n.urls,n.username,n.credential))}),e}function b(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}function k(e){function n(n,o){b(e.localMediaConstraints,n),e.onGettingLocalMedia(n,o),n.addEventListener("ended",function(){delete Y.streams[t],Y.mutex=!1,Y.queueRequests.indexOf(e)&&(delete Y.queueRequests[Y.queueRequests.indexOf(e)],Y.queueRequests=c(Y.queueRequests))},!1),Y.streams[t]={stream:n},Y.mutex=!1,Y.queueRequests.length&&k(Y.queueRequests.shift())}if(Y.mutex===!0)return void Y.queueRequests.push(e);Y.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(Y.streams[t])n(Y.streams[t].stream,!0);else{if(N&&window.PluginRTC)return document.createElement("video"),void window.PluginRTC.getUserMedia({audio:!0,video:!0},function(e){e.streamid=e.id||a(),n(e)},function(e){});var o=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(o||"undefined"==typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=t,n(e)},function(n){e.onLocalMediaError(n,e.localMediaConstraints)});navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||a(),e.idInstance=t,n(e)})["catch"](function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}function T(e){if("PermissionDeniedError"==e){if(ee="PermissionDeniedError",Z)return Z("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"==e&&(ee="desktop"),e.sourceId&&Z&&Z(Q=e.sourceId)}function P(e){if(e){if(A)return R(e);if("desktop"==ee)return e(!0);window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"!=ee)},2e3)}}function R(e){function n(o){var i=o.data;i&&"undefined"!=typeof i.isScreenCapturingEnabled&&(t=!0,e(i.isScreenCapturingEnabled===!0),window.removeEventListener("message",n,!1))}if(e){if(!A)return P(e);var t=!1;window.addEventListener("message",n,!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){t||e(!0)},2e3)}}function E(e,n){if(2!=arguments.length&&(n=e,e=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),A)return n("not-chrome");var t=document.createElement("img");t.src="chrome-extension://"+e+"/icon.png",t.onload=function(){ee="screen",window.postMessage("are-you-there","*"),setTimeout(function(){n("screen"==ee?e==e?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},t.onerror=function(){n("not-installed")}}function O(e,n){var t={mozMediaSource:"window",mediaSource:"window",width:29999,height:8640};return A?e(null,t):void P(function(t){var o={mandatory:{chromeMediaSource:ee,maxWidth:29999,maxHeight:8640,minFrameRate:30,maxFrameRate:128,minAspectRatio:1.77},optional:[]};return"desktop"!=ee||Q?("desktop"==ee&&(o.mandatory.chromeMediaSourceId=Q),void e(null,o)):void getSourceId(function(){o.mandatory.chromeMediaSourceId=Q,e("PermissionDeniedError"==Q?Q:null,o),Q=null},n)})}function x(e){function n(n,o,i){var r=n.uuid;if(t[r]||(t[r]=[]),t[r].push(n.message),n.last){var a=t[r].join("");n.isobject&&(a=JSON.parse(a));var s=(new Date).getTime(),d=s-n.sendingTime,c={data:a,userid:o,extra:i,latency:d};e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(n){c.data=n,e.onmessage(c)})):e.onmessage(c),delete t[r]}}var t={};return{receive:n}}var M=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,A="undefined"!=typeof window.InstallTrigger,I=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,D=!!window.chrome&&!M,U=!!document.documentMode,L=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);"undefined"!=typeof cordova&&(L=!0,D=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(L=!0,D=!0);var N=!L&&(I||U);N&&"undefined"!=typeof URL&&(URL.createObjectURL=function(){});var W=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),50),V=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);D&&V&&V[2]&&(W=parseInt(V[2],10));var B=50;V=navigator.userAgent.match(/Firefox\/(.*)/),A&&V&&V[1]&&(B=parseInt(V[1],10)),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,o){e.addEventListener(n,t,o)};var F=window.MediaStream;"undefined"==typeof F&&"undefined"!=typeof webkitMediaStream&&(F=webkitMediaStream),"undefined"!=typeof F&&("getVideoTracks"in F.prototype||(F.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(n){-1!==n.kind.toString().indexOf("video")&&e.push(n)}),e},F.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(n){-1!==n.kind.toString().indexOf("audio")&&e.push(n)}),e}),"stop"in F.prototype||(F.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})})),function(){function e(){var e,n,t,o=(c.appVersion,c.userAgent),i=c.appName,r=""+parseFloat(c.appVersion),a=parseInt(c.appVersion,10);if(l){i="Opera";try{r=c.userAgent.split("OPR/")[1].split(" ")[0],a=r.split(".")[0]}catch(s){r="0.0.0.0",a=0}}else g?(n=o.indexOf("MSIE"),i="IE",r=o.substring(n+5)):v?(n=o.indexOf("Chrome"),i="Chrome",r=o.substring(n+7)):p?(n=o.indexOf("Safari"),i="Safari",r=o.substring(n+7),-1!==(n=o.indexOf("Version"))&&(r=o.substring(n+8))):m?(n=o.indexOf("Firefox"),i="Firefox",r=o.substring(n+8)):(e=o.lastIndexOf(" ")+1)<(n=o.lastIndexOf("/"))&&(i=o.substring(e,n),r=o.substring(n+1),i.toLowerCase()===i.toUpperCase()&&(i=c.appName));return f&&(i="Edge",r=parseInt(c.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),-1!==(t=r.indexOf(";"))&&(r=r.substring(0,t)),-1!==(t=r.indexOf(" "))&&(r=r.substring(0,t)),a=parseInt(""+r,10),isNaN(a)&&(r=""+parseFloat(c.appVersion),a=parseInt(c.appVersion,10)),{fullVersion:r,version:a,name:i,isPrivateBrowsing:!1}}function n(e,n){var t=0,o=50,i=!1,r=window.setInterval(function(){e()&&(window.clearInterval(r),n(i)),t++>o&&(window.clearInterval(r),i=!0,n(i))},10)}function t(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&parseInt(t[1],10)>=10)}function o(e){var o;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){o=!1},function(e){console.log(e),o=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{i=window.indexedDB.open("test")}catch(r){o=!0}"undefined"==typeof o&&n(function(){return"done"===i.readyState},function(e){e||(o=!i.result)})}else if(t(window.navigator.userAgent)){o=!1;try{window.indexedDB||(o=!0)}catch(r){o=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(r){o=!0}"undefined"==typeof o&&(o=!1,window.localStorage.removeItem("test"))}n(function(){return"undefined"!=typeof o},function(n){e(o)})}function i(){var e="-",n=c.appVersion,t=c.userAgent,o=e,i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var r in i){var a=i[r];if(a.r.test(t)){o=a.s;break}}var s=e;switch(/Windows/.test(o)&&(/Windows (.*)/.test(o)&&(s=/Windows (.*)/.exec(o)[1]),o="Windows"),o){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(t)&&(s=/Mac OS X (10[\.\_\d]+)/.exec(t)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(t)&&(s=/Android ([\.\_\d]+)/.exec(t)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(t)&&(s=/OS (\d+)_(\d+)_?(\d+)?/.exec(n),s=s[1]+"."+s[2]+"."+(0|s[3]))}return{osName:o,osVersion:s}}function r(e){D.isWebRTCSupported&&(D.isORTCSupported||a(function(n){e(n.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+n:"Public: "+n)}))}function a(e){function n(n){var o=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,i=o.exec(n);if(!i)return void console.warn("Could not match IP address in",n);var r=i[1];void 0===t[r]&&e(r),t[r]=!0}var t={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,i=!!window.webkitRTCPeerConnection;if(!o){var r=document.getElementById("iframe");if(!r)throw"NOTE: you need to have an iframe in the page right above the script tag.";var a=r.contentWindow;o=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection,i=!!a.webkitRTCPeerConnection}if(o){var s,d={optional:[{RtpDataChannels:!0}]};i&&(s={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof D&&D.browser.isFirefox&&D.browser.version<=38&&(s[0]={url:s[0].urls}));var c=new o(s,d);c.onicecandidate=function(e){e.candidate&&n(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&n(e)})},1e3)}}function s(e){return E?(!c.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(c.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!c.enumerateDevices&&c.enumerateDevices&&(c.enumerateDevices=c.enumerateDevices.bind(c)),c.enumerateDevices?(k=[],T=[],P=[],R=[],void c.enumerateDevices(function(n){n.forEach(function(e){var n={};for(var t in e)n[t]=e[t];"audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput");var o;k.forEach(function(e){e.id===n.id&&e.kind===n.kind&&(o=!0)}),o||(n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||I||(I=!0),"audioinput"!==n.kind||A||(A=!0)):(n.label="Please invoke getUserMedia once.","https:"!==location.protocol&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(O=!0,-1===T.indexOf(n)&&T.push(n)),"audiooutput"===n.kind&&(x=!0,-1===P.indexOf(n)&&P.push(n)),"videoinput"===n.kind&&(M=!0,-1===R.indexOf(n)&&R.push(n)),-1===k.indexOf(n)&&k.push(n))}),"undefined"!=typeof D&&(D.MediaDevices=k,D.hasMicrophone=O,D.hasSpeakers=x,D.hasWebcam=M,D.isWebsiteHasWebcamPermissions=I,D.isWebsiteHasMicrophonePermissions=A,D.audioInputDevices=T,D.audioOutputDevices=P,D.videoInputDevices=R),e&&e()})):void(e&&e())):void(e&&e())}var d="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:d,getUserMedia:function(){}},e.window=global):"undefined"==typeof window,"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var c=window.navigator;"undefined"!=typeof c?("undefined"!=typeof c.webkitGetUserMedia&&(c.getUserMedia=c.webkitGetUserMedia),"undefined"!=typeof c.mozGetUserMedia&&(c.getUserMedia=c.mozGetUserMedia)):c={getUserMedia:function(){},userAgent:d};var u=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(c.userAgent||""),f=!(-1===c.userAgent.indexOf("Edge")||!c.msSaveOrOpenBlob&&!c.msSaveBlob),l=!!window.opera||c.userAgent.indexOf(" OPR/")>=0,m="undefined"!=typeof window.InstallTrigger,p=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,v=!!window.chrome&&!l,g=!!document.documentMode&&!f,h={Android:function(){return c.userAgent.match(/Android/i)},BlackBerry:function(){return c.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return c.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return c.userAgent.match(/Opera Mini/i)},Windows:function(){return c.userAgent.match(/IEMobile/i)},any:function(){return h.Android()||h.BlackBerry()||h.iOS()||h.Opera()||h.Windows()},getOsName:function(){var e="Unknown OS";return h.Android()&&(e="Android"),h.BlackBerry()&&(e="BlackBerry"),h.iOS()&&(e="iOS"),h.Opera()&&(e="Opera Mini"),h.Windows()&&(e="Windows"),e}},w="Unknown OS",S="Unknown OS Version";if(h.any())w=h.getOsName();else{var C=i();w=C.osName,S=C.osVersion}var y=!1,b=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){!y&&e in document.createElement("canvas")&&(y=!0),!b&&e in document.createElement("video")&&(b=!0)});var k=[],T=[],P=[],R=[];c.mediaDevices&&c.mediaDevices.enumerateDevices&&(c.enumerateDevices=function(e){c.mediaDevices.enumerateDevices().then(e)["catch"](function(){e([])})});var E=!1;"undefined"!=typeof H&&"getSources"in H?E=!0:c.mediaDevices&&c.mediaDevices.enumerateDevices&&(E=!0);var O=!1,x=!1,M=!1,A=!1,I=!1;s();var D=window.DetectRTC||{};D.browser=e(),o(function(e){D.browser.isPrivateBrowsing=!!e}),D.browser["is"+D.browser.name]=!0;var U=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){U||e in window&&(U=!0)}),D.isWebRTCSupported=U,D.isORTCSupported="undefined"!=typeof RTCIceGatherer;var L=!1;D.browser.isChrome&&D.browser.version>=35?L=!0:D.browser.isFirefox&&D.browser.version>=34&&(L=!0),"https:"!==location.protocol&&(L=!1),D.isScreenCapturingSupported=L;var N={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){N.isSupported||e in window&&(N.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(N.isCreateMediaStreamSourceSupported=!0))}),D.isAudioContextSupported=N.isSupported,D.isCreateMediaStreamSourceSupported=N.isCreateMediaStreamSourceSupported;var W=!1;D.browser.isChrome&&D.browser.version>31&&(W=!0),D.isRtpDataChannelsSupported=W;var V=!1;D.browser.isFirefox&&D.browser.version>28?V=!0:D.browser.isChrome&&D.browser.version>25?V=!0:D.browser.isOpera&&D.browser.version>=11&&(V=!0),D.isSctpDataChannelsSupported=V,D.isMobileDevice=u;var B=!1;c.getUserMedia?B=!0:c.mediaDevices&&c.mediaDevices.getUserMedia&&(B=!0),D.browser.isChrome&&D.browser.version>=46&&"https:"!==location.protocol&&(D.isGetUserMediaSupported="Requires HTTPs"),D.isGetUserMediaSupported=B,D.osName=w,D.osVersion=S;var F="";if(screen.width){var G=screen.width?screen.width:"",q=screen.height?screen.height:"";F+=""+G+" x "+q}D.displayResolution=F,D.isCanvasSupportsStreamCapturing=y,D.isVideoSupportsStreamCapturing=b,D.DetectLocalIPAddress=r,D.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,D.isWebSocketsBlocked=!D.isWebSocketsSupported,D.checkWebSocketsSupport=function(e){e=e||function(){};try{var n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){D.isWebSocketsBlocked=!1,e(),n.close(),n=null},n.onerror=function(){D.isWebSocketsBlocked=!0,e()}}catch(t){D.isWebSocketsBlocked=!0,e()}},D.load=function(e){e=e||function(){},s(e)},D.MediaDevices=k,D.hasMicrophone=O,D.hasSpeakers=x,D.hasWebcam=M,D.isWebsiteHasWebcamPermissions=I,D.isWebsiteHasMicrophonePermissions=A,D.audioInputDevices=T,D.audioOutputDevices=P,D.videoInputDevices=R;var j=!1;"setSinkId"in document.createElement("video")&&(j=!0),D.isSetSinkIdSupported=j;var z=!1;D.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(z=!0):D.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(z=!0),D.isRTPSenderReplaceTracksSupported=z;var _=!1;D.browser.isFirefox&&D.browser.version>38&&(_=!0),D.isRemoteStreamProcessingSupported=_;var X=!1;"undefined"!=typeof H&&"applyConstraints"in H.prototype&&(X=!0),D.isApplyConstraintsSupported=X;var J=!1;D.browser.isFirefox&&D.browser.version>=43&&(J=!0),D.isMultiMonitorScreenCapturingSupported=J,D.isPromisesSupported=!!("Promise"in window),"undefined"==typeof D&&(window.DetectRTC={});var $=window.MediaStream;"undefined"==typeof $&&"undefined"!=typeof webkitMediaStream&&($=webkitMediaStream),"undefined"!=typeof $?D.MediaStream=Object.keys($.prototype):D.MediaStream=!1,"undefined"!=typeof H?D.MediaStreamTrack=Object.keys(H.prototype):D.MediaStreamTrack=!1;var Y=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"!=typeof Y?D.RTCPeerConnection=Object.keys(Y.prototype):D.RTCPeerConnection=!1,window.DetectRTC=D,"undefined"!=typeof module&&(module.exports=D),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return D})}(),document.addEventListener("deviceready",v,!1),v();var G,q={};"undefined"!=typeof mozRTCPeerConnection?G=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection?G=webkitRTCPeerConnection:"undefined"!=typeof window.RTCPeerConnection&&(G=window.RTCPeerConnection);var j=window.RTCSessionDescription||window.mozRTCSessionDescription,z=window.RTCIceCandidate||window.mozRTCIceCandidate,H=window.MediaStreamTrack;window.onPluginRTCInitialized=function(){H=window.PluginRTC.MediaStreamTrack,G=window.PluginRTC.RTCPeerConnection,z=window.PluginRTC.RTCIceCandidate,j=window.PluginRTC.RTCSessionDescription},"undefined"!=typeof window.PluginRTC&&window.onPluginRTCInitialized();var _=function(){function e(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtpmap:100 VP8/90000\r\n",""),e=e.replace("a=rtpmap:101 VP9/90000\r\n",""),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 100/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF ([0-9 ]*) 101/g,"m=video $1 RTP/SAVPF $2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 100([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace(/m=video ([0-9]+) RTP\/SAVPF 101([0-9 ]*)/g,"m=video $1 RTP/SAVPF$2"),e=e.replace("a=rtcp-fb:120 nack\r\n",""),e=e.replace("a=rtcp-fb:120 nack pli\r\n",""),e=e.replace("a=rtcp-fb:120 ccm fir\r\n",""),e=e.replace("a=rtcp-fb:101 nack\r\n",""),e=e.replace("a=rtcp-fb:101 nack pli\r\n",""),e=e.replace("a=rtcp-fb:101 ccm fir\r\n","")}function n(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=e.replace("a=rtcp-fb:126 nack\r\n",""),e=e.replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n"),e=e.replace("a=rtcp-fb:97 nack\r\n",""),e=e.replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n");
}function t(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var t=n.getParameters(),o=0;o<t.codecs.length;o++)if(t.codecs[o].mimeType==e){t.codecs.unshift(t.codecs.splice(o,1));break}n.setParameters(t)})}}function o(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function i(e,n,t){return n?"undefined"!=typeof A&&A?e:l?e:(t&&(n.screen?n.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&t&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video||n.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t?n.screen:n.video)+"\r\n")),e):e}function r(e,n,t){return a(e,0,-1,n,t)}function a(e,n,t,o,i){for(var r=-1!==t?t:e.length,a=n;r>a;++a)if(0===e[a].indexOf(o)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null}function s(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=e.match(n);return t&&2===t.length?t[1]:null}function d(e,n){if(l)return e;n=n||{};var t,o=n.min,i=n.max,a=e.split("\r\n"),d=r(a,"a=rtpmap","VP8/90000");if(d&&(t=s(a[d])),!t)return e;var c,u=r(a,"a=rtpmap","rtx/90000");if(u&&(c=s(a[u])),!u)return e;var f=r(a,"a=fmtp:"+c.toString());if(null!==f){var m="\r\n";m+="a=fmtp:"+t+" x-google-min-bitrate="+(o||"228")+"; x-google-max-bitrate="+(i||"228"),a[f]=a[f].concat(m),e=a.join("\r\n")}return e}function c(e,n){if(l)return e;n=n||{};var t,o=e.split("\r\n"),i=r(o,"a=rtpmap","opus/48000");if(i&&(t=s(o[i])),!t)return e;var a=r(o,"a=fmtp:"+t.toString());if(null===a)return e;var d="";return d+="; stereo="+("undefined"!=typeof n.stereo?n.stereo:"1"),d+="; sprop-stereo="+("undefined"!=typeof n["sprop-stereo"]?n["sprop-stereo"]:"1"),"undefined"!=typeof n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),"undefined"!=typeof n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),"undefined"!=typeof n.cbr&&(d+="; cbr="+("undefined"!=typeof n.cbr?n.cbr:"1")),"undefined"!=typeof n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),"undefined"!=typeof n.usedtx&&(d+="; usedtx="+n.usedtx),"undefined"!=typeof n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),o[a]=o[a].concat(d),e=o.join("\r\n")}function u(e){return-1===e.indexOf("SAVPF 100 101")||-1===e.indexOf("VP9/90000")?e:e.replace("SAVPF 100 101","SAVPF 101 100")}function f(e){for(var n=e.split("\r\n"),t=null,o=0;o<n.length;o++)if(-1!==n[o].search("opus/48000")){var i=extractSdp(n[o],/:(\d+) opus\/48000/i);break}for(var o=0;o<n.length;o++)if(-1!==n[o].search("a=fmtp")){var r=extractSdp(n[o],/a=fmtp:(\d+)/);if(r===i){t=o;break}}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}var l=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i);return"undefined"!=typeof cordova&&(l=!0),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(l=!0),{removeVPX:e,disableNACK:n,prioritize:t,removeNonG722:o,setApplicationSpecificBandwidth:function(e,n,t){return i(e,n,t)},setVideoBitrates:function(e,n){return d(e,n)},setOpusAttributes:function(e,n){return c(e,n)},preferVP9:u,forceStereoAudio:f}}();window.BandwidthHandler=_;var X,J=function(){function e(e,n){var t=n.candidate,o=e.candidates,i=o.stun,r=o.turn;if(f(o.reflexive)||(i=o.reflexive),f(o.relay)||(r=o.relay),(o.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(i||!t.match(/typ srflx/g))){var a=e.iceProtocols;if((a.udp||!t.match(/ udp /g))&&(a.tcp||!t.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}}return{processCandidates:e}}();"undefined"!=typeof window.getExternalIceServers&&1==window.getExternalIceServers&&w(function(e){e&&e.length&&(window.RMCExternalIceServers=e,window.iceServersLoadCallback&&"function"==typeof window.iceServersLoadCallback&&window.iceServersLoadCallback(e))});var $=function(){function e(e){var n=[];return n.push(S("stun:stun.l.google.com:19302")),n.push(C("turn:webrtcweb.com:80","muazkh","muazkh")),n.push(C("turn:webrtcweb.com:443","muazkh","muazkh")),window.RMCExternalIceServers?n=n.concat(y()):"undefined"!=typeof window.getExternalIceServers&&1==window.getExternalIceServers&&(e.iceServers=n,window.iceServersLoadCallback=function(){e.iceServers=e.iceServers.concat(y())}),n}return{getIceServers:e}}(),Y={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){n=n.stream;var t=n.currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=c(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}},K=function(){function e(e){return e?"string"==typeof e||"undefined"==typeof e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0:void 0}function n(n,i,r){function a(){if(r.streamEvents[n.streamid].mediaElement){var e=r.streamEvents[n.streamid].mediaElement;e.volume=0,t(200,5,function(){e.volume+=.2})}}n&&n.addEventListener&&(("undefined"==typeof i||1==i)&&n.addEventListener("ended",function(){K.onSyncNeeded(this.streamid,"ended")},!1),n.mute=function(t,a){t=e(t),"undefined"!=typeof a&&(i=a),("undefined"==typeof t||"audio"==t)&&n.getAudioTracks().forEach(function(e){e.enabled=!1,r.streamEvents[n.streamid].isAudioMuted=!0}),("undefined"==typeof t||"video"==t)&&n.getVideoTracks().forEach(function(e){e.enabled=!1}),("undefined"==typeof i||1==i)&&K.onSyncNeeded(n.streamid,"mute",t),r.streamEvents[n.streamid].muteType=t||"both",o(n,"mute",t)},n.unmute=function(t,s){t=e(t),"undefined"!=typeof s&&(i=s),a(),("undefined"==typeof t||"audio"==t)&&n.getAudioTracks().forEach(function(e){e.enabled=!0,r.streamEvents[n.streamid].isAudioMuted=!1}),("undefined"==typeof t||"video"==t)&&(n.getVideoTracks().forEach(function(e){e.enabled=!0}),"undefined"!=typeof t&&"video"==t&&r.streamEvents[n.streamid].isAudioMuted&&!function d(e){e||(e=0),e++,100>e&&r.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){d(e)},50))}()),("undefined"==typeof i||1==i)&&K.onSyncNeeded(n.streamid,"unmute",t),r.streamEvents[n.streamid].unmuteType=t||"both",o(n,"unmute",t)})}function t(e,n,o,i){i=(i||0)+1,i>=n||setTimeout(function(){o(),t(e,n,o,i)},e)}return{setHandlers:n,onSyncNeeded:function(e,n,t){}}}();window.addEventListener("message",function(e){e.origin==window.location.origin&&T(e.data)});var Q,Z,ee="screen",ne={send:function(e){function n(e,r){var a={type:"text",uuid:u,sendingTime:f};e&&(r=e,a.packets=parseInt(r.length/s)),r.length>s?a.message=r.slice(0,s):(a.message=r,a.last=!0,a.isobject=c),o.send(a,i),d=r.slice(a.message.length),d.length&&setTimeout(function(){n(null,d)},t.chunkInterval||100)}var t=e.connection,o=e.channel,i=e.remoteUserId,r=e.text,s=t.chunkSize||1e3,d="",c=!1;l(r)||(c=!0,r=JSON.stringify(r));var u=a(),f=(new Date).getTime();n(r)}},te=function(){function e(e){function n(e,n){if(-1!==e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}var t={};e.onFileStart=function(n){var o=document.createElement("div");return o.title=n.name,o.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(o.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),n.remoteUserId?(t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(t[n.uuid][n.remoteUserId].progress.max=n.maxChunks)):(t[n.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks))},e.onFileProgress=function(e){var o=t[e.uuid];o&&(!e.remoteUserId||(o=t[e.uuid][e.remoteUserId]))&&(o.progress.value=e.currentPosition||e.maxChunks||o.progress.max,n(o.progress,o.label))},e.onFileEnd=function(e){var n=t[e.uuid];if(!n)return void console.error("No such progress-helper element exists.",e);if(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId])){var o=n.div;-1!=e.type.indexOf("image")?o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}}return{handle:e}}(),oe=function(){function e(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,t){var o=document.createElement("script");o.type="text/javascript";var i=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"===e.error.message&&(warn('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var a="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;o.src=a,document.getElementsByTagName("head")[0].appendChild(o)}}}return{handle:e}}();window.RTCMultiConnection=e}();
"use strict";function getSourceId(e,n){if(!e)throw'"callback" parameter is mandatory.';return sourceId?(e(sourceId),void(sourceId=null)):(screenCallback=e,n?void window.postMessage("audio-plus-tab","*"):void window.postMessage("webrtcdev-extension-getsourceId","*"))}function getChromeExtensionStatus(e,n){if(2!=arguments.length&&(n=e,e=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),isFirefox)return n("not-chrome");var t=document.createElement("img");t.src="chrome-extension://"+e+"/icon.png",t.onload=function(){chromeMediaSource="screen",window.postMessage("webrtcdev-extension-presence","*"),setTimeout(function(){n("screen"==chromeMediaSource?e==e?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},t.onerror=function(){n("not-installed")}}function isChromeExtensionAvailable(e){if(e){if(isFirefox)return isFirefoxExtensionAvailable(e);if("desktop"==chromeMediaSource)return e(!0);window.postMessage("webrtcdev-extension-presence","*"),setTimeout(function(){e("screen"!=chromeMediaSource)},2e3)}}function webrtcdevPrepareScreenShare(){roomid="screenshare_"+rtcMultiConnection.channel,connection=new RTCMultiConnection,connection.socketURL=socketAddr,connection.socketMessageEvent="screen-sharing-demo",connection.session={screen:!0,oneway:!0},connection.iceServers=rtcMultiConnection.iceServers,connection.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},connection.videosContainer=document.getElementById(screenshareobj.screenshareContainer),connection.onstream=function(e){console.log(" on stream in _screenshare :",e),e.stream.isScreen&&(document.getElementById(screenshareobj.screenshareContainer).innerHTML="",createScreenViewButton(),screenStreamId=e.streamid,connection.videosContainer.appendChild(e.mediaElement),e.mediaElement.play(),setTimeout(function(){e.mediaElement.play()},5e3))},connection.onstreamended=function(e){console.log(" onstreamended in _screenshare :",e),document.getElementById(screenshareobj.screenshareContainer).innerHTML="",connection.removeStream(screenStreamId),connection.videosContainer.hidden=!0,screenShareButton.className=screenshareobj.button.shareButton.class_off,screenShareButton.innerHTML=screenshareobj.button.shareButton.html_off,removeScreenViewButton()}}function webrtcdevScreenConstraints(e){screen_constraints={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}},console.log(screen_constraints,connection),connection.getScreenConstraints=function(e){alert("getScreenConstraints"),screen_constraints=connection.modifyScreenConstraints(screen_constraints),console.log("screen_constraints",screen_constraints),e(!1,screen_constraints)}}function webrtcdevSharescreen(e){connection.open(e,function(){shownotification(" Making a new session for screenshare"+e),rtcMultiConnection.send({type:"screenshare",message:e})})}function webrtcdevViewscreen(e){connection.join(e)}function webrtcdevStopShareScreen(){window.postMessage("webrtcdev-extension-stopsource","*"),connection.removeStream(screenStreamId),connection.videosContainer.hidden=!0,removeScreenViewButton()}function createScreenViewButton(){if(!document.getElementById("viewScreenShareButton")){var e=document.createElement("span");e.className=screenshareobj.button.viewButton.class_off,e.innerHTML=screenshareobj.button.viewButton.html_off,e.id="viewScreenShareButton",webrtcdevViewscreen(roomid),e.onclick=function(){e.className==screenshareobj.button.viewButton.class_off?(document.getElementById(screenshareobj.screenshareContainer).hidden=!1,e.className=screenshareobj.button.viewButton.class_on,e.innerHTML=screenshareobj.button.viewButton.html_on):e.className==screenshareobj.button.viewButton.class_on&&(document.getElementById(screenshareobj.screenshareContainer).hidden=!0,e.className=screenshareobj.button.viewButton.class_off,e.innerHTML=screenshareobj.button.viewButton.html_off)};var n=document.createElement("li");n.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(n)}}function removeScreenViewButton(){var e=document.getElementById("viewScreenShareButton");e.parentElement.removeChild(e)}function createScreenInstallButton(e){var n=document.createElement("span");n.className=screenshareobj.button.installButton.class_off,n.innerHTML=screenshareobj.button.installButton.html_off,n.id="screeninstallButton",n.onclick=function(t){chrome.webstore.install("https://chrome.google.com/webstore/detail/"+e,function(){console.log("Chrome extension inline installation - success"),n.hidden=!0,createScreenshareButton()},function(e){console.log("Chrome extension inline installation - fail ",e)}),t.preventDefault()};var t=document.createElement("li");t.appendChild(n),document.getElementById("topIconHolder_ul").appendChild(t)}function createScreenshareButton(){var e;e=document.createElement("span"),e.className=screenshareobj.button.shareButton.class_off,e.innerHTML=screenshareobj.button.shareButton.html_off,e.id="screenShareButton",e.onclick=function(n){e.className==screenshareobj.button.shareButton.class_off?(webrtcdevSharescreen(roomid),e.className=screenshareobj.button.shareButton.class_on,e.innerHTML=screenshareobj.button.shareButton.html_on):e.className==screenshareobj.button.shareButton.class_on&&(e.className=screenshareobj.button.shareButton.class_off,e.innerHTML=screenshareobj.button.shareButton.html_off,webrtcdevStopShareScreen())};var n=document.createElement("li");n.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(n)}function onScreenshareExtensionCallback(e){console.log("onScreenshareExtensionCallback",e),e.data.chromeExtensionStatus&&console.log(e.data.chromeExtensionStatus),e.data.sourceId&&("PermissionDeniedError"===e.data.sourceId?console.log("permission-denied"):webrtcdevScreenConstraints(e.data.sourceId))}function detectExtensionScreenshare(e){getChromeExtensionStatus(e,function(n){console.log("detectExtensionScreenshare for ",e," -> ",n),"installed-enabled"==n&&createScreenshareButton(),"installed-disabled"==n&&(shownotification("chrome extension is installed but disabled."),createScreenshareButton()),"not-installed"==n&&createScreenInstallButton(e),webrtcdevPrepareScreenShare()})}var chromeMediaSource="screen",sourceId,screen_constraints,screenStreamId,isFirefox="undefined"!=typeof window.InstallTrigger,isOpera=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isChrome=!!window.chrome&&!isOpera,isMobileDevice=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),connection,screenCallback,iceServers=[],signaler,screen,roomid;window.addEventListener("message",onScreenshareExtensionCallback);
var WebRTCdetect=function(){"use strict";function e(){var e,i,n,o=(c.appVersion,c.userAgent),r=c.appName,t=""+parseFloat(c.appVersion),s=parseInt(c.appVersion,10);if(w){r="Opera";try{t=c.userAgent.split("OPR/")[1].split(" ")[0],s=t.split(".")[0]}catch(d){t="0.0.0.0",s=0}}else v?(i=o.indexOf("MSIE"),r="IE",t=o.substring(i+5)):S?(i=o.indexOf("Chrome"),r="Chrome",t=o.substring(i+7)):m?(i=o.indexOf("Safari"),r="Safari",t=o.substring(i+7),(i=o.indexOf("Version"))!==-1&&(t=o.substring(i+8))):f?(i=o.indexOf("Firefox"),r="Firefox",t=o.substring(i+8)):(e=o.lastIndexOf(" ")+1)<(i=o.lastIndexOf("/"))&&(r=o.substring(e,i),t=o.substring(i+1),r.toLowerCase()===r.toUpperCase()&&(r=c.appName));return p&&(r="Edge",t=parseInt(c.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10).toString()),(n=t.indexOf(";"))!==-1&&(t=t.substring(0,n)),(n=t.indexOf(" "))!==-1&&(t=t.substring(0,n)),s=parseInt(""+t,10),isNaN(s)&&(t=""+parseFloat(c.appVersion),s=parseInt(c.appVersion,10)),{fullVersion:t,version:s,name:r,isPrivateBrowsing:!1}}function i(e,i){var n=0,o=50,r=!1,t=window.setInterval(function(){e()&&(window.clearInterval(t),i(r)),n++>o&&(window.clearInterval(t),r=!0,i(r))},10)}function n(e){var i=e.toLowerCase();if(0===i.indexOf("msie")&&0===i.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(i);return!!(n&&parseInt(n[1],10)>=10)}function o(e){var o;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){o=!1},function(e){console.log(e),o=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var r;try{r=window.indexedDB.open("test")}catch(t){o=!0}"undefined"==typeof o&&i(function(){return"done"===r.readyState},function(e){e||(o=!r.result)})}else if(n(window.navigator.userAgent)){o=!1;try{window.indexedDB||(o=!0)}catch(t){o=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(t){o=!0}"undefined"==typeof o&&(o=!1,window.localStorage.removeItem("test"))}i(function(){return"undefined"!=typeof o},function(i){e(o)})}function r(){var e="-",i=c.appVersion,n=c.userAgent,o=e,r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var t in r){var s=r[t];if(s.r.test(n)){o=s.s;break}}var d=e;switch(/Windows/.test(o)&&(/Windows (.*)/.test(o)&&(d=/Windows (.*)/.exec(o)[1]),o="Windows"),o){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(n)&&(d=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(n)&&(d=/Android ([\.\_\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(d=/OS (\d+)_(\d+)_?(\d+)?/.exec(i),d=d[1]+"."+d[2]+"."+(0|d[3]))}return{osName:o,osVersion:d}}function t(e){I.isWebRTCSupported&&(I.isORTCSupported||s(function(i){e(i.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?"Local: "+i:"Public: "+i)}))}function s(e){function i(i){var o=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,r=o.exec(i);if(!r)return void console.warn("Could not match IP address in",i);var t=r[1];void 0===n[t]&&e(t),n[t]=!0}var n={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,r=!!window.webkitRTCPeerConnection;if(!o){var t=document.getElementById("iframe");if(!t)throw"NOTE: you need to have an iframe in the page right above the script tag.";var s=t.contentWindow;o=s.RTCPeerConnection||s.mozRTCPeerConnection||s.webkitRTCPeerConnection,r=!!s.webkitRTCPeerConnection}if(o){var d,a={optional:[{RtpDataChannels:!0}]};r&&(d={iceServers:[{urls:"stun:stun.services.mozilla.com"}]},"undefined"!=typeof I&&I.browser.isFirefox&&I.browser.version<=38&&(d[0]={url:d[0].urls}));var c=new o(d,a);c.onicecandidate=function(e){e.candidate&&i(e.candidate.candidate)},c.createDataChannel(""),c.createOffer(function(e){c.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){0===e.indexOf("a=candidate:")&&i(e)})},1e3)}}function d(e){return y?(!c.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(c.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!c.enumerateDevices&&c.enumerateDevices&&(c.enumerateDevices=c.enumerateDevices.bind(c)),c.enumerateDevices?(O=[],W=[],T=[],M=[],void c.enumerateDevices(function(i){i.forEach(function(e){var i={};for(var n in e)i[n]=e[n];"audio"===i.kind&&(i.kind="audioinput"),"video"===i.kind&&(i.kind="videoinput");var o;O.forEach(function(e){e.id===i.id&&e.kind===i.kind&&(o=!0)}),o||(i.deviceId||(i.deviceId=i.id),i.id||(i.id=i.deviceId),i.label?("videoinput"!==i.kind||A||(A=!0),"audioinput"!==i.kind||R||(R=!0)):(i.label="Please invoke getUserMedia once.","https:"!==location.protocol&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(i.label="HTTPs is required to get label of this "+i.kind+" device.")),"audioinput"===i.kind&&(P=!0,W.indexOf(i)===-1&&W.push(i)),"audiooutput"===i.kind&&(x=!0,T.indexOf(i)===-1&&T.push(i)),"videoinput"===i.kind&&(D=!0,M.indexOf(i)===-1&&M.push(i)),O.indexOf(i)===-1&&O.push(i))}),"undefined"!=typeof I&&(I.MediaDevices=O,I.hasMicrophone=P,I.hasSpeakers=x,I.hasWebcam=D,I.isWebsiteHasWebcamPermissions=A,I.isWebsiteHasMicrophonePermissions=R,I.audioInputDevices=W,I.audioOutputDevices=T,I.videoInputDevices=M),e&&e()})):void(e&&e())):void(e&&e())}var a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global?(global.navigator={userAgent:a,getUserMedia:function(){}},e.window=global):"undefined"==typeof window,"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))}("undefined"!=typeof global?global:window);var c=window.navigator;"undefined"!=typeof c?("undefined"!=typeof c.webkitGetUserMedia&&(c.getUserMedia=c.webkitGetUserMedia),"undefined"!=typeof c.mozGetUserMedia&&(c.getUserMedia=c.mozGetUserMedia)):c={getUserMedia:function(){},userAgent:a};var u=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(c.userAgent||""),p=!(c.userAgent.indexOf("Edge")===-1||!c.msSaveOrOpenBlob&&!c.msSaveBlob),w=!!window.opera||c.userAgent.indexOf(" OPR/")>=0,f="undefined"!=typeof window.InstallTrigger,m=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,S=!!window.chrome&&!w,v=!!document.documentMode&&!p,l={Android:function(){return c.userAgent.match(/Android/i)},BlackBerry:function(){return c.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return c.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return c.userAgent.match(/Opera Mini/i)},Windows:function(){return c.userAgent.match(/IEMobile/i)},any:function(){return l.Android()||l.BlackBerry()||l.iOS()||l.Opera()||l.Windows()},getOsName:function(){var e="Unknown OS";return l.Android()&&(e="Android"),l.BlackBerry()&&(e="BlackBerry"),l.iOS()&&(e="iOS"),l.Opera()&&(e="Opera Mini"),l.Windows()&&(e="Windows"),e}},b="Unknown OS",C="Unknown OS Version";if(l.any())b=l.getOsName();else{var k=r();b=k.osName,C=k.osVersion}var h=!1,g=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){!h&&e in document.createElement("canvas")&&(h=!0),!g&&e in document.createElement("video")&&(g=!0)});var O=[],W=[],T=[],M=[];c.mediaDevices&&c.mediaDevices.enumerateDevices&&(c.enumerateDevices=function(e){c.mediaDevices.enumerateDevices().then(e)["catch"](function(){e([])})});var y=!1;"undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack?y=!0:c.mediaDevices&&c.mediaDevices.enumerateDevices&&(y=!0);var P=!1,x=!1,D=!1,R=!1,A=!1;d();var I=window.DetectRTC||{};I.browser=e(),o(function(e){I.browser.isPrivateBrowsing=!!e}),I.browser["is"+I.browser.name]=!0;var B=(!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]),!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){B||e in window&&(B=!0)}),I.isWebRTCSupported=B,I.isORTCSupported="undefined"!=typeof RTCIceGatherer;var N=!1;I.browser.isChrome&&I.browser.version>=35?N=!0:I.browser.isFirefox&&I.browser.version>=34&&(N=!0),"https:"!==location.protocol&&(N=!1),I.isScreenCapturingSupported=N;var E={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){E.isSupported||e in window&&(E.isSupported=!0,"createMediaStreamSource"in window[e].prototype&&(E.isCreateMediaStreamSourceSupported=!0))}),I.isAudioContextSupported=E.isSupported,I.isCreateMediaStreamSourceSupported=E.isCreateMediaStreamSourceSupported;var U=!1;I.browser.isChrome&&I.browser.version>31&&(U=!0),I.isRtpDataChannelsSupported=U;var F=!1;I.browser.isFirefox&&I.browser.version>28?F=!0:I.browser.isChrome&&I.browser.version>25?F=!0:I.browser.isOpera&&I.browser.version>=11&&(F=!0),I.isSctpDataChannelsSupported=F,I.isMobileDevice=u;var V=!1;c.getUserMedia?V=!0:c.mediaDevices&&c.mediaDevices.getUserMedia&&(V=!0),I.browser.isChrome&&I.browser.version>=46&&"https:"!==location.protocol&&(I.isGetUserMediaSupported="Requires HTTPs"),I.isGetUserMediaSupported=V,I.osName=b,I.osVersion=C;var z="";if(screen.width){var X=screen.width?screen.width:"",G=screen.height?screen.height:"";z+=""+X+" x "+G}I.displayResolution=z,I.isCanvasSupportsStreamCapturing=h,I.isVideoSupportsStreamCapturing=g,I.DetectLocalIPAddress=t,I.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,I.isWebSocketsBlocked=!I.isWebSocketsSupported,I.checkWebSocketsSupport=function(e){e=e||function(){};try{var i=new WebSocket("wss://echo.websocket.org:443/");i.onopen=function(){I.isWebSocketsBlocked=!1,e(),i.close(),i=null},i.onerror=function(){I.isWebSocketsBlocked=!0,e()}}catch(n){I.isWebSocketsBlocked=!0,e()}},I.load=function(e){e=e||function(){},d(e)},I.MediaDevices=O,I.hasMicrophone=P,I.hasSpeakers=x,I.hasWebcam=D,I.isWebsiteHasWebcamPermissions=A,I.isWebsiteHasMicrophonePermissions=R,I.audioInputDevices=W,I.audioOutputDevices=T,I.videoInputDevices=M;var _=!1;"setSinkId"in document.createElement("video")&&(_=!0),I.isSetSinkIdSupported=_;var L=!1;I.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(L=!0):I.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(L=!0),I.isRTPSenderReplaceTracksSupported=L;var H=!1;I.browser.isFirefox&&I.browser.version>38&&(H=!0),I.isRemoteStreamProcessingSupported=H;var j=!1;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(j=!0),I.isApplyConstraintsSupported=j;var q=!1;I.browser.isFirefox&&I.browser.version>=43&&(q=!0),I.isMultiMonitorScreenCapturingSupported=q,I.isPromisesSupported=!!("Promise"in window),"undefined"==typeof I&&(window.DetectRTC={});var K=window.MediaStream;"undefined"==typeof K&&"undefined"!=typeof webkitMediaStream&&(K=webkitMediaStream),"undefined"!=typeof K?I.MediaStream=Object.keys(K.prototype):I.MediaStream=!1,"undefined"!=typeof MediaStreamTrack?I.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):I.MediaStreamTrack=!1;var Q=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;"undefined"!=typeof Q?I.RTCPeerConnection=Object.keys(Q.prototype):I.RTCPeerConnection=!1,window.DetectRTC=I,"undefined"!=typeof module&&(module.exports=I),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return I})};
function setSettingsAttributes(){$("#inspectorlink").val(window.location+"?appname=webrtcwebcall&role=inspector&audio=0&video=0"),$("#channelname").val(rtcMultiConnection.channel),$("#userid").val(rtcMultiConnection.userid),$("#inAudio").prop("checked",incomingAudio),$("#inVideo").prop("checked",incomingVideo),$("#inData").prop("checked",incomingData),$("#outAudio").prop("checked",outgoingAudio),$("#outVideo").prop("checked",outgoingVideo),$("#outData").prop("checked",outgoingData),$("#btnGetPeers").click(function(){$("#alllpeerinfo").empty(),$("#allpeerinfo").append("<pre contenteditable>"+JSON.stringify(webcallpeers,null,2)+"<pre>")}),$("#btnDebug").click(function(){$("#allwebrtcdevinfo").empty(),$("#allwebrtcdevinfo").append("<pre contenteditable>"+rtcMultiConnection+"<pre>"),console.info(rtcMultiConnection)})}function AddPartner(){$("#partnerlink").val(window.location+"?appname=webrtcwebcall&role=peer&audio=1&video=1&name="+$("#partnername").val())}function getAllPeerInfo(){console.log(webcallpeers)}$("#SettingsButton").click(function(){console.log(localobj.userdetails),localobj.userdisplay.latitude&&(localobj.userdisplay.latitude.value=latitude),localobj.userdisplay.longitude&&(localobj.userdisplay.longitude.value=longitude),localobj.userdisplay.operatingsystem&&(localobj.userdisplay.operatingsystem.value=operatingsystem)});
!function(){function g(t){throw t}function aa(t){return function(){return this[t]}}function p(t){return function(){return t}}function ca(t,e){var n=t.split("."),i=ba;!(n[0]in i)&&i.execScript&&i.execScript("var "+n[0]);for(var r;n.length&&(r=n.shift());)!n.length&&s(e)?i[r]=e:i=i[r]?i[r]:i[r]={}}function da(){}function ea(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&"undefined"!=typeof t.splice&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof t.call&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&"undefined"==typeof t.call)return"object";return e}function s(t){return t!==j}function fa(t){var e=ea(t);return"array"==e||"object"==e&&"number"==typeof t.length}function t(t){return"string"==typeof t}function ga(t){return"number"==typeof t}function ha(t){var e=typeof t;return"object"==e&&t!=l||"function"==e}function ia(t,e,n){return t.call.apply(t.bind,arguments)}function ja(t,e,n){if(t||g(Error()),2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ia:ja,u.apply(l,arguments)}function ka(t,e){function n(){}n.prototype=e.prototype,t.Jd=e.prototype,t.prototype=new n}function la(a){if(a=String(a),/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x10-\x1f\x80-\x9f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(b){}g(Error("Invalid JSON string: "+a))}function ma(){this.Xb=j}function na(t,e,n){switch(typeof e){case"string":oa(e,n);break;case"number":n.push(isFinite(e)&&!isNaN(e)?e:"null");break;case"boolean":n.push(e);break;case"undefined":n.push("null");break;case"object":if(e==l){n.push("null");break}if("array"==ea(e)){var i=e.length;n.push("[");for(var r="",o=0;o<i;o++)n.push(r),r=e[o],na(t,t.Xb?t.Xb.call(e,String(o),r):r,n),r=",";n.push("]");break}n.push("{"),i="";for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r=e[o],"function"!=typeof r&&(n.push(i),oa(o,n),n.push(":"),na(t,t.Xb?t.Xb.call(e,o,r):r,n),i=","));n.push("}");break;case"function":break;default:g(Error("Unknown type: "+typeof e))}}function oa(t,e){e.push('"',t.replace(qa,function(t){if(t in pa)return pa[t];var e=t.charCodeAt(0),n="\\u";return 16>e?n+="000":256>e?n+="00":4096>e&&(n+="0"),pa[t]=n+e.toString(16)}),'"')}function y(t){if("undefined"!=typeof JSON&&s(JSON.stringify))t=JSON.stringify(t);else{var e=[];na(new ma,t,e),t=e.join("")}return t}function ra(t){for(var e=[],n=0,i=0;i<t.length;i++){var r=t.charCodeAt(i);55296<=r&&56319>=r&&(r-=55296,i++,z(i<t.length,"Surrogate pair missing trail surrogate."),r=65536+(r<<10)+(t.charCodeAt(i)-56320)),128>r?e[n++]=r:(2048>r?e[n++]=r>>6|192:(65536>r?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return e}function A(t,e,n,i){var r;i<e?r="at least "+e:i>n&&(r=0===n?"none":"no more than "+n),r&&g(Error(t+" failed: Was called with "+i+(1===i?" argument.":" arguments.")+" Expects "+r+"."))}function B(t,e,n){var i="";switch(e){case 1:i=n?"first":"First";break;case 2:i=n?"second":"Second";break;case 3:i=n?"third":"Third";break;case 4:i=n?"fourth":"Fourth";break;default:sa.assert(o,"errorPrefix_ called with argumentNumber > 4.  Need to update it?")}return t+" failed: "+(i+" argument ")}function C(t,e,n,i){(!i||s(n))&&"function"!=ea(n)&&g(Error(B(t,e,i)+"must be a valid function."))}function ta(t,e,n){s(n)&&(!ha(n)||n===l)&&g(Error(B(t,e,k)+"must be a valid context object."))}function D(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ua(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function ya(e){return t(e)&&0!==e.length&&!wa.test(e)}function za(t,e,n){(!n||s(e))&&Aa(B(t,1,n),e)}function Aa(e,n,i,r){if(i||(i=0),r||(r=[]),s(n)||g(Error(e+"contains undefined"+Ba(r))),"function"==ea(n)&&g(Error(e+"contains a function"+Ba(r))),Ca(n)&&g(Error(e+"contains "+n.toString()+Ba(r))),1e3<i&&g(new TypeError(e+"contains a cyclic object value ("+r.slice(0,100).join(".")+"...)")),t(n)&&n.length>10485760/3&&10485760<va.Kd.Id(n).length&&g(Error(e+"contains a string greater than 10485760 utf8 bytes"+Ba(r)+" ('"+n.substring(0,50)+"...')")),ha(n))for(var o in n)D(n,o)&&(".priority"!==o&&".value"!==o&&!ya(o)&&g(Error(e+"contains an invalid key ("+o+")"+Ba(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')),r.push(o),Aa(e,n[o],i+1,r),r.pop())}function Ba(t){return 0==t.length?"":" in property "+t.join(".")}function Da(t,e){ha(e)||g(Error(B(t,1,o)+" must be an object containing the children to replace.")),za(t,e,o)}function Ea(e,n,i,r){(!r||s(i))&&i!==l&&!ga(i)&&!t(i)&&g(Error(B(e,n,r)+"must be a valid firebase priority (null or a string.)"))}function Fa(t,e,n){if(!n||s(e))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:g(Error(B(t,1,n)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".'))}}function Ga(t,e){s(e)&&!ya(e)&&g(Error(B(t,2,k)+'must be a valid firebase key (non-empty string, not containing ".", "#", "$", "/", "[", or "]").'))}function Ha(e,n){(!t(n)||0===n.length||xa.test(n))&&g(Error(B(e,1,o)+'must be a non-empty string and can\'t contain ".", "#", "$", "[", or "]".'))}function E(t,e){".info"===F(e)&&g(Error(t+" failed: Can't modify data under /.info/"))}function G(t,e,n,i,r,o,a){this.o=t,this.path=e,this.ta=n,this.Z=i,this.la=r,this.ra=o,this.Pa=a,s(this.Z)&&s(this.ra)&&s(this.ta)&&g("Query: Can't combine startAt(), endAt(), and limit().")}function Ja(t){var e={};return s(t.Z)&&(e.sp=t.Z),s(t.la)&&(e.sn=t.la),s(t.ra)&&(e.ep=t.ra),s(t.Pa)&&(e.en=t.Pa),s(t.ta)&&(e.l=t.ta),s(t.Z)&&s(t.la)&&t.Z===l&&t.la===l&&(e.vf="l"),e}function Ia(t,e,n){var i={};return e&&n?(i.cancel=e,C(t,3,i.cancel,k),i.W=n,ta(t,4,i.W)):e&&("object"==typeof e&&e!==l?i.W=e:"function"==typeof e?i.cancel=e:g(Error(B(t,3,k)+"must either be a cancel callback or a context object."))),i}function I(t){if(t instanceof I)return t;if(1==arguments.length){this.m=t.split("/");for(var e=0,n=0;n<this.m.length;n++)0<this.m[n].length&&(this.m[e]=this.m[n],e++);this.m.length=e,this.X=0}else this.m=arguments[0],this.X=arguments[1]}function F(t){return t.X>=t.m.length?l:t.m[t.X]}function La(t){var e=t.X;return e<t.m.length&&e++,new I(t.m,e)}function Ma(t){return t.X<t.m.length?t.m[t.m.length-1]:l}function Na(t,e){var n=F(t);return n===l?e:n===F(e)?Na(La(t),La(e)):void g("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Oa(){this.children={},this.hc=0,this.value=l}function Ra(t,e,n){this.ua=t?t:"",this.ob=e?e:l,this.u=n?n:new Oa}function J(t,e){for(var n,i=e instanceof I?e:new I(e),r=t;(n=F(i))!==l;)r=new Ra(n,r,ua(r.u.children,n)||new Oa),i=La(i);return r}function M(t,e){z("undefined"!=typeof e),t.u.value=e,Sa(t)}function Ta(t,e,n,i){n&&!i&&e(t),t.B(function(t){Ta(t,e,k,i)}),n&&i&&e(t)}function Ua(t,e,n){for(t=n?t:t.parent();t!==l;){if(e(t))return k;t=t.parent()}return o}function Sa(t){if(t.ob!==l){var e=t.ob,n=t.ua,i=t.f(),r=D(e.u.children,n);i&&r?(delete e.u.children[n],e.u.hc--,Sa(e)):!i&&!r&&(e.u.children[n]=t.u,e.u.hc++,Sa(e))}}function Va(t,e){this.Ma=t?t:Wa,this.Y=e?e:Xa}function Wa(t,e){return t<e?-1:t>e?1:0}function Ya(t,e){for(var n,i=t.Y,r=l;!i.f();){if(n=t.Ma(e,i.key),0===n){if(i.left.f())return r?r.key:l;for(i=i.left;!i.right.f();)i=i.right;return i.key}0>n?i=i.left:0<n&&(r=i,i=i.right)}g(Error("Attempted to find predecessor key for a nonexistent key.  What gives?"))}function Za(t,e){for(this.Wc=e,this.Gb=[];!t.f();)this.Gb.push(t),t=t.left}function $a(t){if(0===t.Gb.length)return l;var e,n=t.Gb.pop();for(e=t.Wc?t.Wc(n.key,n.value):{key:n.key,value:n.value},n=n.right;!n.f();)t.Gb.push(n),n=n.left;return e}function ab(t,e,n,i,r){this.key=t,this.value=e,this.color=n!=l?n:k,this.left=i!=l?i:Xa,this.right=r!=l?r:Xa}function bb(t){return t.left.f()?t:bb(t.left)}function db(t){return t.left.f()?Xa:(!t.left.H()&&!t.left.left.H()&&(t=eb(t)),t=t.copy(l,l,l,db(t.left),l),cb(t))}function cb(t){return t.right.H()&&!t.left.H()&&(t=ib(t)),t.left.H()&&t.left.left.H()&&(t=gb(t)),t.left.H()&&t.right.H()&&(t=hb(t)),t}function eb(t){return t=hb(t),t.right.left.H()&&(t=t.copy(l,l,l,l,gb(t.right)),t=ib(t),t=hb(t)),t}function ib(t){var e;return e=t.copy(l,l,k,l,t.right.left),t.right.copy(l,l,t.color,e,l)}function gb(t){var e;return e=t.copy(l,l,k,t.left.right,l),t.left.copy(l,l,t.color,l,e)}function hb(t){var e,n;return e=t.left.copy(l,l,!t.left.color,l,l),n=t.right.copy(l,l,!t.right.color,l,l),t.copy(l,l,!t.color,e,n)}function jb(){}function nb(){}function ob(){this.z=[],this.gc=[],this.hd=[],this.Ob=[],this.Ob[0]=128;for(var t=1;64>t;++t)this.Ob[t]=0;this.reset()}function pb(t,e){var n;n||(n=0);for(var i=t.hd,r=n;r<n+64;r+=4)i[r/4]=e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3];for(r=16;80>r;r++){var o=i[r-3]^i[r-8]^i[r-14]^i[r-16];i[r]=4294967295&(o<<1|o>>>31)}n=t.z[0];for(var a,s=t.z[1],c=t.z[2],h=t.z[3],u=t.z[4],r=0;80>r;r++)40>r?20>r?(o=h^s&(c^h),a=1518500249):(o=s^c^h,a=1859775393):60>r?(o=s&c|h&(s|c),a=2400959708):(o=s^c^h,a=3395469782),o=(n<<5|n>>>27)+o+u+a+i[r]&4294967295,u=h,h=c,c=4294967295&(s<<30|s>>>2),s=n,n=o;t.z[0]=t.z[0]+n&4294967295,t.z[1]=t.z[1]+s&4294967295,t.z[2]=t.z[2]+c&4294967295,t.z[3]=t.z[3]+h&4294967295,t.z[4]=t.z[4]+u&4294967295}function qb(){this.La={},this.length=0}function sb(t,e,n,i){this.host=t,this.Yb=e,this.jb=n,this.aa=i||N.getItem(t)||this.host}function tb(t,e){e!==t.aa&&(t.aa=e,"s-"===t.aa.substr(0,2)&&N.setItem(t.host,t.aa))}function yb(){return ba.navigator?ba.navigator.userAgent:l}function Ib(t,e){if(fa(t)||g(Error("encodeByteArray takes an array as a parameter")),!Gb){Gb={},Hb={};for(var n=0;65>n;n++)Gb[n]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n),Hb[n]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(n)}for(var n=e?Hb:Gb,i=[],r=0;r<t.length;r+=3){var o=t[r],a=r+1<t.length,s=a?t[r+1]:0,c=r+2<t.length,h=c?t[r+2]:0,u=o>>2,o=(3&o)<<4|s>>4,s=(15&s)<<2|h>>6,h=63&h;c||(h=64,a||(s=64)),i.push(n[u],n[o],n[s],n[h])}return i.join("")}function z(t,e){t||g(Error("Firebase INTERNAL ASSERT FAILED:"+e))}function Lb(t){var e=ra(t),t=new ob;t.update(e);var e=[],n=8*t.Ac;56>t.eb?t.update(t.Ob,56-t.eb):t.update(t.Ob,64-(t.eb-56));for(var i=63;56<=i;i--)t.gc[i]=255&n,n/=256;for(pb(t,t.gc),i=n=0;5>i;i++)for(var r=24;0<=r;r-=8)e[n++]=t.z[i]>>r&255;return Ib(e)}function Mb(){for(var t="",e=0;e<arguments.length;e++)t=fa(arguments[e])?t+Mb.apply(l,arguments[e]):"object"==typeof arguments[e]?t+y(arguments[e]):t+arguments[e],t+=" ";return t}function Pb(){if(Ob===k&&(Ob=o,Nb===l&&"true"===N.getItem("logging_enabled")&&Qb(k)),Nb){var t=Mb.apply(l,arguments);Nb(t)}}function Sb(t){return function(){Pb(t,arguments)}}function Tb(){if("undefined"!=typeof console){var t="FIREBASE INTERNAL ERROR: "+Mb.apply(l,arguments);"undefined"!=typeof console.error?console.error(t):console.log(t)}}function Ub(){var t=Mb.apply(l,arguments);g(Error("FIREBASE FATAL ERROR: "+t))}function Vb(){if("undefined"!=typeof console){var t="FIREBASE WARNING: "+Mb.apply(l,arguments);"undefined"!=typeof console.warn?console.warn(t):console.log(t)}}function Ca(t){return ga(t)&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)}function Wb(t,e){return t!==e?t===l?-1:e===l?1:typeof t!=typeof e?"number"==typeof t?-1:1:t>e?1:-1:0}function Xb(t,e){return e&&t in e?e[t]:void g(Error("Missing required key ("+t+") in object: "+y(e)))}function Ka(t){if("object"!=typeof t||t===l)return y(t);var e,n=[];for(e in t)n.push(e);n.sort(),e="{";for(var i=0;i<n.length;i++)0!==i&&(e+=","),e+=y(n[i]),e+=":",e+=Ka(t[n[i]]);return e+"}"}function Zb(t,e){if(t.length<=e)return[t];for(var n=[],i=0;i<t.length;i+=e)i+e>t?n.push(t.substring(i,t.length)):n.push(t.substring(i,i+e));return n}function $b(t){z(!Ca(t));var e,n,i,r;for(0===t?(i=n=0,e=-(1/0)===1/t?1:0):(e=0>t,t=Math.abs(t),t>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023),n=i+1023,i=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,i=Math.round(t/Math.pow(2,-1074)))),r=[],t=52;t;t-=1)r.push(i%2?1:0),i=Math.floor(i/2);for(t=11;t;t-=1)r.push(n%2?1:0),n=Math.floor(n/2);for(r.push(e?1:0),r.reverse(),e=r.join(""),n="",t=0;64>t;t+=8)i=parseInt(e.substr(t,8),2).toString(16),1===i.length&&(i="0"+i),n+=i;return n.toLowerCase()}function ac(t,e){this.oa=t,z(this.oa!==l,"LeafNode shouldn't be created with null value."),this.Ua="undefined"!=typeof e?e:l}function P(t,e){this.R=t||new Va,this.Ua="undefined"!=typeof e?e:l}function cc(t,e,n){P.call(this,t,n),e===l&&(e=new Va(ec),t.sa(function(t,n){e=e.ia({name:t,wa:n.k()},n)})),this.ka=e}function Q(t,e){if("object"!=typeof t)return new ac(t,e);if(t===l)return O;var n=l;if(".priority"in t?n=t[".priority"]:"undefined"!=typeof e&&(n=e),z(n===l||"string"==typeof n||"number"==typeof n),".value"in t&&t[".value"]!==l)return new ac(t[".value"],n);var i,n=new P(new Va,n);for(i in t)if(D(t,i)&&"."!==i.substring(0,1)){var r=Q(t[i]);!r.J()&&r.f()||(n=n.D(i,r))}return n}function ec(t,e){return Wb(t.wa,e.wa)||(t.name!==e.name?t.name<e.name?-1:1:0)}function bc(t){return"number"==typeof t?"number:"+$b(t):"string:"+t}function R(t,e){this.u=t,this.Vb=e}function fc(t){this.sc=t,this.Qb=[],this.Oa=0,this.ic=-1,this.Ga=l}function S(t,e){for(var n in t)e.call(j,t[n],n,t)}function gc(t){var e,n={};for(e in t)n[e]=t[e];return n}function hc(){this.$a={}}function ic(t,e,n){s(n)||(n=1),D(t.$a,e)||(t.$a[e]=0),t.$a[e]+=n}function jc(t){this.jd=t,this.Fb=l}function kc(t,e){this.ad={},this.$b=new jc(t),this.n=e,setTimeout(u(this.Uc,this),10+6e4*Math.random())}function nc(t){return t=t.toString(),lc[t]||(lc[t]=new hc),lc[t]}function pc(t,e,n){this.jc=t,this.e=Sb(this.jc),this.frames=this.gb=l,this.zc=0,this.$=nc(e),this.Na=(e.Yb?"wss://":"ws://")+e.aa+"/.ws?v=5",e.host!==e.aa&&(this.Na=this.Na+"&ns="+e.jb),n&&(this.Na=this.Na+"&s="+n)}function sc(t,e){if(t.frames.push(e),t.frames.length==t.zc){var n=t.frames.join("");t.frames=l,n="undefined"!=typeof JSON&&s(JSON.parse)?JSON.parse(n):la(n),t.Mb(n)}}function rc(t){clearTimeout(t.gb),t.gb=setInterval(function(){t.U.send("0"),rc(t)},45e3)}function tc(){this.set={}}function wc(t,e,n){this.jc=t,this.e=Sb(t),this.Hd=e,this.$=nc(e),this.Zb=n,this.ab=o,this.Ab=function(t){e.host!==e.aa&&(t.ns=e.jb);var n,i=[];for(n in t)t.hasOwnProperty(n)&&i.push(n+"="+t[n]);return(e.Yb?"https://":"http://")+e.aa+"/.lp?"+i.join("&")}}function zc(t,e,n,i){this.Ab=i,this.da=n,this.tc=new tc,this.qb=[],this.kc=Math.floor(1e8*Math.random()),this.Zc=k,this.cc=Jb(),window[uc+this.cc]=t,window[vc+this.cc]=e,t=document.createElement("iframe"),t.style.display="none",document.body?document.body.appendChild(t):g("Document body has not initialized. Wait to initialize Firebase until after the document is ready."),t.contentDocument?t.qa=t.contentDocument:t.contentWindow?t.qa=t.contentWindow.document:t.document&&(t.qa=t.document),this.ca=t;try{this.ca.qa.open(),this.ca.qa.write("<html><body></body></html>"),this.ca.qa.close()}catch(r){Pb("frame writing exception"),r.stack&&Pb(r.stack),Pb(r)}}function Bc(t){if(t.fc&&t.Zc&&t.tc.count()<(0<t.qb.length?2:1)){t.kc++;var e={};e.id=t.td,e.pw=t.ud,e.ser=t.kc;for(var e=t.Ab(e),n="",i=0;0<t.qb.length&&1870>=t.qb[0].Fc.length+30+n.length;){var r=t.qb.shift(),n=n+"&seg"+i+"="+r.Ad+"&ts"+i+"="+r.Gd+"&d"+i+"="+r.Fc;i++}var e=e+n,a=t.kc;t.tc.add(a);var s=function(){t.tc.remove(a),Bc(t)},c=setTimeout(s,25e3);return Ac(t,e,function(){clearTimeout(c),s()}),k}return o}function Ac(t,e,n){setTimeout(function(){try{var i=t.ca.qa.createElement("script");i.type="text/javascript",i.async=k,i.src=e,i.onload=i.onreadystatechange=function(){var t=i.readyState;t&&"loaded"!==t&&"complete"!==t||(i.onload=i.onreadystatechange=l,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=function(){Pb("Long-poll script failed to load."),t.close()},t.ca.qa.body.appendChild(i)}catch(r){}},1)}function Cc(){function t(t,n){n&&n.isAvailable()&&e.push(n)}var e=[],n=Dc;if("array"==ea(n))for(var i=0;i<n.length;++i)t(0,n[i]);else S(n,t);this.bc=e}function Ec(t,e,n,i,r,o){this.id=t,this.e=Sb("c:"+this.id+":"),this.sc=n,this.mb=i,this.va=r,this.rc=o,this.M=e,this.Pb=[],this.Dc=0,this.Bc=new Cc,this.ma=0,this.e("Connection created"),Fc(this)}function Fc(t){var e,n=t.Bc;0<n.bc.length?e=n.bc[0]:g(Error("No transports available")),t.G=new e("c:"+t.id+":"+t.Dc++,t.M);var i=Gc(t,t.G),r=Hc(t,t.G);t.yb=t.G,t.vb=t.G,t.w=l,setTimeout(function(){t.G&&t.G.open(i,r)},0)}function Hc(t,e){return function(n){e===t.G?(t.G=l,n||0!==t.ma?1===t.ma&&t.e("Realtime connection lost."):(t.e("Realtime connection failed."),"s-"===t.M.aa.substr(0,2)&&(N.removeItem(t.M.jb),t.M.aa=t.M.host)),t.close()):e===t.w?(n=t.w,t.w=l,(t.yb===n||t.vb===n)&&t.close()):t.e("closing an old connection")}}function Gc(t,e){return function(n){if(2!=t.ma)if(e===t.vb){var i=Xb("t",n),n=Xb("d",n);if("c"==i){if(i=Xb("t",n),"d"in n)if(n=n.d,"h"===i){var i=n.ts,r=n.v,o=n.h;t.Zb=n.s,tb(t.M,o),0==t.ma&&(t.G.start(),n=t.G,t.e("Realtime connection established."),t.G=n,t.ma=1,t.mb&&(t.mb(i),t.mb=l),"5"!==r&&Vb("Protocol version mismatch detected"),n=1<t.Bc.bc.length?t.Bc.bc[1]:l)&&(t.w=new n("c:"+t.id+":"+t.Dc++,t.M,t.Zb),t.w.open(Gc(t,t.w),Hc(t,t.w)))}else if("n"===i){for(t.e("recvd end transmission on primary"),t.vb=t.w,n=0;n<t.Pb.length;++n)t.Kb(t.Pb[n]);t.Pb=[],Ic(t)}else"s"===i?(t.e("Connection shutdown command received. Shutting down..."),t.rc&&(t.rc(n),t.rc=l),t.va=l,t.close()):"r"===i?(t.e("Reset packet received.  New host: "+n),tb(t.M,n),1===t.ma?t.close():(Jc(t),Fc(t))):Tb("Unknown control packet command: "+i)}else"d"==i&&t.Kb(n)}else e===t.w?(i=Xb("t",n),n=Xb("d",n),"c"==i?"t"in n&&(n=n.t,"a"===n?(t.w.start(),t.e("sending client ack on secondary"),t.w.send({t:"c",d:{t:"a",d:{}}}),t.e("Ending transmission on primary"),t.G.send({t:"c",d:{t:"n",d:{}}}),t.yb=t.w,Ic(t)):"r"===n&&(t.e("Got a reset on secondary, closing it"),t.w.close(),(t.yb===t.w||t.vb===t.w)&&t.close())):"d"==i?t.Pb.push(n):g(Error("Unknown protocol layer: "+i))):t.e("message on old connection")}}function Ic(t){t.yb===t.w&&t.vb===t.w&&(t.e("cleaning up and promoting a connection: "+t.w.jc),t.G=t.w,t.w=l)}function Jc(t){t.e("Shutting down all connections"),t.G&&(t.G.close(),t.G=l),t.w&&(t.w.close(),t.w=l)}function Kc(t,e,n,i){this.id=Lc++,this.e=Sb("p:"+this.id+":"),this.wb=k,this.ba={},this.O=[],this.nb=0,this.lb=[],this.S=o,this.Ub=1e3,this.Lb=e||da,this.Jb=n||da,this.kb=i||da,this.M=t,this.vc=l,this.Rb=[],this.xa={},this.zd=0,this.hb=this.Oc=l,setTimeout(u(this.Gc,this),0)}function Nc(t,e,n,i,r){t.e("Listen on "+e+" for "+n);var o={p:e},i=mb(i,function(t){return Ja(t)});"{}"!==n&&(o.q=i),t.ya("l",o,function(i){t.e("listen response",i),i=i.s,"ok"!==i&&Oc(t,e,n),r&&r(i)},function(){t.e("timed out on listen...")})}function Pc(t){var e=t.Ca;t.S&&e&&t.ya("auth",{cred:e.kd},function(n){var i=n.s,n=n.d||"error";"ok"!==i&&t.Ca===e&&delete t.Ca,e.Ic?"ok"!==i&&e.Cb&&e.Cb(i,n):(e.Ic=k,e.fa&&e.fa(i,n)),t.kb("ok"===i)},function(){t.e("timed out on auth...")})}function Qc(t,e,n,i){t.S?Rc(t,"o",e,n,i):t.lb.push({uc:e,action:"o",data:n,A:i})}function Rc(t,e,n,i,r){n={p:n,d:i},t.e("onDisconnect "+e,n),t.ya(e,n,function(t){r&&setTimeout(function(){r(t.s)},0)},function(){t.e("timed out on onDisconnect...")})}function Sc(t,e,n,i,r,o){n={p:n,d:i},s(o)&&(n.h=o),t.O.push({action:e,Vc:n,A:r}),t.nb++,e=t.O.length-1,t.S&&Tc(t,e)}function Tc(t,e){var n=t.O[e].action,i=t.O[e].A;t.ya(n,t.O[e].Vc,function(r){t.e(n+" response",r),delete t.O[e],t.nb--,0===t.nb&&(t.O=[]),i&&i(r.s)},function(){t.e("timed out on put...")})}function Oc(t,e,n){e=new I(e).toString(),n||(n="{}");var i=t.ba[e][n];return delete t.ba[e][n],i}function Uc(){this.Ka=O}function T(t,e){return t.Ka.F(e)}function U(t,e,n){t.Ka=t.Ka.Ya(e,n)}function Vc(){this.za=new Uc,this.K=new Uc,this.Aa=new Uc,this.pb=new Ra}function Wc(t,e){for(var n=T(t.za,e),i=T(t.K,e),r=J(t.pb,e),a=o,s=r;s!==l;){if(s.j()!==l){a=k;break}s=s.parent()}return a?o:(n=Xc(n,i,r),n!==i?(U(t.K,e,n),k):o)}function Xc(t,e,n){return n.f()?t:n.j()!==l?e:(t=t||O,n.B(function(i){var i=i.name(),r=t.N(i),o=e.N(i),a=J(n,i),r=Xc(r,o,a);t=t.D(i,r)}),t)}function Yc(t,e){lb(e,function(e){var n=e.Bd,e=J(t.pb,e.path),i=e.j();z(i!==l,"pendingPut should not be null."),i===n&&M(e,l)})}function Zc(){this.Da=[]}function $c(t,e){if(0!==e.length){t.Da.push.apply(t.Da,e);for(var n=0;n<t.Da.length;n++)if(t.Da[n]){var i=t.Da[n];t.Da[n]=l;var r=i.fa;r(i.$c,i.rb)}t.Da=[]}}function V(t,e,n,i){this.type=t,this.ja=e,this.V=n,this.rb=i}function ad(t){this.I=t,this.ga=[],this.Hc=new Zc}function bd(t,e,n,i,r){t.ga.push({type:e,fa:n,cancel:i,W:r});var i=[],o=cd(t.g);t.fb&&o.push(new V("value",t.g));for(var a=0;a<o.length;a++)if(o[a].type===e){var s=new W(t.I.o,t.I.path);o[a].V&&(s=s.C(o[a].V)),i.push({fa:r?u(n,r):n,$c:new R(o[a].ja,s),rb:o[a].rb})}$c(t.Hc,i)}function fd(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],o=r.type,a=new W(t.I.o,t.I.path);for(e[i].V&&(a=a.C(e[i].V)),a=new R(e[i].ja,a),"value"!==r.type||a.Eb()?"value"!==r.type&&(o+=" "+a.name()):o+="("+a.P()+")",Pb(t.I.o.n.id+": event:"+t.I.path+":"+t.I.Ia()+":"+o),o=0;o<t.ga.length;o++){var s=t.ga[o];e[i].type===s.type&&n.push({fa:s.W?u(s.fa,s.W):s.fa,$c:a,rb:r.rb})}}$c(t.Hc,n)}function cd(t){var e=[];if(!t.J()){var n=l;t.B(function(t,i){e.push(new V("child_added",i,t,n)),n=t})}return e}function gd(t){t.fb||(t.fb=k,fd(t,[new V("value",t.g)]))}function hd(t,e){ad.call(this,t),this.g=e}function id(t,e){this.Db=t,this.pc=e}function jd(t,e,n,i,r){var a=t.F(n),s=e.F(n),i=new id(i,r),r=kd(i,n,a,s),c=o;if(!a.f()&&!s.f()&&a.k()!==s.k())var c=t.F(n.parent()),h=e.F(n.parent()),u=Ma(n),c=c.T(u,a)!=h.T(u,s);if(r||c)for(a=n,n=r,s=c;a.parent()!==l;){var f=t.F(a),r=e.F(a),c=a.parent();i.Db&&!J(i.Db,c).j()||(h=e.F(c),u=[],a=Ma(a),f.f()?(f=h.T(a,r),u.push(new V("child_added",r,a,f))):r.f()?u.push(new V("child_removed",f,a)):(f=h.T(a,r),s&&u.push(new V("child_moved",r,a,f)),n&&u.push(new V("child_changed",r,a,f))),i.pc(c,h,u)),s&&(s=o,n=k),a=c}}function kd(t,e,n,i){var r,a=[];return n===i?r=o:n.J()&&i.J()?r=n.j()!==i.j():n.J()?(ld(t,e,O,i,a),r=k):i.J()?(ld(t,e,n,O,a),r=k):r=ld(t,e,n,i,a),r?t.pc(e,i,a):n.k()!==i.k()&&t.pc(e,i,l),r}function ld(t,e,n,i,r){var a,c,h,u,f=o,p=!t.Db||!J(t.Db,e).f(),d=[],b=[],y=[],g=[],v={},m={};for(a=n.Qa(),h=$a(a),c=i.Qa(),u=$a(c);h!==l||u!==l;)if(n=h===l?1:u===l?-1:h.key===u.key?0:ec({name:h.key,wa:h.value.k()},{name:u.key,wa:u.value.k()}),0>n?(f=ua(v,h.key),s(f)?(y.push({Jc:h,cd:d[f]}),d[f]=l):(m[h.key]=b.length,b.push(h)),f=k,h=$a(a)):(0<n?(f=ua(m,u.key),s(f)?(y.push({Jc:b[f],cd:u}),b[f]=l):(v[u.key]=d.length,d.push(u)),f=k):(n=e.C(u.key),(n=kd(t,n,h.value,u.value))&&(g.push(u),f=k),h=$a(a)),u=$a(c)),!p&&f)return k;for(p=0;p<b.length;p++)(v=b[p])&&(n=e.C(v.key),kd(t,n,v.value,O),r.push(new V("child_removed",v.value,v.key)));for(p=0;p<d.length;p++)(v=d[p])&&(n=e.C(v.key),b=i.T(v.key,v.value),kd(t,n,O,v.value),r.push(new V("child_added",v.value,v.key,b)));for(p=0;p<y.length;p++)v=y[p].Jc,d=y[p].cd,n=e.C(d.key),b=i.T(d.key,d.value),r.push(new V("child_moved",d.value,d.key,b)),(n=kd(t,n,v.value,d.value))&&g.push(d);for(p=0;p<g.length;p++)t=g[p],b=i.T(t.key,t.value),r.push(new V("child_changed",t.value,t.key,b));return f}function md(){this.L=this.na=l,this.set={}}function nd(t){return t.contains("default")}function od(t){return t.na!=l&&nd(t)}function pd(t,e){ad.call(this,t),this.g=O,this.Tb(e,cd(e))}function qd(t,e,n,i){if(t.J())return l;var r=l;return(i?t.lc:t.B).call(t,function(t,i){if(rd(e,t,i)&&(r=t,n--,0===n))return k}),r}function rd(t,e,n){for(var i=0;i<t.length;i++)if(!t[i](e,n.k()))return o;return k}function sd(t,e){this.n=t,this.i=e,this.Qc=e.Ka,this.pa=new Ra}function vd(t,e,n,i,r){for(var a=t.get(e),s=o,c=a.ga.length-1;0<=c;c--){var h=a.ga[c];if(!(n&&h.type!==n||i&&h.fa!==i||r&&h.W!==r)&&(a.ga.splice(c,1),s=k,n&&i))break}return(n=s&&!(0<a.ga.length))&&t.remove(e),n}function wd(t,e,n,i,r,a){var s=e.path(),s=J(t.pa,s),n=n?n.Ia():l,c=[];if(n&&"default"!==n?vd(e,n,i,r,a)&&c.push(n):lb(e.keys(),function(t){vd(e,t,i,r,a)&&c.push(t)}),e.f()&&M(s,l),n=td(s),0<c.length&&!n){for(var h=s,u=s.parent(),n=o;!n&&u;){var f=u.j();if(f){z(!od(f));var p=h.name(),d=o;S(f.set,function(t){d=t.mc(p)||d}),d&&(n=k)}h=u,u=u.parent()}if(h=l,!od(e)){u=e.na,e.na=l;var b=[],y=function(e){var n=e.j();n&&nd(n)?(b.push(n.path()),n.na==l&&n.setActive(ud(t,n))):(n&&n.na==l&&n.setActive(ud(t,n)),e.B(y))};y(s),h=b,u&&u()}return n?l:h}return l}function xd(t,e,n){Ta(J(t.pa,e),function(t){(t=t.j())&&S(t.set,function(t){gd(t)})},n,k)}function yd(t,e,n){function i(t){for(var e=0;e<n.length;++e)if(n[e].contains(t))return k;return o}var r=t.Qc,a=t.i.Ka;t.Qc=a,jd(r,a,e,t.pa,function(n,r,a){if(e.contains(n)){var s=i(n);s&&xd(t,n,o),t.Sb(n,r,a),s&&xd(t,n,k)}else t.Sb(n,r,a)}),i(e)&&xd(t,e,k)}function td(t){return Ua(t,function(t){return t.j()&&od(t.j())})}function ud(t,e){if(t.n){var n=e.keys(),i=t.n,r=function(i){"ok"!==i?(Vb("on() or once() for "+e.path().toString()+" failed: "+i),e&&S(e.set,function(t){for(var e=0;e<t.ga.length;e++){var n=t.ga[e];n.cancel&&(n.W?u(n.cancel,n.W):n.cancel)()}}),wd(t,e)):lb(n,function(t){(t=e.get(t))&&gd(t)})},o=e.toString(),a=e.path().toString();return i.ba[a]=i.ba[a]||{},z(!i.ba[a][o],"listen() called twice for same path/queryId."),i.ba[a][o]={Va:e.Va(),A:r},i.S&&Nc(i,a,o,e.Va(),r),u(t.n.dd,t.n,e.path(),e.toString(),e.Va())}return da}function zd(t,e,n,i,r,o){var a=e.path();if(o!==l){var s=[];return i.J()||i.B(function(t,e){s.push({path:a.C(t),Fa:e}),delete o[t]}),S(o,function(t,e){s.push({path:a.C(e),Fa:O})}),s}var e=t.bb(a,e,i,r),c=O,h=[];return S(e,function(e,o){var a=new I(o);e?c=c.D(o,i.F(a)):h=h.concat(Ad(t,i.F(a),J(n,a),r))}),[{path:a,Fa:c}].concat(h)}function Bd(t,e,n,i,r){for(var a=J(t.pa,e),s=a.parent(),c=o;!c&&s!==l;){var h=s.j();h!==l&&(nd(h)?c=k:(h=t.bb(e,h,n,i),a=a.name(),ua(h,a)&&(c=k))),a=s,s=s.parent()}return c?[{path:e,Fa:n}]:(s=J(t.pa,e),c=s.j(),c!==l?nd(c)?[{path:e,Fa:n}]:zd(t,c,s,n,i,r):Ad(t,n,s,i))}function Ad(t,e,n,i){var r=n.j();if(r!==l)return nd(r)?[{path:n.path(),Fa:e}]:zd(t,r,n,e,i,l);if(e.J())return[];var o=[];return e.B(function(e,r){var a=new I(e);o=o.concat(Ad(t,r,J(n,a),i))}),o}function Cd(t){this.M=t,this.$=nc(t),this.n=new Kc(this.M,u(this.Lb,this),u(this.Jb,this),u(this.kb,this));var e=u(function(){return new kc(this.$,this.n)},this),t=t.toString();mc[t]||(mc[t]=e()),this.Fd=mc[t],this.ac=new Ra,this.i=new Vc,this.Q=new sd(this.n,this.i.Aa),this.Mc=new Uc,this.nc=new sd(l,this.Mc),Dd(this,"connected",o),Dd(this,"authenticated",o)}function Dd(t,e,n){e=new I("/.info/"+e),U(t.Mc,e,Q(n)),yd(t.nc,e,[e])}function Hd(t,e,n,i){n=Q(n),Qc(t.n,e.toString(),n.P(k),function(t){X(i,t)})}function Id(t){ic(t.$,"deprecated_on_disconnect"),t.Fd.ad.deprecated_on_disconnect=k}function Jd(t,e){var n=new W(t,e);return new R(T(t.i.Aa,e),n)}function X(t,e,n){if(t)if("ok"==e)t(l,n);else{var i=e=(e||"error").toUpperCase();n&&(i+=": "+n),n=Error(i),n.code=e,t(n)}}function Gd(t,e){var n=J(t.ac,e);Ua(n,function(e){Kd(t,e)}),Kd(t,n),Ta(n,function(e){Kd(t,e)})}function Kd(t,e){var n=e.j();if(n!==l){for(var i=-1,r=[],a=0;a<n.length;a++)if(2===n[a].status)z(i===a-1,"All SENT items should be at beginning of queue."),i=a,n[a].status=4,n[a].Cc="set";else if(n[a].dc(),n[a].A){var s=Jd(t,e.path());r.push(u(n[a].A,l,Error("set"),o,s))}for(-1===i?M(e,l):n.length=i+1,a=0;a<r.length;a++)r[a]()}}function Ld(t,e){var n=e||t.ac;if(e||Md(t,n),!n.f())if(n.j()!==l){var i=Nd(t,n);if(0!==i.length){var r=n.path();if(2!==i[0].status&&4!==i[0].status){for(var o=0;o<i.length;o++)z(1===i[o].status,"tryToSendTransactionForNode_: items in queue should all be run."),i[o].status=2,i[o].Yc++;var a=T(t.i.K,r).hash();U(t.i.K,r,T(t.i.Aa,r));var s=T(t.i.K,r).P(k),c=Jb();M(J(t.i.pb,r),c),t.n.put(r.toString(),s,function(e){t.e("transaction put response",{path:r.toString(),status:e});var a=J(t.i.pb,r),s=a.j();if(z(s!==l,"tryToSendTransactionsForNode_: pendingPut should not be null."),s===c&&(M(a,l),U(t.i.K,r,T(t.i.za,r))),"ok"===e){for(e=[],o=0;o<i.length;o++)i[o].status=3,i[o].A&&(a=Jd(t,i[o].path),e.push(u(i[o].A,l,l,k,a))),i[o].dc();for(Md(t,n),Ld(t),o=0;o<e.length;o++)e[o]()}else{if("datastale"===e)for(o=0;o<i.length;o++)i[o].status=4===i[o].status?5:1;else for(Vb("transaction at "+r+" failed: "+e),o=0;o<i.length;o++)i[o].status=5,i[o].Cc=e;e=Ed(t,r),Fd(t,e),yd(t.Q,e.path(),[r])}},a)}}}else n.B(function(e){Ld(t,e)})}function Fd(t,e){var n=e.path();U(t.i.Aa,n,T(t.i.K,n));var i=Nd(t,e);if(0!==i.length){for(var r=T(t.i.Aa,n),a=[],c=0;c<i.length;c++){var h,f=Na(n,i[c].path),p=o;if(z(f!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),5===i[c].status)p=k,h=i[c].Cc;else if(1===i[c].status)if(25<=i[c].Yc)p=k,h="maxretry";else{var d=i[c].update(r.F(f).P());s(d)?(Aa("transaction failed: Data returned ",d),r=r.Ya(f,Q(d))):(p=k,h="nodata")}p&&(i[c].dc(),i[c].status=3,i[c].A&&(p=new W(t,i[c].path),f=new R(r.F(f),p),"nodata"===h?a.push(u(i[c].A,l,l,o,f)):a.push(u(i[c].A,l,Error(h),o,f))))}for(i=T(t.i.K,n).k(),U(t.i.Aa,n,r.ec(i)),Ld(t),c=0;c<a.length;c++)a[c]()}}function Ed(t,e){for(var n,i=t.ac;(n=F(e))!==l&&i.j()===l;)i=J(i,n),e=La(e);return i}function Nd(t,e){var n=[];return Od(t,e,n),n.sort(function(t,e){return t.Sc-e.Sc}),n}function Od(t,e,n){var i=e.j();if(i!==l)for(var r=0;r<i.length;r++)n.push(i[r]);e.B(function(e){Od(t,e,n)})}function Md(t,e){var n=e.j();if(n){for(var i=0,r=0;r<n.length;r++)3!==n[r].status&&(n[i]=n[r],i++);n.length=i,M(e,0<n.length?n:l)}e.B(function(e){Md(t,e)})}function Y(){this.Wa={}}function $(t,e,n){this.tb=t,this.L=e,this.ua=n}function W(){var e,n,i;if(arguments[0]instanceof Cd)i=arguments[0],e=arguments[1];else{A("new Firebase",1,2,arguments.length);var r=arguments[0];n=e="";var a=k,s="";if(t(r)){var c=r.indexOf("//");if(0<=c)var h=r.substring(0,c-1),r=r.substring(c+2);c=r.indexOf("/"),-1===c&&(c=r.length),e=r.substring(0,c);var r=r.substring(c+1),u=e.split(".");if(3==u.length){if(c=u[2].indexOf(":"),a=0<=c?"https"===h:k,"firebase"===u[1])Ub(e+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead");else for(n=u[0],s="",r=("/"+r).split("/"),h=0;h<r.length;h++)if(0<r[h].length){c=r[h];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch(f){}s+="/"+c}n=n.toLowerCase()}else n=l}a||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Vb("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),e=new sb(e,a,n),n=new I(s),a=n.toString(),(r=!t(e.host))||(r=0===e.host.length)||(r=!ya(e.jb))||(r=0!==a.length)&&(a&&(a=a.replace(/^\/*\.info(\/|$)/,"/")),r=!(t(a)&&0!==a.length&&!xa.test(a))),r&&g(Error(B("new Firebase",1,o)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')),arguments[1]?arguments[1]instanceof Y?i=arguments[1]:g(Error("Expected a valid Firebase.Context for second argument to new Firebase()")):i=Y.pd(),a=e.toString(),r=ua(i.Wa,a),r||(r=new Cd(e),i.Wa[a]=r),i=r,e=n}G.call(this,i,e)}function Qb(t,e){z(!e||t===k||t===o,"Can't turn on custom loggers persistently."),t===k?("undefined"!=typeof console&&("function"==typeof console.log?Nb=u(console.log,console):"object"==typeof console.log&&(Nb=function(t){console.log(t)})),e&&N.setItem("logging_enabled","true")):t?Nb=t:(Nb=l,N.removeItem("logging_enabled"))}var j=void 0,k=!0,l=null,o=!1,r,ba=this;Math.floor(2147483648*Math.random()).toString(36);
var pa={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},qa=/\uffff/.test("")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,va={},sa={},wa=/[\[\].#$\/]/,xa=/[\[\].#$]/;G.prototype.oc=function(t,e){A("Query.on",2,4,arguments.length),Fa("Query.on",t,o),C("Query.on",2,e,o);var n=Ia("Query.on",arguments[2],arguments[3]);return this.o.Bb(this,t,e,n.cancel,n.W),e},G.prototype.on=G.prototype.oc,G.prototype.Ib=function(t,e,n){A("Query.off",0,3,arguments.length),Fa("Query.off",t,k),C("Query.off",2,e,k),ta("Query.off",3,n),this.o.Wb(this,t,e,n)},G.prototype.off=G.prototype.Ib,G.prototype.vd=function(t,e){function n(s){a&&(a=o,r.Ib(t,n),e.call(i.W,s))}A("Query.once",2,4,arguments.length),Fa("Query.once",t,o),C("Query.once",2,e,o);var i=Ia("Query.once",arguments[2],arguments[3]),r=this,a=k;this.oc(t,n,function(){r.Ib(t,n),i.cancel&&i.cancel.call(i.W)})},G.prototype.once=G.prototype.vd,G.prototype.rd=function(t){return A("Query.limit",1,1,arguments.length),(!ga(t)||Math.floor(t)!==t||0>=t)&&g("Query.limit: First argument must be a positive integer."),new G(this.o,this.path,t,this.Z,this.la,this.ra,this.Pa)},G.prototype.limit=G.prototype.rd,G.prototype.Ed=function(t,e){return A("Query.startAt",0,2,arguments.length),Ea("Query.startAt",1,t,k),Ga("Query.startAt",e),s(t)||(e=t=l),new G(this.o,this.path,this.ta,t,e,this.ra,this.Pa)},G.prototype.startAt=G.prototype.Ed,G.prototype.ld=function(t,e){return A("Query.endAt",0,2,arguments.length),Ea("Query.endAt",1,t,k),Ga("Query.endAt",e),new G(this.o,this.path,this.ta,this.Z,this.la,t,e)},G.prototype.endAt=G.prototype.ld,G.prototype.Ia=function(){var t=Ka(Ja(this));return"{}"===t?"default":t},r=I.prototype,r.toString=function(){for(var t="",e=this.X;e<this.m.length;e++)""!==this.m[e]&&(t+="/"+this.m[e]);return t||"/"},r.parent=function(){if(this.X>=this.m.length)return l;for(var t=[],e=this.X;e<this.m.length-1;e++)t.push(this.m[e]);return new I(t,0)},r.C=function(t){for(var e=[],n=this.X;n<this.m.length;n++)e.push(this.m[n]);if(t instanceof I)for(n=t.X;n<t.m.length;n++)e.push(t.m[n]);else for(t=t.split("/"),n=0;n<t.length;n++)0<t[n].length&&e.push(t[n]);return new I(e,0)},r.f=function(){return this.X>=this.m.length},r.contains=function(t){var e=0;if(this.m.length>t.m.length)return o;for(;e<this.m.length;){if(this.m[e]!==t.m[e])return o;++e}return k},r=Ra.prototype,r.j=function(){return this.u.value},r.Eb=function(){return 0<this.u.hc},r.f=function(){return this.j()===l&&!this.Eb()},r.B=function(t){for(var e in this.u.children)t(new Ra(e,this,this.u.children[e]))},r.path=function(){return new I(this.ob===l?this.ua:this.ob.path()+"/"+this.ua)},r.name=aa("ua"),r.parent=aa("ob"),r=Va.prototype,r.ia=function(t,e){return new Va(this.Ma,this.Y.ia(t,e,this.Ma).copy(l,l,o,l,l))},r.remove=function(t){return new Va(this.Ma,this.Y.remove(t,this.Ma).copy(l,l,o,l,l))},r.get=function(t){for(var e,n=this.Y;!n.f();){if(e=this.Ma(t,n.key),0===e)return n.value;0>e?n=n.left:0<e&&(n=n.right)}return l},r.f=function(){return this.Y.f()},r.count=function(){return this.Y.count()},r.ib=function(){return this.Y.ib()},r.Sa=function(){return this.Y.Sa()},r.sa=function(t){return this.Y.sa(t)},r.Ja=function(t){return this.Y.Ja(t)},r.Qa=function(t){return new Za(this.Y,t)},r=ab.prototype,r.copy=function(t,e,n,i,r){return new ab(t!=l?t:this.key,e!=l?e:this.value,n!=l?n:this.color,i!=l?i:this.left,r!=l?r:this.right)},r.count=function(){return this.left.count()+1+this.right.count()},r.f=p(o),r.sa=function(t){return this.left.sa(t)||t(this.key,this.value)||this.right.sa(t)},r.Ja=function(t){return this.right.Ja(t)||t(this.key,this.value)||this.left.Ja(t)},r.ib=function(){return bb(this).key},r.Sa=function(){return this.right.f()?this.key:this.right.Sa()},r.ia=function(t,e,n){var i,r;return r=this,i=n(t,r.key),r=0>i?r.copy(l,l,l,r.left.ia(t,e,n),l):0===i?r.copy(l,e,l,l,l):r.copy(l,l,l,l,r.right.ia(t,e,n)),cb(r)},r.remove=function(t,e){var n,i;if(n=this,0>e(t,n.key))!n.left.f()&&!n.left.H()&&!n.left.left.H()&&(n=eb(n)),n=n.copy(l,l,l,n.left.remove(t,e),l);else{if(n.left.H()&&(n=gb(n)),!n.right.f()&&!n.right.H()&&!n.right.left.H()&&(n=hb(n),n.left.left.H()&&(n=gb(n),n=hb(n))),0===e(t,n.key)){if(n.right.f())return Xa;i=bb(n.right),n=n.copy(i.key,i.value,l,l,db(n.right))}n=n.copy(l,l,l,l,n.right.remove(t,e))}return cb(n)},r.H=aa("color"),r=jb.prototype,r.copy=function(){return this},r.ia=function(t,e){return new ab(t,e,j,j,j)},r.remove=function(){return this},r.get=p(l),r.count=p(0),r.f=p(k),r.sa=p(o),r.Ja=p(o),r.ib=p(l),r.Sa=p(l),r.H=p(o);var Xa=new jb,kb=Array.prototype,lb=kb.forEach?function(t,e,n){kb.forEach.call(t,e,n)}:function(e,n,i){for(var r=e.length,o=t(e)?e.split(""):e,a=0;a<r;a++)a in o&&n.call(i,o[a],a,e)},mb=kb.map?function(t,e,n){return kb.map.call(t,e,n)}:function(e,n,i){for(var r=e.length,o=Array(r),a=t(e)?e.split(""):e,s=0;s<r;s++)s in a&&(o[s]=n.call(i,a[s],s,e));return o};ka(ob,nb),ob.prototype.reset=function(){this.z[0]=1732584193,this.z[1]=4023233417,this.z[2]=2562383102,this.z[3]=271733878,this.z[4]=3285377520,this.Ac=this.eb=0},ob.prototype.update=function(e,n){s(n)||(n=e.length);var i=this.gc,r=this.eb,o=0;if(t(e))for(;o<n;)i[r++]=e.charCodeAt(o++),64==r&&(pb(this,i),r=0);else for(;o<n;)i[r++]=e[o++],64==r&&(pb(this,i),r=0);this.eb=r,this.Ac+=n},qb.prototype.setItem=function(t,e){D(this.La,t)||(this.length+=1),this.La[t]=e},qb.prototype.getItem=function(t){return D(this.La,t)?this.La[t]:l},qb.prototype.removeItem=function(t){D(this.La,t)&&(this.length-=1,delete this.La[t])};var N=l;if("undefined"!=typeof sessionStorage)try{sessionStorage.setItem("firebase-sentinel","cache"),sessionStorage.removeItem("firebase-sentinel"),N=sessionStorage}catch(rb){N=new qb}else N=new qb;sb.prototype.toString=function(){return(this.Yb?"https://":"http://")+this.host};var ub,vb,wb,xb;xb=wb=vb=ub=o;var zb;if(zb=yb()){var Ab=ba.navigator;ub=0==zb.indexOf("Opera"),vb=!ub&&-1!=zb.indexOf("MSIE"),wb=!ub&&-1!=zb.indexOf("WebKit"),xb=!ub&&!wb&&"Gecko"==Ab.product}var Bb=vb,Cb=xb,Db=wb,Eb;if(ub&&ba.opera){var Fb=ba.opera.version;"function"==typeof Fb&&Fb()}else Cb?Eb=/rv\:([^\);]+)(\)|;)/:Bb?Eb=/MSIE\s+([^\);]+)(\)|;)/:Db&&(Eb=/WebKit\/(\S+)/),Eb&&Eb.exec(yb());var Gb=l,Hb=l,Jb,Kb=1;Jb=function(){return Kb++};var Nb=l,Ob=k,Yb=0;r=ac.prototype,r.J=p(k),r.k=aa("Ua"),r.ec=function(t){return new ac(this.oa,t)},r.N=function(){return O},r.F=function(t){return F(t)===l?this:O},r.T=p(l),r.D=function(t,e){return new P(new Va,this.Ua).D(t,e)},r.Ya=function(t,e){var n=F(t);return n===l?e:this.D(n,O.Ya(La(t),e))},r.f=p(o),r.Hb=p(0),r.P=function(t){return t&&this.k()!==l?{".value":this.j(),".priority":this.k()}:this.j()},r.hash=function(){var t="";this.k()!==l&&(t+="priority:"+bc(this.k())+":");var e=typeof this.oa,t=t+(e+":"),t="number"===e?t+$b(this.oa):t+this.oa;return Lb(t)},r.j=aa("oa"),r.toString=function(){return"string"==typeof this.oa?'"'+this.oa+'"':this.oa},r=P.prototype,r.J=p(o),r.k=aa("Ua"),r.ec=function(t){return new P(this.R,t)},r.D=function(t,e){var n=this.R.remove(t);return e&&e.f()&&(e=l),e!==l&&(n=n.ia(t,e)),e&&e.k()!==l?new cc(n,l,this.Ua):new P(n,this.Ua)},r.Ya=function(t,e){var n=F(t);if(n===l)return e;var i=this.N(n).Ya(La(t),e);return this.D(n,i)},r.f=function(){return this.R.f()},r.Hb=function(){return this.R.count()};var dc=/^\d+$/;r=P.prototype,r.P=function(t){if(this.f())return l;var e={},n=0,i=0,r=k;if(this.B(function(a,s){e[a]=s.P(t),n++,r&&dc.test(a)?i=Math.max(i,Number(a)):r=o}),!t&&r&&i<2*n){var a,s=[];for(a in e)s[a]=e[a];return s}return t&&this.k()!==l&&(e[".priority"]=this.k()),e},r.hash=function(){var t="";return this.k()!==l&&(t+="priority:"+bc(this.k())+":"),this.B(function(e,n){var i=n.hash();""!==i&&(t+=":"+e+":"+i)}),""===t?"":Lb(t)},r.N=function(t){return t=this.R.get(t),t===l?O:t},r.F=function(t){var e=F(t);return e===l?this:this.N(e).F(La(t))},r.T=function(t){return Ya(this.R,t)},r.Kc=function(){return this.R.ib()},r.Lc=function(){return this.R.Sa()},r.B=function(t){return this.R.sa(t)},r.lc=function(t){return this.R.Ja(t)},r.Qa=function(){return this.R.Qa()},r.toString=function(){var t="{",e=k;return this.B(function(n,i){e?e=o:t+=", ",t+='"'+n+'" : '+i.toString()}),t+="}"};var O=new P(new Va);ka(cc,P),r=cc.prototype,r.D=function(t,e){var n=this.N(t),i=this.R,r=this.ka;return n!==l&&(i=i.remove(t),r=r.remove({name:t,wa:n.k()})),e&&e.f()&&(e=l),e!==l&&(i=i.ia(t,e),r=r.ia({name:t,wa:e.k()},e)),new cc(i,r,this.k())},r.T=function(t,e){var n=Ya(this.ka,{name:t,wa:e.k()});return n?n.name:l},r.B=function(t){return this.ka.sa(function(e,n){return t(e.name,n)})},r.lc=function(t){return this.ka.Ja(function(e,n){return t(e.name,n)})},r.Qa=function(){return this.ka.Qa(function(t,e){return{key:t.name,value:e}})},r.Kc=function(){return this.ka.f()?l:this.ka.ib().name},r.Lc=function(){return this.ka.f()?l:this.ka.Sa().name},R.prototype.P=function(){return A("Firebase.DataSnapshot.val",0,0,arguments.length),this.u.P()},R.prototype.val=R.prototype.P,R.prototype.md=function(){return A("Firebase.DataSnapshot.exportVal",0,0,arguments.length),this.u.P(k)},R.prototype.exportVal=R.prototype.md,R.prototype.C=function(t){A("Firebase.DataSnapshot.child",0,1,arguments.length),ga(t)&&(t=String(t)),Ha("Firebase.DataSnapshot.child",t);var e=new I(t),n=this.Vb.C(e);return new R(this.u.F(e),n)},R.prototype.child=R.prototype.C,R.prototype.mc=function(t){A("Firebase.DataSnapshot.hasChild",1,1,arguments.length),Ha("Firebase.DataSnapshot.hasChild",t);var e=new I(t);return!this.u.F(e).f()},R.prototype.hasChild=R.prototype.mc,R.prototype.k=function(){return A("Firebase.DataSnapshot.getPriority",0,0,arguments.length),this.u.k()},R.prototype.getPriority=R.prototype.k,R.prototype.forEach=function(t){if(A("Firebase.DataSnapshot.forEach",1,1,arguments.length),C("Firebase.DataSnapshot.forEach",1,t,o),this.u.J())return o;var e=this;return this.u.B(function(n,i){return t(new R(i,e.Vb.C(n)))})},R.prototype.forEach=R.prototype.forEach,R.prototype.Eb=function(){return A("Firebase.DataSnapshot.hasChildren",0,0,arguments.length),this.u.J()?o:!this.u.f()},R.prototype.hasChildren=R.prototype.Eb,R.prototype.name=function(){return A("Firebase.DataSnapshot.name",0,0,arguments.length),this.Vb.name()},R.prototype.name=R.prototype.name,R.prototype.Hb=function(){return A("Firebase.DataSnapshot.numChildren",0,0,arguments.length),this.u.Hb()},R.prototype.numChildren=R.prototype.Hb,R.prototype.wd=function(){return A("Firebase.DataSnapshot.ref",0,0,arguments.length),this.Vb},R.prototype.ref=R.prototype.wd,hc.prototype.get=function(){return gc(this.$a)},jc.prototype.get=function(){var t=this.jd.get(),e=gc(t);if(this.Fb)for(var n in this.Fb)e[n]-=this.Fb[n];return this.Fb=t,e},kc.prototype.Uc=function(){var t,e=this.$b.get(),n={},i=o;for(t in e)0<e[t]&&D(this.ad,t)&&(n[t]=e[t],i=k);i&&(e=this.n,e.S&&(n={c:n},e.e("reportStats",n),e.ya("s",n))),setTimeout(u(this.Uc,this),6e5*Math.random())};var lc={},mc={},oc=l;"undefined"!=typeof MozWebSocket?oc=MozWebSocket:"undefined"!=typeof WebSocket&&(oc=WebSocket);var qc;pc.prototype.open=function(t,e){this.da=e,this.Mb=t,this.e("websocket connecting to "+this.Na),this.U=new oc(this.Na),this.ab=o;var n=this;this.U.onopen=function(){n.e("Websocket connected."),n.ab=k},this.U.onclose=function(){n.e("Websocket connection was disconnected."),n.U=l,n.Ha()},this.U.onmessage=function(t){if(n.U!==l)if(t=t.data,ic(n.$,"bytes_received",t.length),rc(n),n.frames!==l)sc(n,t);else{t:{if(z(n.frames===l,"We already have a frame buffer"),4>=t.length){var e=Number(t);if(!isNaN(e)){n.zc=e,n.frames=[],t=l;break t}}n.zc=1,n.frames=[]}t!==l&&sc(n,t)}},this.U.onerror=function(){n.e("WebSocket error.  Closing connection."),n.Ha()}},pc.prototype.start=function(){},pc.isAvailable=function(){return!("undefined"!=typeof navigator&&"Opera"===navigator.appName||oc===l||qc)},pc.prototype.send=function(t){rc(this),t=y(t),ic(this.$,"bytes_sent",t.length),t=Zb(t,16384),1<t.length&&this.U.send(String(t.length));for(var e=0;e<t.length;e++)this.U.send(t[e])},pc.prototype.xb=function(){this.Ea=k,this.gb&&(clearTimeout(this.gb),this.gb=l),this.U&&(this.U.close(),this.U=l)},pc.prototype.Ha=function(){this.Ea||(this.e("WebSocket is closing itself"),this.xb(),this.da&&(this.da(this.ab),this.da=l))},pc.prototype.close=function(){this.Ea||(this.e("WebSocket is being closed"),this.xb())},r=tc.prototype,r.add=function(t,e){this.set[t]=e!==l?e:k},r.contains=function(t){return D(this.set,t)},r.get=function(t){return this.set[t]},r.remove=function(t){delete this.set[t]},r.f=function(){var t;t:{for(t in this.set){t=o;break t}t=k}return t},r.count=function(){var t,e=0;for(t in this.set)e++;return e},r.keys=function(){var t,e=[];for(t in this.set)D(this.set,t)&&e.push(t);return e};var uc="pLPCommand",vc="pRTLPCB",xc,yc;wc.prototype.open=function(t,e){function n(){if(!i.Ea){i.ea=new zc(function(t,e,n,r,a){if(ic(i.$,"bytes_received",y(arguments).length),i.ea)if(i.Ba&&(clearTimeout(i.Ba),i.Ba=l),i.ab=k,"start"==t)i.id=e,i.Tc=n;else if("close"===t)if(e){i.ea.Zc=o;var s=i.Pc;s.ic=e,s.Ga=function(){i.Ha()},s.ic<s.Oa&&(s.Ga(),s.Ga=l)}else i.Ha();else g(Error("Unrecognized command received: "+t))},function(t,e){ic(i.$,"bytes_received",y(arguments).length);var n=i.Pc;for(n.Qb[t]=e;n.Qb[n.Oa];){var r=n.Qb[n.Oa];delete n.Qb[n.Oa];for(var o=0;o<r.length;++o)r[o]&&n.sc(r[o]);if(n.Oa===n.ic){n.Ga&&(clearTimeout(n.Ga),n.Ga(),n.Ga=l);break}n.Oa++}},function(){i.Ha()},i.Ab);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),i.ea.cc&&(t.cb=i.ea.cc),t.v="5",i.Zb&&(t.s=i.Zb),t=i.Ab(t),i.e("Connecting via long-poll to "+t),Ac(i.ea,t,function(){})}}this.Ec=0,this.va=e,this.Pc=new fc(t),this.Ea=o;var i=this;if(this.Ba=setTimeout(function(){i.e("Timed out trying to connect."),i.Ha(),i.Ba=l},3e4),"complete"===document.readyState)n();else{var r=o,a=function(){document.body?r||(r=k,n()):setTimeout(a,10)};document.addEventListener?(document.addEventListener("DOMContentLoaded",a,o),window.addEventListener("load",a,o)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&a()},o),window.attachEvent("onload",a,o))}},wc.prototype.start=function(){var t=this.ea,e=this.Tc;for(t.td=this.id,t.ud=e,t.fc=k;Bc(t););t=this.id,e=this.Tc,this.Ta=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,t=this.Ab(n),this.Ta.src=t,this.Ta.style.display="none",document.body.appendChild(this.Ta)},wc.isAvailable=function(){return!yc&&(xc||k)},wc.prototype.xb=function(){this.Ea=k,this.ea&&(this.ea.close(),this.ea=l),this.Ta&&(document.body.removeChild(this.Ta),this.Ta=l),this.Ba&&(clearTimeout(this.Ba),this.Ba=l)},wc.prototype.Ha=function(){this.Ea||(this.e("Longpoll is closing itself"),this.xb(),this.va&&(this.va(this.ab),this.va=l))},wc.prototype.close=function(){this.Ea||(this.e("Longpoll is being closed."),this.xb())},wc.prototype.send=function(t){t=y(t),ic(this.$,"bytes_sent",t.length);for(var t=ra(t),t=Ib(t,k),t=Zb(t,1840),e=0;e<t.length;e++){var n=this.ea;n.qb.push({Ad:this.Ec,Gd:t.length,Fc:t[e]}),n.fc&&Bc(n),this.Ec++}},zc.prototype.close=function(){if(this.fc=o,this.ca){this.ca.qa.body.innerHTML="";var t=this;setTimeout(function(){t.ca!==l&&(document.body.removeChild(t.ca),t.ca=l)},0)}var e=this.da;e&&(this.da=l,e())};var Dc=[wc,{isAvailable:p(o)},pc];Ec.prototype.wc=function(t){t={t:"d",d:t},1!==this.ma&&g("Connection is not connected"),this.yb.send(t)},Ec.prototype.Kb=function(t){this.sc(t)},Ec.prototype.close=function(){2!==this.ma&&(this.e("Closing realtime connection."),this.ma=2,Jc(this),this.va&&(this.va(),this.va=l))};var Lc=0,Mc=0;r=Kc.prototype,r.ya=function(t,e,n,i){var r=++this.zd,t={r:r,a:t,b:e};this.e(y(t)),this.S?this.sb.wc(t):this.Rb.push(t);var o=this,t=setTimeout(function(){var t=o.xa[r];t&&(delete o.xa[r],t.ha&&t.ha.Nb&&t.ha.Nb())},45e3);this.xa[r]={ha:{Mb:n,Nb:i},bd:t}},r.Za=function(t,e,n){this.Ca={kd:t,Ic:o,fa:e,Cb:n},this.e("Authenticating using credential: "+this.Ca),Pc(this)},r.zb=function(){delete this.Ca,this.kb(o),this.S&&this.ya("unauth",{},function(){},function(){})},r.dd=function(t,e,n){if(t=t.toString(),Oc(this,t,e)&&this.S){this.e("Unlisten on "+t+" for "+e);var i=this,t={p:t},n=mb(n,function(t){return Ja(t)});"{}"!==e&&(t.q=n),this.ya("u",t,l,function(){i.e("timed out on unlisten...")})}},r.qc=function(t,e){this.S?Rc(this,"oc",t,l,e):this.lb.push({uc:t,action:"oc",data:l,A:e})},r.put=function(t,e,n,i){Sc(this,"p",t,e,n,i)},r.Kb=function(t){if("r"in t){this.e("from server: "+y(t));var e=t.r,n=this.xa[e];n&&(delete this.xa[e],clearTimeout(n.bd),n.ha&&n.ha.Mb&&n.ha.Mb(t.b))}else"error"in t&&g("A server-side error has occurred: "+t.error),"a"in t&&(e=t.a,t=t.b,this.e("handleServerMessage",e,t),"d"===e?this.Lb(t.p,t.d):"m"===e?this.Lb(t.p,t.d,k):"c"===e?(e=t.p,t=(t=t.q)?mb(t,function(t){return Ka(t)}).join("$"):"{}",(t=Oc(this,e,t))&&t.A&&t.A("permission_denied")):"ac"===e?(e=t.s,t=t.d,n=this.Ca,delete this.Ca,n&&n.Cb&&n.Cb(e,t),this.kb(o)):"sd"===e?this.vc?this.vc(t):"msg"in t&&"undefined"!=typeof console&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: ")):Tb("Unrecognized action received from server: "+y(e)+"\nAre you using the latest client?"))},r.mb=function(t){for(this.e("connection ready"),this.S=k,this.hb=(new Date).getTime(),Yb=t-(new Date).getTime(),t=0;t<this.Rb.length;t++)this.sb.wc(this.Rb[t]);for(this.Rb=[],Pc(this),t=0;t<this.O.length;t++)this.O[t]&&Tc(this,t);for(var e in this.ba)for(var n in this.ba[e])t=this.ba[e][n],Nc(this,e,n,t.Va,t.A);for(;this.lb.length;)e=this.lb.shift(),Rc(this,e.action,e.uc,e.data,e.A);this.Jb(k)},r.Rc=function(){this.S=o,this.e("data client disconnected");var t=u(function(){this.Gc()},this);if(this.wb){this.hb&&(3e4<(new Date).getTime()-this.hb&&(this.Ub=1e3),this.hb=l);var e=Math.max(0,this.Ub-((new Date).getTime()-this.Oc)),e=Math.random()*e;this.e("Trying to reconnect in "+e+"ms"),setTimeout(t,e),this.Ub=Math.min(3e5,1.5*this.Ub)}else{for(var n=0;n<this.O.length;n++){var i=this.O[n];i&&"h"in i.Vc&&(i.A&&i.A("disconnect"),delete this.O[n],this.nb--)}0===this.nb&&(this.O=[]);for(e in this.xa)n=this.xa[e],delete this.xa[e],n!==l&&(n.ha&&n.ha.Nb&&n.ha.Nb(),clearTimeout(n.bd));this.Xc=function(){setTimeout(t,0)}}this.Jb(o)},r.Gc=function(){if(this.wb){this.e("Making a connection attempt"),this.Oc=(new Date).getTime(),this.hb=l;var t=u(this.Kb,this),e=u(this.mb,this),n=u(this.Rc,this),i=this.id+":"+Mc++,r=this;this.sb=new Ec(i,this.M,t,e,n,function(t){r.wb=o,g(Error(t))})}},r.Ra=function(){this.wb=o,this.sb?this.sb.close():this.Rc()},r.ub=function(){this.wb=k,this.Xc(),this.Xc=j},Uc.prototype.toString=function(){return this.Ka.toString()},Vc.prototype.set=function(t,e){var n=this,i=[];return lb(e,function(t){var e=t.path,t=t.Fa,r=Jb();M(J(n.pb,e),r),U(n.K,e,t),i.push({path:e,Bd:r})}),i},ad.prototype.Sb=function(t,e){e=this.Tb(t,e),e!=l&&fd(this,e)},ka(hd,ad),hd.prototype.Tb=function(t,e){return this.g=t,this.fb&&e!=l&&e.push(new V("value",this.g)),e},hd.prototype.bb=function(){return{}},ka(md,tc),r=md.prototype,r.setActive=function(t){this.na=t},r.defaultView=function(){return nd(this)?this.get("default"):l},r.path=aa("L"),r.toString=function(){return mb(this.keys(),function(t){return"default"===t?"{}":t}).join("$")},r.Va=function(){var t=[];return S(this.set,function(e){t.push(e.I)}),t},ka(pd,ad),pd.prototype.Tb=function(t,e){if(e===l)return e;var n=[],i=this.I;s(i.Z)&&(s(i.la)&&i.la!=l?n.push(function(t,e){var n=Wb(e,i.Z);return 0<n||0===n&&t>=i.la}):n.push(function(t,e){return 0<=Wb(e,i.Z)})),s(i.ra)&&(s(i.Pa)?n.push(function(t,e){var n=Wb(e,i.ra);return 0>n||0===n&&t<=i.Pa}):n.push(function(t,e){return 0>=Wb(e,i.ra)}));var r=l,a=l;if(s(this.I.ta))if(s(this.I.Z)){if(r=qd(t,n,this.I.ta,o)){var c=t.N(r).k();n.push(function(t,e){var n=Wb(e,c);return 0>n||0===n&&t<=r})}}else if(a=qd(t,n,this.I.ta,k)){var h=t.N(a).k();n.push(function(t,e){var n=Wb(e,h);return 0<n||0===n&&t>=a})}for(var u=[],f=[],p=[],d=[],b=0;b<e.length;b++){var y=e[b].V,g=e[b].ja;switch(e[b].type){case"child_added":rd(n,y,g)&&(this.g=this.g.D(y,g),f.push(e[b]));break;case"child_removed":this.g.N(y).f()||(this.g=this.g.D(y,l),u.push(e[b]));break;case"child_changed":!this.g.N(y).f()&&rd(n,y,g)&&(this.g=this.g.D(y,g),d.push(e[b]));break;case"child_moved":var v=!this.g.N(y).f(),m=rd(n,y,g);v?m?(this.g=this.g.D(y,g),p.push(e[b])):(u.push(new V("child_removed",this.g.N(y),y)),this.g=this.g.D(y,l)):m&&(this.g=this.g.D(y,g),f.push(e[b]))}}var w=r||a;if(w){var F=(b=a!==l)?this.g.Kc():this.g.Lc(),S=o,A=o,E=this;(b?t.lc:t.B).call(t,function(t,e){return!A&&F===l&&(A=k),A&&S?k:(S?(u.push(new V("child_removed",E.g.N(t),t)),E.g=E.g.D(t,l)):A&&(f.push(new V("child_added",e,t)),E.g=E.g.D(t,e)),F===t&&(A=k),void(t===w&&(S=k)))})}for(b=0;b<f.length;b++)n=f[b],y=this.g.T(n.V,n.ja),u.push(new V("child_added",n.ja,n.V,y));for(b=0;b<p.length;b++)n=p[b],y=this.g.T(n.V,n.ja),u.push(new V("child_moved",n.ja,n.V,y));for(b=0;b<d.length;b++)n=d[b],y=this.g.T(n.V,n.ja),u.push(new V("child_changed",n.ja,n.V,y));return this.fb&&0<u.length&&u.push(new V("value",this.g)),u},pd.prototype.mc=function(t){return this.g.N(t)!==O},pd.prototype.bb=function(t,e,n){var i={};this.g.J()||this.g.B(function(t){i[t]=k});var r=this.g,n=T(n,new I("")),o=new Ra;M(J(o,this.I.path),k);var a=O.Ya(t,e),s=[];return jd(n,a,t,o,function(t,e,n){n!==l&&(s=s.concat(n))}),this.Tb(e,s),this.g.J()||this.g.B(function(t){i[t]=k}),this.g=r,i},sd.prototype.Bb=function(t,e,n,i,r){var o=t.path,a=J(this.pa,o),s=a.j();s===l?(s=new md,M(a,s)):z(!s.f(),"We shouldn't be storing empty QueryMaps");var c=t.Ia();if(s.contains(c))bd(s.get(c),e,n,i,r);else{var h=this.i.Ka.F(o),t="default"===t.Ia()?new hd(t,h):new pd(t,h);if(od(s)||td(a))s.add(c,t),s.L||(s.L=t.I.path);else{var u,f;s.f()||(u=s.toString(),f=s.Va()),s.add(c,t),s.L||(s.L=t.I.path),s.setActive(ud(this,s)),u&&f&&this.n.dd(s.path(),u,f)}od(s)&&Ta(a,function(t){(t=t.j())&&(t.na&&t.na(),t.na=l)}),bd(t,e,n,i,r),(e=(e=Ua(J(this.pa,o),function(t){var e;if((e=t.j())&&(e=t.j().defaultView())&&(e=t.j().defaultView().fb),e)return k},k))||this.n===l)&&gd(t)}},sd.prototype.Wb=function(t,e,n,i){var r=J(this.pa,t.path).j();return r===l?l:wd(this,r,t,e,n,i)},sd.prototype.Sb=function(t,e,n){t=J(this.pa,t).j(),t!==l&&S(t.set,function(t){t.Sb(e,n)})},sd.prototype.bb=function(t,e,n,i){var r={};return S(e.set,function(e){e=e.bb(t,n,i),S(e,function(t,e){r[e]=t?k:ua(r,e)||o})}),n.J()||n.B(function(t){D(r,t)||(r[t]=o)}),r},r=Cd.prototype,r.toString=function(){return(this.M.Yb?"https://":"http://")+this.M.host},r.name=function(){return this.M.jb},r.Lb=function(t,e,n){var i=[],r=l;if(9<=t.length&&t.lastIndexOf(".priority")===t.length-9)t=new I(t.substring(0,t.length-9)),n=T(this.i.za,t).ec(e),i.push(t);else if(n){var a,r=e,t=new I(t),n=T(this.i.za,t);for(a in e){var s=Q(e[a]),n=n.D(a,s);i.push(t.C(a))}}else t=new I(t),n=Q(e),i.push(t);for(e=Bd(this.Q,t,n,this.i.K,r),r=o,a=0;a<e.length;++a){var n=e[a],s=this.i,c=n.path;U(s.za,c,n.Fa),r=Wc(s,c)||r}r&&(t=Ed(this,t),Fd(this,t),t=t.path()),yd(this.Q,t,i)},r.Jb=function(t){Dd(this,"connected",t)},r.kb=function(t){Dd(this,"authenticated",t)},r.Za=function(t,e,n){this.n.Za(t,function(t,n){X(e,t,n)},function(t,e){if(Vb("auth() was canceled: "+e),n){var i=Error(e);i.code=t.toUpperCase(),n(i)}})},r.zb=function(){this.n.zb()},r.Xa=function(t,e,n,i){this.e("set",{path:t.toString(),value:e});var e=Q(e,n),n=Bd(this.Q,t,e,this.i.K,l),r=this.i.set(t,n),o=this;this.n.put(t.toString(),e.P(k),function(e){var n="ok"===e;Yc(o.i,r),n||(Vb("set at "+t+" failed: "+e),Wc(o.i,t),n=Ed(o,t),Fd(o,n),yd(o.Q,n.path(),[])),X(i,e)}),e=Ed(this,t),Gd(this,t),Fd(this,e),yd(this.Q,e.path(),[t])},r.update=function(t,e,n){this.e("update",{path:t.toString(),value:e});var i,r=T(this.i.Aa,t),a=k,s=[];for(i in e){var a=o,c=Q(e[i]),r=r.D(i,c);s.push(t.C(i))}if(a)Pb("update() called with empty data.  Don't do anything."),X(n,"ok");else{var r=Bd(this.Q,t,r,this.i.K,e),h=this.i.set(t,r),u=this;Sc(this.n,"m",t.toString(),e,function(e){z("ok"===e||"permission_denied"===e,"merge at "+t+" failed."),Yc(u.i,h),X(n,e)},j),e=Ed(this,t),Gd(this,t),Fd(this,e),yd(this.Q,e.path(),s)}},r.xc=function(t,e,n){this.e("setPriority",{path:t.toString(),wa:e});var i=T(this.i.K,t).ec(e),i=Bd(this.Q,t,i,this.i.K,l),r=this.i.set(t,i),o=this;this.n.put(t.toString()+"/.priority",e,function(t){Yc(o.i,r),X(n,t)}),t=Ed(this,t),Fd(this,t),yd(this.Q,t.path(),[])},r.qc=function(t,e){this.n.qc(t.toString(),function(t){X(e,t)})},r.Bb=function(t,e,n,i,r){".info"===F(t.path)?this.nc.Bb(t,e,n,i,r):this.Q.Bb(t,e,n,i,r)},r.Wb=function(t,e,n,i){if(".info"===F(t.path))this.nc.Wb(t,e,n,i);else if(e=this.Q.Wb(t,e,n,i),e!==l){for(var n=this.i,t=t.path,i=[],r=0;r<e.length;++r)i[r]=T(n.za,e[r]);for(U(n.za,t,O),r=0;r<e.length;++r)U(n.za,e[r],i[r])}},r.Ra=function(){this.n.Ra()},r.ub=function(){this.n.ub()},r.yc=function(t){if("undefined"!=typeof console){t?(this.$b||(this.$b=new jc(this.$)),t=this.$b.get()):t=this.$.get();var e,n=t,i=[],r=0;for(e in n)i[r++]=e;var o=function(t,e){return Math.max(e.length,t)};if(i.reduce)e=i.reduce(o,0);else{var a=0;lb(i,function(t){a=o.call(j,a,t)}),e=a}for(var s in t){for(n=t[s],i=s.length;i<e+2;i++)s+=" ";console.log(s+n)}}},r.e=function(){Pb("r:"+this.n.id+":",arguments)},Y.pd=function(){return Y.Nc?Y.Nc:Y.Nc=new Y},Y.prototype.Ra=function(){for(var t in this.Wa)this.Wa[t].Ra()},Y.prototype.interrupt=Y.prototype.Ra,Y.prototype.ub=function(){for(var t in this.Wa)this.Wa[t].ub()},Y.prototype.resume=Y.prototype.ub;var Z={qd:function(t){var e=P.prototype.hash;return P.prototype.hash=t,function(){P.prototype.hash=e}}};Z.hijackHash=Z.qd,Z.Ia=function(t){return t.Ia()},Z.queryIdentifier=Z.Ia,Z.sd=function(t){return t.o.n.ba},Z.listens=Z.sd,Z.xd=function(t){return t.o.n.sb},Z.refConnection=Z.xd,Z.fd=Kc,Z.DataConnection=Z.fd,Kc.prototype.sendRequest=Kc.prototype.ya,Kc.prototype.interrupt=Kc.prototype.Ra,Z.gd=Ec,Z.RealTimeConnection=Z.gd,Ec.prototype.sendRequest=Ec.prototype.wc,Ec.prototype.close=Ec.prototype.close,Z.ed=sb,Z.ConnectionTarget=Z.ed,Z.nd=function(){xc=qc=k},Z.forceLongPolling=Z.nd,Z.od=function(){yc=k},Z.forceWebSockets=Z.od,Z.Dd=function(t,e){t.o.n.vc=e},Z.setSecurityDebugCallback=Z.Dd,Z.yc=function(t,e){t.o.yc(e)},Z.stats=Z.yc,ca("fb.api.onDisconnect",$),$.prototype.cancel=function(t){A("Firebase.onDisconnect().cancel",0,1,arguments.length),C("Firebase.onDisconnect().cancel",1,t,k),this.tb.qc(this.L,t)},$.prototype.cancel=$.prototype.cancel,$.prototype.remove=function(t){A("Firebase.onDisconnect().remove",0,1,arguments.length),E("Firebase.onDisconnect().remove",this.L),C("Firebase.onDisconnect().remove",1,t,k),Hd(this.tb,this.L,l,t)},$.prototype.remove=$.prototype.remove,$.prototype.set=function(t,e){A("Firebase.onDisconnect().set",1,2,arguments.length),E("Firebase.onDisconnect().set",this.L),za("Firebase.onDisconnect().set",t,o),C("Firebase.onDisconnect().set",2,e,k),Hd(this.tb,this.L,t,e)},$.prototype.set=$.prototype.set,$.prototype.Xa=function(t,e,n){A("Firebase.onDisconnect().setWithPriority",2,3,arguments.length),E("Firebase.onDisconnect().setWithPriority",this.L),za("Firebase.onDisconnect().setWithPriority",t,o),Ea("Firebase.onDisconnect().setWithPriority",2,e,o),C("Firebase.onDisconnect().setWithPriority",3,n,k),(".length"===this.ua||".keys"===this.ua)&&g("Firebase.onDisconnect().setWithPriority failed: "+this.ua+" is a read-only object.");var i=this.tb,r=this.L,a=Q(t,e);Qc(i.n,r.toString(),a.P(k),function(t){X(n,t)})},$.prototype.setWithPriority=$.prototype.Xa,$.prototype.update=function(t,e){A("Firebase.onDisconnect().update",1,2,arguments.length),E("Firebase.onDisconnect().update",this.L),Da("Firebase.onDisconnect().update",t),C("Firebase.onDisconnect().update",2,e,k);var n,i=this.tb,r=this.L,a=k;for(n in t)a=o;a?(Pb("onDisconnect().update() called with empty data.  Don't do anything."),X(e,k)):(i=i.n,r=r.toString(),a=function(t){X(e,t)},i.S?Rc(i,"om",r,t,a):i.lb.push({uc:r,action:"om",data:t,A:a}))},$.prototype.update=$.prototype.update;var Pd,Qd=0,Rd=[];Pd=function(){var t=(new Date).getTime()+Yb,e=t===Qd;Qd=t;for(var n=Array(8),i=7;0<=i;i--)n[i]="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".charAt(t%64),t=Math.floor(t/64);if(z(0===t),t=n.join(""),e){for(i=11;0<=i&&63===Rd[i];i--)Rd[i]=0;Rd[i]++}else for(i=0;12>i;i++)Rd[i]=Math.floor(64*Math.random());for(i=0;12>i;i++)t+="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz".charAt(Rd[i]);return z(20===t.length,"NextPushId: Length should be 20."),t},ka(W,G),ca("Firebase",W),W.prototype.name=function(){return A("Firebase.name",0,0,arguments.length),this.path.f()?l:Ma(this.path)},W.prototype.name=W.prototype.name,W.prototype.C=function(t){if(A("Firebase.child",1,1,arguments.length),ga(t))t=String(t);else if(!(t instanceof I))if(F(this.path)===l){var e=t;e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ha("Firebase.child",e)}else Ha("Firebase.child",t);return new W(this.o,this.path.C(t))},W.prototype.child=W.prototype.C,W.prototype.parent=function(){A("Firebase.parent",0,0,arguments.length);var t=this.path.parent();return t===l?l:new W(this.o,t)},W.prototype.parent=W.prototype.parent,W.prototype.toString=function(){A("Firebase.toString",0,0,arguments.length);var t;if(this.parent()===l)t=this.o.toString();else{t=this.parent().toString()+"/";var e=this.name();t+=encodeURIComponent(String(e))}return t},W.prototype.toString=W.prototype.toString,W.prototype.set=function(t,e){return A("Firebase.set",1,2,arguments.length),E("Firebase.set",this.path),za("Firebase.set",t,o),C("Firebase.set",2,e,k),this.o.Xa(this.path,t,l,e)},W.prototype.set=W.prototype.set,W.prototype.update=function(t,e){return A("Firebase.update",1,2,arguments.length),E("Firebase.update",this.path),Da("Firebase.update",t),C("Firebase.update",2,e,k),this.o.update(this.path,t,e)},W.prototype.update=W.prototype.update,W.prototype.Xa=function(t,e,n){return A("Firebase.setWithPriority",2,3,arguments.length),E("Firebase.setWithPriority",this.path),za("Firebase.setWithPriority",t,o),Ea("Firebase.setWithPriority",2,e,o),C("Firebase.setWithPriority",3,n,k),(".length"===this.name()||".keys"===this.name())&&g("Firebase.setWithPriority failed: "+this.name()+" is a read-only object."),this.o.Xa(this.path,t,e,n)},W.prototype.setWithPriority=W.prototype.Xa,W.prototype.remove=function(t){A("Firebase.remove",0,1,arguments.length),E("Firebase.remove",this.path),C("Firebase.remove",1,t,k),this.set(l,t)},W.prototype.remove=W.prototype.remove,W.prototype.transaction=function(t,e){function n(){}A("Firebase.transaction",1,2,arguments.length),E("Firebase.transaction",this.path),C("Firebase.transaction",1,t,o),C("Firebase.transaction",2,e,k),(".length"===this.name()||".keys"===this.name())&&g("Firebase.transaction failed: "+this.name()+" is a read-only object.");var i=this.o,r=this.path;i.e("transaction on "+r);var a=new W(i,r);a.oc("value",n);var c={path:r,update:t,A:e,Sc:Jb(),Yc:0,dc:function(){a.Ib("value",n)}},h=i.i.Aa,u=c.update(T(h,r).P());if(s(u)){Aa("transaction failed: Data returned ",u);var f=T(i.i.K,r).k();U(h,r,Q(u,f)),yd(i.Q,r,[r]),c.status=1,r=J(i.ac,r),h=r.j()||[],h.push(c),M(r,h),Ld(i)}else c.dc(),c.A&&(i=Jd(i,r),c.A(l,o,i))},W.prototype.transaction=W.prototype.transaction,W.prototype.xc=function(t,e){A("Firebase.setPriority",1,2,arguments.length),E("Firebase.setPriority",this.path),Ea("Firebase.setPriority",1,t,o),C("Firebase.setPriority",2,e,k),this.o.xc(this.path,t,e)},W.prototype.setPriority=W.prototype.xc,W.prototype.push=function(t,e){A("Firebase.push",0,2,arguments.length),E("Firebase.push",this.path),za("Firebase.push",t,k),C("Firebase.push",2,e,k);var n=Pd(),n=this.C(n);return"undefined"!=typeof t&&t!==l&&n.set(t,e),n},W.prototype.push=W.prototype.push,W.prototype.da=function(){return new $(this.o,this.path,this.name())},W.prototype.onDisconnect=W.prototype.da,W.prototype.yd=function(){Vb("FirebaseRef.removeOnDisconnect() being deprecated. Please use FirebaseRef.onDisconnect().remove() instead."),this.da().remove(),Id(this.o)},W.prototype.removeOnDisconnect=W.prototype.yd,W.prototype.Cd=function(t){Vb("FirebaseRef.setOnDisconnect(value) being deprecated. Please use FirebaseRef.onDisconnect().set(value) instead."),
this.da().set(t),Id(this.o)},W.prototype.setOnDisconnect=W.prototype.Cd,W.prototype.Za=function(e,n,i){A("Firebase.auth",1,3,arguments.length),t(e)||g(Error(B("Firebase.auth",1,o)+"must be a valid credential (a string).")),C("Firebase.auth",2,n,k),C("Firebase.auth",3,n,k),this.o.Za(e,n,i)},W.prototype.auth=W.prototype.Za,W.prototype.zb=function(){this.o.zb()},W.prototype.unauth=W.prototype.zb,W.enableLogging=Qb,W.INTERNAL=Z,W.Context=Y}();
"use strict";function FileBufferReader(){function e(n,r){if(null==n||"object"!=typeof n)return n;if(n.constructor!=Object&&n.constructor!=Array)return n;if(n.constructor==Date||n.constructor==RegExp||n.constructor==Function||n.constructor==String||n.constructor==Number||n.constructor==Boolean)return new n.constructor(n);r=r||new n.constructor;for(var t in n)r[t]="undefined"==typeof r[t]?e(n[t],null):r[t];return r}var n=this,r=new FileBufferReaderHelper;n.chunks={},n.users={},n.readAsArrayBuffer=function(e,t,o){if(!e.slice)return void console.warn("Not a real File object.",e);if(o=o||{userid:0},e.extra)if("string"==typeof e.extra)o.extra=e.extra;else for(var i in e.extra)o[i]=e.extra[i];o.fileName=e.name,e.uuid&&(o.fileUniqueId=e.uuid);var a={uuid:e.uuid||0,file:e,earlyCallback:t,extra:o,chunkSize:o.chunkSize};r.readAsArrayBuffer(n,a)},n.getNextChunk=function(r,t,o){var i=n.chunks[r];if(i){var a;"undefined"!=typeof o?(n.users[o+""]||(n.users[o+""]={fileUUID:r,userid:o,currentPosition:-1}),n.users[o+""].currentPosition++,a=n.users[o+""].currentPosition):(n.chunks[r].currentPosition++,a=n.chunks[r].currentPosition);var u=i[a];u&&(u=e(u),"undefined"!=typeof o&&(u.remoteUserId=o+""),u.start&&n.onBegin(u),u.end&&n.onEnd(u),n.onProgress(u),n.convertToArrayBuffer(u,function(e){return u.currentPosition==u.maxChunks?void t(e,!0):void t(e,!1)}))}};var t=new FileBufferReceiver(n);n.addChunk=function(e,r){return e?void t.receive(e,function(e){n.convertToArrayBuffer({readyForNextChunk:!0,uuid:e},r)}):void console.error("Chunk is missing.")},n.onBegin=function(){},n.onEnd=function(){},n.onProgress=function(){},n.convertToObject=FileConverter.ConvertToObject,n.convertToArrayBuffer=FileConverter.ConvertToArrayBuffer,n.setMultipleUsers=function(){}}function FileBufferReaderHelper(){function e(e){var n=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"}));return window.fileBufferWorker||(window.fileBufferWorker=new Worker(n)),window.fileBufferWorker}function n(e,n){function r(r,i,a){f=Math.ceil(i.byteLength/o);for(var u=0;f>u;u++){var c=u*o;d[A]=i.slice(c,Math.min(c+o,i.byteLength)),n({uuid:t.uuid,buffer:d[A],currentPosition:A,maxChunks:s,size:t.size,name:t.name||e.extra.fileName,lastModifiedDate:t.lastModifiedDate?t.lastModifiedDate.toString():"",type:t.type,extra:e.extra||e}),A++}A==s&&(l=!0),a()}n=n||function(e){postMessage(e)};var t=e.file;t.uuid||(t.uuid=e.fileUniqueId||(100*Math.random()).toString().replace(/\./g,""));var o=e.chunkSize||15e3,i=0,a=o,u=Math.floor(Math.min(1e8,a)/o),c=u*o,s=Math.ceil(t.size/o);t.maxChunks=s;var f,l,A=0,d=[];n({currentPosition:A,uuid:t.uuid,maxChunks:s,size:t.size,name:t.name||e.extra.fileName,type:t.type,lastModifiedDate:t.lastModifiedDate?t.lastModifiedDate.toString():"",start:!0,extra:e.extra||e,url:URL.createObjectURL(t)});var R,h=new FileReader;h.onloadend=function(o){o.target.readyState==FileReader.DONE&&r(t.name,o.target.result,function(){i++,(i+1)*c<t.size?(R=t.slice(i*c,(i+1)*c),h.readAsArrayBuffer(R)):i*c<t.size?(R=t.slice(i*c,t.size),h.readAsArrayBuffer(R)):n({currentPosition:A,uuid:t.uuid,maxChunks:s,size:t.size,name:t.name||e.extra.fileName,lastModifiedDate:t.lastModifiedDate?t.lastModifiedDate.toString():"",url:URL.createObjectURL(t),type:t.type,end:!0,extra:e.extra||e})})},A+=1,R=t.slice(i*c,(i+1)*c),h.readAsArrayBuffer(R)}var r=this;r.readAsArrayBuffer=function(r,t){function o(e){r.chunks[e.uuid]||(r.chunks[e.uuid]={currentPosition:-1}),t.extra=t.extra||{userid:0},e.userid=t.userid||t.extra.userid||0,e.extra=t.extra,r.chunks[e.uuid][e.currentPosition]=e,e.end&&i&&(i(e.uuid),i=null),e.maxChunks>5&&5==e.currentPosition&&i&&(i(e.uuid),i=null)}var i=t.earlyCallback;if(delete t.earlyCallback,navigator.mozGetUserMedia&&(window.___Worker=window.Worker,delete window.Worker),window.Worker&&"function"==typeof Worker){var a=e(n);a.onmessage=function(e){o(e.data)},a.postMessage(t)}else n(t,o),navigator.mozGetUserMedia&&(window.Worker=window.___Worker)}}function FileBufferReceiver(e){function n(i,a){if(!i.uuid)return void e.convertToObject(i,function(e){n(e)});if(i.start&&!t[i.uuid]&&(t[i.uuid]=[],o[i.uuid]&&(t[i.uuid].push(i.buffer),o[i.uuid].forEach(function(e){n(e,a)}),delete o[i.uuid]),e.onBegin&&e.onBegin(i)),!i.end&&i.buffer){if(!t[i.uuid])return o[i.uuid]||(o[i.uuid]=[]),void o[i.uuid].push(i);-1==t[i.uuid].indexOf(i.buffer)&&t[i.uuid].push(i.buffer)}if(i.end){for(var u=t[i.uuid],c=[],s=u.length,f=0;s>f;f++)u[f]&&c.push(u[f]);var l=new Blob(c,{type:i.type});l=r(l,i),l.url=URL.createObjectURL(l),l.uuid=i.uuid||l.extra.fileUniqueId,l.name=l.name||l.extra.fileName,l.size||console.error("Something went wrong. Blob Size is 0."),e.onEnd&&e.onEnd(l)}i.buffer&&e.onProgress&&e.onProgress(i),i.end||a(i.uuid)}function r(e,n){if(e||(e={}),!n)return e;for(var r in n)try{e[r]=n[r]}catch(t){}return e}var t={},o=[];this.receive=n}function merge(e,n){if(e||(e={}),!n)return e;for(var r in n)e[r]=n[r];return e}window.FileSelector=function(){function e(e,r){var t=document.createElement("input");t.type="file",r&&(t.multiple=!0),t.onchange=function(){return r?t.files.length?void e(t.files):void console.error("No file selected."):t.files[0]?(e(t.files[0]),void t.parentNode.removeChild(t)):void console.error("No file selected.")},t.style.display="none",(document.body||document.documentElement).appendChild(t),n(t)}function n(e){var n=new window.MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,button:0,buttons:0,mozInputSource:1});e.dispatchEvent(n)}var r=this;r.selectSingleFile=e,r.selectMultipleFiles=function(n){e(n,!0)}};var FileConverter={ConvertToArrayBuffer:function(e,n){binarize.pack(e,function(e){n(e.buffer)})},ConvertToObject:function(e,n){binarize.unpack(e,n)}};!function(e){var n=!1,r=!1,t=!0,o=Uint8Array.BYTES_PER_ELEMENT,i=Uint16Array.BYTES_PER_ELEMENT,a=Uint32Array.BYTES_PER_ELEMENT,u={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17};if(n)var c=["NULL","UNDEFINED","STRING","NUMBER","BOOLEAN","ARRAY","OBJECT","INT8ARRAY","INT16ARRAY","INT32ARRAY","UINT8ARRAY","UINT16ARRAY","UINT32ARRAY","FLOAT32ARRAY","FLOAT64ARRAY","ARRAYBUFFER","BLOB","BUFFER"];var s=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],f=function(e,n,t){var o=[],i=r,a=40;o[0]=[];for(var u=0;a>u;u++)o[0][u]=10>u?"0"+u.toString(10):u.toString(10);for(u=0;t>u;u++){var c=e.getUint8(n+u,i),s=~~(u/a)+1;"undefined"==typeof o[s]&&(o[s]=[]),o[s][u%a]=16>c?"0"+c.toString(16):c.toString(16)}for(console.log("%c"+o[0].join(" "),"font-weight: bold;"),u=1;u<o.length;u++)console.log(o[u].join(" "))},l=function(e){var n=void 0;if(void 0===e)n=u.UNDEFINED;else if(null===e)n=u.NULL;else{var r=e.constructor.name;if(void 0!==r)n=u[r.toUpperCase()];else switch(typeof e){case"string":n=u.STRING;break;case"number":n=u.NUMBER;break;case"boolean":n=u.BOOLEAN;break;case"object":e instanceof Array?n=u.ARRAY:e instanceof Int8Array?n=u.INT8ARRAY:e instanceof Int16Array?n=u.INT16ARRAY:e instanceof Int32Array?n=u.INT32ARRAY:e instanceof Uint8Array?n=u.UINT8ARRAY:e instanceof Uint16Array?n=u.UINT16ARRAY:e instanceof Uint32Array?n=u.UINT32ARRAY:e instanceof Float32Array?n=u.FLOAT32ARRAY:e instanceof Float64Array?n=u.FLOAT64ARRAY:e instanceof ArrayBuffer?n=u.ARRAYBUFFER:e instanceof Blob?n=u.BLOB:e instanceof Buffer?n=u.BUFFER:e instanceof Object&&(n=u.OBJECT)}}return n},A=function(t){var l=0,A=0,d=0,R=r,h=new ArrayBuffer(t[0].byte_length+t[0].header_size),v=new DataView(h);for(A=0;A<t.length;A++){var U=l,y=t[A].header_size,b=t[A].type,g=t[A].length,N=t[A].value,E=t[A].byte_length,T=s[b],B=null===T?0:e[T+"Array"].BYTES_PER_ELEMENT;switch(b===u.BUFFER?v.setUint8(l,u.BLOB,R):v.setUint8(l,b,R),l+=o,n&&console.info("Packing",b,c[b]),(b===u.ARRAY||b===u.OBJECT)&&(v.setUint16(l,g,R),l+=i,n&&console.info("Content Length",g)),v.setUint32(l,E,R),l+=a,n&&(console.info("Header Size",y,"bytes"),console.info("Byte Length",E,"bytes")),b){case u.NULL:case u.UNDEFINED:break;case u.STRING:for(n&&console.info('Actual Content %c"'+N+'"',"font-weight:bold;"),d=0;g>d;d++,l+=B)v.setUint16(l,N.charCodeAt(d),R);break;case u.NUMBER:case u.BOOLEAN:n&&console.info("%c"+N.toString(),"font-weight:bold;"),v["set"+T](l,N,R),l+=B;break;case u.INT8ARRAY:case u.INT16ARRAY:case u.INT32ARRAY:case u.UINT8ARRAY:case u.UINT16ARRAY:case u.UINT32ARRAY:case u.FLOAT32ARRAY:case u.FLOAT64ARRAY:var p=new Uint8Array(v.buffer,l,E);p.set(new Uint8Array(N.buffer)),l+=E;break;case u.ARRAYBUFFER:case u.BUFFER:var p=new Uint8Array(v.buffer,l,E);p.set(new Uint8Array(N)),l+=E;break;case u.BLOB:case u.ARRAY:case u.OBJECT:break;default:throw"TypeError: Unexpected type found."}n&&f(v,U,l-U)}return v},d=function(t,l){var A,R,h,v,U,y=0,b=r,g=l;A=t.getUint8(l,b),l+=o,n&&console.info("Unpacking",A,c[A]),(A===u.ARRAY||A===u.OBJECT)&&(R=t.getUint16(l,b),l+=i,n&&console.info("Content Length",R)),h=t.getUint32(l,b),l+=a,n&&console.info("Byte Length",h,"bytes");var N=s[A],E=null===N?0:e[N+"Array"].BYTES_PER_ELEMENT;switch(A){case u.NULL:case u.UNDEFINED:n&&f(t,g,l-g),v=null;break;case u.STRING:R=h/E;var T=[];for(y=0;R>y;y++){var B=t.getUint16(l,b);l+=E,T.push(String.fromCharCode(B))}v=T.join(""),n&&(console.info('Actual Content %c"'+v+'"',"font-weight:bold;"),f(t,g,l-g));break;case u.NUMBER:v=t.getFloat64(l,b),l+=E,n&&(console.info('Actual Content %c"'+v.toString()+'"',"font-weight:bold;"),f(t,g,l-g));break;case u.BOOLEAN:v=1===t.getUint8(l,b),l+=E,n&&(console.info('Actual Content %c"'+v.toString()+'"',"font-weight:bold;"),f(t,g,l-g));break;case u.INT8ARRAY:case u.INT16ARRAY:case u.INT32ARRAY:case u.UINT8ARRAY:case u.UINT16ARRAY:case u.UINT32ARRAY:case u.FLOAT32ARRAY:case u.FLOAT64ARRAY:case u.ARRAYBUFFER:U=t.buffer.slice(l,l+h),l+=h,v=A===u.ARRAYBUFFER?U:new e[N+"Array"](U),n&&f(t,g,l-g);break;case u.BLOB:if(n&&f(t,g,l-g),e.Blob){var p=d(t,l),w=d(t,p.cursor);l=w.cursor,v=new Blob([w.value],{type:p.value})}else U=t.buffer.slice(l,l+h),l+=h,v=new Buffer(U);break;case u.ARRAY:for(n&&f(t,g,l-g),v=[],y=0;R>y;y++)U=d(t,l),l=U.cursor,v.push(U.value);break;case u.OBJECT:for(n&&f(t,g,l-g),v={},y=0;R>y;y++){var F=d(t,l),Y=d(t,F.cursor);l=Y.cursor,v[F.value]=Y.value}break;default:throw"TypeError: Type not supported."}return{value:v,cursor:l}},R=function(e,n){for(var r=e.length,t=[],o=0,i=0,a=0;a<e.length;a++)!function(a){h(e[a],function(e){if(t[a]=e,i+=e[0].header_size+e[0].byte_length,++o===r){for(var u=[],c=0;c<t.length;c++)u=u.concat(t[c]);n(u,i)}})}(a)},h=function(n,r){var t,c=[],f=1,A=o+a,d=0,h=0,v=n;switch(t=l(n),f=void 0===s[t]||null===s[t]?0:e[s[t]+"Array"].BYTES_PER_ELEMENT,t){case u.UNDEFINED:case u.NULL:break;case u.NUMBER:case u.BOOLEAN:d=f;break;case u.STRING:h=n.length,d+=h*f;break;case u.INT8ARRAY:case u.INT16ARRAY:case u.INT32ARRAY:case u.UINT8ARRAY:case u.UINT16ARRAY:case u.UINT32ARRAY:case u.FLOAT32ARRAY:case u.FLOAT64ARRAY:h=n.length,d+=h*f;break;case u.ARRAY:return void R(n,function(e,o){r([{type:t,length:n.length,header_size:A+i,byte_length:o,value:null}].concat(e))});case u.OBJECT:var U=[];for(var y in n)n.hasOwnProperty(y)&&(U.push(y),U.push(n[y]),h++);return void R(U,function(e,n){r([{type:t,length:h,header_size:A+i,byte_length:n,value:null}].concat(e))});case u.ARRAYBUFFER:d+=n.byteLength;break;case u.BLOB:var b=n.type,g=new FileReader;return g.onload=function(e){R([b,e.target.result],function(e,n){r([{type:t,length:h,header_size:A,byte_length:n,value:null}].concat(e))})},g.onerror=function(e){throw"FileReader Error: "+e},void g.readAsArrayBuffer(n);case u.BUFFER:d+=n.length;break;default:throw'TypeError: Type "'+n.constructor.name+'" not supported.'}r([{type:t,length:h,header_size:A,byte_length:d,value:v}].concat(c))},v=function(e,n){var r=e instanceof DataView?e:new DataView(e),t=d(r,0);return t.value};n&&(e.Test={BIG_ENDIAN:r,LITTLE_ENDIAN:t,Types:u,pack:A,unpack:d,serialize:h,deserialize:v});var U={pack:function(e,r){try{n&&console.info("%cPacking Start","font-weight: bold; color: red;",e),h(e,function(e){n&&console.info("Serialized Object",e),r(A(e))})}catch(t){throw t}},unpack:function(e,r){try{n&&console.info("%cUnpacking Start","font-weight: bold; color: red;",e);var t=v(e);n&&console.info("Deserialized Object",t),r(t)}catch(o){throw o}}};"undefined"!=typeof module&&module.exports?module.exports=U:e.binarize=U}("undefined"!=typeof global?global:this);
function MediaStreamRecorder(t){if(!t)throw"MediaStream is mandatory.";this.start=function(a){var i=IsChrome?window.StereoRecorder:window.MediaRecorderWrapper;this.mimeType.indexOf("video")!=-1&&(i=IsChrome?window.WhammyRecorder:window.MediaRecorderWrapper),"image/gif"===this.mimeType&&(i=window.GifRecorder),e=new i(t),e.ondataavailable=this.ondataavailable,e.onstop=this.onstop,e.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,e=mergeProps(e,this),e.start(a)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){e&&e.clearOldRecordedFrames()},this.stop=function(){e&&e.stop()},this.ondataavailable=function(t){console.log("ondataavailable..",t)},this.onstop=function(t){console.warn("stopped..",t)};var e}function loadScript(t,e){var a=window.MediaStreamRecorderScriptsDir,i=document.createElement("script");i.src=a+t,i.onload=e||function(){},document.documentElement.appendChild(i)}function mergeProps(t,e){e=reformatProps(e);for(var a in e)"function"!=typeof e[a]&&(t[a]=e[a]);return t}function reformatProps(t){var e={};for(var a in t)if(a.indexOf("-")!=-1){var i=a.split("-"),n=i[0]+i[1].split("")[0].toUpperCase()+i[1].substr(1);e[n]=t[a]}else e[a]=t[a];return e}function MediaRecorderWrapper(t){if("audio"==this.type&&t.getVideoTracks&&t.getVideoTracks().length&&!navigator.mozGetUserMedia){var e=new AudioContext,a=e.createMediaStreamSource(t),i=e.createMediaStreamDestination();a.connect(i),t=i.stream}this.start=function(e){function a(){n||(r=new MediaRecorder(t),r.ondataavailable=function(t){if(console.log("ondataavailable",t.data.type,t.data.size,t.data),!t.data.size)return void console.warn("Recording of",t.data.type,"failed.");var e=new window.Blob([t.data],{type:t.data.type||o.mimeType||"audio/ogg"});o.ondataavailable(e)},r.onstop=function(t){},r.onerror=function(t){console.error(t),o.start(e)},r.onwarning=function(t){console.warn(t)},r.start(0),setTimeout(function(){r.stop(),a()},e))}e=e||1e3,n=!1,a()};var n=!1;this.stop=function(){n=!0,o.onstop&&o.onstop({})},this.ondataavailable=this.onstop=function(){};var o=this;!o.mimeType&&t.getAudioTracks&&(o.mimeType=t.getAudioTracks().length&&t.getVideoTracks().length?"video/webm":"audio/ogg");var r}function StereoRecorder(t){this.start=function(i){i=i||1e3,e=new StereoAudioRecorder(t,this),e.record(),a=setInterval(function(){e.requestData()},i)},this.stop=function(){e&&(e.stop(),clearTimeout(a))},this.ondataavailable=function(){};var e,a}function StereoAudioRecorder(t,e){function a(t,e){for(var a=t.length+e.length,i=new Float32Array(a),n=0,o=0;o<a;)i[o++]=t[n],i[o++]=e[n],n++;return i}function i(t,e){for(var a=new Float32Array(e),i=0,n=t.length,o=0;o<n;o++){var r=t[o];a.set(r,i),i+=r.length}return a}function n(t,e,a){for(var i=a.length,n=0;n<i;n++)t.setUint8(e+n,a.charCodeAt(n))}var o,r,d,s,h,c=[],u=[],l=!1,m=0,w=44100,f=e.mono?1:2;this.record=function(){l=!0,c.length=u.length=0,m=0},this.requestData=function(){if(0==m)return void(v=!1);v=!0;var t=c.slice(0),o=(u.slice(0),m);c.length=u.length=[],m=0,v=!1;var r=i(t,o),d=i(t,o);if(2===f)var s=a(r,d);else var s=r;var h=new ArrayBuffer(44+2*s.length),l=new DataView(h);n(l,0,"RIFF"),l.setUint32(4,44+2*s.length,!0),n(l,8,"WAVE"),n(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,f,!0),l.setUint32(24,w,!0),l.setUint32(28,4*w,!0),l.setUint16(32,2*f,!0),l.setUint16(34,16,!0),n(l,36,"data"),l.setUint32(40,2*s.length,!0);for(var g=s.length,p=44,b=1,y=0;y<g;y++)l.setInt16(p,s[y]*(32767*b),!0),p+=2;var M=new Blob([l],{type:"audio/wav"});console.debug("audio recorded blob size:",bytesToSize(M.size)),e.ondataavailable(M)},this.stop=function(){l=!1,this.requestData()};var s=ObjectStore.AudioContext;ObjectStore.AudioContextConstructor||(ObjectStore.AudioContextConstructor=new s);var h=ObjectStore.AudioContextConstructor;ObjectStore.VolumeGainNode||(ObjectStore.VolumeGainNode=h.createGain());var r=ObjectStore.VolumeGainNode;ObjectStore.AudioInput||(ObjectStore.AudioInput=h.createMediaStreamSource(t));var d=ObjectStore.AudioInput;d.connect(r);var g=e.bufferSize||2048;if(0==e.bufferSize&&(g=0),h.createJavaScriptNode)o=h.createJavaScriptNode(g,f,f);else{if(!h.createScriptProcessor)throw"WebAudio API has no support on this browser.";o=h.createScriptProcessor(g,f,f)}g=o.bufferSize,console.debug("using audio buffer-size:",g);var v=!1;window.scriptprocessornode=o,1==f&&console.debug("It seems mono audio. All right-channels are skipped."),o.onaudioprocess=function(t){if(l&&!v){var e=t.inputBuffer.getChannelData(0);if(c.push(new Float32Array(e)),2==f){var a=t.inputBuffer.getChannelData(1);u.push(new Float32Array(a))}m+=g}},r.connect(o),o.connect(h.destination)}function WhammyRecorderHelper(t,e){function a(){if(!s){if(o)return setTimeout(a,100);var t=(new Date).getTime()-c;if(!t)return a();c=(new Date).getTime(),m.drawImage(h,0,0,l.width,l.height),!s&&r.push({duration:t,image:l.toDataURL("image/webp")}),d||i(r[r.length-1])||(d=!0,e.onStartedDrawingNonBlankFrames()),setTimeout(a,10)}}function i(t,e,a){var i=document.createElement("canvas");i.width=l.width,i.height=l.height;var n,o,r,d=i.getContext("2d"),s={r:0,g:0,b:0},h=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),c=e&&e>=0&&e<=1?e:0,u=a&&a>=0&&a<=1?a:0,m=new Image;m.src=t.image,d.drawImage(m,0,0,l.width,l.height);var w=d.getImageData(0,0,l.width,l.height);n=0,o=w.data.length,r=w.data.length/4;for(var f=0;f<o;f+=4){var g={r:w.data[f],g:w.data[f+1],b:w.data[f+2]},v=Math.sqrt(Math.pow(g.r-s.r,2)+Math.pow(g.g-s.g,2)+Math.pow(g.b-s.b,2));v<=h*c&&n++}return!(r-n<=r*u)}function n(t,e,a,i){var n=document.createElement("canvas");n.width=l.width,n.height=l.height;for(var o=n.getContext("2d"),r=[],d=e===-1,s=e&&e>0&&e<=t.length?e:t.length,h={r:0,g:0,b:0},c=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),u=a&&a>=0&&a<=1?a:0,m=i&&i>=0&&i<=1?i:0,w=!1,f=0;f<s;f++){var g,v,p;if(!w){var b=new Image;b.src=t[f].image,o.drawImage(b,0,0,l.width,l.height);var y=o.getImageData(0,0,l.width,l.height);g=0,v=y.data.length,p=y.data.length/4;for(var M=0;M<v;M+=4){var S={r:y.data[M],g:y.data[M+1],b:y.data[M+2]},A=Math.sqrt(Math.pow(S.r-h.r,2)+Math.pow(S.g-h.g,2)+Math.pow(S.b-h.b,2));A<=c*u&&g++}}!w&&p-g<=p*m||(d&&(w=!0),r.push(t[f]))}return r=r.concat(t.slice(s)),r.length<=0&&r.push(t[t.length-1]),r}this.record=function(e){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=h.videoWidth||320),this.height||(this.height=h.videoHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas||(this.canvas={width:this.width,height:this.height}),l.width=this.canvas.width,l.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?h=this.video.cloneNode():(h=document.createElement("video"),h.src=URL.createObjectURL(t),h.width=this.video.width,h.height=this.video.height),h.muted=!0,h.play(),c=(new Date).getTime(),u=new Whammy.Video,console.log("canvas resolutions",l.width,"*",l.height),console.log("video width/height",h.width||l.width,"*",h.height||l.height),a()},this.clearOldRecordedFrames=function(){r=[]};var o=!1;this.requestData=function(){if(!r.length)return void(o=!1);o=!0;var t=r.slice(0);r=[],u.frames=n(t,-1);var a=u.compile();e.ondataavailable(a),console.debug("video recorded blob size:",bytesToSize(a.size)),o=!1};var r=[],d=!1,s=!1;this.stop=function(){s=!0,this.requestData()};var h,c,u,l=document.createElement("canvas"),m=l.getContext("2d")}function WhammyRecorder(t){this.start=function(i){i=i||1e3,e=new WhammyRecorderHelper(t,this);for(var n in this)"function"!=typeof this[n]&&(e[n]=this[n]);e.record(),a=setInterval(function(){e.requestData()},i)},this.stop=function(){e&&(e.stop(),clearTimeout(a))},this.clearOldRecordedFrames=function(){e&&e.clearOldRecordedFrames()},this.ondataavailable=function(){};var e,a}function GifRecorder(t){function e(){d=Date.now();var t=new Blob([new Uint8Array(h.stream().bin)],{type:"image/gif"});a.ondataavailable(t),h.stream().bin=[]}if(!window.GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";this.start=function(t){function a(t){u=requestAnimationFrame(a),void 0===typeof s&&(s=t),t-s<90||(n.drawImage(o,0,0,d,l),h.addFrame(n),s=t)}t=t||1e3;var d=this.videoWidth||320,l=this.videoHeight||240;i.width=o.width=d,i.height=o.height=l,h=new GIFEncoder,h.setRepeat(0),h.setDelay(this.frameRate||200),h.setQuality(this.quality||1),h.start(),r=Date.now(),u=requestAnimationFrame(a),c=setTimeout(e,t)},this.stop=function(){u&&(cancelAnimationFrame(u),clearTimeout(c),e())},this.ondataavailable=function(){},this.onstop=function(){};var a=this,i=document.createElement("canvas"),n=i.getContext("2d"),o=document.createElement("video");o.muted=!0,o.autoplay=!0,o.src=URL.createObjectURL(t),o.play();var r,d,s,h,c,u=null}function MultiStreamRecorder(t){if(!t)throw"MediaStream is mandatory.";var e=this,a=!!navigator.mozGetUserMedia;this.stream=t,this.start=function(d){function s(t){r++,e.ondataavailable(t)}i=new MediaStreamRecorder(t),n=new MediaStreamRecorder(t),i.mimeType="audio/ogg",n.mimeType="video/webm";for(var h in this)"function"!=typeof this[h]&&(i[h]=n[h]=this[h]);i.ondataavailable=function(t){o[r]||(o[r]={}),o[r].audio=t,o[r].video&&!o[r].posted&&(o[r].posted=!0,s(o[r]))},n.ondataavailable=function(t){return a?e.ondataavailable({video:t,audio:t}):(o[r]||(o[r]={}),o[r].video=t,void(o[r].audio&&!o[r].invokedOnce&&(o[r].invokedOnce=!0,s(o[r]))))},n.onstop=i.onstop=function(t){e.onstop(t)},a?n.start(d):(n.onStartedDrawingNonBlankFrames=function(){console.debug("Fired: onStartedDrawingNonBlankFrames"),n.clearOldRecordedFrames(),i.start(d)},n.start(d))},this.stop=function(){i&&i.stop(),n&&n.stop()},this.ondataavailable=function(t){console.log("ondataavailable..",t)},this.onstop=function(t){console.warn("stopped..",t)};var i,n,o={},r=0}function bytesToSize(t){var e=1e3,a=["Bytes","KB","MB","GB","TB"];if(0===t)return"0 Bytes";var i=parseInt(Math.floor(Math.log(t)/Math.log(e)),10);return(t/Math.pow(e,i)).toPrecision(3)+" "+a[i]}function SaveToDisk(t,e){var a=document.createElement("a");a.href=URL.createObjectURL(t),a.target="_blank",a.download=(e||Math.round(9999999999*Math.random())+888888888)+"."+t.type.split("/")[1];var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});a.dispatchEvent(i),(window.URL||window.webkitURL).revokeObjectURL(a.href)}window.requestAnimationFrame||(requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame),window.cancelAnimationFrame||(cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame),window.AudioContext||(window.AudioContext=window.webkitAudioContext||window.mozAudioContext),URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia,window.webkitMediaStream&&(window.MediaStream=window.webkitMediaStream),IsChrome=!!navigator.webkitGetUserMedia;var ObjectStore={AudioContext:window.AudioContext||window.webkitAudioContext},Whammy=function(){function t(t){for(var a=e(t),i=3e4,n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:h(a.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:a.width,id:176},{data:a.height,id:186}]}]}]}]}],d=0,s=0;d<t.length;){var c=[],u=0;do c.push(t[d]),u+=t[d].duration,d++;while(d<t.length&&u<i);var l=0,m={id:524531317,data:[{data:s,id:231}].concat(c.map(function(t){var e=r({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(l)});return l+=t.duration,{data:e,id:163}}))};n[1].data.push(m),s+=u}return o(n)}function e(t){if(!t[0])return void console.warn("Something went wrong. Maybe WebP format is not supported in the current browser.");for(var e=t[0].width,a=t[0].height,i=t[0].duration,n=1;n<t.length;n++)i+=t[n].duration;return{duration:i,width:e,height:a}}function a(t){for(var e=[];t>0;)e.push(255&t),t>>=8;return new Uint8Array(e.reverse())}function i(t){return new Uint8Array(t.split("").map(function(t){return t.charCodeAt(0)}))}function n(t){var e=[],a=t.length%8?new Array(9-t.length%8).join("0"):"";t=a+t;for(var i=0;i<t.length;i+=8)e.push(parseInt(t.substr(i,8),2));return new Uint8Array(e)}function o(t){for(var e=[],r=0;r<t.length;r++){var d=t[r].data;"object"==typeof d&&(d=o(d)),"number"==typeof d&&(d=n(d.toString(2))),"string"==typeof d&&(d=i(d));var s=d.size||d.byteLength||d.length,h=Math.ceil(Math.ceil(Math.log(s)/Math.log(2))/8),c=s.toString(2),u=new Array(7*h+7+1-c.length).join("0")+c,l=new Array(h).join("0")+"1"+u;e.push(a(t[r].id)),e.push(n(l)),e.push(d)}return new Blob(e,{type:"video/webm"})}function r(t){var e=0;if(t.keyframe&&(e|=128),t.invisible&&(e|=8),t.lacing&&(e|=t.lacing<<1),t.discardable&&(e|=1),t.trackNum>127)throw"TrackNumber > 127 not supported";var a=[128|t.trackNum,t.timecode>>8,255&t.timecode,e].map(function(t){return String.fromCharCode(t)}).join("")+t.frame;return a}function d(t){for(var e=t.RIFF[0].WEBP[0],a=e.indexOf("*"),i=0,n=[];i<4;i++)n[i]=e.charCodeAt(a+3+i);var o,r,d;return d=n[1]<<8|n[0],o=16383&d,d=n[3]<<8|n[2],r=16383&d,{width:o,height:r,data:e,riff:t}}function s(t){for(var e=0,a={};e<t.length;){var i=t.substr(e,4),n=parseInt(t.substr(e+4,4).split("").map(function(t){var e=t.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e}).join(""),2),o=t.substr(e+4+4,n);e+=8+n,a[i]=a[i]||[],"RIFF"==i||"LIST"==i?a[i].push(s(o)):a[i].push(o)}return a}function h(t){return[].slice.call(new Uint8Array(new Float64Array([t]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")}function c(t){this.frames=[],this.duration=t||1,this.quality=100}return c.prototype.add=function(t,e){if("canvas"in t&&(t=t.canvas),"toDataURL"in t&&(t=t.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:e||this.duration})},c.prototype.compile=function(){return new t(this.frames.map(function(t){var e=d(s(atob(t.image.slice(23))));return e.duration=t.duration,e}))},{Video:c,toWebM:t}}();
"use strict";function RecordRTC(e,t){function o(){return t.disableLogs||console.debug("started recording "+t.type+" stream."),u?(u.clearRecordedData(),u.resume(),f.recordingDuration&&c(),f):(i(function(){f.recordingDuration&&c()}),f)}function i(o){o&&(t.initCallback=function(){o(),o=t.initCallback=null});var i=new GetRecorderType(e,t);u=new i(e,t),u.record(),t.disableLogs||console.debug("Initialized recorderType:",u.constructor.name,"for output-type:",t.type)}function r(e){function o(o){for(var r in u)f&&(f[r]=u[r]),i&&(i[r]=u[r]);var a=u.blob;if(!a){if(!o)throw"Recording failed.";u.blob=a=o}if(e){var n=URL.createObjectURL(a);e(n)}a&&!t.disableLogs&&console.debug(a.type,"->",bytesToSize(a.size)),t.autoWriteToDisk&&s(function(e){var o={};o[t.type+"Blob"]=e,DiskStorage.Store(o)})}if(!u)return console.warn(l);var i=this;t.disableLogs||console.warn("Stopped recording "+t.type+" stream."),"gif"!==t.type?u.stop(o):(u.stop(),o())}function a(){return u?(u.pause(),void(t.disableLogs||console.debug("Paused recording."))):console.warn(l)}function n(){return u?(u.resume(),void(t.disableLogs||console.debug("Resumed recording."))):console.warn(l)}function d(e){postMessage((new FileReaderSync).readAsDataURL(e))}function s(e,o){function i(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(t);return URL.revokeObjectURL(t),o}if(!e)throw"Pass a callback function over getDataURL.";var r=o?o.blob:(u||{}).blob;if(!r)return t.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){s(e,o)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var a=new FileReader;a.readAsDataURL(r),a.onload=function(t){e(t.target.result)}}else{var n=i(d);n.onmessage=function(t){e(t.data)},n.postMessage(r)}}function c(){setTimeout(function(){r(f.onRecordingStopped)},f.recordingDuration)}if(!e)throw"MediaStream is mandatory.";t=t||{type:"video"},t=new RecordRTCConfiguration(e,t);var u,f=this,l='It seems that "startRecording" is not invoked for '+t.type+" recorder.",g={startRecording:o,stopRecording:r,pauseRecording:a,resumeRecording:n,initRecorder:i,setRecordingDuration:function(e,t){if("undefined"==typeof e)throw"milliseconds is required.";if("number"!=typeof e)throw"milliseconds must be a number.";return f.recordingDuration=e,f.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){f.onRecordingStopped=e}}},clearRecordedData:function(){return u?(u.clearRecordedData(),void(t.disableLogs||console.debug("Cleared old recorded data."))):console.warn(l)},getBlob:function(){return u?u.blob:console.warn(l)},getDataURL:s,toURL:function(){return u?URL.createObjectURL(u.blob):console.warn(l)},save:function(e){return u?void invokeSaveAsDialog(u.blob,e):console.warn(l)},getFromDisk:function(e){return u?void RecordRTC.getFromDisk(t.type,e):console.warn(l)},setAdvertisementArray:function(e){t.advertisement=[];for(var o=e.length,i=0;i<o;i++)t.advertisement.push({duration:i,image:e[i]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return f=g,g;for(var m in g)this[m]=g[m];return f=this,g}function RecordRTCConfiguration(e,t){return t.recorderType&&!t.type&&(t.recorderType===WhammyRecorder||t.recorderType===CanvasRecorder?t.type="video":t.recorderType===GifRecorder?t.type="gif":t.recorderType===StereoAudioRecorder?t.type="audio":t.recorderType===MediaStreamRecorder&&(e.getAudioTracks().length&&e.getVideoTracks().length?t.type="video":e.getAudioTracks().length&&!e.getVideoTracks().length?t.type="audio":!e.getAudioTracks().length&&e.getVideoTracks().length&&(t.type="audio"))),"undefined"!=typeof MediaStreamRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),!t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function GetRecorderType(e,t){var o;return(isChrome||isEdge||isOpera)&&(o=StereoAudioRecorder),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!isChrome&&(o=MediaStreamRecorder),"video"===t.type&&(isChrome||isOpera)&&(o=WhammyRecorder),"gif"===t.type&&(o=GifRecorder),"canvas"===t.type&&(o=CanvasRecorder),isMediaRecorderCompatible()&&o!==CanvasRecorder&&o!==GifRecorder&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&e.getVideoTracks().length&&(o=MediaStreamRecorder),t.recorderType&&(o=t.recorderType),!t.disableLogs&&o&&o.name&&console.debug("Using recorderType:",o.name||o.constructor.name),o}function MRecordRTC(e){this.addStream=function(t){t&&(e=t)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var t,o=this.mediaType,i=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof o.audio&&isMediaRecorderCompatible()&&e.getAudioTracks&&!e.getAudioTracks().length&&(o.audio=!1),"function"!=typeof o.video&&isMediaRecorderCompatible()&&e.getVideoTracks&&!e.getVideoTracks().length&&(o.video=!1),!o.audio&&!o.video)throw"MediaStream must have either audio or video tracks.";if(o.audio&&(t=null,"function"==typeof o.audio&&(t=o.audio),this.audioRecorder=new RecordRTC(e,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:i.audio}),o.video||this.audioRecorder.startRecording()),o.video){t=null,"function"==typeof o.video&&(t=o.video);var r=e;if(isMediaRecorderCompatible()&&o.audio&&"function"==typeof o.audio){var a=e.getVideoTracks()[0];navigator.mozGetUserMedia?(r=new MediaStream,r.addTrack(a),t&&t===WhammyRecorder&&(t=MediaStreamRecorder)):r=new MediaStream([a])}this.videoRecorder=new RecordRTC(r,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:i.video}),o.audio||this.videoRecorder.startRecording()}if(o.audio&&o.video){var n=this;isMediaRecorderCompatible()?(n.audioRecorder=null,n.videoRecorder.startRecording()):n.videoRecorder.initRecorder(function(){n.audioRecorder.initRecorder(function(){n.videoRecorder.startRecording(),n.audioRecorder.startRecording()})})}o.gif&&(t=null,"function"==typeof o.gif&&(t=o.gif),this.gifRecorder=new RecordRTC(e,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:i.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.getDataURL=function(e){function t(e,t){if("undefined"!=typeof Worker){var i=o(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});i.onmessage=function(e){t(e.data)},i.postMessage(e)}else{var r=new FileReader;r.readAsDataURL(e),r.onload=function(e){t(e.target.result)}}}function o(e){var t,o=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),i=new Worker(o);if("undefined"!=typeof URL)t=URL;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(o),i}this.getBlob(function(o){t(o.audio,function(i){t(o.video,function(t){e({audio:i,video:t})})})})},this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},e.audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}function bytesToSize(e){var t=1e3,o=["Bytes","KB","MB","GB","TB"];if(0===e)return"0 Bytes";var i=parseInt(Math.floor(Math.log(e)/Math.log(t)),10);return(e/Math.pow(t,i)).toPrecision(3)+" "+o[i]}function invokeSaveAsDialog(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(o){}var i=(e.type||"video/webm").split("/")[1];if(t&&t.indexOf(".")!==-1){var r=t.split(".");t=r[0],i=r[1]}var a=(t||Math.round(9999999999*Math.random())+888888888)+"."+i;if("undefined"!=typeof navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,a);if("undefined"!=typeof navigator.msSaveBlob)return navigator.msSaveBlob(e,a);var n=document.createElement("a");n.href=URL.createObjectURL(e),n.target="_blank",n.download=a,navigator.mozGetUserMedia&&(n.onclick=function(){(document.body||document.documentElement).removeChild(n)},(document.body||document.documentElement).appendChild(n));var d=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});n.dispatchEvent(d),navigator.mozGetUserMedia||URL.revokeObjectURL(n.href)}function isMediaRecorderCompatible(){var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=!!window.chrome&&!e,o="undefined"!=typeof window.InstallTrigger;if(o)return!0;var i,r,a=(navigator.appVersion,navigator.userAgent),n=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10);return(t||e)&&(i=a.indexOf("Chrome"),n=a.substring(i+7)),(r=n.indexOf(";"))!==-1&&(n=n.substring(0,r)),(r=n.indexOf(" "))!==-1&&(n=n.substring(0,r)),d=parseInt(""+n,10),isNaN(d)&&(n=""+parseFloat(navigator.appVersion),d=parseInt(navigator.appVersion,10)),d>=49}function MediaStreamRecorder(e,t){function o(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}var i=this;if(t=t||{mimeType:"video/webm"},"audio"===t.type){if(e.getVideoTracks().length&&e.getAudioTracks().length){var r;navigator.mozGetUserMedia?(r=new MediaStream,r.addTrack(e.getAudioTracks()[0])):r=new MediaStream(e.getAudioTracks()),e=r}t.mimeType&&t.mimeType.indexOf("audio")!==-1||(t.mimeType=isChrome?"audio/webm":"audio/ogg")}this.record=function(){i.blob=null;var o=t;t.disableLogs||console.log("Passing following config over MediaRecorder API.",o),a&&(a=null),isChrome&&!isMediaRecorderCompatible()&&(o="video/vp8");try{a=new MediaRecorder(e,o)}catch(r){a=new MediaRecorder(e)}"canRecordMimeType"in a&&a.canRecordMimeType(t.mimeType)===!1&&(t.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",t.mimeType)),a.ignoreMutedMedia=t.ignoreMutedMedia||!1,a.ondataavailable=function(e){i.dontFireOnDataAvailableEvent||!e.data||!e.data.size||e.data.size<100||i.blob||(i.blob=t.getNativeBlob?e.data:new Blob([e.data],{type:t.mimeType||"video/webm"}),i.recordingCallback&&(i.recordingCallback(i.blob),i.recordingCallback=null))},a.onerror=function(e){t.disableLogs||("InvalidState"===e.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),"inactive"!==a.state&&"stopped"!==a.state&&a.stop()},a.start(36e5),t.onAudioProcessStarted&&t.onAudioProcessStarted(),t.initCallback&&t.initCallback()},this.stop=function(e){a&&(this.recordingCallback=function(t){a=null,e&&e(t)},"recording"===a.state&&(a.requestData(),a.stop()))},this.pause=function(){a&&"recording"===a.state&&a.pause()},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var e=t.disableLogs;return t.disableLogs=!0,this.record(),void(t.disableLogs=e)}a&&"paused"===a.state&&a.resume()},this.clearRecordedData=function(){a&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())};var a,i=this;!function n(){if(a)return o()===!1?(t.disableLogs||console.log("MediaStream seems stopped."),void i.stop()):void setTimeout(n,1e3)}()}function StereoAudioRecorder(e,t){function o(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function i(e,t){function o(e,t){function o(e,t){for(var o=new Float64Array(t),i=0,r=e.length,a=0;a<r;a++){var n=e[a];o.set(n,i),i+=n.length}return o}function i(e,t){for(var o=e.length+t.length,i=new Float64Array(o),r=0,a=0;a<o;)i[a++]=e[r],i[a++]=t[r],r++;return i}function r(e,t,o){for(var i=o.length,r=0;r<i;r++)e.setUint8(t+r,o.charCodeAt(r))}var a=e.numberOfAudioChannels,n=e.leftBuffers.slice(0),d=e.rightBuffers.slice(0),s=e.sampleRate,c=e.internalInterleavedLength;2===a&&(n=o(n,c),d=o(d,c)),1===a&&(n=o(n,c));var u;2===a&&(u=i(n,d)),1===a&&(u=n);var f=u.length,l=44+2*f,g=new ArrayBuffer(l),m=new DataView(g);r(m,0,"RIFF"),m.setUint32(4,44+2*f,!0),r(m,8,"WAVE"),r(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,a,!0),m.setUint32(24,s,!0),m.setUint32(28,2*s,!0),m.setUint16(32,2*a,!0),m.setUint16(34,16,!0),r(m,36,"data"),m.setUint32(40,2*f,!0);for(var h=f,p=44,v=1,b=0;b<h;b++)m.setInt16(p,u[b]*(32767*v),!0),p+=2;return t?t({buffer:g,view:m}):void postMessage({buffer:g,view:m})}if(!isChrome)return void o(e,function(e){t(e.buffer,e.view)});var i=r(o);i.onmessage=function(e){t(e.data.buffer,e.data.view),URL.revokeObjectURL(i.workerURL)},i.postMessage(e)}function r(e){var t=URL.createObjectURL(new Blob([e.toString(),";this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(t);return o.workerURL=t,o}function a(e){if(!b){if(o()===!1&&(t.disableLogs||console.log("MediaStream seems stopped."),n.disconnect(),u=!1),!u)return void m.disconnect();R||(R=!0,t.onAudioProcessStarted&&t.onAudioProcessStarted(),t.initCallback&&t.initCallback());var i=e.inputBuffer.getChannelData(0);if(s.push(new Float32Array(i)),2===l){var r=e.inputBuffer.getChannelData(1);c.push(new Float32Array(r))}f+=p}}if(!e.getAudioTracks().length)throw"Your stream has no audio tracks.";t=t||{};var n,d=this,s=[],c=[],u=!1,f=0,l=2;t.leftChannel===!0&&(l=1),1===t.numberOfAudioChannels&&(l=1),t.disableLogs||console.debug("StereoAudioRecorder is set to record number of channels: ",l),this.record=function(){if(o()===!1)throw"Please make sure MediaStream is active.";s.length=c.length=0,f=0,m&&m.connect(n),R=b=!1,u=!0},this.stop=function(e){u=!1,i({sampleRate:v,numberOfAudioChannels:l,internalInterleavedLength:f,leftBuffers:s,rightBuffers:1===l?[]:c},function(t,o){d.blob=new Blob([o],{type:"audio/wav"}),d.buffer=new ArrayBuffer(o.buffer.byteLength),d.view=o,d.sampleRate=v,d.bufferSize=p,d.length=f,e&&e(),R=!1})},Storage.AudioContextConstructor||(Storage.AudioContextConstructor=new Storage.AudioContext);var g=Storage.AudioContextConstructor,m=g.createMediaStreamSource(e),h=[0,256,512,1024,2048,4096,8192,16384],p="undefined"==typeof t.bufferSize?4096:t.bufferSize;if(h.indexOf(p)===-1&&(t.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(h,null,"\t"))),g.createJavaScriptNode)n=g.createJavaScriptNode(p,l,l);else{if(!g.createScriptProcessor)throw"WebAudio API has no support on this browser.";n=g.createScriptProcessor(p,l,l)}m.connect(n),t.bufferSize||(p=n.bufferSize);var v="undefined"!=typeof t.sampleRate?t.sampleRate:g.sampleRate||44100;(v<22050||v>96e3)&&(t.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.")),t.disableLogs||(console.log("sample-rate",v),console.log("buffer-size",p));var b=!1;this.pause=function(){b=!0},this.resume=function(){if(o()===!1)throw"Please make sure MediaStream is active.";return u?void(b=!1):(t.disableLogs||console.info("Seems recording has been restarted."),void this.record())},this.clearRecordedData=function(){this.pause(),s.length=c.length=0,f=0};var R=!1;n.onaudioprocess=a,n.connect(g.destination)}function CanvasRecorder(e,t){function o(){var t=document.createElement("canvas"),o=t.getContext("2d");return t.width=e.width,t.height=e.height,o.drawImage(e,0,0),t}function i(){if(f)return l=(new Date).getTime(),setTimeout(i,500);if("canvas"===e.nodeName.toLowerCase()){var r=(new Date).getTime()-l;return l=(new Date).getTime(),g.frames.push({image:o(),duration:r}),void(u&&setTimeout(i,t.frameInterval))}html2canvas(e,{grabMouse:"undefined"==typeof t.showMousePointer||t.showMousePointer,onrendered:function(e){var o=(new Date).getTime()-l;return o?(l=(new Date).getTime(),g.frames.push({image:e.toDataURL("image/webp",1),duration:o}),void(u&&setTimeout(i,t.frameInterval))):setTimeout(i,t.frameInterval)}})}if("undefined"==typeof html2canvas&&"canvas"!==e.nodeName.toLowerCase())throw"Please link: https://cdn.webrtc-experiment.com/screenshot.js";t=t||{},t.frameInterval||(t.frameInterval=10);var r=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(r=!0)});var a=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),n=50,d=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);a&&d&&d[2]&&(n=parseInt(d[2],10)),a&&n<52&&(r=!1);var s,c;if(r)if(t.disableLogs||console.debug("Your browser supports both MediRecorder API and canvas.captureStream!"),e instanceof HTMLCanvasElement)s=e;else{if(!(e instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";s=e.canvas}else navigator.mozGetUserMedia&&(t.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var u;this.record=function(){if(u=!0,r){var e;"captureStream"in s?e=s.captureStream(25):"mozCaptureStream"in s?e=s.mozCaptureStream(25):"webkitCaptureStream"in s&&(e=s.webkitCaptureStream(25));try{var o=new MediaStream;o.addTrack(e.getVideoTracks()[0]),e=o}catch(a){}if(!e)throw"captureStream API are NOT available.";c=new MediaStreamRecorder(e,{mimeType:"video/webm"}),c.record()}else g.frames=[],l=(new Date).getTime(),i();t.initCallback&&t.initCallback()},this.getWebPImages=function(o){if("canvas"!==e.nodeName.toLowerCase())return void o();var i=g.frames.length;g.frames.forEach(function(e,o){var r=i-o;t.disableLogs||console.debug(r+"/"+i+" frames remaining"),t.onEncodingCallback&&t.onEncodingCallback(r,i);var a=e.image.toDataURL("image/webp",1);g.frames[o].image=a}),t.disableLogs||console.debug("Generating WebM"),o()},this.stop=function(e){u=!1;var o=this;return r&&c?void c.stop(e):void this.getWebPImages(function(){g.compile(function(i){t.disableLogs||console.debug("Recording finished!"),o.blob=i,o.blob.forEach&&(o.blob=new Blob([],{type:"video/webm"})),e&&e(o.blob),g.frames=[]})})};var f=!1;this.pause=function(){f=!0},this.resume=function(){f=!1,u||this.record()},this.clearRecordedData=function(){this.pause(),g.frames=[]};var l=(new Date).getTime(),g=new Whammy.Video(100)}function WhammyRecorder(e,t){function o(e){e="undefined"!=typeof e?e:10;var t=(new Date).getTime()-s;return t?n?(s=(new Date).getTime(),setTimeout(o,100)):(s=(new Date).getTime(),d.paused&&d.play(),f.drawImage(d,0,0,u.width,u.height),c.frames.push({duration:t,image:u.toDataURL("image/webp")}),void(a||setTimeout(o,e,e))):setTimeout(o,e,e)}function i(e){var t=-1,o=e.length,i=function(){return t++,t===o?void e.callback():void e.functionToLoop(i,t)};i()}function r(e,t,o,r,a){var n=document.createElement("canvas");n.width=u.width,n.height=u.height;var d=n.getContext("2d"),s=[],c=t===-1,f=t&&t>0&&t<=e.length?t:e.length,l={r:0,g:0,b:0},g=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),m=o&&o>=0&&o<=1?o:0,h=r&&r>=0&&r<=1?r:0,p=!1;i({length:f,functionToLoop:function(t,o){var i,r,a,n=function(){!p&&a-i<=a*h||(c&&(p=!0),s.push(e[o])),t()};if(p)n();else{var f=new Image;f.onload=function(){d.drawImage(f,0,0,u.width,u.height);var e=d.getImageData(0,0,u.width,u.height);i=0,r=e.data.length,a=e.data.length/4;for(var t=0;t<r;t+=4){var o={r:e.data[t],g:e.data[t+1],b:e.data[t+2]},s=Math.sqrt(Math.pow(o.r-l.r,2)+Math.pow(o.g-l.g,2)+Math.pow(o.b-l.b,2));s<=g*m&&i++}n()},f.src=e[o].image}},callback:function(){s=s.concat(e.slice(f)),s.length<=0&&s.push(e[e.length-1]),a(s)}})}t=t||{},t.frameInterval||(t.frameInterval=10),t.disableLogs||console.log("Using frames-interval:",t.frameInterval),this.record=function(){t.width||(t.width=320),t.height||(t.height=240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),u.width=t.canvas.width,u.height=t.canvas.height,f=u.getContext("2d"),t.video&&t.video instanceof HTMLVideoElement?(d=t.video.cloneNode(),t.initCallback&&t.initCallback()):(d=document.createElement("video"),"undefined"!=typeof d.srcObject?d.srcObject=e:d.src=URL.createObjectURL(e),d.onloadedmetadata=function(){t.initCallback&&t.initCallback()},d.width=t.video.width,d.height=t.video.height),d.muted=!0,d.play(),s=(new Date).getTime(),c=new Whammy.Video,t.disableLogs||(console.log("canvas resolutions",u.width,"*",u.height),console.log("video width/height",d.width||u.width,"*",d.height||u.height)),o(t.frameInterval)};var a=!1;this.stop=function(e){a=!0;var o=this;setTimeout(function(){r(c.frames,-1,null,null,function(i){c.frames=i,t.advertisement&&t.advertisement.length&&(c.frames=t.advertisement.concat(c.frames)),c.compile(function(t){o.blob=t,o.blob.forEach&&(o.blob=new Blob([],{type:"video/webm"})),e&&e(o.blob)})})},10)};var n=!1;this.pause=function(){n=!0},this.resume=function(){n=!1,a&&this.record()},this.clearRecordedData=function(){this.pause(),c.frames=[]};var d,s,c,u=document.createElement("canvas"),f=u.getContext("2d")}function GifRecorder(e,t){if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";t=t||{};var o=e instanceof CanvasRenderingContext2D||e instanceof HTMLCanvasElement;this.record=function(){function e(d){return i?setTimeout(function(){e(d)},100):(f=requestAnimationFrame(e),void 0===typeof c&&(c=d),void(d-c<90||(!o&&n.paused&&n.play(),o||a.drawImage(n,0,0,r.width,r.height),t.onGifPreview&&t.onGifPreview(r.toDataURL("image/png")),u.addFrame(a),c=d)))}o||(t.width||(t.width=n.offsetWidth||320),this.height||(t.height=n.offsetHeight||240),t.video||(t.video={width:t.width,height:t.height}),t.canvas||(t.canvas={width:t.width,height:t.height}),r.width=t.canvas.width,r.height=t.canvas.height,n.width=t.video.width,n.height=t.video.height),u=new GIFEncoder,u.setRepeat(0),u.setDelay(t.frameRate||200),u.setQuality(t.quality||10),u.start(),d=Date.now();f=requestAnimationFrame(e),t.initCallback&&t.initCallback()},this.stop=function(){f&&cancelAnimationFrame(f),s=Date.now(),this.blob=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"}),u.stream().bin=[]};var i=!1;this.pause=function(){i=!0},this.resume=function(){i=!1},this.clearRecordedData=function(){u&&(this.pause(),u.stream().bin=[])};var r=document.createElement("canvas"),a=r.getContext("2d");if(o&&(e instanceof CanvasRenderingContext2D?(a=e,r=a.canvas):e instanceof HTMLCanvasElement&&(a=e.getContext("2d"),r=e)),!o){var n=document.createElement("video");n.muted=!0,n.autoplay=!0,"undefined"!=typeof n.srcObject?n.srcObject=e:n.src=URL.createObjectURL(e),n.play()}var d,s,c,u,f=null}RecordRTC.getFromDisk=function(e,t){if(!t)throw"callback is mandatory.";console.log("Getting recorded "+("all"===e?"blobs":e+" blob ")+" from disk!"),DiskStorage.Fetch(function(o,i){"all"!==e&&i===e+"Blob"&&t&&t(o),"all"===e&&t&&t(o,i.replace("Blob",""))})},RecordRTC.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),e=e||{},e.audio&&e.video&&e.gif?e.audio.getDataURL(function(t){e.video.getDataURL(function(o){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:o,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){DiskStorage.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){DiskStorage.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){DiskStorage.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){DiskStorage.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){DiskStorage.Store({gifBlob:e})})},"undefined"!=typeof module&&(module.exports=RecordRTC),"function"==typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC}),MRecordRTC.getFromDisk=RecordRTC.getFromDisk,MRecordRTC.writeToDisk=RecordRTC.writeToDisk,"undefined"!=typeof RecordRTC&&(RecordRTC.MRecordRTC=MRecordRTC);var browserFakeUserAgent="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";!function(e){e&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:browserFakeUserAgent,getUserMedia:function(){}},global.console||(global.console={}),"undefined"==typeof global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},e.HTMLVideoElement=function(){}),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}),"undefined"==typeof URL&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)}("undefined"!=typeof global?global:null);var requestAnimationFrame=window.requestAnimationFrame;"undefined"==typeof requestAnimationFrame&&("undefined"!=typeof webkitRequestAnimationFrame&&(requestAnimationFrame=webkitRequestAnimationFrame),"undefined"!=typeof mozRequestAnimationFrame&&(requestAnimationFrame=mozRequestAnimationFrame));var cancelAnimationFrame=window.cancelAnimationFrame;"undefined"==typeof cancelAnimationFrame&&("undefined"!=typeof webkitCancelAnimationFrame&&(cancelAnimationFrame=webkitCancelAnimationFrame),"undefined"!=typeof mozCancelAnimationFrame&&(cancelAnimationFrame=mozCancelAnimationFrame));var AudioContext=window.AudioContext;"undefined"==typeof AudioContext&&("undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;"undefined"==typeof URL&&"undefined"!=typeof webkitURL&&(URL=webkitURL),"undefined"!=typeof navigator&&("undefined"!=typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!=typeof navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var isEdge=!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;"undefined"==typeof MediaStream&&"undefined"!=typeof webkitMediaStream&&(MediaStream=webkitMediaStream),"undefined"!=typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(t){t.kind.toString().indexOf("video")!==-1&&e.push(t)}),e},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach(function(t){t.kind.toString().indexOf("audio")!==-1&&e.push(t)}),e}),"stop"in MediaStream.prototype||(MediaStream.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})}));var Storage={};"undefined"!=typeof AudioContext?Storage.AudioContext=AudioContext:"undefined"!=typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext),"undefined"!=typeof RecordRTC&&(RecordRTC.Storage=Storage),"undefined"!=typeof RecordRTC&&(RecordRTC.MediaStreamRecorder=MediaStreamRecorder),"undefined"!=typeof RecordRTC&&(RecordRTC.StereoAudioRecorder=StereoAudioRecorder),"undefined"!=typeof RecordRTC&&(RecordRTC.CanvasRecorder=CanvasRecorder),"undefined"!=typeof RecordRTC&&(RecordRTC.WhammyRecorder=WhammyRecorder);var Whammy=function(){function e(e){this.frames=[],this.duration=e||1,this.quality=.8}function t(e){var t=URL.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (e) {"+e.name+"(e.data);}"],{type:"application/javascript"})),o=new Worker(t);return URL.revokeObjectURL(t),o}function o(e){function t(e){var t=i(e);if(!t)return[];for(var r=3e4,a=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:l(t.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],n=0,s=0;n<e.length;){var c=[],u=0;do c.push(e[n]),u+=e[n].duration,n++;while(n<e.length&&u<r);var f=0,g={id:524531317,data:o(s,f,c)};a[1].data.push(g),s+=u}return d(a)}function o(e,t,o){return[{data:e,id:231}].concat(o.map(function(e){var o=s({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:o,id:163}}))}function i(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,o=e[0].height,i=e[0].duration,r=1;r<e.length;r++)i+=e[r].duration;return{duration:i,width:t,height:o}}function r(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function a(e){return new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)}))}function n(e){var t=[],o=e.length%8?new Array(9-e.length%8).join("0"):"";e=o+e;for(var i=0;i<e.length;i+=8)t.push(parseInt(e.substr(i,8),2));return new Uint8Array(t)}function d(e){for(var t=[],o=0;o<e.length;o++){var i=e[o].data;"object"==typeof i&&(i=d(i)),"number"==typeof i&&(i=n(i.toString(2))),"string"==typeof i&&(i=a(i));var s=i.size||i.byteLength||i.length,c=Math.ceil(Math.ceil(Math.log(s)/Math.log(2))/8),u=s.toString(2),f=new Array(7*c+7+1-u.length).join("0")+u,l=new Array(c).join("0")+"1"+f;t.push(r(e[o].id)),t.push(n(l)),t.push(i)}return new Blob(t,{type:"video/webm"})}function s(e){var t=0;if(e.keyframe&&(t|=128),e.invisible&&(t|=8),e.lacing&&(t|=e.lacing<<1),e.discardable&&(t|=1),e.trackNum>127)throw"TrackNumber > 127 not supported";var o=[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame;return o}function c(e){for(var t=e.RIFF[0].WEBP[0],o=t.indexOf("*"),i=0,r=[];i<4;i++)r[i]=t.charCodeAt(o+3+i);
var a,n,d;return d=r[1]<<8|r[0],a=16383&d,d=r[3]<<8|r[2],n=16383&d,{width:a,height:n,data:t,riff:e}}function u(e,t){return parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t}).join(""),2)}function f(e){for(var t=0,o={};t<e.length;){var i=e.substr(t,4),r=u(e,t),a=e.substr(t+4+4,r);t+=8+r,o[i]=o[i]||[],"RIFF"===i||"LIST"===i?o[i].push(f(a)):o[i].push(a)}return o}function l(e){return[].slice.call(new Uint8Array(new Float64Array([e]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")}var g=new t(e.map(function(e){var t=c(f(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(g)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var i=t(o);i.onmessage=function(t){return t.data.error?void console.error(t.data.error):void e(t.data)},i.postMessage(this.frames)},{Video:e}}();"undefined"!=typeof RecordRTC&&(RecordRTC.Whammy=Whammy);var DiskStorage={init:function(){function e(e){e.createObjectStore(o.dataStoreName)}function t(){function e(e){t.objectStore(o.dataStoreName).get(e).onsuccess=function(t){o.callback&&o.callback(t.target.result,e)}}var t=i.transaction([o.dataStoreName],"readwrite");o.videoBlob&&t.objectStore(o.dataStoreName).put(o.videoBlob,"videoBlob"),o.gifBlob&&t.objectStore(o.dataStoreName).put(o.gifBlob,"gifBlob"),o.audioBlob&&t.objectStore(o.dataStoreName).put(o.audioBlob,"audioBlob"),e("audioBlob"),e("videoBlob"),e("gifBlob")}var o=this;if("undefined"==typeof indexedDB||"undefined"==typeof indexedDB.open)return void console.error("IndexedDB API are not available in this browser.");var i,r=1,a=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),n=indexedDB.open(a,r);n.onerror=o.onError,n.onsuccess=function(){if(i=n.result,i.onerror=o.onError,i.setVersion)if(i.version!==r){var a=i.setVersion(r);a.onsuccess=function(){e(i),t()}}else t();else t()},n.onupgradeneeded=function(t){e(t.target.result)}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};"undefined"!=typeof RecordRTC&&(RecordRTC.DiskStorage=DiskStorage),"undefined"!=typeof RecordRTC&&(RecordRTC.GifRecorder=GifRecorder);
"use strict";function h2clog(t){_html2canvas.logging&&window.console&&window.console.log&&window.console.log(t)}function backgroundBoundsFactory(t,e,n,a,o,r){var i,l,c,d,s=_html2canvas.Util.getCSS(e,t,o);if(1===s.length&&(d=s[0],s=[],s[0]=d,s[1]=d),s[0].toString().indexOf("%")!==-1)c=parseFloat(s[0])/100,l=n.width*c,"backgroundSize"!==t&&(l-=(r||a).width*c);else if("backgroundSize"===t)if("auto"===s[0])l=a.width;else if(s[0].match(/contain|cover/)){var h=_html2canvas.Util.resizeBounds(a.width,a.height,n.width,n.height,s[0]);l=h.width,i=h.height}else l=parseInt(s[0],10);else l=parseInt(s[0],10);return"auto"===s[1]?i=l/a.width*a.height:s[1].toString().indexOf("%")!==-1?(c=parseFloat(s[1])/100,i=n.height*c,"backgroundSize"!==t&&(i-=(r||a).height*c)):i=parseInt(s[1],10),[l,i]}function h2czContext(t){return{zindex:t,children:[]}}function h2cRenderContext(t,e){var n=[];return{storage:n,width:t,height:e,clip:function(){n.push({type:"function",name:"clip",arguments:arguments})},translate:function(){n.push({type:"function",name:"translate",arguments:arguments})},fill:function(){n.push({type:"function",name:"fill",arguments:arguments})},save:function(){n.push({type:"function",name:"save",arguments:arguments})},restore:function(){n.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){n.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){n.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var t=[];return n.push({type:"function",name:"drawShape",arguments:t}),{moveTo:function(){t.push({name:"moveTo",arguments:arguments})},lineTo:function(){t.push({name:"lineTo",arguments:arguments})},arcTo:function(){t.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){t.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){t.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){n.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){n.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(t,e){n.push({type:"variable",name:t,arguments:e})}}}function getMouseXY(t){return IE?(coordX=event.clientX+document.body.scrollLeft,coordY=event.clientY+document.body.scrollTop):(coordX=t.pageX,coordY=t.pageY),coordX<0&&(coordX=0),coordY<0&&(coordY=0),!0}var _html2canvas={},previousElement,computedCSS,html2canvas;_html2canvas.Util={},_html2canvas.Util.trimText=function(t){return function(e){return t?t.apply(e):((e||"")+"").replace(/^\s+|\s+$/g,"")}}(String.prototype.trim),_html2canvas.Util.parseBackgroundImage=function(t){var e,n,a,o,r,i,l,c,d=" \r\n\t",s=[],h=0,u=0,m=function(){e&&('"'===n.substr(0,1)&&(n=n.substr(1,n.length-2)),n&&c.push(n),"-"===e.substr(0,1)&&(o=e.indexOf("-",1)+1)>0&&(a=e.substr(0,o),e=e.substr(o)),s.push({prefix:a,method:e.toLowerCase(),value:r,args:c})),c=[],e=a=n=r=""};m();for(var g=0,p=t.length;g<p;g++)if(i=t[g],!(0===h&&d.indexOf(i)>-1)){switch(i){case'"':l?l===i&&(l=null):l=i;break;case"(":if(l)break;if(0===h){h=1,r+=i;continue}u++;break;case")":if(l)break;if(1===h){if(0===u){h=0,r+=i,m();continue}u--}break;case",":if(l)break;if(0===h){m();continue}if(1===h&&0===u&&!e.match(/^url$/i)){c.push(n),n="",r+=i;continue}}r+=i,0===h?e+=i:n+=i}return m(),s},_html2canvas.Util.Bounds=function(t){var e,n={};if(t.getBoundingClientRect)return e=t.getBoundingClientRect(),n.top=e.top,n.bottom=e.bottom||e.top+e.height,n.left=e.left,n.width=e.width||e.right-e.left,n.height=e.height||e.bottom-e.top,n},_html2canvas.Util.getCSS=function(t,e,n){function a(e,n){var a,o=t.runtimeStyle&&t.runtimeStyle[e],r=t.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(n)&&/^-?\d/.test(n)&&(a=r.left,o&&(t.runtimeStyle.left=t.currentStyle.left),r.left="fontSize"===e?"1em":n||0,n=r.pixelLeft+"px",r.left=a,o&&(t.runtimeStyle.left=o)),/^(thin|medium|thick)$/i.test(n)?n:Math.round(parseFloat(n))+"px"}var o,r=e.match(/^background(Size|Position)$/);if(previousElement!==t&&(computedCSS=document.defaultView.getComputedStyle(t,null)),o=computedCSS[e],r)if(o=(o||"").split(","),o=o[n||0]||o[0]||"auto",o=_html2canvas.Util.trimText(o).split(" "),"backgroundSize"!==e||o[0]&&!o[0].match(/cover|contain|auto/)){if(o[0]=o[0].indexOf("%")===-1?a(e+"X",o[0]):o[0],void 0===o[1]){if("backgroundSize"===e)return o[1]="auto",o;o[1]=o[0]}o[1]=o[1].indexOf("%")===-1?a(e+"Y",o[1]):o[1]}else;else if(/border(Top|Bottom)(Left|Right)Radius/.test(e)){var i=o.split(" ");i.length<=1&&(i[1]=i[0]),i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10),o=i}return o},_html2canvas.Util.resizeBounds=function(t,e,n,a,o){var r,i,l=n/a,c=t/e;return o&&"auto"!==o?l<c^"contain"===o?(i=a,r=a*c):(r=n,i=n/c):(r=n,i=a),{width:r,height:i}},_html2canvas.Util.BackgroundPosition=function(t,e,n,a,o){var r=backgroundBoundsFactory("backgroundPosition",t,e,n,a,o);return{left:r[0],top:r[1]}},_html2canvas.Util.BackgroundSize=function(t,e,n,a){var o=backgroundBoundsFactory("backgroundSize",t,e,n,a);return{width:o[0],height:o[1]}},_html2canvas.Util.Extend=function(t,e){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},_html2canvas.Util.Children=function(t){var e;try{e=t.nodeName&&"IFRAME"===t.nodeName.toUpperCase()?t.contentDocument||t.contentWindow.document:function(t){var e=[];return null!==t&&!function(t,e){var n=t.length,a=0;if("number"==typeof e.length)for(var o=e.length;a<o;a++)t[n++]=e[a];else for(;void 0!==e[a];)t[n++]=e[a++];return t.length=n,t}(e,t),e}(t.childNodes)}catch(n){h2clog("html2canvas.Util.Children failed with exception: "+n.message),e=[]}return e},_html2canvas.Util.Font=function(){var t={};return function(e,n,a){if(void 0!==t[e+"-"+n])return t[e+"-"+n];var o,r,i,l=a.createElement("div"),c=a.createElement("img"),d=a.createElement("span"),s="Hidden Text";return l.style.visibility="hidden",l.style.fontFamily=e,l.style.fontSize=n,l.style.margin=0,l.style.padding=0,a.body.appendChild(l),c.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",c.width=1,c.height=1,c.style.margin=0,c.style.padding=0,c.style.verticalAlign="baseline",d.style.fontFamily=e,d.style.fontSize=n,d.style.margin=0,d.style.padding=0,d.appendChild(a.createTextNode(s)),l.appendChild(d),l.appendChild(c),o=c.offsetTop-d.offsetTop+1,l.removeChild(d),l.appendChild(a.createTextNode(s)),l.style.lineHeight="normal",c.style.verticalAlign="super",r=c.offsetTop-l.offsetTop+1,i={baseline:o,lineWidth:1,middle:r},t[e+"-"+n]=i,a.body.removeChild(l),i}}(),function(){_html2canvas.Generate={};var t=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];_html2canvas.Generate.parseGradient=function(e,n){var a,o,r,i,l,c,d,s,h,u,m,g,p=t.length;for(o=0;o<p&&!(r=e.match(t[o]));o+=1);if(r)switch(r[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(a={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},l=r[2].match(/\w+/g))for(c=l.length,o=0;o<c;o+=1)switch(l[o]){case"top":a.y0=0,a.y1=n.height;break;case"right":a.x0=n.width,a.x1=0;break;case"bottom":a.y0=n.height,a.y1=0;break;case"left":a.x0=0,a.x1=n.width}if(null===a.x0&&null===a.x1&&(a.x0=a.x1=n.width/2),null===a.y0&&null===a.y1&&(a.y0=a.y1=n.height/2),l=r[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(c=l.length,d=1/Math.max(c-1,1),o=0;o<c;o+=1)s=l[o].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),s[2]?(i=parseFloat(s[2]),i/="%"===s[3]?100:n.width):i=o*d,a.colorStops.push({color:s[1],stop:i});break;case"-webkit-gradient":if(a={type:"radial"===r[2]?"circle":r[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},l=r[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/),l&&(a.x0=l[1]*n.width/100,a.y0=l[2]*n.height/100,a.x1=l[3]*n.width/100,a.y1=l[4]*n.height/100),l=r[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(c=l.length,o=0;o<c;o+=1)s=l[o].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),i=parseFloat(s[2]),"from"===s[1]&&(i=0),"to"===s[1]&&(i=1),a.colorStops.push({color:s[3],stop:i});break;case"-moz-linear-gradient":if(a={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},l=r[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),l&&(a.x0=l[1]*n.width/100,a.y0=l[2]*n.height/100,a.x1=n.width-a.x0,a.y1=n.height-a.y0),l=r[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(c=l.length,d=1/Math.max(c-1,1),o=0;o<c;o+=1)s=l[o].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/),s[2]?(i=parseFloat(s[2]),s[3]&&(i/=100)):i=o*d,a.colorStops.push({color:s[1],stop:i});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(a={type:"circle",x0:0,y0:0,x1:n.width,y1:n.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},l=r[2].match(/(\d{1,3})%?\s(\d{1,3})%?/),l&&(a.cx=l[1]*n.width/100,a.cy=l[2]*n.height/100),l=r[3].match(/\w+/),s=r[4].match(/[a-z\-]*/),l&&s)switch(s[0]){case"farthest-corner":case"cover":case"":h=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.cy,2)),u=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.y1-a.cy,2)),m=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.y1-a.cy,2)),g=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.cy,2)),a.rx=a.ry=Math.max(h,u,m,g);break;case"closest-corner":h=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.cy,2)),u=Math.sqrt(Math.pow(a.cx,2)+Math.pow(a.y1-a.cy,2)),m=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.y1-a.cy,2)),g=Math.sqrt(Math.pow(a.x1-a.cx,2)+Math.pow(a.cy,2)),a.rx=a.ry=Math.min(h,u,m,g);break;case"farthest-side":"circle"===l[0]?a.rx=a.ry=Math.max(a.cx,a.cy,a.x1-a.cx,a.y1-a.cy):(a.type=l[0],a.rx=Math.max(a.cx,a.x1-a.cx),a.ry=Math.max(a.cy,a.y1-a.cy));break;case"closest-side":case"contain":"circle"===l[0]?a.rx=a.ry=Math.min(a.cx,a.cy,a.x1-a.cx,a.y1-a.cy):(a.type=l[0],a.rx=Math.min(a.cx,a.x1-a.cx),a.ry=Math.min(a.cy,a.y1-a.cy))}if(l=r[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(c=l.length,d=1/Math.max(c-1,1),o=0;o<c;o+=1)s=l[o].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/),s[2]?(i=parseFloat(s[2]),i/="%"===s[3]?100:n.width):i=o*d,a.colorStops.push({color:s[1],stop:i})}return a},_html2canvas.Generate.Gradient=function(t,e){if(0!==e.width&&0!==e.height){var n,a,o,r,i=document.createElement("canvas"),l=i.getContext("2d");if(i.width=e.width,i.height=e.height,n=_html2canvas.Generate.parseGradient(t,e))if("linear"===n.type){for(a=l.createLinearGradient(n.x0,n.y0,n.x1,n.y1),o=0,r=n.colorStops.length;o<r;o+=1)try{a.addColorStop(n.colorStops[o].stop,n.colorStops[o].color)}catch(c){h2clog(["failed to add color stop: ",c,"; tried to add: ",n.colorStops[o],"; stop: ",o,"; in: ",t])}l.fillStyle=a,l.fillRect(0,0,e.width,e.height)}else if("circle"===n.type){for(a=l.createRadialGradient(n.cx,n.cy,0,n.cx,n.cy,n.rx),o=0,r=n.colorStops.length;o<r;o+=1)try{a.addColorStop(n.colorStops[o].stop,n.colorStops[o].color)}catch(c){h2clog(["failed to add color stop: ",c,"; tried to add: ",n.colorStops[o],"; stop: ",o,"; in: ",t])}l.fillStyle=a,l.fillRect(0,0,e.width,e.height)}else if("ellipse"===n.type){var d=document.createElement("canvas"),s=d.getContext("2d"),h=Math.max(n.rx,n.ry),u=2*h;for(d.width=d.height=u,a=s.createRadialGradient(n.rx,n.ry,0,n.rx,n.ry,h),o=0,r=n.colorStops.length;o<r;o+=1)try{a.addColorStop(n.colorStops[o].stop,n.colorStops[o].color)}catch(c){h2clog(["failed to add color stop: ",c,"; tried to add: ",n.colorStops[o],"; stop: ",o,"; in: ",t])}s.fillStyle=a,s.fillRect(0,0,u,u),l.fillStyle=n.colorStops[o-1].color,l.fillRect(0,0,i.width,i.height),l.drawImage(d,n.cx-n.rx,n.cy-n.ry,2*n.rx,2*n.ry)}return i}},_html2canvas.Generate.ListAlpha=function(t){var e,n="";do e=t%26,n=String.fromCharCode(e+64)+n,t/=26;while(26*t>26);return n},_html2canvas.Generate.ListRoman=function(t){var e,n=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],a=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],o="",r=n.length;if(t<=0||t>=4e3)return t;for(e=0;e<r;e+=1)for(;t>=a[e];)t-=a[e],o+=n[e];return o}}(),_html2canvas.Parse=function(t,e){function n(){return Math.max(Math.max(tt.body.scrollWidth,tt.documentElement.scrollWidth),Math.max(tt.body.offsetWidth,tt.documentElement.offsetWidth),Math.max(tt.body.clientWidth,tt.documentElement.clientWidth))}function a(){return Math.max(Math.max(tt.body.scrollHeight,tt.documentElement.scrollHeight),Math.max(tt.body.offsetHeight,tt.documentElement.offsetHeight),Math.max(tt.body.clientHeight,tt.documentElement.clientHeight))}function o(t,e){var n=parseInt(ot(t,e),10);return isNaN(n)?0:n}function r(t,e,n,a,o,r){"transparent"!==r&&(t.setVariable("fillStyle",r),t.fillRect(e,n,a,o),Z+=1)}function i(t,e){switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(t,e,n){if(t.length>0)return e+n.toUpperCase()});case"uppercase":return t.toUpperCase();default:return t}}function l(t){return/^(normal|none|0px)$/.test(t)}function c(t,e,n,a){null!==t&&_html2canvas.Util.trimText(t).length>0&&(a.fillText(t,e,n),Z+=1)}function d(t,e,n,a){var o=!1,r=ot(e,"fontWeight"),i=ot(e,"fontFamily"),l=ot(e,"fontSize");switch(parseInt(r,10)){case 401:r="bold";break;case 400:r="normal"}if(t.setVariable("fillStyle",a),t.setVariable("font",[ot(e,"fontStyle"),ot(e,"fontVariant"),r,l,i].join(" ")),t.setVariable("textAlign",o?"right":"left"),"none"!==n)return _html2canvas.Util.Font(i,l,tt)}function s(t,e,n,a,o){switch(e){case"underline":r(t,n.left,Math.round(n.top+a.baseline+a.lineWidth),n.width,1,o);break;case"overline":r(t,n.left,Math.round(n.top),n.width,1,o);break;case"line-through":r(t,n.left,Math.ceil(n.top+a.middle+a.lineWidth),n.width,1,o)}}function h(t,e,n,a){var o;if(et.rangeBounds)"none"===n&&0===_html2canvas.Util.trimText(e).length||(o=u(e,t.node,t.textOffset)),t.textOffset+=e.length;else if(t.node&&"string"==typeof t.node.nodeValue){var r=a?t.node.splitText(e.length):null;o=m(t.node),t.node=r}return o}function u(t,e,n){var a=tt.createRange();return a.setStart(e,n),a.setEnd(e,n+t.length),a.getBoundingClientRect()}function m(t){var e=t.parentNode,n=tt.createElement("wrapper"),a=t.cloneNode(!0);n.appendChild(t.cloneNode(!0)),e.replaceChild(n,t);var o=_html2canvas.Util.Bounds(n);return e.replaceChild(a,n),o}function g(t,n,a){var o,r,u=a.ctx,m=ot(t,"color"),g=ot(t,"textDecoration"),p=ot(t,"textAlign"),f={node:n,textOffset:0};_html2canvas.Util.trimText(n.nodeValue).length>0&&(n.nodeValue=i(n.nodeValue,ot(t,"textTransform")),p=p.replace(["-webkit-auto"],["auto"]),r=!e.letterRendering&&/^(left|right|justify|auto)$/.test(p)&&l(ot(t,"letterSpacing"))?n.nodeValue.split(/(\b| )/):n.nodeValue.split(""),o=d(u,t,g,m),e.chinese&&r.forEach(function(t,e){/.*[\u4E00-\u9FA5].*$/.test(t)&&(t=t.split(""),t.unshift(e,1),r.splice.apply(r,t))}),r.forEach(function(t,e){var n=h(f,t,g,e<r.length-1);n&&(c(t,n.left,n.bottom,u),s(u,g,n,o,m))}))}function p(t,e){var n,a,o=tt.createElement("boundelement");return o.style.display="inline",n=t.style.listStyleType,t.style.listStyleType="none",o.appendChild(tt.createTextNode(e)),t.insertBefore(o,t.firstChild),a=_html2canvas.Util.Bounds(o),t.removeChild(o),t.style.listStyleType=n,a}function f(t){var e=-1,n=1,a=t.parentNode.childNodes;if(t.parentNode){for(;a[++e]!==t;)1===a[e].nodeType&&n++;return n}return-1}function w(t,e){var n,a=f(t);switch(e){case"decimal":n=a;break;case"decimal-leading-zero":n=1===a.toString().length?a="0"+a.toString():a.toString();break;case"upper-roman":n=_html2canvas.Generate.ListRoman(a);break;case"lower-roman":n=_html2canvas.Generate.ListRoman(a).toLowerCase();break;case"lower-alpha":n=_html2canvas.Generate.ListAlpha(a).toLowerCase();break;case"upper-alpha":n=_html2canvas.Generate.ListAlpha(a)}return n+=". "}function v(t,e,n){var a,o,r,i=e.ctx,l=ot(t,"listStyleType");if(/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(l)){if(o=w(t,l),r=p(t,o),d(i,t,"none",ot(t,"color")),"inside"!==ot(t,"listStylePosition"))return;i.setVariable("textAlign","left"),a=n.left,c(o,a,r.bottom,i)}}function y(e){var n=t[e];return!(!n||n.succeeded!==!0)&&n.img}function b(t,e){var n=Math.max(t.left,e.left),a=Math.max(t.top,e.top),o=Math.min(t.left+t.width,e.left+e.width),r=Math.min(t.top+t.height,e.top+e.height);return{left:n,top:a,width:o-n,height:r-a}}function x(t,e){var n;return e?"auto"!==t?(n=h2czContext(t),e.children.push(n),n):e:n=h2czContext(0)}function C(t,e,n,a,r){var i=o(e,"paddingLeft"),l=o(e,"paddingTop"),c=o(e,"paddingRight"),d=o(e,"paddingBottom");z(t,n,0,0,n.width,n.height,a.left+i+r[3].width,a.top+l+r[0].width,a.width-(r[1].width+r[3].width+i+c),a.height-(r[0].width+r[2].width+l+d))}function A(t){return["Top","Right","Bottom","Left"].map(function(e){return{width:o(t,"border"+e+"Width"),color:ot(t,"border"+e+"Color")}})}function S(t){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(e){return ot(t,"border"+e+"Radius")})}function R(t,e,n,a){var o=function(t,e,n){return{x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}};return{start:t,startControl:e,endControl:n,end:a,subdivide:function(r){var i=o(t,e,r),l=o(e,n,r),c=o(n,a,r),d=o(i,l,r),s=o(l,c,r),h=o(d,s,r);return[R(t,i,d,h),R(h,s,c,a)]},curveTo:function(t){t.push(["bezierCurve",e.x,e.y,n.x,n.y,a.x,a.y])},curveToReversed:function(a){a.push(["bezierCurve",n.x,n.y,e.x,e.y,t.x,t.y])}}}function E(t,e,n,a,o,r,i){e[0]>0||e[1]>0?(t.push(["line",a[0].start.x,a[0].start.y]),a[0].curveTo(t),a[1].curveTo(t)):t.push(["line",r,i]),(n[0]>0||n[1]>0)&&t.push(["line",o[0].start.x,o[0].start.y])}function M(t,e,n,a,o,r,i){var l=[];return e[0]>0||e[1]>0?(l.push(["line",a[1].start.x,a[1].start.y]),a[1].curveTo(l)):l.push(["line",t.c1[0],t.c1[1]]),n[0]>0||n[1]>0?(l.push(["line",r[0].start.x,r[0].start.y]),r[0].curveTo(l),l.push(["line",i[0].end.x,i[0].end.y]),i[0].curveToReversed(l)):(l.push(["line",t.c2[0],t.c2[1]]),l.push(["line",t.c3[0],t.c3[1]])),e[0]>0||e[1]>0?(l.push(["line",o[1].end.x,o[1].end.y]),o[1].curveToReversed(l)):l.push(["line",t.c4[0],t.c4[1]]),l}function k(t,e,n){var a=t.left,o=t.top,r=t.width,i=t.height,l=e[0][0],c=e[0][1],d=e[1][0],s=e[1][1],h=e[2][0],u=e[2][1],m=e[3][0],g=e[3][1],p=r-d,f=i-h,w=r-u,v=i-g;return{topLeftOuter:lt(a,o,l,c).topLeft.subdivide(.5),topLeftInner:lt(a+n[3].width,o+n[0].width,Math.max(0,l-n[3].width),Math.max(0,c-n[0].width)).topLeft.subdivide(.5),topRightOuter:lt(a+p,o,d,s).topRight.subdivide(.5),topRightInner:lt(a+Math.min(p,r+n[3].width),o+n[0].width,p>r+n[3].width?0:d-n[3].width,s-n[0].width).topRight.subdivide(.5),bottomRightOuter:lt(a+w,o+f,u,h).bottomRight.subdivide(.5),bottomRightInner:lt(a+Math.min(w,r+n[3].width),o+Math.min(f,i+n[0].width),Math.max(0,u-n[1].width),Math.max(0,h-n[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:lt(a,o+v,m,g).bottomLeft.subdivide(.5),bottomLeftInner:lt(a+n[3].width,o+v,Math.max(0,m-n[3].width),Math.max(0,g-n[2].width)).bottomLeft.subdivide(.5)}}function T(t,e,n,a,o){var r=ot(t,"backgroundClip"),i=[];switch(r){case"content-box":case"padding-box":E(i,a[0],a[1],e.topLeftInner,e.topRightInner,o.left+n[3].width,o.top+n[0].width),E(i,a[1],a[2],e.topRightInner,e.bottomRightInner,o.left+o.width-n[1].width,o.top+n[0].width),E(i,a[2],a[3],e.bottomRightInner,e.bottomLeftInner,o.left+o.width-n[1].width,o.top+o.height-n[2].width),E(i,a[3],a[0],e.bottomLeftInner,e.topLeftInner,o.left+n[3].width,o.top+o.height-n[2].width);break;default:E(i,a[0],a[1],e.topLeftOuter,e.topRightOuter,o.left,o.top),E(i,a[1],a[2],e.topRightOuter,e.bottomRightOuter,o.left+o.width,o.top),E(i,a[2],a[3],e.bottomRightOuter,e.bottomLeftOuter,o.left+o.width,o.top+o.height),E(i,a[3],a[0],e.bottomLeftOuter,e.topLeftOuter,o.left,o.top+o.height)}return i}function I(t,e,n){var a,o,r,i,l,c,d=e.left,s=e.top,h=e.width,u=e.height,m=S(t),g=k(e,m,n),p={clip:T(t,g,n,m,e),borders:[]};for(a=0;a<4;a++)if(n[a].width>0){switch(o=d,r=s,i=h,l=u-n[2].width,a){case 0:l=n[0].width,c=M({c1:[o,r],c2:[o+i,r],c3:[o+i-n[1].width,r+l],c4:[o+n[3].width,r+l]},m[0],m[1],g.topLeftOuter,g.topLeftInner,g.topRightOuter,g.topRightInner);break;case 1:o=d+h-n[1].width,i=n[1].width,c=M({c1:[o+i,r],c2:[o+i,r+l+n[2].width],c3:[o,r+l],c4:[o,r+n[0].width]},m[1],m[2],g.topRightOuter,g.topRightInner,g.bottomRightOuter,g.bottomRightInner);break;case 2:r=r+u-n[2].width,l=n[2].width,c=M({c1:[o+i,r+l],c2:[o,r+l],c3:[o+n[3].width,r],c4:[o+i-n[2].width,r]},m[2],m[3],g.bottomRightOuter,g.bottomRightInner,g.bottomLeftOuter,g.bottomLeftInner);break;case 3:i=n[3].width,c=M({c1:[o,r+l+n[2].width],c2:[o,r],c3:[o+i,r+n[0].width],c4:[o+i,r+l]},m[3],m[0],g.bottomLeftOuter,g.bottomLeftInner,g.topLeftOuter,g.topLeftInner)}p.borders.push({args:c,color:n[a].color})}return p}function L(t,e){var n=t.drawShape();return e.forEach(function(t,e){n[0===e?"moveTo":t[0]+"To"].apply(null,t.slice(1))}),n}function U(t,e,n){"transparent"!==n&&(t.setVariable("fillStyle",n),L(t,e),t.fill(),Z+=1)}function _(t,e,n){var a,o,r=tt.createElement("valuewrap"),i=["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"];i.forEach(function(e){try{r.style[e]=ot(t,e)}catch(n){h2clog("html2canvas: Parse: Exception caught in renderFormValue: "+n.message)}}),r.style.borderColor="black",r.style.borderStyle="solid",r.style.display="block",r.style.position="absolute",(/^(submit|reset|button|text|password)$/.test(t.type)||"SELECT"===t.nodeName)&&(r.style.lineHeight=ot(t,"height")),r.style.top=e.top+"px",r.style.left=e.left+"px",a="SELECT"===t.nodeName?(t.options[t.selectedIndex]||0).text:t.value,a||(a=t.placeholder),o=tt.createTextNode(a),r.appendChild(o),at.appendChild(r),g(t,o,n),at.removeChild(r)}function z(t){t.drawImage.apply(t,Array.prototype.slice.call(arguments,1)),Z+=1}function O(t,e){var n=window.getComputedStyle(t,e);if(n&&n.content&&"none"!==n.content&&"-moz-alt-content"!==n.content){var a=n.content+"",o=a.substr(0,1);o===a.substr(a.length-1)&&o.match(/'|"/)&&(a=a.substr(1,a.length-2));var r="url"===a.substr(0,3),i=document.createElement(r?"img":"span");return i.className=rt+"-before "+rt+"-after",Object.keys(n).filter(N).forEach(function(t){i.style[t]=n[t]}),r?i.src=_html2canvas.Util.parseBackgroundImage(a)[0].args[0]:i.innerHTML=a,i}}function N(t){return isNaN(window.parseInt(t,10))}function B(t,e){var n=O(t,":before"),a=O(t,":after");(n||a)&&(n&&(t.className+=" "+rt+"-before",t.parentNode.insertBefore(n,t),J(n,e,!0),t.parentNode.removeChild(n),t.className=t.className.replace(rt+"-before","").trim()),a&&(t.className+=" "+rt+"-after",t.appendChild(a),J(a,e,!0),t.removeChild(a),t.className=t.className.replace(rt+"-after","").trim()))}function F(t,e,n,a){var o=Math.round(a.left+n.left),r=Math.round(a.top+n.top);t.createPattern(e),t.translate(o,r),t.fill(),t.translate(-o,-r)}function P(t,e,n,a,o,r,i,l){var c=[];c.push(["line",Math.round(o),Math.round(r)]),c.push(["line",Math.round(o+i),Math.round(r)]),c.push(["line",Math.round(o+i),Math.round(l+r)]),c.push(["line",Math.round(o),Math.round(l+r)]),L(t,c),t.save(),t.clip(),F(t,e,n,a),t.restore()}function V(t,e,n){r(t,e.left,e.top,e.width,e.height,n)}function G(t,e,n,a,o){var r=_html2canvas.Util.BackgroundSize(t,e,a,o),i=_html2canvas.Util.BackgroundPosition(t,e,a,o,r),l=ot(t,"backgroundRepeat").split(",").map(function(t){return t.trim()});switch(a=D(a,r),l=l[o]||l[0]){case"repeat-x":P(n,a,i,e,e.left,e.top+i.top,99999,a.height);break;case"repeat-y":P(n,a,i,e,e.left+i.left,e.top,a.width,99999);break;case"no-repeat":P(n,a,i,e,e.left+i.left,e.top+i.top,a.width,a.height);break;default:F(n,a,i,{top:e.top,left:e.left,width:a.width,height:a.height})}}function Y(t,e,n){for(var a,o=ot(t,"backgroundImage"),r=_html2canvas.Util.parseBackgroundImage(o),i=r.length;i--;)if(o=r[i],o.args&&0!==o.args.length){var l="url"===o.method?o.args[0]:o.value;a=y(l),a?G(t,e,n,a,i):h2clog("html2canvas: Error loading background:",o)}}function D(t,e){if(t.width===e.width&&t.height===e.height)return t;var n,a=tt.createElement("canvas");return a.width=e.width,a.height=e.height,n=a.getContext("2d"),z(n,t,0,0,t.width,t.height,0,0,e.width,e.height),a}function q(t,e,n){var a=ot(e,"opacity")*(n?n.opacity:1);return t.setVariable("globalAlpha",a),a}function W(t,o,r){var i=h2cRenderContext(o?r.width:n(),o?r.height:a()),l={ctx:i,zIndex:x(ot(t,"zIndex"),o?o.zIndex:null),opacity:q(i,t,o),cssPosition:ot(t,"position"),borders:A(t),clip:o&&o.clip?_html2canvas.Util.Extend({},o.clip):null};return e.useOverflow===!0&&/(hidden|scroll|auto)/.test(ot(t,"overflow"))===!0&&/(BODY)/i.test(t.nodeName)===!1&&(l.clip=l.clip?b(l.clip,r):r),l.zIndex.children.push(l),l}function X(t,e,n){var a={left:e.left+t[3].width,top:e.top+t[0].width,width:e.width-(t[1].width+t[3].width),height:e.height-(t[0].width+t[2].width)};return n&&(a=b(a,n)),a}function j(t,e,n){var a,o=_html2canvas.Util.Bounds(t),r=nt.test(t.nodeName)?"#efefef":ot(t,"backgroundColor"),i=W(t,e,o),l=i.borders,c=i.ctx,d=X(l,o,i.clip),s=I(t,o,l);switch(L(c,s.clip),c.save(),c.clip(),d.height>0&&d.width>0&&(V(c,o,r),Y(t,d,c)),c.restore(),s.borders.forEach(function(t){U(c,t.args,t.color)}),n||B(t,i),t.nodeName){case"IMG":(a=y(t.getAttribute("src")))?C(c,t,a,o,l):h2clog("html2canvas: Error loading <img>:"+t.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(t.type)&&(t.value||t.placeholder).length>0&&_(t,o,i);break;case"TEXTAREA":(t.value||t.placeholder||"").length>0&&_(t,o,i);break;case"SELECT":(t.options||t.placeholder||"").length>0&&_(t,o,i);break;case"LI":v(t,i,d);break;case"VIDEO":var h=document.createElement("canvas");h.width=t.videoWidth||t.clientWidth||320,h.height=t.videoHeight||t.clientHeight||240;var u=h.getContext("2d");u.drawImage(t,0,0,h.width,h.height),C(c,h,h,o,l);break;case"CANVAS":C(c,t,t,o,l)}return i}function H(t){return"none"!==ot(t,"display")&&"hidden"!==ot(t,"visibility")&&!t.hasAttribute("data-html2canvas-ignore")}function J(t,e,n){H(t)&&(e=j(t,e,n)||e,nt.test(t.nodeName)||("IFRAME"==t.tagName&&(t=t.contentDocument),_html2canvas.Util.Children(t).forEach(function(a){1===a.nodeType?J(a,e,n):3===a.nodeType&&g(t,a,e)})))}function Q(t,e){function o(t){var e,n,a,r,i,l=_html2canvas.Util.Children(t),d=l.length;for(i=0;i<d;i+=1)if(r=l[i],3===r.nodeType)c+=r.nodeValue.replace(/</g,"&lt;").replace(/>/g,"&gt;");else if(1===r.nodeType&&!/^(script|meta|title)$/.test(r.nodeName.toLowerCase())){if(c+="<"+r.nodeName.toLowerCase(),r.hasAttributes())for(e=r.attributes,a=e.length,n=0;n<a;n+=1)c+=" "+e[n].name+'="'+e[n].value+'"';c+=">",o(r),c+="</"+r.nodeName.toLowerCase()+">"}}var r=new Image,i=n(),l=a(),c="";o(t),r.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='"+i+"' height='"+l+"'>","<foreignObject width='"+i+"' height='"+l+"'>","<html xmlns='http://www.w3.org/1999/xhtml' style='margin:0;'>",c.replace(/\#/g,"%23"),"</html>","</foreignObject>","</svg>"].join(""),r.onload=function(){e.svgRender=r}}function $(){var t=j(K,null);return et.svgRendering&&Q(document.documentElement,t),Array.prototype.slice.call(K.children,0).forEach(function(e){J(e,t)}),t.backgroundColor=ot(document.documentElement,"backgroundColor"),at.removeChild(it),t}var K=void 0===e.elements?document.body:e.elements[0],Z=0,tt=K.ownerDocument,et=_html2canvas.Util.Support(e,tt),nt=new RegExp("("+e.ignoreElements+")"),at=tt.body,ot=_html2canvas.Util.getCSS,rt="___html2canvas___pseudoelement",it=tt.createElement("style");it.innerHTML="."+rt+'-before:before { content: "" !important; display: none !important; }.'+rt+'-after:after { content: "" !important; display: none !important; }',at.appendChild(it),t=t||{};var lt=function(t){return function(e,n,a,o){var r=a*t,i=o*t,l=e+a,c=n+o;return{topLeft:R({x:e,y:c},{x:e,y:c-i},{x:l-r,y:n},{x:l,y:n}),topRight:R({x:e,y:n},{x:e+r,y:n},{x:l,y:c-i},{x:l,y:c}),bottomRight:R({x:l,y:n},{x:l,y:n+i},{x:e+r,y:c},{x:e,y:c}),bottomLeft:R({x:l,y:c},{x:l-r,y:c},{x:e,y:n+i},{x:e,y:n})}}}(4*((Math.sqrt(2)-1)/3));return $()},_html2canvas.Preload=function(t){function e(t){x.href=t,x.href=x.href;var e=x.protocol+x.host;return e===h}function n(){h2clog("html2canvas: start: images: "+p.numLoaded+" / "+p.numTotal+" (failed: "+p.numFailed+")"),!p.firstRun&&p.numLoaded>=p.numTotal&&(h2clog("Finished loading images: # "+p.numTotal+" (failed: "+p.numFailed+")"),"function"==typeof t.complete&&t.complete(p))}function a(e,a,o){var r,i,l=t.proxy;x.href=e,e=x.href,r="html2canvas_"+f++,o.callbackname=r,l+=l.indexOf("?")>-1?"&":"?",l+="url="+encodeURIComponent(e)+"&callback="+r,i=v.createElement("script"),window[r]=function(t){"error:"===t.substring(0,6)?(o.succeeded=!1,p.numLoaded++,p.numFailed++,n()):(s(a,o),a.src=t),window[r]=void 0;try{delete window[r]}catch(e){}i.parentNode.removeChild(i),i=null,delete o.script,delete o.callbackname},i.setAttribute("type","text/javascript"),i.setAttribute("src",l),o.script=i,window.document.body.appendChild(i)}function o(t,e){var n=window.getComputedStyle(t,e),a=n.content;"url"===a.substr(0,3)&&u.loadImage(_html2canvas.Util.parseBackgroundImage(a)[0].args[0]),c(n.backgroundImage,t)}function r(t){o(t,":before"),o(t,":after")}function i(t,e){var a=_html2canvas.Generate.Gradient(t,e);void 0!==a&&(p[t]={img:a,succeeded:!0},p.numTotal++,p.numLoaded++,n())}function l(t){return t&&t.method&&t.args&&t.args.length>0}function c(t,e){var n;_html2canvas.Util.parseBackgroundImage(t).filter(l).forEach(function(t){"url"===t.method?u.loadImage(t.args[0]):t.method.match(/\-?gradient$/)&&(void 0===n&&(n=_html2canvas.Util.Bounds(e)),i(t.value,n))})}function d(t){var e=!1;try{_html2canvas.Util.Children(t).forEach(function(t){d(t)})}catch(n){}try{e=t.nodeType}catch(a){e=!1,h2clog("html2canvas: failed to access some element's nodeType - Exception: "+a.message)}if(1===e||void 0===e){r(t);try{c(_html2canvas.Util.getCSS(t,"backgroundImage"),t)}catch(n){h2clog("html2canvas: failed to get background-image - Exception: "+n.message)}c(t)}}function s(e,o){e.onload=function(){void 0!==o.timer&&window.clearTimeout(o.timer),p.numLoaded++,o.succeeded=!0,e.onerror=e.onload=null,n()},e.onerror=function(){if("anonymous"===e.crossOrigin&&(window.clearTimeout(o.timer),t.proxy)){var r=e.src;return e=new Image,o.img=e,e.src=r,void a(e.src,e,o)}p.numLoaded++,p.numFailed++,o.succeeded=!1,e.onerror=e.onload=null,n()}}var h,u,m,g,p={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},f=0,w=t.elements[0]||document.body,v=w.ownerDocument,y=v.images,b=y.length,x=v.createElement("a"),C=function(t){return void 0!==t.crossOrigin}(new Image);for(x.href=window.location.href,h=x.protocol+x.host,u={loadImage:function(n){var o,r;n&&void 0===p[n]&&(o=new Image,n.match(/data:image\/.*;base64,/i)?(o.src=n.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),r=p[n]={img:o},p.numTotal++,s(o,r)):e(n)||t.allowTaint===!0?(r=p[n]={img:o},p.numTotal++,s(o,r),o.src=n):C&&!t.allowTaint&&t.useCORS?(o.crossOrigin="anonymous",r=p[n]={img:o},p.numTotal++,s(o,r),o.src=n,o.customComplete=function(){this.img.complete?this.img.onerror():this.timer=window.setTimeout(this.img.customComplete,100)}.bind(r),o.customComplete()):t.proxy&&(r=p[n]={img:o},p.numTotal++,a(n,o,r)))},cleanupDOM:function(e){var a,o;if(!p.cleanupDone){h2clog(e&&"string"==typeof e?"html2canvas: Cleanup because: "+e:"html2canvas: Cleanup after timeout: "+t.timeout+" ms.");for(o in p)if(p.hasOwnProperty(o)&&(a=p[o],"object"==typeof a&&a.callbackname&&void 0===a.succeeded)){window[a.callbackname]=void 0;try{delete window[a.callbackname]}catch(r){}
a.script&&a.script.parentNode&&(a.script.setAttribute("src","about:blank"),a.script.parentNode.removeChild(a.script)),p.numLoaded++,p.numFailed++,h2clog("html2canvas: Cleaned up failed img: '"+o+"' Steps: "+p.numLoaded+" / "+p.numTotal)}void 0!==window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1),void 0!==document.close&&document.close(),p.cleanupDone=!0,e&&"string"==typeof e||n()}},renderingDone:function(){g&&window.clearTimeout(g)}},t.timeout>0&&(g=window.setTimeout(u.cleanupDOM,t.timeout)),h2clog("html2canvas: Preload starts: finding background-images"),p.firstRun=!0,d(w),h2clog("html2canvas: Preload: Finding images"),m=0;m<b;m+=1)u.loadImage(y[m].getAttribute("src"));return p.firstRun=!1,h2clog("html2canvas: Preload: Done."),p.numTotal===p.numLoaded&&n(),u},_html2canvas.Renderer=function(t,e){function n(t){var e=[],n=function(t){var a=[],o=[];t.children.forEach(function(t){t.children&&t.children.length>0?(a.push(t),o.push(t.zindex)):e.push(t)}),o.sort(function(t,e){return t-e}),o.forEach(function(t){var e;a.some(function(n,a){return e=a,n.zindex===t}),n(a.splice(e,1)[0])})};return n(t.zIndex),e}function a(t){var n;if("string"==typeof e.renderer&&void 0!==_html2canvas.Renderer[t])n=_html2canvas.Renderer[t](e);else{if("function"!=typeof t)throw new Error("Unknown renderer");n=t(e)}if("function"!=typeof n)throw new Error("Invalid renderer defined");return n}return a(e.renderer)(t,e,document,n(t),_html2canvas)},_html2canvas.Util.Support=function(t,e){function n(){var t=new Image,n=e.createElement("canvas"),a=void 0!==n.getContext&&n.getContext("2d");if(a===!1)return!1;n.width=n.height=10,t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{a.drawImage(t,0,0),n.toDataURL()}catch(o){return!1}return h2clog("html2canvas: Parse: SVG powered rendering available"),!0}function a(){var t,n,a,o,r=!1;return e.createRange&&(t=e.createRange(),t.getBoundingClientRect&&(n=e.createElement("boundtest"),n.style.height="123px",n.style.display="block",e.body.appendChild(n),t.selectNode(n),a=t.getBoundingClientRect(),o=a.height,123===o&&(r=!0),e.body.removeChild(n))),r}return{rangeBounds:a(),svgRendering:t.svgRendering&&n()}},window.html2canvas=function(t,e){t=t.length?t:[t];var n,a,o={logging:!1,elements:t,background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"};return o=_html2canvas.Util.Extend(e,o),_html2canvas.logging=o.logging,o.complete=function(t){if(!("function"==typeof o.onpreloaded&&o.onpreloaded(t)===!1||(n=_html2canvas.Parse(t,o),"function"==typeof o.onparsed&&o.onparsed(n)===!1||(a=_html2canvas.Renderer(n,o),"function"!=typeof o.onrendered))))if("undefined"==typeof o.grabMouse||o.grabMouse){var e=new Image(25,25);e.onload=function(){a.getContext("2d").drawImage(e,coordX,coordY,25,25),o.onrendered(a)},e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjExR/NCNwAAAzZJREFUSEut1EtME1EUANBiTTFaivRDKbaFFgiILgxx0bQllYItYKFIgEYoC2oEwqeCC4gG1xg2dmEwEQMJujIxwQ24wA2uCFAB3SBBfqWuyqd/CuV634QSPgOFxElu+mZye+a++948BgAw/mccYAwGIyY7O1vR3NzSiuMLX5GiDoO8tLQ0QzAYDLW1tT2/qEgHJslk8rKtLU9odzcMTU3N7RdB6UBhRkZG6fz8QrCuzgJutwfq6xtazovSgunp6SUOhzPI5XJBr9fD9nYojHjDeVA6MJH0EMGARCIBRKC8vJygO2ZzrSUaSgumpqY+cDjWAlJpCgWSMJlMiO6EqqpMtWehtKBUKi1eXV3zI3wAEhQrJJUGseJHp6G0IE61CKfsl8lkR0CCWiyPAXeU32AwVNChdKAAwUIEfXK5/ARI0IaGRkS3vXp9ofE4SguKxWL92tpfH642LUjQ1lYr+P0Bt1abX3wYPQv04n48FSRoe/sz8Pn8G7m5uboISgfyk5OT72OF3szMzBMgk8k88qyjowPW1zddCoVCS1BaUCQSEdCTlZV18GcOh0ONq6trYGbmJ0xMTO3Z7dMwPj4B4XAYXC7XhkqlKqAFBQJBAS6KB08dClEqlTA8/JUak5cEAkHo6nppMxqN7ZWVVZ0GQ0lnRUXlC6VSVXoamI+gm/RQKEyChYU/u5gYUqvVFDo09AVsNttrHMdh3MAQYyRhxNIeX3y+QLu0tLKlVufC5OQU9Pa+/TgwMPCpv7+fAouKigG/pFX81qV4H4PBwrh8Wg95eOUtLi5vLi+v4FSHRzExRafTNZJ7NptNobOzs2C1Wp+eZx/yEhIS8jwer99ut//icOJvk+mwWCzF3NzvebPZTIF4+ILd/mMcx1ei7UOeUCjUjY19n8YvRYPJVzG4GGk9PT3vRkZGKJDH44PT6STTfxgNjGez4+4idg8Tr+8nx+KvNCcnx4y926mpMUNf33vY2wPo7n71JhpImszer4x5KFmE4zujo98m3W6ve3Dww2eNRvMEW3GLrG4kj26Vj/c5ch+Pg5t4ApXhopFWSDASMcjzg+siIKmWVJm839Nr+Hvp+Nsj4D+5Hdf43ZzjNQAAAABJRU5ErkJggg=="}else o.onrendered(a)},window.setTimeout(function(){_html2canvas.Preload(o)},0),{render:function(t,e){return _html2canvas.Renderer(t,_html2canvas.Util.Extend(e,o))},parse:function(t,e){return _html2canvas.Parse(t,_html2canvas.Util.Extend(e,o))},preload:function(t){return _html2canvas.Preload(_html2canvas.Util.Extend(t,o))},log:h2clog}},window.html2canvas.log=h2clog,window.html2canvas.Renderer={Canvas:void 0},_html2canvas.Renderer.Canvas=function(t){function e(t,e){t.beginPath(),e.forEach(function(e){t[e.name].apply(t,e.arguments)}),t.closePath()}function n(t){if(i.indexOf(t.arguments[0].src)===-1){c.drawImage(t.arguments[0],0,0);try{c.getImageData(0,0,1,1)}catch(e){return l=r.createElement("canvas"),c=l.getContext("2d"),!1}i.push(t.arguments[0].src)}return!0}function a(t){return"transparent"===t||"rgba(0, 0, 0, 0)"===t}function o(a,o){switch(o.type){case"variable":a[o.name]=o.arguments;break;case"function":if("createPattern"===o.name){if(o.arguments[0].width>0&&o.arguments[0].height>0)try{a.fillStyle=a.createPattern(o.arguments[0],"repeat")}catch(r){h2clog("html2canvas: Renderer: Error creating pattern",r.message)}}else"drawShape"===o.name?e(a,o.arguments):"drawImage"===o.name?o.arguments[8]>0&&o.arguments[7]>0&&(!t.taintTest||t.taintTest&&n(o))&&a.drawImage.apply(a,o.arguments):a[o.name].apply(a,o.arguments)}}t=t||{};var r=document,i=[],l=document.createElement("canvas"),c=l.getContext("2d"),d=t.canvas||r.createElement("canvas");return function(t,e,n,r,i){var l,c,s,h,u,m,g=d.getContext("2d");if(d.width=d.style.width=e.width||t.ctx.width,d.height=d.style.height=e.height||t.ctx.height,m=g.fillStyle,g.fillStyle=a(t.backgroundColor)&&void 0!==e.background?e.background:t.backgroundColor,g.fillRect(0,0,d.width,d.height),g.fillStyle=m,e.svgRendering&&void 0!==t.svgRender)g.drawImage(t.svgRender,0,0);else for(c=0,s=r.length;c<s;c+=1)l=r.splice(0,1)[0],l.canvasPosition=l.canvasPosition||{},g.textBaseline="bottom",l.clip&&(g.save(),g.beginPath(),g.rect(l.clip.left,l.clip.top,l.clip.width,l.clip.height),g.clip()),l.ctx.storage&&l.ctx.storage.forEach(o.bind(null,g)),l.clip&&g.restore();return h2clog("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),s=e.elements.length,1===s&&"object"==typeof e.elements[0]&&"BODY"!==e.elements[0].nodeName?(u=i.Util.Bounds(e.elements[0]),h=n.createElement("canvas"),h.width=u.width,h.height=u.height,g=h.getContext("2d"),g.drawImage(d,u.left,u.top,u.width,u.height,0,0,u.width,u.height),d=null,h):d}},function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"RequestCancelAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var a=(new Date).getTime(),o=Math.max(0,16-(a-t)),r=window.setTimeout(function(){e(a+o)},o);return t=a+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var IE=!!document.all;IE||document.captureEvents(Event.MOUSEMOVE),document.addEventListener("mousemove",getMouseXY,!1);var coordX=0,coordY=0;
function createSnapshotButton(t,e){var n=document.createElement("div");return n.id=t+"snapshotButton",n.setAttribute("title","Snapshot"),n.setAttribute("data-placement","bottom"),n.setAttribute("data-toggle","tooltip"),n.setAttribute("data-container","body"),n.className=snapshotobj.button.class_on,n.innerHTML=snapshotobj.button.html_on,n.onclick=function(){console.log(" mediaobj ----------------",e),takeSnapshot(e,function(t){var n="snapshot"+(new Date).getTime();e.filearray.push(n);var a=document.createElement("div");a.value=e.filearray.length,fileshareobj.active?(syncSnapshot(t,"imagesnapshot",n),displayList(e.uuid,e,t,n,"imagesnapshot"),displayFile(e.uuid,e,t,n,"imagesnapshot")):displayFile(e.uuid,e,t,n,"imagesnapshot")})},n}function takeSnapshot(t,e){function n(t){var n=document.createElement("canvas");n.width=t.videoWidth||t.clientWidth,n.height=t.videoHeight||t.clientHeight;var a=n.getContext("2d");a.drawImage(t,0,0,n.width,n.height),e(n.toDataURL("image/png"))}if(t.videoContainer)return n(document.getElementById(t.videoContainer))}function syncSnapshot(t,e,n){rtcMultiConnection.send({type:e,message:t,name:n})}
function showPosition(o){console.log("Latitude: "+o.coords.latitude+"<br>Longitude: "+o.coords.longitude),latitude=o.coords.latitude,longitude=o.coords.longitude}function showError(o){switch(o.code){case o.PERMISSION_DENIED:showNotification("User denied the request for Geolocation.");break;case o.POSITION_UNAVAILABLE:showNotification("Location information is unavailable.");break;case o.TIMEOUT:showNotification("The request to get user location timed out.");break;case o.UNKNOWN_ERROR:showNotification("An unknown error occurred.")}}navigator.geolocation?(operatingsystem=navigator.platform,navigator.geolocation.getCurrentPosition(showPosition,showError)):x.innerHTML="Geolocation is not supported by this browser.";
function createChatButton(e){var t=document.createElement("span");t.className=e.button.class_on,t.innerHTML=e.button.html_on,t.onclick=function(){t.className==e.button.class_off?(document.getElementById(e.chatContainer).hidden=!0,t.className=e.button.class_on,t.innerHTML=e.button.html_on):t.className==e.button.class_on&&(document.getElementById(e.chatContainer).hidden=!1,t.className=e.button.class_off,t.innerHTML=e.button.html_off)};var n=document.createElement("li");n.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(n)}function createChatBox(e){var t=document.createElement("div"),n=document.createElement("input");n.setAttribute("type","text"),n.className="form-control chatInputClass",n.id="chatInput",n.onkeypress=function(e){13==e.keyCode&&(sendChatMessage(n.value),n.value="")};var a=document.createElement("span");a.className="btn btn-primary",a.innerHTML="Enter",a.onclick=function(){var e=document.getElementById("chatInput");sendChatMessage(e.value),e.value=""};var s=document.createElement("div");s.className="whoTypingClass",s.id="whoTyping",t.appendChild(n),t.appendChild(a),t.appendChild(s),document.getElementById(e.chatContainer).appendChild(t);var c=document.createElement("div");c.className="chatMessagesClass",c.contenteditable=!0,c.id="chatBoard",document.getElementById(e.chatContainer).appendChild(c)}function updateWhotyping(e){document.getElementById("whoTyping").innerHTML=e}function addMessageLineformat(e,t,n){var a=document.createElement("div");a.className=e,a.innerHTML=t,document.getElementById(n).insertBefore(a,document.getElementById(n).firstChild)}function addMessageBlockFormat(e,t,n,a,s){var c=document.createElement("div");c.className=e,c.innerHTML='<div class="chatusername">'+t+"</div>";var o=document.createElement("div");o.className=n,o.innerHTML=a,c.appendChild(o),$("#"+s).append(o)}function addNewMessage(e){""!=e.message&&" "!=e.message&&addMessageLineformat("user-activity user-activity-right remoteMessageClass",e.message,"chatBoard")}function addNewMessagelocal(e){""!=e.message&&" "!=e.message&&addMessageLineformat("user-activity user-activity-right localMessageClass",e.message,"chatBoard")}function sendChatMessage(e){addNewMessagelocal({header:rtcMultiConnection.extra.username,message:e,userinfo:getUserinfo(rtcMultiConnection.blobURLs[rtcMultiConnection.userid],"chat-message.png"),color:rtcMultiConnection.extra.color}),rtcMultiConnection.send({type:"chat",message:e})}$("#chatbox").css("max-height",$("#leftVideo").height()+80),$("#chatBoard").css("max-height",$("#leftVideo").height()),$("#chatBoard").css("overflow-y","scroll");
function createAudioMuteButton(t,e){var o=document.createElement("span");return o.id=t+"audioButton",o.setAttribute("data-val","mute"),o.setAttribute("title","Toggle Audio"),o.setAttribute("data-placement","bottom"),o.setAttribute("data-toggle","tooltip"),o.setAttribute("data-container","body"),o.className=muteobj.audio.button.class_on,o.innerHTML=muteobj.audio.button.html_on,o.onclick=function(){o.className==muteobj.audio.button.class_on?(e.stream.mute({audio:!0}),o.className=muteobj.audio.button.class_off,o.innerHTML=muteobj.audio.button.html_off):(e.stream.unmute({audio:!0}),o.className=muteobj.audio.button.class_on,o.innerHTML=muteobj.audio.button.html_on),syncButton(o.id)},o}function createVideoMuteButton(t,e){var o=document.createElement("span");return o.id=t+"videoButton",o.setAttribute("title","Toggle Video"),o.setAttribute("data-placement","bottom"),o.setAttribute("data-toggle","tooltip"),o.setAttribute("data-container","body"),o.className=muteobj.video.button.class_on,o.innerHTML=muteobj.video.button.html_on,o.onclick=function(t){o.className==muteobj.video.button.class_on?(e.stream.mute({video:!0}),o.innerHTML=muteobj.video.button.html_off,o.className=muteobj.video.button.class_off):(e.stream.unmute({video:!0}),o.innerHTML=muteobj.video.button.html_on,o.className=muteobj.video.button.class_on),syncButton(o.id)},o}function waitForRemoteVideo(t,e,o,i){var n=t.getVideoTracks();0===n.length||e.currentTime>0?transitionToActive(e,o,i):setTimeout(function(){waitForRemoteVideo(t,e,o,i)},100)}function transitionToActive(t,e,o){t.style.opacity=1,null!=localVideo&&setTimeout(function(){e.src=""},500),null!=miniVideo&&setTimeout(function(){o.style.opacity=1},1e3)}function transitionToWaiting(){card.style.webkitTransform="rotateY(0deg)",setTimeout(function(){localVideo.src=miniVideo.src,localVideo.muted=!0,miniVideo.src="",remoteVideo.src="",localVideo.style.opacity=1},500),miniVideo.style.opacity=0,remoteVideo.style.opacity=0}function attachMediaStream(t,e){console.log("element.src",typeof t.srcObject,typeof t.src),"string"==typeof t.src?t.src=URL.createObjectURL(e):"object"==typeof t.srcObject?t.srcObject=e:console.log("Error attaching stream to element.",t,e)}function reattachMediaStream(t,e){t.src=e.src}
function createRecordButton(e,t,o,r){var c=document.createElement("div");return c.id=e+"recordButton",c.setAttribute("title","Record"),c.setAttribute("data-placement","bottom"),c.setAttribute("data-toggle","tooltip"),c.setAttribute("data-container","body"),c.className=videoRecordobj.button.class_off,c.innerHTML=videoRecordobj.button.html_off,c.onclick=function(e){c.className==videoRecordobj.button.class_on?(c.className=videoRecordobj.button.class_off,c.innerHTML=videoRecordobj.button.html_off,stopRecord(t,o,r)):c.className==videoRecordobj.button.class_off&&(c.className=videoRecordobj.button.class_on,c.innerHTML=videoRecordobj.button.html_on,startRecord(t,o,r))},c}function startRecord(e,t,o){var r=RecordRTC(o,{type:"video",recorderType:MediaStreamRecorder});r.startRecording(),listOfRecorders[t]=r}function stopRecord(e,t,o){listOfRecorders[t]||console.log("wrong stream id ");var r=listOfRecorders[t];r.stopRecording(function(){var t=r.getBlob(),o="recordedvideo"+(new Date).getTime();e.filearray.push(o);var c=document.createElement("div");c.value=e.filearray.length;var d=URL.createObjectURL(t);displayList(rtcMultiConnection.uuid,e,d,o,"videoRecording"),displayFile(rtcMultiConnection.uuid,e,d,o,"videoRecording")})}var listOfRecorders={};
function syncVideoScreenRecording(e,n,o){rtcMultiConnection.send({type:n,message:e,name:o})}function autorecordScreenVideo(){}function createScreenRecordButton(){var e=document.body;recorder=RecordRTC(e,{type:"canvas",showMousePointer:!0});var n=document.createElement("span");n.className=screenrecordobj.button.class_off,n.innerHTML=screenrecordobj.button.html_off,n.onclick=function(){n.className==screenrecordobj.button.class_off?(n.className=screenrecordobj.button.class_on,n.innerHTML=screenrecordobj.button.html_on,recorder.startRecording()):n.className==screenrecordobj.button.class_on&&(n.className=screenrecordobj.button.class_off,n.innerHTML=screenrecordobj.button.html_off,recorder.stopRecording(function(e){for(i in webcallpeers)if(webcallpeers[i].userid==rtcMultiConnection.userid){var n="recordedScreenvideo"+(new Date).getTime();webcallpeers[i].filearray.push(n);var o=document.createElement("div");o.value=webcallpeers[i].filearray.length,syncVideoScreenRecording(e,"videoScreenRecording",n),displayList(rtcMultiConnection.uuid,rtcMultiConnection.userid,e,n,"videoScreenRecording"),displayFile(rtcMultiConnection.uuid,rtcMultiConnection.userid,e,n,"videoScreenRecording")}recorder.getBlob();recorder.getDataURL(function(e){console.log("dataURL ",e)})}))};var o=document.createElement("li");o.appendChild(n),document.getElementById("topIconHolder_ul").appendChild(o)}
function createFileShareButton(e){var t=document.createElement("span");t.setAttribute("data-provides","fileinput"),t.className=e.button["class"],t.innerHTML=e.button.html,t.onclick=function(){var e=new FileSelector;e.selectSingleFile(function(e){sendFile(e)})};var n=document.createElement("li");n.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(n)}function sendFile(e){rtcMultiConnection.send(e)}function addProgressHelper(e,t,n,i,l){var o=document.createElement("div");o.id=n,o.title=e+n,o.setAttribute("class",l),o.innerHTML="<label>0%</label><progress></progress>",document.getElementById(t.fileList.container).appendChild(o),progressHelper[e]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},progressHelper[e].progress.max=i}function addNewFileLocal(e){console.log("addNewFileLocal message ",e),""!=e.message&&" "!=e.message&&alert("addNewFileLocal")}function addNewFileRemote(e){console.log("addNewFileRemote message ",e),""!=e.message&&" "!=e.message&&alert("addNewFileRemote")}function updateLabel(e,t){if(-1!=e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}function simulateClick(e){return document.getElementById(e).click(),console.log("simulateClick on "+e),!0}function displayList(e,t,n,i,l){console.log("DisplayList peerinfo->",t);var o=!0,d=!0,a=t.fileList.container,r=t.fileShare.container,c=t.filearray.length;alert("displayList-> elementDisplay"+r),d=("localVideo"==t.name,!1);var s=document.createElement("div");s.innerHTML=c+"   "+i,s.title=l+" shared by "+t.name,s.id="name"+i;var m=document.createElement("div");m.setAttribute("class","btn btn-primary"),m.setAttribute("style","color:white"),m.innerHTML='<a href="'+n+'" download="'+i+'" style="color:white" > Download </a>';var u=document.createElement("div");u.id="showButton"+i,u.setAttribute("class","btn btn-primary"),u.innerHTML="show",u.onclick=function(){repeatFlagShowButton!=i?(showFile(e,r,n,i,l),rtcMultiConnection.send({type:"shareFileShow",_uuid:e,_element:r,_fileurl:n,_filename:i,_filetype:l}),repeatFlagShowButton=i):repeatFlagShowButton==i&&(repeatFlagShowButton="")};var p=document.createElement("div");p.id="hideButton"+i,p.setAttribute("class","btn btn-primary"),p.innerHTML="hide",p.onclick=function(t){repeatFlagHideButton!=i?(hideFile(e,r,n,i,l),rtcMultiConnection.send({type:"shareFileHide",_uuid:e,_element:r,_fileurl:n,_filename:i,_filetype:l}),repeatFlagHideButton=i):repeatFlagHideButton==i&&(repeatFlagHideButton="")};var h=document.createElement("div");h.id="removeButton"+i,h.setAttribute("class","btn btn-primary"),h.innerHTML="remove",h.onclick=function(t){if(repeatFlagRemoveButton!=i){hideFile(e,r,n,i,l);var o=t.target.parentNode.id;rtcMultiConnection.send({type:"shareFileRemove",_element:o,_filename:i}),removeFile(o),repeatFlagRemoveButton=i}else repeatFlagRemoveButton==i&&(repeatFlagRemoveButton="")};var f,g;document.getElementById(i)?(g=document.getElementById(i),fileshareobj.active&&(g.innerHTML="",g.appendChild(s),o&&g.appendChild(m),g.appendChild(u),g.appendChild(p),d&&g.appendChild(h))):(document.getElementById(a)?(f=document.getElementById(a),g=document.createElement("div")):(f=document.body,g=document.createElement("div")),fileshareobj.active&&(g.id=i,g.innerHTML="",g.appendChild(s),o&&g.appendChild(m),g.appendChild(u),g.appendChild(p),d&&g.appendChild(h)),f.appendChild(g))}function getFileElementDisplayByType(e,t,n){var i;if(e.indexOf("msword")>-1||e.indexOf("officedocument")>-1){var l=document.createElement("div");l.className="alert alert-warning",l.innerHTML="Microsoft and Libra word file cannt be opened in browser",i=l}else if(e.indexOf("image")>-1){var o=document.createElement("img");o.src=t,o.style.width="100%",o.title=n,o.id="display"+n,i=o}else if(e.indexOf("videoScreenRecording")>-1){console.log("videoScreenRecording ",t);var d=document.createElement("video");d.src=t,d.setAttribute("controls","controls"),d.style.width="100%",d.title=n,d.id="display"+n,i=d}else if(e.indexOf("video")>-1){console.log("videoRecording ",t);var d=document.createElement("video");d.src=t,d.setAttribute("controls","controls"),d.style.width="100%",d.title=n,d.id="display"+n,i=d}else{var a=document.createElement("iframe");a.src=t,a.className="viewerIframeClass",a.title=n,a.id="display"+n,i=a}return i}function displayFile(e,t,n,i,l){console.log("displayFile peerinfo->",t);var o=document.getElementById(t.fileShare.container),d=getFileElementDisplayByType(l,n,i);o?(o.innerHTML="",o.appendChild(d)):document.body.appendChild(d)}function syncButton(e){var t=document.getElementById(e);for(x in webcallpeers)if(t.getAttribute("lastClickedBy")==webcallpeers[x].userid)return void t.setAttribute("lastClickedBy","");""==t.getAttribute("lastClickedBy")&&(t.setAttribute("lastClickedBy",rtcMultiConnection.userid),rtcMultiConnection.send({type:"buttonclick",buttonName:e}))}function showFile(e,t,n,i,l){$("#"+t).html(getFileElementDisplayByType(l,n,i)),alert("file shown in "+t)}function hideFile(e,t,n,i,l){$("#"+t).has("#display"+i)?(console.log("hidefile ",i," from ",t),document.getElementById(t).innerHTML=""):console.log(" file is not displayed to hide  ")}function removeFile(e){document.getElementById(e).hidden=!0}function createFileSharingBox(e,t){if(!document.getElementById(e.fileShare.outerbox)){var n=document.createElement("div");n.className="col-sm-6 fileViewing1Box",n.setAttribute("style","background-color:"+e.color),n.id=e.fileShare.outerbox;var i=document.createElement("p");i.appendChild(document.createTextNode("File Viewer for "+e.name));var l=document.createElement("span");l.className="btn btn-default glyphicon glyphicon-import closeButton",l.innerHTML="Minimize",l.id=e.fileShare.minButton,l.setAttribute("lastClickedBy",""),l.onclick=function(){resizeFV(e.userid,l.id,arrFilesharingBoxes)};var o=document.createElement("span");o.className="btn btn-default glyphicon glyphicon-export closeButton",o.innerHTML="Maximize",o.id=e.fileShare.maxButton,o.setAttribute("lastClickedBy",""),o.onclick=function(){maxFV(e.userid,o.id,arrFilesharingBoxes,e.fileShare.outerbox)};var d=document.createElement("span");d.className="btn btn-default glyphicon glyphicon-remove closeButton",d.innerHTML="Close",d.id=e.fileShare.closeButton,d.setAttribute("lastClickedBy",""),d.onclick=function(){closeFV(e.userid,d.id,e.fileShare.container)},i.appendChild(l),i.appendChild(o),i.appendChild(d);var a=document.createElement("div");a.className="filesharingWidget",a.id=e.fileShare.container;var r=document.createElement("p");if(r.className="filler",debug){var c=document.createElement("span");c.innerHTML="<br/>"+a.id+"<br/>",n.appendChild(c)}n.appendChild(i),n.appendChild(a),n.appendChild(r),t.appendChild(n)}}function createFileListingBox(e,t){if(!document.getElementById(e.fileList.outerbox)){var n=document.createElement("div");n.className="col-sm-6  filesharing1Box",n.id=e.fileList.outerbox,n.setAttribute("style","background-color:"+e.color);var i=document.createElement("p"),l=document.createElement("span");l.className="btn btn-default glyphicon glyphicon-question-sign closeButton",l.innerHTML="Help",i.appendChild(document.createTextNode("List of Uploaded Files")),i.appendChild(l);var o=document.createElement("div");o.id=e.fileList.container;var d=document.createElement("div");if(debug){var a=document.createElement("span");a.innerHTML=o.id,n.appendChild(a)}n.appendChild(i),n.appendChild(o),n.appendChild(d),t.appendChild(n)}}function createFileSharingDiv(e){var t=document.getElementById(fileshareobj.fileShareContainer);createFileSharingBox(e,t);var n=document.getElementById(fileshareobj.fileListContainer);createFileListingBox(e,n)}function closeFV(e,t,n){document.getElementById(n).innerHTML="",syncButton(t)}function resizeFV(e,t,n){for(x in n)document.getElementById(n[x]).hidden=!1,document.getElementById(n[x]).style.width="50%";syncButton(t)}function minFV(e,t,n){for(x in n)document.getElementById(n[x]).hidden=!1,document.getElementById(n[x]).style.width="50%",document.getElementById(n[x]).style.height="10%";syncButton(t)}function maxFV(e,t,n,i){for(x in n)n[x]==i?(document.getElementById(n[x]).hidden=!1,document.getElementById(n[x]).style.width="100%"):(document.getElementById(n[x]).hidden=!0,document.getElementById(n[x]).style.width="0%");syncButton(t)}var progressHelper={};
function webrtcdevCanvasDesigner(){try{CanvasDesigner.addSyncListener(function(e){rtcMultiConnection.send({type:"canvas",draw:e})}),CanvasDesigner.setSelected("pencil"),CanvasDesigner.setTools({pencil:!0,eraser:!0}),CanvasDesigner.appendTo(document.getElementById(drawCanvasobj.drawCanvasContainer))}catch(e){console.log(" Canvas drawing not supported "),console.log(e)}}function createdrawButton(){var e=document.createElement("span");e.className=drawCanvasobj.button.class_off,e.innerHTML=drawCanvasobj.button.html_off,e.onclick=function(){e.className==drawCanvasobj.button.class_off?(e.className=drawCanvasobj.button.class_on,e.innerHTML=drawCanvasobj.button.html_on,webrtcdevCanvasDesigner(),document.getElementById(drawCanvasobj.drawCanvasContainer).hidden=!1):e.className==drawCanvasobj.button.class_on&&(e.className=drawCanvasobj.button.class_off,e.innerHTML=drawCanvasobj.button.html_off,document.getElementById(drawCanvasobj.drawCanvasContainer).hidden=!0)};var n=document.createElement("li");n.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(n)}var CanvasDesigner=function(){function e(e){a&&a.contentWindow.postMessage({canvasDesignerSyncData:e},"*")}function n(){event.data&&event.data.canvasDesignerSyncData&&o(event.data.canvasDesignerSyncData)}var a,t={line:!0,pencil:!0,dragSingle:!0,dragMultiple:!0,eraser:!0,rectangle:!0,arc:!0,bezier:!0,quadratic:!0,text:!0},s="pencil",o=function(e){console.log("syncDataListener",e)},d=window.addEventListener?"addEventListener":"attachEvent",r=window[d],c="attachEvent"==d?"onmessage":"message";return r(c,function(e){console.log("CanvasDesigner parent received message!:  ",e.data),e.data&&e.data.canvasDesignerSyncData&&o(e.data.canvasDesignerSyncData)},!1),{appendTo:function(e){a=document.createElement("iframe"),a.id="drawboard",a.src="widget.html?tools="+JSON.stringify(t)+"&selectedIcon="+s,a.style.width="100%",a.style.height="100%",a.style.border=0,e.appendChild(a)},destroy:function(){a&&a.parentNode.removeChild(a),window.removeEventListener("message",n)},addSyncListener:function(e){o=e},syncData:e,setTools:function(e){t=e},setSelected:function(e){"undefined"!=typeof t[e]&&(s=e)}}}();
function createButtonRedial(){var e=document.createElement("span");e.className=reconnectobj.button["class"],e.innerHTML=reconnectobj.button.html,e.onclick=function(){var e=confirm("Do you want to reconnet ?");1==e&&location.reload()};var n=document.createElement("li");n.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(n)}
function placeCursor(t,e,o){var r=document.getElementById(t);r.style.position="absolute",r.style.left=e+"px",r.style.top=o+"px"}var cursorX,cursorY;
function createCodeEditorButton(){var e=document.createElement("span");e.className=codeeditorobj.button.class_off,e.innerHTML=codeeditorobj.button.html_off;for(x in codeeditorobj.languages)document.getElementById("CodeStyles").innerHTML=document.getElementById("CodeStyles").innerHTML+codeeditorobj.languages[x];var o=(document.getElementById("codeArea").value,"text/javascript");editor=CodeMirror.fromTextArea(document.getElementById("codeArea"),{mode:o,styleActiveLine:!0,lineNumbers:!1,lineWrapping:!0}),editor.setOption("theme","mdn-like"),e.onclick=function(){e.className==codeeditorobj.button.class_off?(e.className=codeeditorobj.button.class_on,e.innerHTML=codeeditorobj.button.html_on,startWebrtcdevcodeeditorSync(),document.getElementById(codeeditorobj.codeeditorContainer).hidden=!1):e.className==codeeditorobj.button.class_on&&(e.className=codeeditorobj.button.class_off,e.innerHTML=codeeditorobj.button.html_off,stopWebrtcdevcodeeditorSync(),document.getElementById(codeeditorobj.codeeditorContainer).hidden=!0)};var t=document.createElement("li");t.appendChild(e),document.getElementById("topIconHolder_ul").appendChild(t)}function sendWebrtcdevCodeeditorSync(e){if(37==e.which||38==e.which||39==e.which||40==e.which||17==e.which||18==e.which||16==e.which)return!0;var o={option:"text",codeContent:editor.getValue()};console.log(" sending ",o),rtcMultiConnection.send({type:"codeeditor",data:o})}function sendWebrtcdevCodeeditorStyleSync(e){$("#CodeStyles option:selected").each(function(){var e=CodeMirror.findModeByMIME($(this).attr("mime"));e&&(mode=e.mode,spec=$(this).attr("mime"),editor.setOption("mode",spec),CodeMirror.autoLoadMode(editor,mode))});var o={option:"menu",codeMode:mode,codeSpec:spec};console.log(" sending ",o),rtcMultiConnection.send({type:"codeeditor",data:o})}function receiveWebrtcdevCodeeditorSync(e){if(console.log("codeeditor ",e),"text"==e.option){var o=editor.getCursor();editor.setValue(e.codeContent),editor.setCursor(o)}else"menu"==e.option&&(editor.setOption("mode",evt.data.codeSpec),CodeMirror.autoLoadMode(editor,evt.data.codeMode))}function startWebrtcdevcodeeditorSync(){document.getElementById(codeeditorobj.codeeditorContainer).addEventListener("keyup",sendWebrtcdevCodeeditorSync,!1),document.getElementById("CodeStyles").addEventListener("change",sendWebrtcdevCodeeditorStyleSync,!1)}function stopWebrtcdevcodeeditorSync(){document.getElementById(codeeditorobj.codeeditorContainer).removeEventListener("keyup",sendWebrtcdevCodeeditorSync,!1)}
function createTextEditorButton(){var t=document.createElement("span");t.className=texteditorobj.button.class_off,t.innerHTML=texteditorobj.button.html_off,t.onclick=function(){t.className==texteditorobj.button.class_off?(t.className=texteditorobj.button.class_on,t.innerHTML=texteditorobj.button.html_on,startWebrtcdevTexteditorSync(),document.getElementById(texteditorobj.texteditorContainer).hidden=!1):t.className==texteditorobj.button.class_on&&(t.className=texteditorobj.button.class_off,t.innerHTML=texteditorobj.button.html_off,stopWebrtcdevTexteditorSync(),document.getElementById(texteditorobj.texteditorContainer).hidden=!0)};var e=document.createElement("li");e.appendChild(t),document.getElementById("topIconHolder_ul").appendChild(e)}function sendWebrtcdevTexteditorSync(t){if(37==t.which||38==t.which||39==t.which||40==t.which||17==t.which||18==t.which||16==t.which)return!0;var e={option:"text",content:document.getElementById(texteditorobj.texteditorContainer).value};console.log(" sending ",document.getElementById(texteditorobj.texteditorContainer).value),rtcMultiConnection.send({type:"texteditor",data:e})}function receiveWebrtcdevTexteditorSync(t){console.log("texteditor ",t),"text"==t.option&&(document.getElementById(texteditorobj.texteditorContainer).value=t.content)}function startWebrtcdevTexteditorSync(){document.getElementById(texteditorobj.texteditorContainer).addEventListener("keyup",sendWebrtcdevTexteditorSync,!1)}function stopWebrtcdevTexteditorSync(){document.getElementById(texteditorobj.texteditorContainer).removeEventListener("keyup",sendWebrtcdevTexteditorSync,!1)}
function createCORSRequest(e,r){var o=new XMLHttpRequest;return"withCredentials"in o?o.open(e,r,!0):"undefined"!=typeof XDomainRequest?(o=new XDomainRequest,o.open(e,r)):o=null,o}function getICEServer(e,r,o,n,t,s){console.log(" TURN -------------",e,r,o,n,t,s);var c="https://service.xirsys.com/ice",i=createCORSRequest("POST",c);i.onload=function(){console.log(i.responseText),null==JSON.parse(i.responseText).d?(webrtcdevIceServers="err",shownotification(" media not able to pass through "+JSON.parse(i.responseText).e)):(webrtcdevIceServers=JSON.parse(i.responseText).d.iceServers,console.log("iceserver got",webrtcdevIceServers))},i.onerror=function(){console.error("Woops, there was an error making xhr request.")},i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send("ident="+e+"&secret="+r+"&domain="+o+"&application="+n+"&room="+t+"&secure="+s)}var iceServers=[];
function startsessionTimer(t){"forward"==t.style?startForwardTimer():"backward"==t.style&&startBackwardTimer()}function startBackwardTimer(){var t=$("#countdownSecond"),r=$("#countdownMinutes"),e=parseInt(t.text(),10),n=parseInt(r.text(),10);timer(t,e,r,n)}function startForwardTimer(){alert("time started ")}function timer(t,r,e,n){console.log(n);var a=setInterval(function(){r--,t.html(r),0==r&&(r=60,n--,$("#countdownMinutes").html(n),n<0&&clearInterval(a))},1e3)}
function checkDevices(e){console.log(" obj.DetectRTC  ",e.DetectRTC),e.DetectRTC.hasMicrophone?console.log("has Microphone"):console.log("doesnt have  hasMicrophone"),e.DetectRTC.hasSpeakers?console.log("has Speakers"):console.log("doesnt have  Speakers"),e.DetectRTC.hasWebcam?console.log("has Webcam"):console.log("doesnt have Webcam")}function checkWebRTCSupport(e){e.DetectRTC.isWebRTCSupported,e.DetectRTC.isAudioContextSupported,e.DetectRTC.isScreenCapturingSupported,e.DetectRTC.isSctpDataChannelsSupported,e.DetectRTC.isRtpDataChannelsSupported}function shownotification(e){var t=document.createElement("div");t.className="alert alert-success fade in",t.innerHTML='<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+e,document.getElementById("alertBox").hidden=!1,document.getElementById("alertBox").innerHTML="",document.getElementById("alertBox").appendChild(t),setTimeout(function(){document.getElementById("alertBox").hidden=!0},3e3)}function error(e,t){console.log(e,t)}function getElement(e){return document.querySelector(e)}function getRandomColor(){for(var e="0123456789ABCDEF".split(""),t="#",n=0;6>n;n++)t+=e[Math.round(15*Math.random())];return t}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function getUserinfo(e,t){return e?'<video src="'+e+'" autoplay></vide>':'<img src="'+t+'">'}function fireClickEvent(e){var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}function bytesToSize(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Bytes";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]}function appendVideo(e,t){createVideoContainer(e,t,function(n){var o=document.createElement("video");o.className=t,o.setAttribute("style","height:auto;opacity:1;"),o.id=e.userid,o.src=URL.createObjectURL(e.stream),viden.hidden=!1;document.getElementById("remote");n.appendChild(o),o.play()})}function createVideoContainer(e,t,n){var o=document.createElement("div");o.setAttribute("style",t||"float:left;opacity: 1;width: 32%;"),remote.insertBefore(o,remote.firstChild),n&&n(o)}function attachUserDetails(e,t){var n=document.createElement("span");n.className="well well-sm",n.setAttribute("style","background-color:"+t.color),n.innerHTML=t.name+"<br/>",e.parentNode.insertBefore(n,e.parentNode.firstChild)}function attachControlButtons(e,t){var n=t.stream,o=t.streamid,i=t.controlBarName,r=(t.fileSharingContainer,document.createElement("div"));if(r.id=i,r.setAttribute("style","float:left;margin-left: 20px;"),muteobj.active&&(muteobj.audio.active&&r.appendChild(createAudioMuteButton(i,t)),muteobj.video.active&&r.appendChild(createVideoMuteButton(i,t))),snapshotobj.active&&r.appendChild(createSnapshotButton(i,t)),videoRecordobj.active&&r.appendChild(createRecordButton(i,t,o,n)),debug){var a=document.createElement("span");a.innerHTML=e.id,r.appendChild(a)}e.parentNode.appendChild(r)}function updateWebCallView(e){if(e.vid.indexOf("videolocal")>-1){if($("#"+localobj.videoContainer).show(),$("#"+remoteobj.videoContainer).hide(),localVideo){var t=document.getElementsByName(localVideo)[0];t.muted=!0,t.style.opacity=1,t.setAttribute("style","width: 90%!important; border: 5px solid "+e.color),attachMediaStream(t,e.stream)}}else if(e.vid.indexOf("videoremote")>-1){if($("#"+localobj.videoContainer).hide(),$("#"+remoteobj.videoContainer).show(),outgoingVideo){var n=document.getElementsByName(selfVideo)[0],o=document.getElementsByName(localVideo)[0];0==n.played.length&&(o.played.lebth>0?reattachMediaStream(n,o):attachMediaStream(n,webcallpeers[0].stream),n.id=webcallpeers[0].videoContainer,n.muted=!0,n.setAttribute("style","border: 5px solid "+webcallpeers[0].color),attachControlButtons(n,webcallpeers[0]),attachUserDetails(n,webcallpeers[0]),fileshareobj.active&&createFileSharingDiv(webcallpeers[0]))}for(var i=0,r=0;r<remoteVideos.length;r++)remoteVideos[r].src&&i++;var a;if("unlimited"==remoteobj.maxAllowed){var s=document.createElement("video");s.autoplay="autoplay",remoteVideos[i]=s,document.getElementById(remoteobj.dynamicVideos.videoContainer).appendChild(s),a=remoteVideos[i]}else a=document.getElementsByName(remoteVideos[i])[0],console.log("remote video not unlimited ",remoteVideos[i]);attachMediaStream(a,e.stream),a.id=e.videoContainer,a.setAttribute("style","border: 5px solid "+e.color),attachControlButtons(a,e),attachUserDetails(a,e),fileshareobj.active&&createFileSharingDiv(e)}}function startcall(e){"none"==turn?e.startwebrtcdev():null!=turn&&"none"!=turn&&(repeatInitilization=window.setInterval(e.startwebrtcdev,1e3))}function updatePeerInfo(e,t,n,o,i){console.log("updating peerInfo: ",e,i);for(x in webcallpeers)if(webcallpeers[x].userid==e)return void console.log("UserID is already existing , webcallpeers");peerInfo={videoContainer:"video"+e,videoHeight:null,videoClassName:null,userid:e,name:t,color:n,email:o,controlBarName:"control-video"+e,filearray:[],vid:"video"+i+"_"+e},"single"==fileshareobj.props.fileShare?peerInfo.fileShare={outerbox:"widget-filesharing-box",container:"widget-filesharing-container",minButton:"widget-filesharing-minbutton",maxButton:"widget-filesharing-maxbutton",closeButton:"widget-filesharing-closebutton"}:peerInfo.fileShare={outerbox:"widget-filesharing-box"+e,container:"widget-filesharing-container"+e,minButton:"widget-filesharing-minbutton"+e,maxButton:"widget-filesharing-maxbutton"+e,closeButton:"widget-filesharing-closebutton"+e},"single"==fileshareobj.props.fileList?peerInfo.fileList={outerbox:"widget-filelisting-box",container:"widget-filelisting-container"}:peerInfo.fileList={outerbox:"widget-filelisting-box"+e,container:"widget-filelisting-container"+e},console.log("updated peerInfo: ",peerInfo),webcallpeers.push(peerInfo)}function findPeerInfo(e){var t;for(x in webcallpeers)if(webcallpeers[x].userid==e)return t=webcallpeers[x],console.log("PeerInfo is found for userid",t),t;return null}function showStatus(){console.log(rtcMultiConnection),console.log(webcallpeers)}var RTCPeerConnection=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,rtcMultiConnection,usersList=document.getElementById("userslist"),numbersOfUsers=document.getElementById("numbersofusers"),usersContainer=document.getElementById("usersContainer"),tempuserid=guid(),sessions={},WebRTCdom=function(e,t,n,o){n&&(incomingAudio=n.audio,incomingVideo=n.video,incomingData=n.data),o&&(outgoingAudio=o.audio,outgoingVideo=o.video,outgoingData=o.data),localobj=e,localVideo=localobj.video,remoteobj=t;var i=t.videoarr;if(outgoingVideo&&(selfVideo=i[0]),!remoteobj.dynamicVideos)for(var r=1;r<i.length;r++)remoteVideos.push(i[r]);localobj.hasOwnProperty("userdetails")&&(console.log("userdetails ",localobj.userdetails),selfusername=void 0==localobj.userdetails.username?"user":localobj.userdetails.username,selfcolor=void 0==localobj.userdetails.usercolor?"orange":localobj.userdetails.usercolor,selfemail=void 0==localobj.userdetails.useremail?"noemail":localobj.userdetails.useremail)},WebRTCdev=function(e,t){return sessionid=e.sessionid,socketAddr=e.socketAddr,turn=e.hasOwnProperty("turn")?e.turn:null,console.log("widgets ",t),null!=turn&&getICEServer(turn.username,turn.secretkey,turn.domain,turn.application,turn.room,turn.secure),t&&(t.debug&&(debug=t.debug),t.chat&&(chatobj=t.chat),t.fileShare&&(fileshareobj=t.fileShare),t.screenrecord&&(screenrecordobj=t.screenrecord),t.screenshare&&(screenshareobj=t.screenshare),t.snapshot&&(snapshotobj=t.snapshot),t.videoRecord&&(videoRecordobj=t.videoRecord),t.reconnect&&(reconnectobj=t.reconnect),t.drawCanvas&&(drawCanvasobj=t.drawCanvas),t.texteditor&&(texteditorobj=t.texteditor),t.codeeditor&&(codeeditorobj=t.codeeditor),t.mute&&(muteobj=t.mute),t.timer&&(timer=t.timer)),{startwebrtcdev:function(){if(rtcMultiConnection=new RTCMultiConnection(sessionid),"none"!=turn){if(!webrtcdevIceServers)return;rtcMultiConnection.iceServers=webrtcdevIceServers,window.clearInterval(repeatInitilization)}rtcMultiConnection.extra={uuid:tempuserid,name:localobj.userdetails.username,color:localobj.userdetails.usercolor,email:localobj.userdetails.useremail},rtcMultiConnection.channel=sessionid,rtcMultiConnection.userid=tempuserid,rtcMultiConnection.preventSSLAutoAllowed=!1,rtcMultiConnection.autoReDialOnFailure=!0,rtcMultiConnection.setDefaultEventsForMediaElement=!1,rtcMultiConnection.customStreams={},rtcMultiConnection.autoCloseEntireSession=!1,rtcMultiConnection.autoTranslateText=!1,rtcMultiConnection.maxParticipantsAllowed="unlimited"==remoteobj.maxAllowed?256:remoteobj.maxAllowed,rtcMultiConnection.blobURLs={},rtcMultiConnection.dontCaptureUserMedia=!0,rtcMultiConnection.onstream=function(e){var t=findPeerInfo(e.userid);t.type=e.type,t.stream=e.stream,t.streamid=e.stream.streamid,updateWebCallView(t)},rtcMultiConnection.onUserIdAlreadyTaken=function(e,t){connection.join(e)},rtcMultiConnection.onstreamended=function(e){e.isScreen?$("#"+e.userid+"_screen").remove():$("#"+e.userid).remove()},rtcMultiConnection.onconnected=function(e){console.log("rtcMultiConnection.onconnected ......between you and",e.userid)},rtcMultiConnection.onopen=function(e){timer&&startsessionTimer(timer),shownotification(e.extra.name+" joined session ")},rtcMultiConnection.onNewSession=function(e){console.log("rtcMultiConnection.onNewSession : ",e)},rtcMultiConnection.onRequest=function(e){console.log(" OnRequest ",e),rtcMultiConnection.accept(e)},rtcMultiConnection.onmessage=function(e){if(console.log(" on message ",e),e.data.typing)updateWhotyping(e.extra.name+" is typing ...");else if(e.data.stoppedTyping)updateWhotyping("");else switch(e.data.type){case"screenshare":shownotification("screen is getting shared "+e.data.message),createScreenViewButton();break;case"chat":updateWhotyping(e.extra.name+" has send message"),addNewMessage({header:e.extra.name,message:e.data.message,userinfo:getUserinfo(rtcMultiConnection.blobURLs[e.userid],"chat-message.png"),color:e.extra.color});break;case"imagesnapshot":var t=findPeerInfo(e.userid);displayList(null,t,e.data.message,e.data.name,"imagesnapshot"),displayFile(null,t,e.data.message,e.data.name,"imagesnapshot");break;case"videoRecording":var t=findPeerInfo(e.userid);displayList(null,t,e.data.message,e.data.name,"videoRecording"),displayFile(null,t,e.data.message,e.data.name,"videoRecording");break;case"videoScreenRecording":var t=findPeerInfo(e.userid);displayList(null,t,e.data.message,e.data.name,"videoScreenRecording"),displayFile(null,t,e.data.message,e.data.name,"videoScreenRecording");break;case"file":addNewMessage({header:e.extra.username,message:e.data.message,userinfo:getUserinfo(rtcMultiConnection.blobURLs[e.userid],"chat-message.png"),color:e.extra.color});break;case"canvas":CanvasDesigner.syncData(e.data.draw);break;case"texteditor":receiveWebrtcdevTexteditorSync(e.data.data);break;case"codeeditor":receiveWebrtcdevCodeeditorSync(e.data.data);break;case"pointer":placeCursor("cursor2",e.data.corX,e.data.corY);break;case"buttonclick":var n=document.getElementById(e.data.buttonName);n.getAttribute("lastClickedBy")!=rtcMultiConnection.userid&&(n.setAttribute("lastClickedBy",e.userid),n.click());break;default:console.log(" unrecognizable message from peer  ",e)}},rtcMultiConnection.sendMessage=function(e){console.log(" sendMessage ",e),e.userid=rtcMultiConnection.userid,e.extra=rtcMultiConnection.extra,rtcMultiConnection.sendCustomMessage(e)},rtcMultiConnection.onEntireSessionClosed=function(e){rtcMultiConnection.attachStreams.forEach(function(e){e.stop()})},rtcMultiConnection.onclose=rtcMultiConnection.onleave=function(e){addNewMessage({header:e.extra.name,message:e.extra.name+" left session.",userinfo:getUserinfo(rtcMultiConnection.blobURLs[e.userid],"info.png"),color:e.extra.color}),shownotification(e.extra.name+" left the conversation.");for(x in webcallpeers)(webcallpeers[x].userid=e.userid)&&webcallpeers.splice(x,1)},rtcMultiConnection.takeSnapshot=function(e,t){takeSnapshot({userid:e,connection:connection,callback:t})},rtcMultiConnection.onFileStart=function(e){console.log("on File start "+e.name);var t=findPeerInfo(e.userid);addProgressHelper(e.uuid,t,e.name,e.maxChunks,"fileBoxClass")},rtcMultiConnection.onFileProgress=function(e){var t=progressHelper[e.uuid];t&&(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,updateLabel(t.progress,t.label))},rtcMultiConnection.onFileEnd=function(e){console.log("On file End "+e.name);var t=findPeerInfo(e.userid);null!=t&&t.filearray.push(e.name),displayFile(e.uuid,t,e.url,e.name,e.type),displayList(e.uuid,t,e.url,e.name,e.type)},chatobj.active&&(createChatButton(chatobj),createChatBox(chatobj)),screenrecordobj.active&&createScreenRecordButton(),screenshareobj.active&&detectExtensionScreenshare(screenshareobj.extensionID),reconnectobj.active&&createButtonRedial(),drawCanvasobj.active&&createdrawButton(),texteditorobj.active&&createTextEditorButton(),codeeditorobj.active&&createCodeEditorButton(),fileshareobj.active&&(rtcMultiConnection.enableFileSharing=!0,rtcMultiConnection.filesContainer=document.getElementById(fileshareobj.fileShareContainer),createFileShareButton(fileshareobj));var e="/";"/"!=socketAddr&&(e=socketAddr),socket=io.connect(e),socket.emit("presence",{channel:rtcMultiConnection.channel}),socket.on("presence",function(e){console.log("PRESENCE -----------> ",e),e?joinWebRTC(rtcMultiConnection.channel,selfuserid):opneWebRTC(rtcMultiConnection.channel,selfuserid)}),socket.on("open-channel-resp",function(e){console.log("opened-channel",e),e&&connectWebRTC("open",rtcMultiConnection.channel,selfuserid,[])}),socket.on("join-channel-resp",function(e){console.log("joined-channel",e,"existing memebers ",e.users),e.status?connectWebRTC("join",rtcMultiConnection.channel,selfuserid,e.users):shownotification(e.msgtype+" : "+e.message)}),socket.on("channel-event",function(e){console.log("channel-event",e),"new-join"==e.type&&(e.status?(updatePeerInfo(e.data.sender,"Peer","#BFD9DA","","remote"),shownotification(e.type)):shownotification(e.msgtype+" : "+e.message))}),setSettingsAttributes()}}};opneWebRTC=function(e,t){rtcMultiConnection.open(e),socket.emit("open-channel",{channel:e,sender:tempuserid,maxAllowed:remoteobj.maxAllowed}),shownotification(" Making a new session ")},connectWebRTC=function(e,t,n,o){"open"==e?(rtcMultiConnection.connect(t),shownotification("Connected to new channel")):"join"==e?(rtcMultiConnection.join(t),shownotification("Connected with existing channel")):shownotification("Connection type not found"),void(document.title=t),rtcMultiConnection.dontCaptureUserMedia=!1,rtcMultiConnection.getUserMedia(),rtcMultiConnection.session={video:incomingVideo,audio:incomingAudio,data:incomingData},rtcMultiConnection.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},null==selfuserid&&(selfuserid=rtcMultiConnection.userid,updatePeerInfo(selfuserid,selfusername,selfcolor,selfemail,"local"),tempuserid!=selfuserid&&socket.emit("update-channel",{type:"change-userid",channel:rtcMultiConnection.channel,sender:selfuserid,extra:{old:tempuserid,"new":selfuserid}}));for(x in o)updatePeerInfo(o[x],"Peer","#BFD9DA","","remote")},joinWebRTC=function(e,t){shownotification("Joining an existing session "),socket.emit("join-channel",{channel:e,sender:null==selfuserid?tempuserid:selfuserid,extra:{userid:null==selfuserid?tempuserid:selfuserid,name:selfusername,color:selfcolor,email:selfemail}})},leaveWebRTC=function(){shownotification("Leaving the session ")};var repeatInitilization=null;
function onLoadAdmin(){socket.emit("admin_enquire",{ask:"channels",format:"list"})}function clearList(e){$("#"+e).empty()}function drawList(e,n){$("#"+e).append("<li class='list-group-item'>"+n+"</li>")}function drawTable(e,n){for(i in Object.keys(n)){var a=Object.keys(n)[i];drawTableRow(e,i,n[a].channel,n[a].timestamp,n[a].users,n[a].status,n[a].endtimestamp,0)}}function drawTableRow(e,n,a,t,s,i,c,r){var l=$("<tr class='success' />");l.append($("<td>"+n+"</td>")),l.append($("<td>"+a+"</td>")),l.append($("<td>"+t+"</td>")),l.append($("<td>"+JSON.stringify(s,null,4)+"</td>")),l.append($("<td>"+i+"</td>")),l.append($("<td>"+c+"</td>")),l.append($("<td>"+r+"</td>")),$("#"+e).append(l)}function drawUsersTable(e){var n=document.createElement("table");$("#usersRow").append(n);for(var a=0;a<e.length;a++)drawUsersRow(n,data[a])}function drawUsersRow(e){var n=$("<tr />");$("#table").append(n),n.append($("<td>"+e+"</td>"))}var socket,webrtcdevDataObj,usersDataObj,channelsFeed=document.getElementById("channelsFeed"),WebRTCdevadmin=function(e){socket=io.connect(e),socket.on("response_to_admin_enquire",function(e){switch(e.response){case"channels":if(webrtcdevDataObj=e.channels,"list"==e.format){clearList("channellistArea");for(i in Object.keys(webrtcdevDataObj))drawList("channellistArea",webrtcdevDataObj[i])}else"table"==e.format?drawTable("webrtcdevTableBody",webrtcdevDataObj):console.error("format not specified ");break;case"users":if(usersDataObj=e.users,"list"==e.format){clearList("userslistArea");for(i in usersDataObj)drawList("userslistArea",usersDataObj[i])}break;case"all":channelsFeed.innerHTML=JSON.stringify(e.channels,null,4);break;default:console.log("unrecognizable response from signaller ",e)}})};$("#channels_list").click(function(){socket.emit("admin_enquire",{ask:"channels",format:"list"})}),$("#channelFindBtn").click(function(){socket.emit("admin_enquire",{ask:"channels",find:$("#channelFindInput").val(),format:"list"})}),$("#users_list").click(function(){socket.emit("admin_enquire",{ask:"users",format:"list"})}),$("#channels_table").click(function(){socket.emit("admin_enquire",{ask:"channels",format:"table"})}),$("#channels_json").click(function(){socket.emit("admin_enquire",{ask:"all",format:"json"})}),$("#channel_clients").click(function(){socket.emit("admin_enquire",{ask:"channel_clients",channel:"https172162010780841524489749781952"})});