var username=" ";document.getElementById("username").innerHTML=username;var useremail="serviceexchange@serviceexchange.com",currentTimeTicker="";window.location.href.indexOf("s=1")>=0||(currentTimeTicker=(new Date).getTime());
if(function(e,t){var n=e;n.version="0.9.0",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,o){var i,r,s,a=n.util.parseUri(e);return t&&t.location&&(a.protocol=a.protocol||t.location.protocol.slice(0,-1),a.host=a.host||(t.document?t.document.domain:t.location.hostname),a.port=a.port||t.location.port),i=n.util.uniqueUri(a),s={host:a.host,secure:"https"==a.protocol,port:a.port||("https"==a.protocol?443:80),query:a.query||""},n.util.merge(s,o),(s["force new connection"]||!n.sockets[i])&&(r=new n.Socket(s)),!s["force new connection"]&&r&&(n.sockets[i]=r),r=r||n.sockets[i],r.of(a.path.length>1?a.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(e,t){var n,o=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];o.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},o.uniqueUri=function(e){var n=e.protocol,o=e.host,i=e.port;return"document"in t?(o=o||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(o=o||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+o+":"+(i||80)},o.query=function(e,t){var n,i=o.chunkQuery(e||""),r=[];o.merge(i,o.chunkQuery(t||""));for(n in i)i.hasOwnProperty(n)&&r.push(n+"="+i[n]);return r.length?"?"+r.join("&"):""},o.chunkQuery=function(e){for(var t,n={},o=e.split("&"),i=0,r=o.length;r>i;++i)t=o[i].split("="),t[0]&&(n[t[0]]=t[1]);return n},n=!1,o.load=function(e){return"document"in t&&"complete"===document.readyState||n?e():void o.on(t,"load",e,!1)},o.on=function(e,t,n,o){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,o)},o.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||o.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&o.load(function(){n=!0}),o.defer=function(e){return o.ua.webkit&&"undefined"==typeof importScripts?void o.load(function(){setTimeout(e,100)}):e()},o.merge=function(e,t,n,i){var r,s=i||[],a="undefined"==typeof n?2:n;for(r in t)t.hasOwnProperty(r)&&o.indexOf(s,r)<0&&("object"==typeof e[r]&&a?o.merge(e[r],t[r],a-1,s):(e[r]=t[r],s.push(t[r])));return e},o.mixin=function(e,t){o.merge(e.prototype,t.prototype)},o.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},o.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.intersect=function(e,t){for(var n=[],i=e.length>t.length?e:t,r=e.length>t.length?t:e,s=0,a=r.length;a>s;s++)~o.indexOf(i,r[s])&&n.push(r[s]);return n},o.indexOf=function(e,t,n){for(var o=e.length,n=0>n?0>n+o?0:n+o:n||0;o>n&&e[n]!==t;n++);return n>=o?-1:n},o.toArray=function(e){for(var t=[],n=0,o=e.length;o>n;n++)t.push(e[n]);return t},o.ua={},o.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),o.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){o.removeListener(e,n),t.apply(this,arguments)}var o=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){var o,i,r,s;if(this.$events&&this.$events[e])if(o=this.$events[e],t.util.isArray(o)){for(i=-1,r=0,s=o.length;s>r;r++)if(o[r]===n||o[r].listener&&o[r].listener===n){i=r;break}if(0>i)return this;o.splice(i,1),o.length||delete this.$events[e]}else(o===n||o.listener&&o.listener===n)&&delete this.$events[e];return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){var n,o,i,r,s;if(!this.$events)return!1;if(n=this.$events[e],!n)return!1;if(o=Array.prototype.slice.call(arguments,1),"function"==typeof n)n.apply(this,o);else{if(!t.util.isArray(n))return!1;for(i=n.slice(),r=0,s=i.length;s>r;r++)i[r].apply(this,o)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(n,t){"use strict";function u(e){return 10>e?"0"+e:e}function a(e){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+u(e.getUTCMonth()+1)+"-"+u(e.getUTCDate())+"T"+u(e.getUTCHours())+":"+u(e.getUTCMinutes())+":"+u(e.getUTCSeconds())+"Z":null}function s(e){return h.lastIndex=0,h.test(e)?'"'+e.replace(h,function(e){var t=l[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function e(t,n){var o,c,p,u,l,h=i,d=n[t];switch(d instanceof Date&&(d=a(t)),"function"==typeof r&&(d=r.call(n,t,d)),typeof d){case"string":return s(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(i+=f,l=[],"[object Array]"===Object.prototype.toString.apply(d)){for(u=d.length,o=0;u>o;o+=1)l[o]=e(o,d)||"null";return p=0===l.length?"[]":i?"[\n"+i+l.join(",\n"+i)+"\n"+h+"]":"["+l.join(",")+"]",i=h,p}if(r&&"object"==typeof r)for(u=r.length,o=0;u>o;o+=1)"string"==typeof r[o]&&(c=r[o],p=e(c,d),p&&l.push(s(c)+(i?": ":":")+p));else for(c in d)Object.prototype.hasOwnProperty.call(d,c)&&(p=e(c,d),p&&l.push(s(c)+(i?": ":":")+p));return p=0===l.length?"{}":i?"{\n"+i+l.join(",\n"+i)+"\n"+h+"}":"{"+l.join(",")+"}",i=h,p}}var o;if(t&&t.parse)return n.JSON={parse:t.parse,stringify:t.stringify};o=n.JSON={};var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i,f,l={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r;o.stringify=function(t,n,o){var s;if(i="",f="","number"==typeof o)for(s=0;o>s;s+=1)f+=" ";else"string"==typeof o&&(f=o);if(r=n,n&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw new Error("JSON.stringify");return e("",{"":t})},o.parse=function(n,t){function r(e,n){var o,i,s=e[n];if(s&&"object"==typeof s)for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(i=r(s,o),void 0!==i?s[o]=i:delete s[o]);return t.call(e,n,s)}var i;if(n=String(n),c.lastIndex=0,c.test(n)&&(n=n.replace(c,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),"function"==typeof t?r({"":i},""):i;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n,o=e.parser={},i=o.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=o.reasons=["transport not supported","client not handshaken","unauthorized"],s=o.advice=["reconnect"],a=t.JSON,c=t.util.indexOf;o.encodePacket=function(e){var t,n,o,p,u=c(i,e.type),l=e.id||"",h=e.endpoint||"",f=e.ack,d=null;switch(e.type){case"error":t=e.reason?c(r,e.reason):"",n=e.advice?c(s,e.advice):"",(""!==t||""!==n)&&(d=t+(""!==n?"+"+n:""));break;case"message":""!==e.data&&(d=e.data);break;case"event":o={name:e.name},e.args&&e.args.length&&(o.args=e.args),d=a.stringify(o);break;case"json":d=a.stringify(e.data);break;case"connect":e.qs&&(d=e.qs);break;case"ack":d=e.ackId+(e.args&&e.args.length?"+"+a.stringify(e.args):"")}return p=[u,l+("data"==f?"+":""),h],null!==d&&void 0!==d&&p.push(d),p.join(":")},o.encodePayload=function(e){var t,n,o,i="";if(1==e.length)return e[0];for(t=0,n=e.length;n>t;t++)o=e[t],i+="�"+o.length+"�"+e[t];return i},n=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/,o.decodePacket=function(e){var t,o=e.match(n);if(!o)return{};var c=o[2]||"",e=o[5]||"",p={type:i[o[1]],endpoint:o[4]||""};switch(c&&(p.id=c,p.ack=o[3]?"data":!0),p.type){case"error":o=e.split("+"),p.reason=r[o[0]]||"",p.advice=s[o[1]]||"";break;case"message":p.data=e||"";break;case"event":try{t=a.parse(e),p.name=t.name,p.args=t.args}catch(u){}p.args=p.args||[];break;case"json":try{p.data=a.parse(e)}catch(u){}break;case"connect":p.qs=e||"";break;case"ack":if(o=e.match(/^([0-9]+)(\+)?(.*)/),o&&(p.ackId=o[1],p.args=[],o[3]))try{p.args=o[3]?a.parse(o[3]):[]}catch(u){}}return p},o.decodePayload=function(e){var t,n,i;if("�"==e.charAt(0)){for(t=[],n=1,i="";n<e.length;n++)"�"==e.charAt(n)?(t.push(o.decodePacket(e.substr(n+1).substr(0,i))),n+=Number(i)+1,i=""):i+=e.charAt(n);return t}return[o.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){var n,o,i;if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e&&(n=t.parser.decodePayload(e),n&&n.length))for(o=0,i=n.length;i>o;o++)this.onPacket(n[o]);return this},n.prototype.onPacket=function(e){return"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.open=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function o(e){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var o=this;t.util.on(n,"beforeunload",function(){o.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=o,t.util.mixin(o,t.EventEmitter),o.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},o.prototype.publish=function(){var e,t;this.emit.apply(this,arguments);for(t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},o.prototype.handshake=function(e){function n(t){t instanceof Error?a.onError(t.message):e.apply(null,t.split(":"))}var o,r,s,a=this,c=this.options,p=["http"+(c.secure?"s":"")+":/",c.host+":"+c.port,c.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");this.isXDomain()&&!t.util.ua.hasCORS?(o=document.getElementsByTagName("script")[0],r=document.createElement("script"),r.src=p+"&jsonp="+t.j.length,o.parentNode.insertBefore(r,o),t.j.push(function(e){n(e),r.parentNode.removeChild(r)})):(s=t.util.request(),s.open("GET",p,!0),s.withCredentials=!0,s.onreadystatechange=function(){4==s.readyState&&(s.onreadystatechange=i,200==s.status?n(s.responseText):!a.reconnecting&&a.onError(s.responseText))},s.send(null))},o.prototype.getTransport=function(e){for(var n,o=e||this.transports,i=0;n=o[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},o.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(o,i,r,s){function a(e){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e),n.transport?void n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){n.remainingTransports||(n.remainingTransports=n.transports.slice(0));for(var e=n.remainingTransports;e.length>0&&e.splice(0,1)[0]!=n.transport.name;);e.length?a(e):n.publish("connect_failed")}},n.options["connect timeout"]))}):n.publish("connect_failed")}n.sessionid=o,n.closeTimeout=1e3*r,n.heartbeatTimeout=1e3*i,n.transports=t.util.intersect(s.split(","),n.options.transports),a(),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},o.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},o.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},o.prototype.disconnect=function(){return this.connected&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},o.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},o.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},o.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},o.prototype.onOpen=function(){this.open=!0},o.prototype.onClose=function(){this.open=!1},o.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},o.prototype.onError=function(e){e&&e.advice&&this.options.reconnect&&"reconnect"===e.advice&&this.connected&&(this.disconnect(),this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},o.prototype.onDisconnect=function(e){var t=this.connected;this.connected=!1,this.connecting=!1,this.open=!1,t&&(this.transport.close(),this.transport.clearTimeouts(),this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect())},o.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){return n.reconnecting?n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++<o?(n.reconnectionDelay<r&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)):n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect())):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,o=this.options["max reconnection attempts"],i=this.options["try multiple transports"],r=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new o(this,"json"),this.ackPackets=0,this.acks={}}function o(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],o={type:"event",name:e};return"function"==typeof n&&(o.id=++this.ackPackets,o.ack="data",this.acks[o.id]=n,t=t.slice(0,t.length-1)),o.args=t,this.packet(o)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var o,i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":o=["message",e.data],"data"==e.ack?o.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,o);break;case"event":o=[e.name].concat(e.args),"data"==e.ack&&o.push(n),this.$emit.apply(this,o);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},o.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},o.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function o(){t.Transport.apply(this,arguments)}e.websocket=o,t.util.inherit(o,t.Transport),o.prototype.name="websocket",o.prototype.open=function(){var e,o=t.util.query(this.socket.options.query),i=this;return e||(e=n.MozWebSocket||n.WebSocket),this.websocket=new e(this.prepareUrl()+o),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},o.prototype.send=function(e){return this.websocket.send(e),this},o.prototype.payload=function(e){for(var t=0,n=e.length;n>t;t++)this.packet(e[t]);return this},o.prototype.close=function(){return this.websocket.close(),this},o.prototype.onError=function(e){this.socket.onError(e)},o.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},o.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},o.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,o){function i(){var t=e.options,i=t["flash policy port"],s=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=s.join("/")),843!==i&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+i),WebSocket.__initialize(),n.loaded=!0),o.call(r)}var r=this;return document.body?i():void t.util.load(i)},n.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function e(){var e,t,n;if(!H){try{e=B.getElementsByTagName("body")[0].appendChild(m("span")),e.parentNode.removeChild(e)}catch(o){return}for(H=!0,t=R.length,n=0;t>n;n++)R[n]()}}function t(e){H?e():R[R.length]=e}function n(e){if(typeof D.addEventListener!=W)D.addEventListener("load",e,!1);else if(typeof B.addEventListener!=W)B.addEventListener("load",e,!1);else if(typeof D.attachEvent!=W)v(D,"onload",e);else if("function"==typeof D.onload){var t=D.onload;D.onload=function(){t(),e()}}else D.onload=e}function o(){P?i():r()}function i(){var e,t,n=B.getElementsByTagName("body")[0],o=m(O);o.setAttribute("type",N),e=n.appendChild(o),e?(t=0,function(){if(typeof e.GetVariable!=W){var i=e.GetVariable("$version");i&&(i=i.split(" ")[1].split(","),G.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)])}else if(10>t)return t++,void setTimeout(arguments.callee,10);n.removeChild(o),e=null,r()}()):r()}function r(){var e,t,n,o,i,r=F.length;if(r>0)for(e=0;r>e;e++){var u=F[e].id,l=F[e].callbackFn,h={success:!1,id:u};if(G.pv[0]>0){if(t=y(u))if(!g(F[e].swfVersion)||G.wk&&G.wk<312)if(F[e].expressInstall&&a()){n={},n.data=F[e].expressInstall,n.width=t.getAttribute("width")||"0",n.height=t.getAttribute("height")||"0",t.getAttribute("class")&&(n.styleclass=t.getAttribute("class")),t.getAttribute("align")&&(n.align=t.getAttribute("align"));var f={},d=t.getElementsByTagName("param"),m=d.length;for(o=0;m>o;o++)"movie"!=d[o].getAttribute("name").toLowerCase()&&(f[d[o].getAttribute("name")]=d[o].getAttribute("value"));c(n,f,u,l)}else p(t),l&&l(h);else b(u,!0),l&&(h.success=!0,h.ref=s(u),l(h))}else b(u,!0),l&&(i=s(u),i&&typeof i.SetVariable!=W&&(h.success=!0,h.ref=i),l(h))}}function s(e){var t,n=null,o=y(e);return o&&"OBJECT"==o.nodeName&&(typeof o.SetVariable!=W?n=o:(t=o.getElementsByTagName(O)[0],t&&(n=t))),n}function a(){return!M&&g("6.0.65")&&(G.win||G.mac)&&!(G.wk&&G.wk<312)}function c(e,t,n,o){var i,r,s,a;M=!0,_=o||null,E={success:!1,id:n},i=y(n),i&&("OBJECT"==i.nodeName?(S=u(i),T=null):(S=i,T=n),e.id=j,(typeof e.width==W||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==W||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),B.title=B.title.slice(0,47)+" - Flash Player Installation",r=G.ie&&G.win?"ActiveX":"PlugIn",s="MMredirectURL="+D.location.toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+B.title,typeof t.flashvars!=W?t.flashvars+="&"+s:t.flashvars=s,G.ie&&G.win&&4!=i.readyState&&(a=m("div"),n+="SWFObjectNew",a.setAttribute("id",n),i.parentNode.insertBefore(a,i),i.style.display="none",function(){4==i.readyState?i.parentNode.removeChild(i):setTimeout(arguments.callee,10)}()),l(e,t,n))}function p(e){if(G.ie&&G.win&&4!=e.readyState){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t,n,o,i,r=m("div");if(G.win&&G.ie)r.innerHTML=e.innerHTML;else if(t=e.getElementsByTagName(O)[0],t&&(n=t.childNodes))for(o=n.length,i=0;o>i;i++)1==n[i].nodeType&&"PARAM"==n[i].nodeName||8==n[i].nodeType||r.appendChild(n[i].cloneNode(!0));return r}function l(e,t,n){var o,i,r,s,a,c,p,u,l=y(n);if(G.wk&&G.wk<312)return o;if(l)if(typeof e.id==W&&(e.id=n),G.ie&&G.win){i="";for(r in e)e[r]!=Object.prototype[r]&&("data"==r.toLowerCase()?t.movie=e[r]:"styleclass"==r.toLowerCase()?i+=' class="'+e[r]+'"':"classid"!=r.toLowerCase()&&(i+=" "+r+'="'+e[r]+'"'));s="";for(a in t)t[a]!=Object.prototype[a]&&(s+='<param name="'+a+'" value="'+t[a]+'" />');l.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+s+"</object>",q[q.length]=e.id,o=y(e.id)}else{c=m(O),c.setAttribute("type",N);for(p in e)e[p]!=Object.prototype[p]&&("styleclass"==p.toLowerCase()?c.setAttribute("class",e[p]):"classid"!=p.toLowerCase()&&c.setAttribute(p,e[p]));for(u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&h(c,u,t[u]);l.parentNode.replaceChild(c,l),o=c}return o}function h(e,t,n){var o=m("param");o.setAttribute("name",t),o.setAttribute("value",n),e.appendChild(o)}function f(e){var t=y(e);t&&"OBJECT"==t.nodeName&&(G.ie&&G.win?(t.style.display="none",function(){4==t.readyState?d(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function d(e){var t,n=y(e);if(n){for(t in n)"function"==typeof n[t]&&(n[t]=null);n.parentNode.removeChild(n)}}function y(e){var t=null;try{t=B.getElementById(e)}catch(n){}return t}function m(e){return B.createElement(e)}function v(e,t,n){e.attachEvent(t,n),X[X.length]=[e,t,n]}function g(e){var t=G.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function k(e,t,n,o){var i,r,s;G.ie&&G.mac||(i=B.getElementsByTagName("head")[0],i&&(r=n&&"string"==typeof n?n:"screen",o&&(C=null,x=null),C&&x==r||(s=m("style"),s.setAttribute("type","text/css"),s.setAttribute("media",r),C=i.appendChild(s),G.ie&&G.win&&typeof B.styleSheets!=W&&B.styleSheets.length>0&&(C=B.styleSheets[B.styleSheets.length-1]),x=r),G.ie&&G.win?C&&typeof C.addRule==O&&C.addRule(e,t):C&&typeof B.createTextNode!=W&&C.appendChild(B.createTextNode(e+" {"+t+"}"))))}function b(e,t){if(U){var n=t?"visible":"hidden";H&&y(e)?y(e).style.visibility=n:k("#"+e,"visibility:"+n)}}function w(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=W?encodeURIComponent(e):e}var S,T,_,E,C,x,W="undefined",O="object",A="Shockwave Flash",I="ShockwaveFlash.ShockwaveFlash",N="application/x-shockwave-flash",j="SWFObjectExprInst",L="onreadystatechange",D=window,B=document,$=navigator,P=!1,R=[o],F=[],q=[],X=[],H=!1,M=!1,U=!0,G=function(){var e,t=typeof B.getElementById!=W&&typeof B.getElementsByTagName!=W&&typeof B.createElement!=W,n=$.userAgent.toLowerCase(),o=$.platform.toLowerCase(),i=/win/.test(o?o:n),r=/mac/.test(o?o:n),s=/webkit/.test(n)?parseFloat(n.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,c=[0,0,0],p=null;if(typeof $.plugins!=W&&typeof $.plugins[A]==O)p=$.plugins[A].description,!p||typeof $.mimeTypes!=W&&$.mimeTypes[N]&&!$.mimeTypes[N].enabledPlugin||(P=!0,a=!1,p=p.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),c[0]=parseInt(p.replace(/^(.*)\..*$/,"$1"),10),c[1]=parseInt(p.replace(/^.*\.(.*)\s.*$/,"$1"),10),c[2]=/[a-zA-Z]/.test(p)?parseInt(p.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof D.ActiveXObject!=W)try{e=new ActiveXObject(I),e&&(p=e.GetVariable("$version"),p&&(a=!0,p=p.split(" ")[1].split(","),c=[parseInt(p[0],10),parseInt(p[1],10),parseInt(p[2],10)]))}catch(u){}return{w3:t,pv:c,wk:s,ie:a,win:i,mac:r}}();return!function(){G.w3&&((typeof B.readyState!=W&&"complete"==B.readyState||typeof B.readyState==W&&(B.getElementsByTagName("body")[0]||B.body))&&e(),H||(typeof B.addEventListener!=W&&B.addEventListener("DOMContentLoaded",e,!1),G.ie&&G.win&&(B.attachEvent(L,function(){"complete"==B.readyState&&(B.detachEvent(L,arguments.callee),e())}),D==top&&function(){if(!H){try{B.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),G.wk&&function(){return H?void 0:/loaded|complete/.test(B.readyState)?void e():void setTimeout(arguments.callee,0)}(),n(e)))}(),function(){G.ie&&G.win&&window.attachEvent("onunload",function(){for(var e,t,n,o,i=X.length,r=0;i>r;r++)X[r][0].detachEvent(X[r][1],X[r][2]);for(e=q.length,t=0;e>t;t++)f(q[t]);for(n in G)G[n]=null;G=null;for(o in swfobject)swfobject[o]=null;swfobject=null})}(),{registerObject:function(e,t,n,o){if(G.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=o,F[F.length]=i,b(e,!1)}else o&&o({success:!1,id:e})},getObjectById:function(e){return G.w3?s(e):void 0},embedSWF:function(e,n,o,i,r,s,p,u,h,f){var d={success:!1,id:n};G.w3&&!(G.wk&&G.wk<312)&&e&&n&&o&&i&&r?(b(n,!1),t(function(){var t,y,m,v,k,w;if(o+="",i+="",t={},h&&typeof h===O)for(y in h)t[y]=h[y];if(t.data=e,t.width=o,t.height=i,m={},u&&typeof u===O)for(v in u)m[v]=u[v];if(p&&typeof p===O)for(k in p)typeof m.flashvars!=W?m.flashvars+="&"+k+"="+p[k]:m.flashvars=k+"="+p[k];if(g(r))w=l(t,m,n),t.id==n&&b(n,!0),d.success=!0,d.ref=w;else{if(s&&a())return t.data=s,void c(t,m,n,f);b(n,!0)}f&&f(d)})):f&&f(d)},switchOffAutoHideShow:function(){U=!1},ua:G,getFlashPlayerVersion:function(){return{major:G.pv[0],minor:G.pv[1],release:G.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(e,t,n){return G.w3?l(e,t,n):void 0},showExpressInstall:function(e,t,n,o){G.w3&&a()&&c(e,t,n,o)},removeSWF:function(e){G.w3&&f(e)},createCSS:function(e,t,n,o){G.w3&&k(e,t,n,o)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t,n,o=B.location.search||B.location.hash;if(o){if(/\?/.test(o)&&(o=o.split("?")[1]),null==e)return w(o);for(t=o.split("&"),n=0;n<t.length;n++)if(t[n].substring(0,t[n].indexOf("="))==e)return w(t[n].substring(t[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(M){var e=y(j);e&&S&&(e.parentNode.replaceChild(S,e),T&&(b(T,!0),G.ie&&G.win&&(S.style.display="block")),_&&_(E)),M=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var e=window.console;return e&&e.log&&e.error||(e={log:function(){},error:function(){}}),swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,o,i){var r=this;r.__id=WebSocket.__nextId++,WebSocket.__instances[r.__id]=r,r.readyState=WebSocket.CONNECTING,r.bufferedAmount=0,r.__events={},t?"string"==typeof t&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(r.__id,e,t,n||null,o||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));
return 0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(e,t){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t){var n,o;if(e in this.__events)for(n=this.__events[e],o=n.length-1;o>=0;--o)if(n[o]===t){n.splice(o,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var t,n=this.__events[e.type]||[],o=0;o<n.length;++o)n[o](e);t=this["on"+e.type],t&&t(e)},WebSocket.prototype.__handleEvent=function(e){var t,n;if("readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol),"open"==e.type||"error"==e.type)t=this.__createSimpleEvent(e.type);else if("close"==e.type)t=this.__createSimpleEvent("close");else{if("message"!=e.type)throw"unknown event type: "+e.type;n=decodeURIComponent(e.message),t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){var t,n;return WebSocket.__flash?void 0:(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION?(t=document.createElement("div"),t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px"),n=document.createElement("div"),n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),void swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})):void e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf"))},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){var t,n;try{for(t=WebSocket.__flash.receiveEvents(),n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(o){e.error(o)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename&&e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},void(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()})))):void e.error("Flash Player >= 10.0.0 is required.")}}(),function(e,t,n){function o(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=o,t.util.inherit(o,t.Transport),o.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},o.prototype.payload=function(e){for(var n=[],o=0,i=e.length;i>o;o++)n.push(t.parser.encodePacket(e[o]));this.send(t.parser.encodePayload(n))},o.prototype.send=function(e){return this.post(e),this},o.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=i,r.posting=!1,200==this.status?r.socket.setBuffer(!1):r.onClose())}function o(){this.onload=i,r.socket.setBuffer(!1)}var r=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=o:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},o.prototype.close=function(){return this.onClose(),this},o.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),o=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+o,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(i){}return n},o.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},o.check=function(e,n){try{if(t.util.request(n))return!0}catch(o){}return!1},o.xdomainCheck=function(){return o.check(null,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){var e,n,o;this.doc=new ActiveXObject("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this,e=this.doc.createElement("div"),e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe),n=this,o=t.util.query(this.socket.options.query,"t="+ +new Date),this.iframe.src=this.prepareUrl()+o,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(o){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(){if("undefined"!=typeof window&&"ActiveXObject"in window)try{var e=new ActiveXObject("htmlfile");return e&&t.Transport.XHR.check()}catch(n){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function o(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=o,t.util.inherit(o,t.Transport.XHR),t.util.merge(o,t.Transport.XHR),o.prototype.name="xhr-polling",o.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},o.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(r.onData(this.responseText),r.get()):r.onClose())}function t(){this.onload=i,this.onerror=i,r.onData(this.responseText),r.get()}function o(){r.onClose()}if(this.open){var r=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=o):this.xhr.onreadystatechange=e,this.xhr.send(null)}},o.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},o.prototype.ready=function(e,n){var o=this;t.util.defer(function(){n.call(o)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function o(){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var e=this;t.j.push(function(t){e._(t)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=o,t.util.inherit(o,t.Transport["xhr-polling"]),o.prototype.name="jsonp-polling",o.prototype.post=function(e){function n(){o(),i.socket.setBuffer(!1)}function o(){i.iframe&&i.form.removeChild(i.iframe);try{s=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){s=document.createElement("iframe"),s.name=i.iframeId}s.id=i.iframeId,i.form.appendChild(s),i.iframe=s}var i=this,r=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var s,a=document.createElement("form"),c=document.createElement("textarea"),p=this.iframeId="socketio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=p,a.method="POST",a.setAttribute("accept-charset","utf-8"),c.name="d",a.appendChild(c),document.body.appendChild(a),this.form=a,this.area=c}this.form.action=this.prepareUrl()+r,o(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(u){}this.iframe.attachEvent?s.onreadystatechange=function(){"complete"==i.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},o.prototype.get=function(){var e,n=this,o=document.createElement("script"),r=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),o.async=!0,o.src=this.prepareUrl()+r,o.onerror=function(){n.onClose()},e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(o,e),this.script=o,i&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype._=function(e){return this.onData(e),this.open&&this.get(),this},o.prototype.ready=function(e,n){var o=this;return i?void t.util.load(function(){n.call(o)}):n.call(this)},o.check=function(){return"document"in n},o.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
""==location.hash?$("#currenturl").val(location.origin+"/#/"+currentTimeTicker+"?s=1"):$("#currenturl").val(location.origin+"/"+location.hash.split("&")[0]),!function(){function e(e,t){function s(n){return n.data.checkingPresence&&e.channels[n.userid]?void e.channels[n.userid].send({presenceDetected:!0}):n.data.presenceDetected&&e.peers[n.userid]?void(e.peers[n.userid].connected=!0):void("text"===n.data.type?se.receive(n.data,n.userid,n.extra):e.autoTranslateText?(n.original=n.data,e.Translator.TranslateText(n.data,function(t){n.data=t,e.onmessage(n)})):e.onmessage(n))}function f(n){return e.skipOnNewSession||(n.session||(n.session={}),n.extra||(n.extra={}),e.sessionid&&n.sessionid!=e.sessionid)?void 0:e.onNewSession?(n.join=function(t){if(!t)return e.join(n);for(var i in t)n.session[i]=t[i];var s=e.dontCaptureUserMedia;e.dontCaptureUserMedia=!1,e.captureUserMedia(function(){e.dontCaptureUserMedia=!0,e.join(n),e.dontCaptureUserMedia=s},t)},n.extra||(n.extra={}),e.onNewSession(n)):void e.join(n)}function O(n){for(var t=0;t<e.localStreamids.length;t++){var i=e.localStreamids[t];e.streams[i]&&e.streams[i].sockets.push(n)}}function P(t){function i(n){return K||Q||a(e.waitUntilRemoteStreamStartsFlowing)||!e.waitUntilRemoteStreamStartsFlowing?m(n):(n.numberOfTimes||(n.numberOfTimes=0),n.numberOfTimes++,n.mediaElement.readyState<=HTMLMediaElement.HAVE_CURRENT_DATA||n.mediaElement.paused||n.mediaElement.currentTime<=0?n.numberOfTimes>=60?P.send({failedToReceiveRemoteVideo:!0,streamid:n.stream.streamid}):void setTimeout(function(){p("Waiting for incoming remote stream to be started flowing: "+n.numberOfTimes+" seconds."),i(n)},900):m(n))}function o(){if(e.fakeDataChannels&&!e.channels[t.userid]&&!e.session.data){var n={send:function(e){P.send({fakeData:e})},readyState:"open"};e.channels[t.userid]={channel:n,send:function(e){this.channel.send(e)}},j.onopen(n)}}function m(n){var i=n.mediaElement,s=n.session,o=n.stream;o.onended=function(){r.mediaElement&&!r.mediaElement.parentNode&&document.getElementById(o.streamid)&&(r.mediaElement=document.getElementById(o.streamid)),y(r,e)};var r={mediaElement:i,stream:o,streamid:o.streamid,session:s||e.session,blobURL:Q?"":i.mozSrcObject?URL.createObjectURL(o):i.src,type:"remote",extra:t.extra,userid:t.userid,isVideo:Q?!!s.video:!!o.isVideo,isAudio:Q?!!s.audio&&!s.video:!!o.isAudio,isScreen:!!o.isScreen,isInitiator:!!t.isInitiator,rtcMultiConnection:e,socket:P};if(e.streams[o.streamid]=e._getStream(r),e.onstream(r),!c(n.preMuted)&&(n.preMuted.audio||n.preMuted.video)){var a=k({},r);a.session=k(a.session,n.preMuted),a.isAudio=!!a.session.audio&&!a.session.video,a.isVideo=!!a.session.video,a.isScreen=!1,e.onmute(a)}p("on:add:stream",r),C(),e.onspeaking&&I({stream:o,streamedObject:r,connection:e})}function f(n){t.channel=n,e.channels[t.userid]={channel:t.channel,send:function(n){e.send(n,this.channel)}},e.onopen({extra:t.extra,userid:t.userid,channel:n});for(var i in e.fileQueue)e.send(e.fileQueue[i],n);r(e.session)&&C(),e.partOfScreen&&e.partOfScreen.sharing&&e.peers[t.userid].sharePartOfScreen(e.partOfScreen)}function h(){P.userid!=t.userid&&(P.userid=t.userid,ee[t.socketIndex]=P,e.numberOfConnectedUsers++,e.peers[t.userid]={socket:P,peer:F,userid:t.userid,extra:t.extra,userinfo:t.userinfo,addStream:function(n){e.addStream(n,this.socket)},removeStream:function(n){return e.streams[n]?(this.peer.connection.removeStream(e.streams[n].stream),void this.renegotiate()):g("No such stream exists. Stream-id:",n)},renegotiate:function(n,t){e.renegotiate(n,t)},changeBandwidth:function(e){if(!e)throw"You MUST pass bandwidth object.";if(d(e))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=e,this.socket.send({changeBandwidth:!0,bandwidth:e})},sendCustomMessage:function(e){this.socket.send({customMessage:!0,message:e})},onCustomMessage:function(e){p('Received "private" message from',this.userid,d(e)?e:v(e))},drop:function(n){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==e.userid&&"local"==t.type&&(this.peer.connection.removeStream(t.stream),y(t,e)),"remote"==t.type&&t.userid==this.userid&&y(t,e));!n&&this.socket.send({drop:!0})},hold:function(n){return"answer"==F.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({hold:!0,holdMLine:n||"both"}),this.peer.hold=!0,void this.fireHoldUnHoldEvents({kind:n,isHold:!0,userid:e.userid,remoteUser:this.userid}))},unhold:function(n){return"answer"==F.prevCreateType?void this.socket.send({unhold:!0,holdMLine:n||"both",takeAction:!0}):(this.socket.send({unhold:!0,holdMLine:n||"both"}),this.peer.hold=!1,void this.fireHoldUnHoldEvents({kind:n,isHold:!1,userid:e.userid,remoteUser:this.userid}))},fireHoldUnHoldEvents:function(n){var t=n.isHold,i=n.kind,s=n.remoteUser||n.userid;for(var o in e.streams)-1==e._skip.indexOf(o)&&(o=e.streams[o],o.userid==s&&(t&&e.onhold(k({kind:i},o)),t||e.onunhold(k({kind:i},o))))},redial:function(){for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],t.userid==this.userid&&"remote"==t.type&&y(t,e));p("ReDialing..."),P.send({recreatePeer:!0}),F=new n,F.create("offer",j)},sharePartOfScreen:function(n){function t(){return i.stopPartOfScreenSharing?(i.stopPartOfScreenSharing=!1,void(e.onpartofscreenstopped&&e.onpartofscreenstopped())):i.pausePartOfScreenSharing?(e.onpartofscreenpaused&&e.onpartofscreenpaused(),setTimeout(t,n.interval||200)):void R({element:n.element,connection:e,callback:function(o){if(!e.channels[i.userid])throw"No such data channel exists.";o!=s&&(s=o,e.channels[i.userid].send({screenshot:o,isPartOfScreen:!0})),!n.once&&setTimeout(t,n.interval||200)}})}var i=this,s="";t()},getConnectionStats:function(n,t){function i(){N.prototype.getConnectionStats=window.getConnectionStats,F.connection&&F.connection.getConnectionStats(n,t)}if(!n)throw"callback is mandatory.";window.getConnectionStats?i():M(e.resources.getConnectionStats,i)},takeSnapshot:function(n){x({userid:this.userid,connection:e,callback:n})}})}function C(){if(e.isInitiator&&S(ie)&&S(ie)<=e.maxParticipantsAllowed&&(e.session.oneway||e.session.broadcast||oe.send({sessionid:e.sessionid,newParticipant:t.userid||P.channel,userData:{userid:t.userid||P.channel,extra:t.extra}})),"chrome"==t.userinfo.browser&&!t.renegotiatedOnce)for(var n in e.renegotiatedSessions)t.renegotiatedOnce=!0,e.renegotiatedSessions[n]&&e.renegotiatedSessions[n].stream&&e.peers[t.userid].renegotiate(e.renegotiatedSessions[n].stream,e.renegotiatedSessions[n].session)}function E(i){if(!re&&i.userid!=e.userid){if(i.sdp){t.userid=i.userid,t.extra=i.extra||{},t.renegotiate=i.renegotiate,t.streaminfo=i.streaminfo,t.isInitiator=i.isInitiator,t.userinfo=i.userinfo;var s=JSON.parse(i.sdp);"offer"==s.type&&(j.preferSCTP=!!i.preferSCTP,e.fakeDataChannels=!!i.fakeDataChannels),o(),D(s,i.labels)}if(i.candidate&&F&&F.addIceCandidate(JSON.parse(i.candidate)),i.streamid&&(te.streamids||(te.streamids={}),te.streamids[i.streamid]||(te.streamids[i.streamid]=i.streamid,e.onstreamid(i))),i.mute||i.unmute)if(i.promptMuteUnmute){if(!e.privileges.canMuteRemoteStream)return void e.onstatechange({userid:i.userid,extra:i.extra,name:"mute-request-denied",reason:i.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'});e.streams[i.streamid]&&(i.mute&&!e.streams[i.streamid].muted&&e.streams[i.streamid].mute(i.session),i.unmute&&e.streams[i.streamid].muted&&e.streams[i.streamid].unmute(i.session))}else{var r={};e.streams[i.streamid]&&(r=e.streams[i.streamid]);var a=i.session,d=k({},r);d.session=a,d.isAudio=!!d.session.audio&&!d.session.video,d.isVideo=!!d.session.video,d.isScreen=!!d.session.screen,i.mute&&e.onmute(d||i),i.unmute&&e.onunmute(d||i)}if(i.isVolumeChanged&&(p("Volume of stream: "+i.streamid+" has changed to: "+i.volume),e.streams[i.streamid])){var c=e.streams[i.streamid].mediaElement;c&&(c.volume=i.volume)}if(i.stopped&&e.streams[i.streamid]&&y(e.streams[i.streamid],e),i.promptStreamStop){if(!e.privileges.canStopRemoteStream)return void e.onstatechange({userid:i.userid,extra:i.extra,name:"stop-request-denied",reason:i.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'});g("Remote stream has been manually stopped!"),e.streams[i.streamid]&&e.streams[i.streamid].stop()}if(i.left){if(z){var u=i.userid;for(var m in e.streams)m=e.streams[m],m.userid==u&&(e.stopMediaStream(m),y(m,e))}if(F&&F.connection&&("closed"!=F.connection.signalingState&&-1==F.connection.iceConnectionState.search(/disconnected|failed/gi)&&F.connection.close(),F.connection=null),ie[i.userid]&&delete ie[i.userid],i.closeEntireSession)return e.onSessionClosed(i),void e.leave();e.remove(i.userid),b({userid:i.userid,extra:i.extra||{},entireSessionClosed:!!i.closeEntireSession},e)}if(i.playRoleOfBroadcaster&&(i.extra&&(e.extra=k(e.extra,i.extra)),i.participants&&(ie=i.participants,ie[e.userid]&&delete ie[e.userid],ee[0]&&ee[0].userid==i.userid&&(delete ee[0],ee=l(ee)),Z[i.userid]&&delete Z[i.userid]),setTimeout(e.playRoleOfInitiator,2e3)),i.changeBandwidth){if(!e.peers[i.userid])throw"No such peer exists.";e.peers[i.userid].peer.bandwidth=i.bandwidth,e.peers[i.userid].renegotiate()}if(i.customMessage){if(!e.peers[i.userid])throw"No such peer exists.";if(i.message.ejected){if(e.sessionDescriptions[e.sessionid].userid!=i.userid)throw"only initiator can eject a user.";e.leave(),e.onSessionClosed({userid:i.userid,extra:i.extra||t.extra,isEjected:!0})}else e.peers[i.userid].onCustomMessage(i.message)}if(i.drop){if(!e.peers[i.userid])throw"No such peer exists.";e.peers[i.userid].drop(!0),e.peers[i.userid].renegotiate(),e.ondrop(i.userid)}if(i.hold||i.unhold){if(!e.peers[i.userid])throw"No such peer exists.";if(i.takeAction)return void e.peers[i.userid][i.hold?"hold":"unhold"](i.holdMLine);e.peers[i.userid].peer.hold=!!i.hold,e.peers[i.userid].peer.holdMLine=i.holdMLine,P.send({isRenegotiate:!0}),e.peers[i.userid].fireHoldUnHoldEvents({kind:i.holdMLine,isHold:!!i.hold,userid:i.userid})}i.isRenegotiate&&e.peers[i.userid].renegotiate(null,e.peers[i.userid].peer.session),i.fakeData&&j.onmessage(i.fakeData),i.recreatePeer&&(F=new n),i.failedToReceiveRemoteVideo&&(p("Remote peer hasn't received stream: "+i.streamid+". Renegotiating..."),e.peers[i.userid]&&e.peers[i.userid].renegotiate()),i.redial&&e.peers[i.userid]&&("disconnected"!=e.peers[i.userid].peer.connection.iceConnectionState&&(t.redialing=!1),"disconnected"!=e.peers[i.userid].peer.connection.iceConnectionState||t.redialing||(t.redialing=!0,g("Peer connection is closed.",v(e.peers[i.userid].peer.connection),"ReDialing.."),e.peers[i.userid].redial()))}}function D(i,s){function o(){return z||"firefox"==t.userinfo.browser?void(e.peers[t.userid]&&e.peers[t.userid].redial()):void F.recreateAnswer(i,a,function(n,t){L({sdp:n,socket:P,streaminfo:t}),e.detachStreams=[]})}if("answer"==i.type)return F.setRemoteDescription(i),void h();if(!t.renegotiate&&"offer"==i.type)return j.offerDescription=i,j.session=e.session,F||(F=new n),F.create("answer",j),void h();var a=t.renegotiate;if(U(s,F.connection),a.oneway||r(a))o(),delete t.renegotiate;else{if(t.capturing)return;t.capturing=!0,e.captureUserMedia(function(n){t.capturing=!1,(G||z&&!F.connection.getLocalStreams().length)&&F.addStream(n),e.renegotiatedSessions[JSON.stringify(t.renegotiate)]={session:t.renegotiate,stream:n},delete t.renegotiate,o()},t.renegotiate)}}var A={channel:t.channel,onmessage:E,onopen:function(i){i&&(P=i),_&&!F&&(j.session=e.session,F||(F=new n),F.create("offer",j)),t.socketIndex=P.index=ee.length,Z[A.channel]=P,ee[t.socketIndex]=P,O(P),P.__push||(P.__push=P.send,P.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},P.__push(n)})}};A.callback=function(e){P=e,A.onopen()};var P=e.openSignalingChannel(A);P&&A.onopen(P);var F,_=t.isofferer,j={onopen:f,onicecandidate:function(n){if(!e.candidates)throw"ICE candidates are mandatory.";if(!e.iceProtocols)throw"At least one must be true; UDP or TCP.";var t=e.candidates,i=t.stun,s=t.turn;if(a(t.reflexive)||(i=t.reflexive),a(t.relay)||(s=t.relay),(t.host||!n.candidate.match(/a=candidate.*typ host/g))&&!(!s&&n.candidate.match(/a=candidate.*typ relay/g)||!i&&n.candidate.match(/a=candidate.*typ srflx/g))){var o=e.iceProtocols;(o.udp||!n.candidate.match(/a=candidate.* udp/g))&&(o.tcp||!n.candidate.match(/a=candidate.* tcp/g))&&(window.selfNPObject||(window.selfNPObject=n),P&&P.send({candidate:JSON.stringify({candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex})}))}},onmessage:function(n){if(n){var i=u(n);if(-1!=i.indexOf('"userid":'))i=JSON.parse(i),s(i);else if(n instanceof ArrayBuffer||n instanceof DataView){if(!e.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!te.fileBufferReader){var o=this;return void T(e,function(e){te.fileBufferReader=e,o.onmessage(n)})}var r=te.fileBufferReader;return void r.convertToObject(n,function(n){return n.maxChunks||n.readyForNextChunk?n.readyForNextChunk?void r.getNextChunk(n.uuid,function(e,n,t){te.send(e)}):void r.addChunk(n,function(e){te.send(e)}):void e.onmessage({data:n,userid:t.userid,extra:t.extra})})}}},onaddstream:function(n,s){function o(){setTimeout(function(){u.muted=!1,m({mediaElement:u,session:s,stream:n,preMuted:a})},3e3),u.removeEventListener("play",o)}if(s=s||t.renegotiate||e.session,!r(s)){s.screen&&(s.audio||s.video)&&(t.gotAudioOrVideo?(s.audio=!1,s.video=!1):(t.gotAudioOrVideo=!0,s.screen=!1));var a={};if(t.streaminfo){var d=t.streaminfo.split("----"),c=JSON.parse(d[d.length-1]);Y||(n.streamid=c.streamid,n.isScreen=!!c.isScreen,n.isVideo=!!c.isVideo,n.isAudio=!!c.isAudio,a=c.preMuted),d.pop(),t.streaminfo=d.join("----")}var u=w(n,k({remote:!0},s));return e.setDefaultEventsForMediaElement&&e.setDefaultEventsForMediaElement(u,n.streamid),Q||n.getVideoTracks().length?void i({mediaElement:u,session:s,stream:n,preMuted:a}):u.addEventListener("play",o,!1)}},onremovestream:function(n){n&&n.streamid?(n=e.streams[n.streamid],n&&(p("on:stream:ended via on:remove:stream",n),y(n,e))):p("on:remove:stream",n)},onclose:function(n){n.extra=t.extra,n.userid=t.userid,e.onclose(n),e.channels[n.userid]&&delete e.channels[n.userid]},onerror:function(n){n.extra=t.extra,n.userid=t.userid,e.onerror(n)},oniceconnectionstatechange:function(n){p("oniceconnectionstatechange",v(n)),F.connection&&"connected"==F.connection.iceConnectionState&&"complete"==F.connection.iceGatheringState&&"stable"==F.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onconnected({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),!e.isInitiator&&F.connection&&"connected"==F.connection.iceConnectionState&&"complete"==F.connection.iceGatheringState&&"stable"==F.connection.signalingState&&1==e.numberOfConnectedUsers&&e.onstatechange({userid:t.userid,extra:t.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),e.peers[t.userid]&&e.peers[t.userid].oniceconnectionstatechange&&e.peers[t.userid].oniceconnectionstatechange(n),e.peers[t.userid]&&"failed"==e.peers[t.userid].peer.connection.iceConnectionState&&e.onfailed({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),e.peers[t.userid]&&"disconnected"==e.peers[t.userid].peer.connection.iceConnectionState&&(!F.connection.renegotiate&&e.ondisconnected({userid:t.userid,extra:t.extra,peer:e.peers[t.userid],targetuser:t.userinfo}),F.connection.renegotiate=!1),e.autoReDialOnFailure&&e.peers[t.userid]&&("disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState&&(t.redialing=!1),"disconnected"!=e.peers[t.userid].peer.connection.iceConnectionState||t.redialing||(t.redialing=!0,g("Peer connection is closed.",v(e.peers[t.userid].peer.connection),"ReDialing.."),e.peers[t.userid].socket.send({redial:!0}),e.streams.remove({remote:!0,userid:t.userid})))},onsignalingstatechange:function(e){p("onsignalingstatechange",v(e))},attachStreams:e.dontAttachStream?[]:e.attachStreams,iceServers:e.iceServers,rtcConfiguration:e.rtcConfiguration,bandwidth:e.bandwidth,sdpConstraints:e.sdpConstraints,optionalArgument:e.optionalArgument,disableDtlsSrtp:e.disableDtlsSrtp,dataChannelDict:e.dataChannelDict,preferSCTP:e.preferSCTP,onSessionDescription:function(e,n){L({sdp:e,socket:P,streaminfo:n})},trickleIce:e.trickleIce,processSdp:e.processSdp,sendStreamId:function(e){P&&P.send({streamid:e.streamid,isScreen:!!e.isScreen,isAudio:!!e.isAudio,isVideo:!!e.isVideo})},rtcMultiConnection:e};e.playRoleOfInitiator=function(){e.dontCaptureUserMedia=!0,e.open(),ee=l(ee),e.dontCaptureUserMedia=!1},e.askToShareParticipants=function(){oe&&oe.send({askToShareParticipants:!0})},e.shareParticipants=function(n){var t={joinUsers:ie,userid:e.userid,extra:e.extra};n&&(n.dontShareWith&&(t.dontShareWith=n.dontShareWith),n.shareWith&&(t.shareWith=n.shareWith)),oe.send(t)}}function U(n,t){if(n)for(var i=0;i<n.length;i++){var s=n[i];e.streams[s]&&t.removeStream(e.streams[s].stream)}}function L(n){n.socket.send({sdp:JSON.stringify({sdp:n.sdp.sdp,type:n.sdp.type}),renegotiate:n.renegotiate?n.renegotiate:!1,streaminfo:n.streaminfo||"",labels:n.labels||[],preferSCTP:!!e.preferSCTP,fakeDataChannels:!!e.fakeDataChannels,isInitiator:!!e.isInitiator,userinfo:{browser:z?"firefox":"chrome"}})}function F(n){var t=n.newParticipant;if(t&&!ie[t]&&t!=e.userid){var i=e.token();P({channel:i,extra:n.userData?n.userData.extra:n.extra,userid:n.userData?n.userData.userid:n.userid}),oe.send({participant:!0,targetUser:t,channel:i})}}function _(){e.numberOfConnectedUsers--;var n={left:!0,extra:e.extra||{},userid:e.userid,sessionid:e.sessionid};e.isInitiator&&(e.autoCloseEntireSession?n.closeEntireSession=!0:ee[0]&&ee[0].send({playRoleOfBroadcaster:!0,userid:e.userid,extra:e.extra,participants:ie})),ee.forEach(function(e,t){e.send(n),Z[e.channel]&&delete Z[e.channel],delete ee[t]}),ee=l(ee),e.refresh(),W.forEach(function(e){e.disconnect()}),W=[]}function j(){te.signalingReady||(te.signalingReady=!0,setTimeout(t,5e3),e.isInitiator||oe&&oe.send({searchingForRooms:!0}))}function B(n){for(var t in n)ie[n[t]]||F({sessionid:e.sessionid,newParticipant:n[t],userid:e.userid,extra:e.extra})}function H(){return e.openSignalingChannel({onmessage:function(n){if(!re&&n.userid!=e.userid){if(n.sessionid&&n.userid&&(e.sessionDescriptions[n.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[n.sessionid]=n,e.isAcceptNewSession&&(e.dontOverrideSession||(e.session=n.session),f(n)))),n.newParticipant&&!e.isAcceptNewSession&&te.broadcasterid===n.userid&&n.newParticipant!=e.userid&&F(n),S(ie)<e.maxParticipantsAllowed&&n.targetUser==e.userid&&n.participant){if(e.peers[n.userid]&&!e.peers[n.userid].peer)return delete ie[n.userid],delete e.peers[n.userid],e.isAcceptNewSession=!0,X(n);ie[n.userid]||X(n)}if(n.acceptedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-accepted",reason:n.userid+" accepted your participation request."}),n.rejectedRequestOf==e.userid&&e.onstatechange({userid:n.userid,extra:n.extra,name:"request-rejected",reason:n.userid+" rejected your participation request."}),n.customMessage)if(n.message.drop){e.ondrop(n.userid),e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),y(t,e)):y(t,e));n.message.renegotiate&&e.renegotiate()}else e.onCustomMessage&&e.onCustomMessage(n.message);if(e.isInitiator&&n.searchingForRooms&&oe&&oe.send({sessionDescription:e.sessionDescription,responseFor:n.userid}),n.sessionDescription&&n.responseFor==e.userid){var i=n.sessionDescription;e.sessionDescriptions[i.sessionid]||(e.numberOfSessions++,e.sessionDescriptions[i.sessionid]=i)}e.isInitiator&&n.askToShareParticipants&&oe&&e.shareParticipants({shareWith:n.userid}),n.shareWith==e.userid&&n.dontShareWith!=e.userid&&n.joinUsers&&B(n.joinUsers),!n.shareWith&&n.joinUsers&&(n.dontShareWith?e.userid!=n.dontShareWith&&B(n.joinUsers):B(n.joinUsers)),n.messageFor==e.userid&&n.presenceState&&("checking"==n.presenceState&&(oe.send({messageFor:n.userid,presenceState:"available",_config:n._config}),p("participant asked for availability")),"available"==n.presenceState&&(te.presenceState="available",e.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),J(n._config))),n.donotJoin&&n.messageFor==e.userid&&p(n.userid,"is not joining your room."),n.isDisconnectSockets&&(p("Disconnecting your sockets because initiator also disconnected his sockets."),e.disconnect())}},callback:function(e){e&&this.onopen(e)},onopen:function(n){n&&(oe=n),ne.log(n),j&&j(),te.defaultSocket=oe,oe.__push||(oe.__push=oe.send,oe.send=function(n){n.userid=n.userid||e.userid,n.extra=n.extra||e.extra||{},oe.__push(n)})}})}function q(){var n=3;3!=e.maxParticipantsAllowed&&(n=e.maxParticipantsAllowed),"one-way"==e.direction&&(e.session.oneway=!0),"one-to-one"==e.direction&&(e.maxParticipantsAllowed=1),"one-to-many"==e.direction&&(e.session.broadcast=!0),"many-to-many"==e.direction&&(e.maxParticipantsAllowed&&1!=e.maxParticipantsAllowed||(e.maxParticipantsAllowed=3)),n&&1!=e.maxParticipantsAllowed&&(e.maxParticipantsAllowed=n)}function J(n,t){if(!te.donotJoin||te.donotJoin!=n.sessionid){e.dontOverrideSession||(e.session=n.session||{}),te.broadcasterid=n.userid,n.sessionid&&(e.sessionid=n.sessionid),e.isAcceptNewSession=!1;var i=o();P({channel:i,extra:n.extra||{},userid:n.userid});var s={};if(e.attachStreams.length){var r=e.attachStreams[e.attachStreams.length-1];r.getAudioTracks&&r.getAudioTracks().length&&(s.audio=!0),r.getVideoTracks().length&&(s.video=!0)}p(c(s)?"Seems data-only connection.":v(s)),e.onstatechange({userid:n.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),oe.send({participant:!0,channel:i,targetUser:n.userid,session:e.session,offers:{audio:!!s.audio,video:!!s.video}}),e.skipOnNewSession=!1,C(e)}}function X(n){if(te.requestsFrom||(te.requestsFrom={}),!te.requestsFrom[n.userid]){var t={userid:n.userid,extra:n.extra,channel:n.channel||n.userid,session:n.session||e.session};if(n.offers){p(n.offers.audio&&n.offers.video?"target user has both audio/video streams.":n.offers.audio&&!n.offers.video?"target user has only audio stream.":!n.offers.audio&&n.offers.video?"target user has only video stream.":"target user has no stream; it seems one-way streaming or data-only connection.");var i=e.sdpConstraints.mandatory;a(i.OfferToReceiveAudio)&&(e.sdpConstraints.mandatory.OfferToReceiveAudio=!!n.offers.audio),a(i.OfferToReceiveVideo)&&(e.sdpConstraints.mandatory.OfferToReceiveVideo=!!n.offers.video),p("target user's SDP has?",v(e.sdpConstraints.mandatory))}te.requestsFrom[n.userid]=t,e.onRequest&&e.isInitiator?e.onRequest(t):$(t)}}function $(n){return te.captureUserMediaOnDemand?(te.captureUserMediaOnDemand=!1,void e.captureUserMedia(function(){$(n),C(e)})):(p("accepting request from",n.userid),ie[n.userid]=n.userid,void P({isofferer:!0,userid:n.userid,channel:n.channel,extra:n.extra||{},session:n.session||e.session}))}var Z={},ee=[],te=this,ie={};!te.fileBufferReader&&e.session.data&&e.enableFileSharing&&T(e,function(e){te.fileBufferReader=e});var se=new i(e);e.remove=function(n){te.requestsFrom&&te.requestsFrom[n]&&delete te.requestsFrom[n],e.peers[n]&&(e.peers[n].peer&&e.peers[n].peer.connection&&("closed"!=e.peers[n].peer.connection.signalingState&&e.peers[n].peer.connection.close(),e.peers[n].peer.connection=null),delete e.peers[n]),ie[n]&&delete ie[n];for(var t in e.streams)t=e.streams[t],t.userid==n&&(y(t,e),delete e.streams[t]);Z[n]&&delete Z[n]},e.refresh=function(){e.isInitiator&&e.socket&&e.socket.remove&&e.socket.remove(),ie={};for(var n=0;n<e.attachStreams.length;n++)e.stopMediaStream(e.attachStreams[n]);V={streams:[],mutex:!1,queueRequests:[]},te.isOwnerLeaving=!0,e.isInitiator=!1,e.isAcceptNewSession=!0,e.attachMediaStreams=[],e.sessionDescription=null,e.sessionDescriptions={},e.localStreamids=[],e.preRecordedMedias={},e.snapshots={},e.numberOfConnectedUsers=0,e.numberOfSessions=0,e.attachStreams=[],e.detachStreams=[],e.fileQueue={},e.channels={},e.renegotiatedSessions={};for(var t in e.peers)t!=e.userid&&delete e.peers[t];for(var i in e.streams)-1==e._skip.indexOf(i)&&(y(e.streams[i],e),delete e.streams[i]);Z={},ee=[],ie={}},e.reject=function(n){d(n)||(n=n.userid),oe.send({rejectedRequestOf:n}),e.remove(n)},te.leaveHandler=function(n){return e.leaveOnPageUnload?a(n.keyCode)?_():void(116==n.keyCode&&_()):void 0},A("beforeunload",te.leaveHandler),A("keyup",te.leaveHandler),te.onLineOffLineHandler=function(){navigator.onLine?te.isOffLine&&(te.isOffLine=!navigator.onLine):te.isOffLine=!0},A("load",te.onLineOffLineHandler),A("online",te.onLineOffLineHandler),A("offline",te.onLineOffLineHandler);var oe=H();te.defaultSocket=oe,oe&&j&&setTimeout(j,2e3),e.session.screen&&E(),e.getExternalIceServers&&D(function(n){e.iceServers=e.iceServers.concat(n)}),0==e.log&&e.skipLogs(),e.onlog&&(p=g=h=function(){var n={},t=0;Array.prototype.slice.call(arguments).forEach(function(e){n[t++]=v(e)}),v=function(e){return e},e.onlog(n)}),this.initSession=function(n){function t(){oe&&S(ie)<e.maxParticipantsAllowed&&!te.isOwnerLeaving&&oe.send(e.sessionDescription),e.transmitRoomOnce||te.isOwnerLeaving||setTimeout(t,e.interval||3e3)}te.isOwnerLeaving=!1,q(),ie={},te.isOwnerLeaving=!1,a(n.transmitRoomOnce)||(e.transmitRoomOnce=n.transmitRoomOnce),n.dontTransmit||t()},this.joinSession=function(n){function t(){oe.send({messageFor:n.userid,presenceState:te.presenceState,_config:{userid:n.userid,extra:n.extra||{},sessionid:n.sessionid,session:n.session||!1}})}function i(){"checking"==te.presenceState&&(g("Unable to reach initiator. Trying again..."),t(),setTimeout(function(){"checking"==te.presenceState&&(e.onstatechange({userid:n.userid,extra:n.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),e.isAcceptNewSession=!0,setTimeout(i,2e3))},2e3))}return oe?(n=n||{},ie={},te.presenceState="checking",e.onstatechange({userid:n.userid,extra:n.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),t(),void setTimeout(i,3e3)):setTimeout(function(){g("Default-Socket is not yet initialized."),te.joinSession(n)},1e3)},e.donotJoin=function(n){te.donotJoin=n;var t=e.sessionDescriptions[n];t&&(oe.send({donotJoin:!0,messageFor:t.userid,sessionid:n}),ie={},e.isAcceptNewSession=!0,e.sessionid=null)},this.send=function(n,t){if(n instanceof ArrayBuffer||n instanceof DataView||(n=m({extra:e.extra,userid:e.userid,data:n})),t)return void("open"==t.readyState&&t.send(n));for(var i in e.channels){var s=e.channels[i].channel;"open"==s.readyState&&s.send(n)}},this.leave=function(){_()},this.addStream=function(n){function t(t){var s=t.socket;if(!s)return void g(t,"doesn't has socket.");if(O(s),!t||!t.peer)throw"No peer to renegotiate.";var o=t.peer;return n.stream&&(o.attachStreams=[n.stream]),U(e.detachStreams,o.connection),n.stream&&(i.audio||i.video||i.screen)&&(G||z&&!o.connection.getLocalStreams().length)&&o.addStream(n.stream),z||"firefox"==t.userinfo.browser?t.redial():void o.recreateOffer(i,function(n,t){L({sdp:n,socket:s,renegotiate:i,labels:e.detachStreams,streaminfo:t}),e.detachStreams=[]})}var i=n.renegotiate;if(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]||(e.renegotiatedSessions[JSON.stringify(n.renegotiate)]={session:n.renegotiate,stream:n.stream}),n.socket)n.socket.userid!=e.userid&&t(e.peers[n.socket.userid]);else for(var s in e.peers)s!=e.userid&&t(e.peers[s])},e.request=function(n,t){e.captureUserMedia(function(){P({channel:e.userid,extra:t||{},userid:n}),oe.send({participant:!0,targetUser:n})})},e.accept=function(n){arguments.length>1&&d(arguments[0])&&(n={},arguments[0]&&(n.userid=arguments[0]),arguments[1]&&(n.extra=arguments[1]),arguments[2]&&(n.channel=arguments[2])),e.captureUserMedia(function(){$(n)})};var re=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!e.keepStreamsOpened){for(var n in e.localStreams)e.localStreams[n].stop();e.localStreams={},V={streams:[],mutex:!1,queueRequests:[]}}e.isInitiator&&oe.send({isDisconnectSockets:!0}),e.refresh(),te.defaultSocket=oe=null,re=!0,e.ondisconnected({userid:e.userid,extra:e.extra,peer:e.peers[e.userid],isSocketsDisconnected:!0}),e.close(),window.removeEventListener("beforeunload",te.leaveHandler),window.removeEventListener("keyup",te.leaveHandler),delete this,p("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function n(){return{create:function(e,n){k(this,n);var t=this;return this.type=e,this.init(),this.attachMediaStreams(),z&&this.session.data?(this.session.data&&"offer"==e&&this.createDataChannel(),this.getLocalDescription(e),this.session.data&&"answer"==e&&this.createDataChannel()):t.getLocalDescription(e),this},getLocalDescription:function(e){function n(){t.connection["offer"==e?"createOffer":"createAnswer"](function(n){n.sdp=t.serializeSdp(n.sdp,e),t.connection.setLocalDescription(n),t.trickleIce&&t.onSessionDescription(n,t.streaminfo),"offer"==n.type&&p("offer sdp",n.sdp),t.prevCreateType=e},t.onSdpError,t.constraints)}p("(getLocalDescription) peer createType is",e),this.session.inactive&&a(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var t=this;"answer"==e?this.setRemoteDescription(this.offerDescription,n):n()},serializeSdp:function(e,n){if(e=this.processSdp(e),z)return e;if(this.renegotiate,this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),e=this.setBandwidth(e),"both"==this.holdMLine){if(this.hold)this.prevSDP=e,e=e.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(e=this.prevSDP,35>=$))return e}else if("audio"==this.holdMLine||"video"==this.holdMLine){e=e.split("m=");var t="",i="";e[1]&&0==e[1].indexOf("audio")&&(t="m="+e[1]),e[2]&&0==e[2].indexOf("audio")&&(t="m="+e[2]),e[1]&&0==e[1].indexOf("video")&&(i="m="+e[1]),e[2]&&0==e[2].indexOf("video")&&(i="m="+e[2]),"audio"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+i):this.prevSDP&&(e=this.prevSDP)),"video"==this.holdMLine&&(this.hold?(this.prevSDP=e[0]+t+i,e=e[0]+t+i.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(e=this.prevSDP))}return!this.hold&&this.session.inactive&&(e="offer"==n?e.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):e.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),e=e.replace(/a=inactive/g,"a=sendrecv")),e},init:function(){function e(){return n.returnedSDP?void(n.returnedSDP=!1):(n.returnedSDP=!0,void n.onSessionDescription(n.connection.localDescription,n.streaminfo))}this.setConstraints(),this.connection=new N(this.iceServers,this.optionalArgument),this.session.data&&(p("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(t){return t.candidate?void(n.trickleIce&&n.onicecandidate(t.candidate)):void(n.trickleIce||e())},this.connection.onaddstream=function(e){p("onaddstream",Q?e.stream:v(e.stream)),n.onaddstream(e.stream,n.session)},this.connection.onremovestream=function(e){n.onremovestream(e.stream)},this.connection.onsignalingstatechange=function(){n.connection&&n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,signalingState:n.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){n.connection&&(n.oniceconnectionstatechange({iceConnectionState:n.connection.iceConnectionState,iceGatheringState:n.connection.iceGatheringState,
signalingState:n.connection.signalingState}),n.trickleIce||"complete"==n.connection.iceGatheringState&&(p("iceGatheringState",n.connection.iceGatheringState),e()))};var n=this},setBandwidth:function(e){if(K||z||!this.bandwidth)return e;var n=this.bandwidth;return this.session.screen&&(n.screen?n.screen<300&&g("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):g("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&this.session.screen&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video||n.data)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?n.screen:n.video)+"\r\n")),n.data&&!this.preferSCTP&&(e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+n.data+"\r\n")),e},setConstraints:function(){if(this.constraints={optional:this.sdpConstraints.optional||G?[{VoiceActivityDetection:!1}]:[],mandatory:this.sdpConstraints.mandatory||{OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen}},this.constraints.mandatory&&p("sdp-mandatory-constraints",v(this.constraints.mandatory)),this.constraints.optional&&p("sdp-optional-constraints",v(this.constraints.optional)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),p("optional-argument",v(this.optionalArgument)),a(this.iceServers))this.iceServers=null;else{var e=this.rtcMultiConnection.candidates,n=e.stun,t=e.turn,i=e.host;a(e.reflexive)||(n=e.reflexive),a(e.relay)||(t=e.relay),i||n||!t?i||n||t||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.iceServers={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}p("rtc-configuration",v(this.iceServers))},onSdpError:function(e){var n=v(e);n&&-1!=n.indexOf("RTP/SAVPF Expects at least 4 fields")&&(n="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),h("onSdpError:",n)},onSdpSuccess:function(){p("sdp success")},onMediaError:function(e){h(v(e))},setRemoteDescription:function(e,n){if(!e)throw"Remote session description should NOT be NULL.";if(this.connection){p("setting remote description",e.type,e.sdp);var t=this;this.connection.setRemoteDescription(new F(e),n||this.onSdpSuccess,function(e){-1==e.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&t.onSdpError(e)})}},addIceCandidate:function(e){function n(n){t.connection.addIceCandidate(n,function(){p("added:",e.sdpMid,e.candidate)},function(){h("onIceFailure",arguments,e.candidate)})}var t=this;Q?_(e,function(e){n(e)}):n(new _(e))},createDataChannel:function(e){if(!this.channels||!this.channels.length){var n=this;this.channels||(this.channels=[]);var t={};this.dataChannelDict&&(t=this.dataChannelDict),G&&!this.preferSCTP&&(t.reliable=!1),p("dataChannelDict",v(t)),("answer"==this.type||z)&&(this.connection.ondatachannel=function(e){n.setChannelEvents(e.channel)}),(G&&"offer"==this.type||z)&&this.setChannelEvents(this.connection.createDataChannel(e||"channel",t))}},setChannelEvents:function(e){var n=this;e.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(e.binaryType=this.dataChannelDict.binaryType),e.onmessage=function(e){n.onmessage(e.data)};var t=0;e.onopen=function(){e.push=e.send,e.send=function(i){if("disconnected"!=n.connection.iceConnectionState&&-1==e.readyState.search(/closing|closed/g)&&-1!=e.readyState.search(/connecting|open/g)){if("connecting"==e.readyState)return t++,setTimeout(function(){if(!(20>t))throw"Number of times exceeded to wait for WebRTC data connection to be opened.";e.send(i)},1e3);try{e.push(i)}catch(s){if(t++,g("Data transmission failed. Re-transmitting..",t,v(s)),t>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){e.send(i)},100)}}},n.onopen(e)},e.onerror=function(e){n.onerror(e)},e.onclose=function(e){n.onclose(e)},this.channels.push(e)},addStream:function(e){e.streamid||Y||(e.streamid=o()),p("attaching stream:",e.streamid,Q?e:v(e)),this.connection.addStream(e),this.sendStreamId(e),this.getStreamInfo()},attachMediaStreams:function(){for(var e=this.attachStreams,n=0;n<e.length;n++)this.addStream(e[n])},getStreamInfo:function(){this.streaminfo="";for(var e=this.connection.getLocalStreams(),n=0;n<e.length;n++)0==n?this.streaminfo=JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:e[n].streamid||"",isScreen:!!e[n].isScreen,isAudio:!!e[n].isAudio,isVideo:!!e[n].isVideo,preMuted:e[n].preMuted||{}})},recreateOffer:function(e,n){p("recreating offer"),this.type="offer",this.renegotiate=!0,this.session=e,this.onSessionDescription=n,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(e,n,t){p("recreating answer"),this.type="answer",this.renegotiate=!0,this.session=n,this.onSessionDescription=t,this.offerDescription=e,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function t(e){function n(n,s,r){r||(r=o()),i.localStreams[r]=n;var a=e.video;a&&(a[z?"mozSrcObject":"src"]=z?n:window.webkitURL.createObjectURL(n),a.play()),e.onsuccess(n,s,y,r),V.streams[y]={stream:n,streamid:r},V.mutex=!1,V.queueRequests.length&&t(V.queueRequests.shift())}if(Q)return fe.getUserMedia?fe.getUserMedia(e.constraints||{audio:!0,video:!0},e.onsuccess,e.onerror):void setTimeout(function(){t(e)},1e3);if(V.mutex===!0)return void V.queueRequests.push(e);V.mutex=!0;var i=e.connection,s=e.mediaConstraints||{},r="boolean"==typeof s.video?s.video:s.video||s,a="boolean"==typeof s.audio?s.audio:s.audio||j,d=navigator,u=e.constraints||{audio:j,video:j};u.video&&u.video.mozMediaSource&&(r={}),1==u.video&&(u.video=j),1==u.audio&&(u.audio=j),"boolean"==typeof a&&u.audio&&(u.audio=a),"boolean"==typeof r&&u.video&&(u.video=r);var m=a.mandatory;c(m)||(u.audio.mandatory=k(u.audio.mandatory,m));var f=r.mandatory;if(f){var S={};if(f.minWidth&&(S.minWidth=f.minWidth),f.minHeight&&(S.minHeight=f.minHeight),f.maxWidth&&(S.maxWidth=f.maxWidth),f.maxHeight&&(S.maxHeight=f.maxHeight),f.minAspectRatio&&(S.minAspectRatio=f.minAspectRatio),f.maxFrameRate&&(S.maxFrameRate=f.maxFrameRate),f.minFrameRate&&(S.minFrameRate=f.minFrameRate),S.minWidth&&S.minHeight){var w=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1==w.indexOf(S.minWidth+":"+S.minHeight)||-1==w.indexOf(S.maxWidth+":"+S.maxHeight))&&h('The min/max width/height constraints you passed "seems" NOT supported.',v(S)),(S.minWidth>S.maxWidth||S.minHeight>S.maxHeight)&&h("Minimum value must not exceed maximum value.",v(S)),S.minWidth>=1280&&S.minHeight>=720&&g("Enjoy HD video! min/"+S.minWidth+":"+S.minHeight+", max/"+S.maxWidth+":"+S.maxHeight)}u.video.mandatory=k(u.video.mandatory,S)}f&&(u.video.mandatory=k(u.video.mandatory,f)),r.optional&&r.optional instanceof Array&&r.optional.length&&(u.video.optional=u.video.optional?u.video.optional.concat(r.optional):r.optional),a.optional&&a.optional instanceof Array&&a.optional.length&&(u.audio.optional=u.audio.optional?u.audio.optional.concat(a.optional):a.optional),u.video.mandatory&&!c(u.video.mandatory)&&i._mediaSources.video&&(u.video.optional.forEach(function(e,n){e.sourceId==i._mediaSources.video&&delete u.video.optional[n]}),u.video.optional=l(u.video.optional),u.video.optional.push({sourceId:i._mediaSources.video})),u.audio.mandatory&&!c(u.audio.mandatory)&&i._mediaSources.audio&&(u.audio.optional.forEach(function(e,n){e.sourceId==i._mediaSources.audio&&delete u.audio.optional[n]}),u.audio.optional=l(u.audio.optional),u.audio.optional.push({sourceId:i._mediaSources.audio})),u.video&&!u.video.mozMediaSource&&u.video.optional&&u.video.mandatory&&!u.video.optional.length&&c(u.video.mandatory)&&(u.video=!0),K&&(u={audio:!!u.audio,video:!!u.video}),p("invoked getUserMedia with constraints:",v(u));var y=JSON.stringify(u);V.streams[y]?n(V.streams[y].stream,!0,V.streams[y].streamid):(d.getMedia=d.webkitGetUserMedia||d.mozGetUserMedia,d.getMedia(u,n,function(n){e.onerror(n,u)}))}function i(e){function n(n,i,s){var o=n.uuid;if(t[o]||(t[o]=[]),t[o].push(n.message),n.last){var r=t[o].join("");n.isobject&&(r=JSON.parse(r));var a=(new Date).getTime(),d=a-n.sendingTime,c={data:r,userid:i,extra:s,latency:d};r.preRecordedMediaChunk?(e.preRecordedMedias[r.streamerid]||e.shareMediaFile(null,null,r.streamerid),e.preRecordedMedias[r.streamerid].onData(r.chunk)):e.autoTranslateText?(c.original=c.data,e.Translator.TranslateText(c.data,function(n){c.data=n,e.onmessage(c)})):r.isPartOfScreen?e.onpartofscreen(r):e.onmessage(c),delete t[o]}}var t={};return{receive:n}}function s(e){if(!e)throw"MediaStream is mandatory.";if(e.getVideoTracks&&!e.getVideoTracks().length)return e;var n=new AudioContext,t=n.createMediaStreamSource(e),i=n.createMediaStreamDestination();return t.connect(i),W.push(t),i.stream}function o(){if(window.crypto&&crypto.getRandomValues&&-1==navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,i=e.length;i>t;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function r(e){return!e.audio&&!e.video&&!e.screen&&e.data}function a(e){return"undefined"==typeof e}function d(e){return"string"==typeof e}function c(e){var n=0;for(var t in e)n++;return 0==n}function u(e){var n="";try{n=String.fromCharCode.apply(null,new Uint16Array(e))}catch(t){}return n}function m(e){d(e)||(e=JSON.stringify(e));for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),i=0,s=e.length;s>i;i++)t[i]=e.charCodeAt(i);return n}function l(e){for(var n=[],t=e.length,i=0;t>i;i++)e[i]&&e[i]!==!0&&n.push(e[i]);return n}function f(e,n){for(var t in e)n(e[t],t)}function p(){ne.log(arguments)}function h(){ne.error(arguments)}function g(){ne.warn(arguments)}function v(e){return JSON.stringify(e,function(e,n){return n&&n.sdp?(p(n.sdp.type,"	",n.sdp.sdp),""):n},"	")}function S(e){var n=0;for(var t in e)t&&n++;return n}function w(e,n){var t=document.createElement(e.isAudio?"audio":"video");if(t.id=e.streamid,Q){var i=document.body||document.documentElement;return i.insertBefore(t,i.firstChild),setTimeout(function(){fe.attachMediaStream(t,e)},1e3),fe.attachMediaStream(t,e)}return t[z?"mozSrcObject":"src"]=z?e:window.webkitURL.createObjectURL(e),t.controls=!0,t.autoplay=!!n.remote,t.muted=n.remote?!1:!0,z&&t.addEventListener("ended",function(){e.onended()},!1),t.play(),t}function y(e,n){(!e.mediaElement||e.mediaElement.parentNode)&&(oe[e.streamid]||(oe[e.streamid]=e,n.onstreamended(e)))}function b(e,n){re[e.userid]||(re[e.userid]=e,n.onleave(e))}function x(e){function n(n){var s=document.createElement("canvas");s.width=n.videoWidth||n.clientWidth,s.height=n.videoHeight||n.clientHeight;var o=s.getContext("2d");o.drawImage(n,0,0,s.width,s.height),i.snapshots[t]=s.toDataURL("image/png"),e.callback&&e.callback(i.snapshots[t])}var t=e.userid,i=e.connection;if(e.mediaElement)return n(e.mediaElement);for(var s in i.streams)s=i.streams[s],s.userid==t&&s.stream&&s.stream.getVideoTracks&&s.stream.getVideoTracks().length&&n(s.mediaElement)}function C(e){e.onMediaCaptured&&(e.onMediaCaptured(),delete e.onMediaCaptured)}function k(e,n){if(e||(e={}),!n)return e;for(var t in n)e[t]=n[t];return e}function M(e,n){var t=document.createElement("script");t.src=e,t.onload=function(){p("loaded resource:",e),n&&n()},document.documentElement.appendChild(t)}function R(e){var n=e.connection,t=e.element;if(!window.html2canvas)return M(n.resources.html2canvas,function(){R(e)});if(d(t)&&(t=document.querySelector(t),t||(t=document.getElementById(t))),!t)throw"HTML DOM Element is not accessible!";html2canvas(t,{onrendered:function(n){e.callback(n.toDataURL())}})}function T(e,n){function t(e){return e.userid=e.extra.userid,e}if(!window.FileBufferReader)return void M(e.resources.FileBufferReader,function(){T(e,n)});var i=new FileBufferReader;i.onProgress=function(n){e.onFileProgress(t(n),n.uuid)},i.onBegin=function(n){e.onFileStart(t(n))},i.onEnd=function(n){e.onFileEnd(t(n))},n(i)}function E(e){if(le.screen.extensionid==ce&&!ie){if(!e)return E(!0);ie=!0;var n=document.createElement("iframe");n.onload=function(){n.isLoaded=!0,p("Screen Capturing frame is loaded.")},n.src="getSourceId.html",n.style.display="none",(document.body||document.documentElement).appendChild(n),te={postMessage:function(){return n.isLoaded?void n.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(te.postMessage,100)}}}}function D(e,n){if(!se){if(!n)return D(e,!0);se=!0;var t=document.createElement("iframe");t.onload=function(){function n(t){t.data&&t.data.iceServers&&(e(t.data.iceServers),window.removeEventListener("message",n))}t.isLoaded=!0,A("message",n),t.contentWindow.postMessage("get-ice-servers","*")},t.src="getIceServers.html",t.style.display="none",(document.body||document.documentElement).appendChild(t)}}function O(e){var n=e.stream,t=e.root,i=e.session||{},s=e.enabled;if(i.audio||i.video||(i=d(i)?{audio:!0,video:!0}:k(i,{audio:!0,video:!0})),i.type){if("remote"==i.type&&"remote"!=t.type)return;if("local"==i.type&&"local"!=t.type)return}if(p(s?"Muting":"UnMuting","session",v(i)),"local"==t.type&&i.audio&&n.getAudioTracks){var o=n.getAudioTracks()[0];o&&(o.enabled=!s)}if("local"==t.type&&(i.video||i.screen)&&n.getVideoTracks){var r=n.getVideoTracks()[0];r&&(r.enabled=!s)}if(t.sockets.forEach(function(e){"local"==t.type&&e.send({streamid:t.streamid,mute:!!s,unmute:!s,session:i}),"remote"==t.type&&e.send({promptMuteUnmute:!0,streamid:t.streamid,mute:!!s,unmute:!s,session:i})}),"remote"!=t.type){var a=k({},t);a.session=i,a.isAudio=!!a.session.audio&&!a.session.video,a.isVideo=!!a.session.video,a.isScreen=!!a.session.screen,s&&(n.preMuted={audio:n.getAudioTracks().length&&!n.getAudioTracks()[0].enabled,video:n.getVideoTracks().length&&!n.getVideoTracks()[0].enabled},t.rtcMultiConnection.onmute(a)),s||(n.preMuted={},t.rtcMultiConnection.onunmute(a))}}function A(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function I(e){if(!window.hark)return void M(e.connection.resources.hark,function(){I(e)});var n=e.connection,t=e.streamedObject,i=e.stream,s={},o=hark(i,s);o.on("speaking",function(){n.onspeaking&&n.onspeaking(t)}),o.on("stopped_speaking",function(){n.onsilence&&n.onsilence(t)}),o.on("volume_change",function(e,i){n.onvolumechange&&n.onvolumechange(k({volume:e,threshold:i},t))})}function P(e){function n(e,n){if(-1!=e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}e.userid=o(),e.session={audio:!0,video:!0},e.maxParticipantsAllowed=3,e.direction="many-to-many",e.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}},e.candidates={host:!0,stun:!0,turn:!0},e.sdpConstraints={},e.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},e.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},e.iceProtocols={tcp:!0,udp:!0},e.preferSCTP=z||$>=32?!0:!1,e.chunkInterval=z||$>=32?100:500,e.chunkSize=z||$>=32?13e3:1e3,e.fakeDataChannels=!1,e.waitUntilRemoteStreamStartsFlowing=null,e.leaveOnPageUnload=!0,e.getExternalIceServers=G,e.UA={isFirefox:z,isChrome:G,isMobileDevice:K,version:G?$:ee,isNodeWebkit:X,isSafari:J,isIE:Y,isOpera:q},e.fileQueue={},e.renegotiatedSessions={},e.channels={},e.extra={},e.bandwidth={screen:300},e.caniuse={RTCPeerConnection:le.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:le.isAudioContextSupported,ScreenSharing:le.isScreenCapturingSupported,RtpDataChannels:le.isRtpDataChannelsSupported,SctpDataChannels:le.isSctpDataChannelsSupported},e.snapshots={},e._mediaSources={},e.devices={},e.language="en",e.autoTranslateText=!1,e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.localStreamids=[],e.localStreams={},e.preRecordedMedias={},e.attachStreams=[],e.detachStreams=[],e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},e.dataChannelDict={},e.dontAttachStream=!1,e.dontCaptureUserMedia=!1,e.preventSSLAutoAllowed=!1,e.autoReDialOnFailure=!0,e.isInitiator=!1,e.DetectRTC=le,e.trickleIce=!0,e.sessionDescriptions={},e.sessionDescription=null,e.resources={RecordRTC:"RecordRTC.js",PreRecordedMediaStreamer:"PreRecordedMediaStreamer.js",customGetUserMediaBar:"navigator.customGetUserMediaBar.js",html2canvas:"screenshot.js",hark:"hark.js",firebase:"firebase.js",firebaseio:"https://dazzling-fire-764.firebaseio.com/",muted:"images/muted.png?"+Math.random(),getConnectionStats:"getConnectionStats.js",FileBufferReader:"FileBufferReader.js"},e.body=document.body||document.documentElement,e.peers={},e.firebase="chat",e.numberOfSessions=0,e.numberOfConnectedUsers=0,e.enableFileSharing=!0,e.autoSaveToDisk=!1,e.processSdp=function(e){return e},e.onmessage=function(e){p("onmessage",v(e))},e.onopen=function(e){p("Data connection is opened between you and",e.userid)},e.onerror=function(e){h(onerror,v(e))},e.onclose=function(n){g("onclose",v(n)),e.streams.remove({userid:n.userid})};var t={};e.onFileStart=function(e){addNewMessage({header:rtcMultiConnection.extra.username,message:"File Shared -> "+e.name+" ( "+bytesToSize(e.size)+" )",userinfo:getUserinfo(rtcMultiConnection.blobURLs[rtcMultiConnection.userid],"images/share-files.png"),callback:function(e){}})},e.onFileProgress=function(e){var i=t[e.uuid];i&&(i.progress.value=e.currentPosition||e.maxChunks||i.progress.max,n(i.progress,i.label))},e.onFileEnd=function(n){t[n.uuid]&&(t[n.uuid].div.innerHTML='<a href="'+n.url+'" target="_blank" download="'+n.name+'">'+n.name+"</a>"),(e.onFileSent||e.onFileReceived)&&(e.onFileSent&&e.onFileSent(n,n.uuid),e.onFileReceived&&e.onFileReceived(n.name,n))},e.onstream=function(n){e.body.insertBefore(n.mediaElement,e.body.firstChild)},e.onstreamended=function(e){if(p("onStreamEndedHandler:",e),!e.mediaElement)return g("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode){if(e.mediaElement=document.getElementById(e.streamid),!e.mediaElement)return g("Event.mediaElement is undefined",e);if(!e.mediaElement.parentNode)return g("Event.mediElement.parentNode is null.",e)}e.mediaElement.parentNode.removeChild(e.mediaElement)},e.onSessionClosed=function(e){e.isEjected?g(e.userid,"ejected you."):g("Session has been closed.",e)},e.onmute=function(n){n.isVideo&&n.mediaElement&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",e.resources.muted),n.mediaElement.style.display="none"),n.isAudio&&n.mediaElement&&(n.mediaElement.muted=!0)},e.onunmute=function(e){e.isVideo&&e.mediaElement&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster"),e.mediaElement.style.display="initial",e.mediaElement.volume=.5),e.isAudio&&e.mediaElement&&(e.mediaElement.muted=!1,e.mediaElement.volume=.5)},e.onleave=function(e){p("onleave",v(e))},e.token=o,e.peers[e.userid]={drop:function(){e.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},e._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],e.streams={mute:function(e){this._private(e,!0)},unmute:function(e){this._private(e,!1)},_private:function(n,t){function i(e,n,t){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||!(n.isScreen&&!e.isScreen||n.isAudio&&!e.isAudio||n.isVideo&&!e.isVideo||(t?!e.mute(n):!e.unmute(n)))}if(!n||d(n))for(var s in this)-1==e._skip.indexOf(s)&&this[s]._private(n,t);else for(var s in this)-1==e._skip.indexOf(s)&&i(this[s],n,t)},stop:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&e.stop(),n.audio&&e.isAudio&&e.stop(),n.video&&e.isVideo&&e.stop(),n.audio||n.video||n.screen||e.stop())}var i;for(var s in this)if(-1==e._skip.indexOf(s))if(i=this[s],n)if(d(n)){var o={};o[n]=!0,t(i,o)}else t(i,n);else i.stop()},remove:function(n){function t(e,n){n.userid&&e.userid!=n.userid||n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&i(e),n.audio&&e.isAudio&&i(e),n.video&&e.isVideo&&i(e),n.audio||n.video||n.screen||i(e))}function i(n){y(n,e),delete e.streams[n.streamid]}var s;for(var o in this)if(-1==e._skip.indexOf(o))if(s=this[o],n)if(d(n)){var r={};r[n]=!0,t(s,r)}else t(s,n);else t(s,{local:!0,remote:!0})},selectFirst:function(e){return this._selectStreams(e,!1)},selectAll:function(e){return this._selectStreams(e,!0)},_selectStreams:function(n,t){if(!n||d(n)||c(n))throw"Invalid arguments.";a(n.local)&&a(n.remote)&&a(n.userid)&&(n.local=n.remote=!0),n.isAudio||n.isVideo||n.isScreen||(n.isAudio=n.isVideo=n.isScreen=!0);var i=[];for(var s in this)-1==e._skip.indexOf(s)&&(s=this[s])&&(n.local&&"local"==s.type||n.remote&&"remote"==s.type||n.userid&&s.userid==n.userid)&&(n.isVideo&&s.isVideo&&i.push(s),n.isAudio&&s.isAudio&&i.push(s),n.isScreen&&s.isScreen&&i.push(s));return t?i:i[0]}};var i=[];i.push({url:"stun:turn2.xirsys.com"}),i.push({username:"539b1ef2-019b-4cb0-9950-c456f4252015",url:"turn:turn2.xirsys.com:443?transport=udp",credential:"799efd12-8c0e-443a-8aee-20e0fd583b7b"}),i.push({username:"539b1ef2-019b-4cb0-9950-c456f4252015",url:"turn:turn2.xirsys.com:443?transport=tcp",credential:"799efd12-8c0e-443a-8aee-20e0fd583b7b"}),e.iceServers=i,e.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},e.media={min:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.minWidth=n,e.mediaConstraints.video.mandatory.minHeight=t)},max:function(n,t){e.mediaConstraints.video&&(e.mediaConstraints.video.mandatory||(e.mediaConstraints.video.mandatory={}),e.mediaConstraints.video.mandatory.maxWidth=n,e.mediaConstraints.video.mandatory.maxHeight=t)}},e._getStream=function(n){function t(e,n,t){if(t){var i=t.onpause,s=t.onplay;t.onpause=t.onplay=function(){},n?t.pause():t.play(),t.onpause=i,t.onplay=s}}var i=k({sockets:n.socket?[n.socket]:[]},n);return i.stop=function(){var e=this;if(e.sockets.forEach(function(n){"local"==e.type&&n.send({streamid:e.streamid,stopped:!0}),"remote"==e.type&&n.send({promptStreamStop:!0,streamid:e.streamid})}),"remote"!=e.type){var n=e.stream;n&&e.rtcMultiConnection.stopMediaStream(n)}},i.mute=function(e){this.muted=!0,this._private(e,!0)},i.unmute=function(e){this.muted=!1,this._private(e,!1)},i._private=function(e,n){return e&&!a(e.sync)&&0==e.sync?void t(e,n,this.mediaElement):void O({root:this,session:e,enabled:n,stream:this.stream})},i.startRecording=function(e){var n=this;return e||(e={audio:!0,video:!0}),d(e)&&(e={audio:"audio"==e,video:"video"==e}),window.RecordRTC?(p("started recording session",e),n.videoRecorder=n.audioRecorder=null,z?e.video?n.videoRecorder=RecordRTC(n.stream,{type:"video"}):e.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"})):G&&(e.video&&(n.videoRecorder=RecordRTC(n.stream,{type:"video"})),e.audio&&(n.audioRecorder=RecordRTC(n.stream,{type:"audio"}))),n.audioRecorder&&n.audioRecorder.startRecording(),void(n.videoRecorder&&n.videoRecorder.startRecording())):M(n.rtcMultiConnection.resources.RecordRTC,function(){n.startRecording(e)})},i.stopRecording=function(e,n){n||(n={audio:!0,video:!0}),d(n)&&(n={audio:"audio"==n,video:"video"==n}),p("stopped recording session",n);var t=this;n.audio&&t.audioRecorder?t.audioRecorder.stopRecording(function(){n.video&&t.videoRecorder?t.videoRecorder.stopRecording(function(){e({audio:t.audioRecorder.getBlob(),video:t.videoRecorder.getBlob()})}):e({audio:t.audioRecorder.getBlob()})}):n.video&&t.videoRecorder&&t.videoRecorder.stopRecording(function(){e({video:t.videoRecorder.getBlob()})})},i.takeSnapshot=function(n){x({mediaElement:this.mediaElement,userid:this.userid,connection:e,callback:n})},i.streamObject=i,i},e.set=function(e){for(var n in e)this[n]=e[n];return this},e.onMediaError=function(e){h("name",e.name),h("constraintName",v(e.constraintName)),h("message",e.message),h("original session",e.session)},e.takeSnapshot=function(n,t){x({userid:n,connection:e,callback:t})},e.saveToDisk=function(e,n){e.size&&e.type?B.SaveToDisk(URL.createObjectURL(e),n||e.name||e.type.replace("/","-")+e.type.split("/")[1]):B.SaveToDisk(e,n)},e.selectDevices=function(n,t){function i(n){n&&(e._mediaSources[n.kind]=n.id)}n&&i(this.devices[n]),t&&i(this.devices[t])},e.getDevices=function(n){return le.MediaDevices.length?(le.MediaDevices.forEach(function(n){e.devices[n.deviceId]=n}),void(n&&n(e.devices))):setTimeout(function(){e.getDevices(n)},1e3)},e.getMediaDevices=e.enumerateDevices=function(n){if(!n)throw"callback is mandatory.";e.getDevices(function(){n(e.DetectRTC.MediaDevices)})},e.onCustomMessage=function(e){p("Custom message",e)},e.ondrop=function(e){p("Media connection is dropped by "+e)},e.drop=function(n){n=n||{},e.attachStreams=[];for(var t in e.streams)-1==e._skip.indexOf(t)&&(t=e.streams[t],"local"==t.type?(e.detachStreams.push(t.streamid),y(t,e)):y(t,e));e.sendCustomMessage({drop:!0,dontRenegotiate:a(n.renegotiate)?!0:n.renegotiate})},e.Translator={TranslateText:function(n,t){var i=document.createElement("script");i.type="text/javascript";var s=encodeURIComponent(n),o="method"+e.token();window[o]=function(e){e.data&&e.data.translations[0]&&t&&t(e.data.translations[0].translatedText),e.error&&"Daily Limit Exceeded"==e.error.message&&(g('Text translation failed. Error message: "Daily Limit Exceeded."'),t(n))};var r="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+o+"&q="+s;i.src=r,document.getElementsByTagName("head")[0].appendChild(i)}},e.setDefaultEventsForMediaElement=function(n,t){n.onpause=function(){e.streams[t]&&!e.streams[t].muted&&e.streams[t].mute()},n.onplay=function(){e.streams[t]&&e.streams[t].muted&&e.streams[t].unmute()};var i=!1;n.onvolumechange=function(){i||(i=!0,e.streams[t]&&setTimeout(function(){var s=e.streams[t];e.streams[t].sockets.forEach(function(e){e.send({streamid:s.streamid,isVolumeChanged:!0,volume:n.volume})}),i=!1},2e3))}},e.onMediaFile=function(n){p("onMediaFile",n),e.body.appendChild(n.mediaElement)},e.shareMediaFile=function(n,t,i){return i=i||e.token(),PreRecordedMediaStreamer?PreRecordedMediaStreamer.shareMediaFile({file:n,video:t,streamerid:i,connection:e}):(M(e.resources.PreRecordedMediaStreamer,function(){e.shareMediaFile(n,t,i)}),i)},e.onpartofscreen=function(n){var t=document.createElement("img");t.src=n.screenshot,e.body.appendChild(t)},e.skipLogs=function(){p=h=g=function(){}},e.hold=function(n){for(var t in e.peers)e.peers[t].hold(n)},e.onhold=function(n){p("onhold",n),"audio"!=n.kind&&(n.mediaElement.pause(),n.mediaElement.setAttribute("poster",e.resources.muted)),"audio"==n.kind&&(n.mediaElement.muted=!0)},e.unhold=function(n){for(var t in e.peers)e.peers[t].unhold(n)},e.onunhold=function(e){p("onunhold",e),"audio"!=e.kind&&(e.mediaElement.play(),e.mediaElement.removeAttribute("poster")),"audio"!=e.kind&&(e.mediaElement.muted=!1)},e.sharePartOfScreen=function(n){function t(){(!e.partOfScreen||e.partOfScreen.sharing)&&R({element:n.element,connection:e,callback:function(s){if(s!=i){i=s;for(var o in e.channels)e.channels[o].send({screenshot:s,isPartOfScreen:!0})}!n.once&&setTimeout(t,n.interval||200)}})}var i="";t(),e.partOfScreen=k({sharing:!0},n)},e.pausePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.resumePartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].pausePartOfScreenSharing=!1;e.partOfScreen&&(e.partOfScreen.sharing=!0)},e.stopPartOfScreenSharing=function(){for(var n in e.peers)e.peers[n].stopPartOfScreenSharing=!0;e.partOfScreen&&(e.partOfScreen.sharing=!1)},e.takeScreenshot=function(n,t){if(!n||!t)throw"Invalid number of arguments.";if(!window.html2canvas)return M(e.resources.html2canvas,function(){e.takeScreenshot(n)});if(d(n)&&(n=document.querySelector(n),n||(n=document.getElementById(n))),!n)throw"HTML Element is inaccessible!";html2canvas(n,{onrendered:function(e){t(e.toDataURL())}})},e.onScreenCapturingExtensionAvailable=function(){p("It seems that screen capturing extension is installed and available on your system!")},!Q&&le.screen.onScreenCapturingExtensionAvailable&&(le.screen.onScreenCapturingExtensionAvailable=function(){e.onScreenCapturingExtensionAvailable()}),e.changeBandwidth=function(n){for(var t in e.peers)e.peers[t].changeBandwidth(n)},e.convertToAudioStream=function(e){s(e)},e.onstatechange=function(e){p("on:state:change ("+e.userid+"):",e.name+":",e.reason||"")},e.onfailed=function(e){e.peer.numOfRetries||(e.peer.numOfRetries=0),e.peer.numOfRetries++,z||"firefox"==e.targetuser.browser?(h("ICE connectivity check is failed. Re-establishing peer connection."),e.peer.numOfRetries<2&&e.peer.redial()):(h("ICE connectivity check is failed. Renegotiating peer connection."),e.peer.numOfRetries<2&&e.peer.renegotiate()),e.peer.numOfRetries>=2&&(e.peer.numOfRetries=0)},e.onconnected=function(e){p("Peer connection has been established between you and",e.userid)},e.ondisconnected=function(n){h("Peer connection seems has been disconnected between you and",n.userid),c(e.channels)||e.channels[n.userid]&&(e.channels[n.userid].send({checkingPresence:!0}),setTimeout(function(){return e.peers[n.userid].connected?void delete e.peers[n.userid].connected:(e.streams.remove({remote:!0,userid:n.userid}),void e.remove(n.userid))},3e3))},e.onstreamid=function(e){p("got remote streamid",e.streamid,"from",e.userid)},e.stopMediaStream=function(n){if(!n)throw"MediaStream argument is mandatory.";if(e.keepStreamsOpened)return void(n.onended&&n.onended());e.localStreams[n.streamid]&&delete e.localStreams[n.streamid],z&&n.onended&&n.onended();var t=Boolean((n.getAudioTracks||n.getVideoTracks)&&(n.getAudioTracks()[0]&&!n.getAudioTracks()[0].stop||n.getVideoTracks()[0]&&!n.getVideoTracks()[0].stop));return!n.getAudioTracks||t?void(n.stop&&n.stop()):(n.getAudioTracks().length&&n.getAudioTracks()[0].stop&&n.getAudioTracks().forEach(function(e){e.stop()}),void(n.getVideoTracks().length&&n.getVideoTracks()[0].stop&&n.getVideoTracks().forEach(function(e){e.stop()})))},e.changeBandwidth=function(n){if(!n||d(n)||c(n))throw'Invalid "bandwidth" arguments.';f(e.peers,function(e){e.peer.bandwidth=n}),e.renegotiate()},e.openSignalingChannel=function(n){if(!window.Firebase)return M(e.resources.firebase,function(){e.openSignalingChannel(n)});var t=n.channel||e.channel;e.firebase&&(e.resources.firebaseio=e.resources.firebaseio.replace("//chat.","//"+e.firebase+"."));var i=new Firebase(e.resources.firebaseio+t);i.channel=t,i.on("child_added",function(e){n.onmessage(e.val())}),i.send=function(e){for(var n in e)(a(e[n])||"function"==typeof e[n])&&(e[n]=!1);this.push(e)},e.socket||(e.socket=i),i.onDisconnect().remove(),setTimeout(function(){n.callback(i)},1)},e.Plugin=fe}var U=location.href,L=U.split("?");window.RMCDefaultChannel=L[0].replace(/\/|:|#|%|\.|\[|\]/g,"")+currentTimeTicker,window.RTCMultiConnection=function(n){function i(n){return te&&E(),S?n():void(S=new e(b,n))}function u(e,n){if(d(e)&&(b.skipOnNewSession=!0),!S)return p("Signaling channel is not ready. Connecting..."),void i(function(){p("Signaling channel is connected. Joining the session again..."),setTimeout(function(){u(e,n)},1e3)});if(d(e)){if(!b.sessionDescriptions[e])return setTimeout(function(){p("Session-Descriptions not found. Rechecking.."),u(e,n)},1e3);e=b.sessionDescriptions[e]}if(n)return m(function(){
e.oneway=!0,u(e)},n);if(!e||!e.userid||!e.sessionid){t("missing arguments",arguments);var t='Invalid data passed over "connection.join" method.';throw b.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:t}),t}b.dontOverrideSession||(b.session=e.session);var s=b.extra||e.extra||{};e.oneway||r(e)?S.joinSession(e,s):m(function(){S.joinSession(e,s)})}function m(e,n,i){function s(t){if(t.data&&t.data.chromeMediaSourceId){window.removeEventListener("message",s);var i=t.data.chromeMediaSourceId;if(le.screen.sourceId=i,le.screen.chromeMediaSource="desktop","PermissionDeniedError"==i){var o={message:"https:"==location.protocol?"User denied to share content of his screen.":de,name:"PermissionDeniedError",constraintName:l,session:a};return V.mutex=!1,le.screen.sourceId=null,b.onMediaError(o)}m(e,n)}t.data&&t.data.chromeExtensionStatus&&(g("Screen capturing extension status is:",t.data.chromeExtensionStatus),le.screen.chromeMediaSource="screen",m(e,n,!0))}function o(n,i,s,r){if(b.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+v(n)}),b.preventSSLAutoAllowed&&!r&&G)return navigator.customGetUserMediaBar?void navigator.customGetUserMediaBar(n,function(){o(n,i,s,!0)},function(){b.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:n,session:a})}):void M(b.resources.customGetUserMediaBar,function(){o(n,i,s,r)});var c={onsuccess:function(e,t,o,r){f(e,t,o,r,n,i,s,l,u,a)},onerror:function(n,t){if(z&&"PERMISSION_DENIED"==n&&(n={message:"",name:"PermissionDeniedError",constraintName:t,session:a}),z&&t.video&&t.video.mozMediaSource)return i={message:ae,name:n.name||"PermissionDeniedError",constraintName:t,session:a},void b.onMediaError(i);if(d(n))return b.onMediaError({message:"Unknown Error",name:n,constraintName:t,session:a});if(n.name&&("PermissionDeniedError"==n.name||"DevicesNotFoundError"==n.name)){var i="Either: ";i+="\n Media resolutions are not permitted.",i+="\n Another application is using same media device.",i+="\n Media device is not attached or drivers not installed.",i+="\n You denied access once and it is still denied.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:a},b.onMediaError(i),G&&(a.audio||a.video)&&le.load(function(){a.audio&&!le.hasMicrophone&&(g("It seems that you have no microphone attached to your device/system."),a.audio=a.audio=!1,a.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),a.video&&!le.hasWebcam&&(g("It seems that you have no webcam attached to your device/system."),a.video=a.video=!1,a.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),le.hasMicrophone||le.hasWebcam?b.getUserMediaPromptedOnce||(b.getUserMediaPromptedOnce=!0,m(e,a)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})}if(n.name&&"ConstraintNotSatisfiedError"==n.name){var i="Either: ";i+="\n You are prompting unknown media resolutions.",i+="\n You are using invalid media constraints.",n.message&&n.message.length&&(i+="\n "+n.message),i={message:i,name:n.name,constraintName:t,session:a},b.onMediaError(i)}a.screen&&(z?h(ae):"https:"!==location.protocol?X||"file:"!=location.protocol&&"http:"!=location.protocol||h("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):h('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),V.mutex=!1;var s=JSON.stringify(t);V.streams[s]&&delete V.streams[s]},mediaConstraints:b.mediaConstraints||{}};c.constraints=n||u,c.connection=b,t(c)}var a=n||b.session;if(c(a))return void(e&&e());if(b.dontCaptureUserMedia)return e();if(r(a)||!b.isInitiator&&a.oneway)return b.attachStreams=[],e();var u={audio:a.audio?{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]}:!1,video:!!a.video};if(b._mediaSources.audio&&u.audio.optional.push({sourceId:b._mediaSources.audio}),b._mediaSources.video&&(u.video={optional:[{sourceId:b._mediaSources.video}]}),!a.screen&&!u.audio&&!u.video)return e();var l={audio:!1,video:{mandatory:{chromeMediaSource:le.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(z&&a.screen){if("https:"!==location.protocol)return h(de);g(ae),l.video=k(l.video.mandatory,{mozMediaSource:"window",mediaSource:"window"}),u.audio&&(l.audio=!0,u={}),delete l.video.chromeMediaSource}if(a.screen){if(G&&le.screen.extensionid!=ce&&(ue=!0),G&&!ue&&!i&&!le.screen.sourceId)return A("message",s),te||E(),void te.postMessage();if(G&&ue&&!i&&"screen"==le.screen.chromeMediaSource&&le.screen.extensionid)return le.screen.extensionid==ce?m(e,n,!0):(p("checking if chrome extension is installed."),void le.screen.getChromeExtensionStatus(function(t){"installed-enabled"==t&&(le.screen.chromeMediaSource="desktop"),m(e,n,!0),p("chrome extension is installed?","desktop"==le.screen.chromeMediaSource)}));if(G&&ue&&"desktop"==le.screen.chromeMediaSource&&!le.screen.sourceId)return void le.screen.getSourceId(function(t){if("PermissionDeniedError"==t){var i={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:l,session:a};return V.mutex=!1,le.screen.chromeMediaSource="desktop",b.onMediaError(i)}return"No-Response"==t?(h("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),le.screen.chromeMediaSource="screen",m(e,n,!0)):void m(e,n,!0)});G&&"desktop"==le.screen.chromeMediaSource&&(l.video.mandatory.chromeMediaSourceId=le.screen.sourceId);var S=x;o(l,u.audio||u.video?function(){S&&(x=!0),o(u,e)}:e)}else o(u,e,a.audio&&!a.video)}function f(e,n,t,i,r,a,d,c,u,m){i||(i=o()),b.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+v(r)}),d&&(e=s(e)),b.localStreamids.push(i),e.onended=function(){p.mediaElement&&!p.mediaElement.parentNode&&document.getElementById(e.streamid)&&(p.mediaElement=document.getElementById(e.streamid)),b.attachStreams.forEach(function(n,t){n==e&&(delete b.attachStreams[t],b.attachStreams=l(b.attachStreams))}),y(p,b),b.streams[i]&&b.removeStream(i);var n=b.streams[i];n&&n.sockets.length&&n.sockets.forEach(function(e){e.send({streamid:n.streamid,stopped:!0})}),V.mutex=!1,V.streams[t]&&delete V.streams[t],le.screen.sourceId=null},Y||(e.streamid=i,e.isScreen=r==c,e.isVideo=r==u&&!!u.video,e.isAudio=r==u&&!!u.audio&&!u.video,e.preMuted={audio:e.getAudioTracks().length&&!e.getAudioTracks()[0].enabled,video:e.getVideoTracks().length&&!e.getVideoTracks()[0].enabled});var f=w(e,m);f.muted=!0;var p={stream:e,streamid:i,mediaElement:f,blobURL:f.mozSrcObject?URL.createObjectURL(e):f.src,type:"local",userid:b.userid,extra:b.extra,session:m,isVideo:!!e.isVideo,isAudio:!!e.isAudio,isScreen:!!e.isScreen,isInitiator:!!b.isInitiator,rtcMultiConnection:b};console.log(),x&&b.attachStreams.push(e),x=!1,b.streams[i]=b._getStream(p),n||b.onstream(p),b.setDefaultEventsForMediaElement&&b.setDefaultEventsForMediaElement(f,i),a&&a(e,p),b.onspeaking&&I({stream:e,streamedObject:p,connection:b})}var S,b=this;b.channel=n||RMCDefaultChannel,b.isAcceptNewSession=!0,b.open=function(e){b.isAcceptNewSession=!1,b.isInitiator=!0;var n=!1;return e&&(d(e)?b.sessionid=e:(a(e.transmitRoomOnce)||(b.transmitRoomOnce=e.transmitRoomOnce),a(e.dontTransmit)||(n=e.dontTransmit),a(e.sessionid)||(b.sessionid=e.sessionid))),b.socket&&b.socket.remove&&b.socket.remove(),b.sessionid||(b.sessionid=b.channel),b.sessionDescription={sessionid:b.sessionid,userid:b.userid,session:b.session,extra:b.extra},b.sessionDescriptions[b.sessionDescription.sessionid]||(b.numberOfSessions++,b.sessionDescriptions[b.sessionDescription.sessionid]=b.sessionDescription),i(function(){S.captureUserMediaOnDemand=e?!!e.captureUserMediaOnDemand:!1,e&&e.onMediaCaptured&&(b.onMediaCaptured=e.onMediaCaptured),S.captureUserMediaOnDemand||m(function(){S.initSession({sessionDescription:b.sessionDescription,dontTransmit:n}),C(b)}),S.captureUserMediaOnDemand&&S.initSession({sessionDescription:b.sessionDescription,dontTransmit:n})}),b.sessionDescription},b.connect=function(e){return e&&(b.sessionid=e),i(function(){p("Signaling channel is ready.")}),this},b.join=u,b.send=function(e,n){if(b.numberOfConnectedUsers<=0)return void alert(" Add atleast one connection to share files ");if(!e)throw"No file, data or text message to share.";if(e instanceof Array&&!a(e[0].size)&&!a(e[0].type))for(var t=0;t<e.length;t++)e[t].size&&e[t].type&&b.send(e[t],n);else if(a(e.size)||a(e.type))H.send({text:e,channel:S,_channel:n,connection:b});else{if(!b.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!S.fileBufferReader)return void T(b,function(t){S.fileBufferReader=t,b.send(e,n)});var i=k({userid:b.userid},e.extra||b.extra);S.fileBufferReader.readAsArrayBuffer(e,function(e){S.fileBufferReader.getNextChunk(e,function(e,t,i){n?n.send(e):S.send(e)})},i)}},b.disconnect=function(){S&&S.disconnect(),S=null};var x=!0;b.captureUserMedia=m,b.leave=function(e){return S?(x=!0,e?void b.eject(e):void S.leave()):void 0},b.eject=function(e){if(!b.isInitiator)throw"Only session-initiator can eject a user.";if(!b.peers[e])throw"You ejected invalid user.";b.peers[e].sendCustomMessage({ejected:!0})},b.close=function(){b.autoCloseEntireSession=!0,b.leave()},b.renegotiate=function(e,n){return b.numberOfConnectedUsers<=0?void setTimeout(function(){b.renegotiate(e,n)},1e3):void S.addStream({renegotiate:n||k({oneway:!0},b.session),stream:e})},b.attachExternalStream=function(e,n){var t={};e.getAudioTracks&&e.getAudioTracks().length&&(t.audio=!0),e.getVideoTracks&&e.getVideoTracks().length&&(t.video=!0);var i={video:{chromeMediaSource:"fake"}},s=n?i:t;f(e,!1,"",null,s,!1,!1,i,t,t)},b.addStream=function(e,n){function t(t){S.addStream({stream:t,renegotiate:e||b.session,socket:n})}if(b.numberOfConnectedUsers<=0)return void setTimeout(function(){b.addStream(e,n)},1e3);if(e){var i;!b.isInitiator&&e.oneway&&(e.oneway=!1,i=!0),m(function(n){i&&(e.oneway=!0),t(n)},e)}else t()},b.removeStream=function(e,n){function t(e,n){n.local&&"local"!=e.type||n.remote&&"remote"!=e.type||(n.screen&&e.isScreen&&b.detachStreams.push(e.streamid),n.audio&&e.isAudio&&b.detachStreams.push(e.streamid),n.video&&e.isVideo&&b.detachStreams.push(e.streamid),n.audio||n.video||n.screen||b.detachStreams.push(e.streamid),-1!=b.detachStreams.indexOf(e.streamid)&&(p("removing stream",e.streamid),y(e,b),n.stop&&b.stopMediaStream(e.stream)))}if(b.numberOfConnectedUsers<=0)return void setTimeout(function(){b.removeStream(e,n)},1e3);if(e||(e="all"),!d(e)||-1!=e.search(/all|audio|video|screen/gi)){for(var i in b.streams)if(-1==b._skip.indexOf(i))if(_stream=b.streams[i],"all"==e)t(_stream,{audio:!0,video:!0,screen:!0});else if(d(e)){var s={};s[e]=!0,t(_stream,s)}else t(_stream,e);return void(!n&&b.detachStreams.length&&b.renegotiate())}var i=b.streams[e];return i?(b.detachStreams.push(i.streamid),p("removing stream",i.streamid),y(i,b),void(n||b.renegotiate())):g("No such stream exists. Stream-id:",e)},b.switchStream=function(e){return b.numberOfConnectedUsers<=0?void setTimeout(function(){b.switchStream(e)},1e3):(b.removeStream("all",!0),void b.addStream(e))},b.sendCustomMessage=function(e){return S&&S.defaultSocket?void S.defaultSocket.send({customMessage:!0,message:e}):setTimeout(function(){b.sendCustomMessage(e)},1e3)},P(b)};var N=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,F=window.mozRTCSessionDescription||window.RTCSessionDescription,_=window.mozRTCIceCandidate||window.RTCIceCandidate,j={mandatory:{},optional:[]},V={streams:[],mutex:!1,queueRequests:[]},B={SaveToDisk:function(e,n){var t=document.createElement("a");t.href=e,t.target="_blank",t.download=n||e;var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(i)}},H={send:function(e){function n(e,o){var r={type:"text",uuid:m,sendingTime:l};e&&(o=e,r.packets=parseInt(o.length/a)),o.length>a?r.message=o.slice(0,a):(r.message=o,r.last=!0,r.isobject=u),i.send(r,s),c=o.slice(r.message.length),c.length&&setTimeout(function(){n(null,c)},t.chunkInterval||100)}var t=e.connection;if(e.text instanceof ArrayBuffer||e.text instanceof DataView)return e.channel.send(e.text,e._channel);var i=e.channel,s=e._channel,r=e.text,a=t.chunkSize||1e3,c="",u=!1;d(r)||(u=!0,r=JSON.stringify(r));var m=o(),l=(new Date).getTime();n(r)}},W=[],q=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,z="undefined"!=typeof window.InstallTrigger,J=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,G=!!window.chrome&&!q,Y=!!document.documentMode,Q=J||Y,K=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),X=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var $=50,Z=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);G&&Z&&Z[2]&&($=parseInt(Z[2],10));var ee=50;Z=navigator.userAgent.match(/Firefox\/(.*)/),z&&Z&&Z[1]&&(ee=parseInt(Z[1],10));var ne=window.console||{log:function(){},error:function(){},warn:function(){}};if(G||z||J)var p=ne.log.bind(ne),h=ne.error.bind(ne),g=ne.warn.bind(ne);var te,ie,se,oe={},re={},ae='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',de="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",ce="ldklenbdhlfgplklobfkkmlaedeojdle",ue=-1!=document.domain.indexOf("webrtc-experiment.com"),me=window.MediaStreamTrack,le={};!function(){function e(e){return Q||z?void(e&&e()):(me&&me.getSources&&(navigator.getMediaDevices=me.getSources.bind(me)),navigator.getMediaDevices?void navigator.getMediaDevices(function(n){le.MediaDevices=[],n.forEach(function(e){"audio"==e.kind&&(e.kind="audioinput"),"video"==e.kind&&(e.kind="videoinput"),e.deviceId||(e.deviceId=e.id),e.id||(e.id=e.deviceId),le.MediaDevices.push(e),("audioinput"==e.kind||"audio"==e.kind)&&(le.hasMicrophone=!0),"audiooutput"==e.kind&&(le.hasSpeakers=!0),("videoinput"==e.kind||"video"==e.kind)&&(le.hasWebcam=!0)}),e&&e()}):(p("navigator.getMediaDevices is undefined."),G&&(le.hasMicrophone=!0,le.hasSpeakers=!0,le.hasWebcam=!0),void(e&&e())))}le.hasMicrophone=!1,le.hasSpeakers=!1,le.hasWebcam=!1,le.MediaDevices=[],le.isWebRTCSupported=!!window.webkitRTCPeerConnection||!!window.mozRTCPeerConnection,le.isAudioContextSupported=!(!window.AudioContext&&!window.webkitAudioContext||!AudioContext.prototype.createMediaStreamSource),le.isScreenCapturingSupported=G&&$>=26&&(X?!0:"https:"==location.protocol),le.isSctpDataChannelsSupported=!!navigator.mozGetUserMedia||G&&$>=25,le.isRtpDataChannelsSupported=G&&$>=31,e(),le.load=e;var n;le.screen={chromeMediaSource:"screen",extensionid:ce,getSourceId:function(e){function t(t){return"installed-enabled"==t?(n=e,void window.postMessage("get-sourceId","*")):(le.screen.chromeMediaSource="screen",void e("No-Response"))}if(!e)throw'"callback" parameter is mandatory.';le.screen.status?t(le.screen.status):le.screen.getChromeExtensionStatus(t)},onMessageCallback:function(e){if(d(e)||e.sourceId){if(p("chrome message",e),"PermissionDeniedError"==e){if(le.screen.chromeMediaSource="PermissionDeniedError",n)return n("PermissionDeniedError");throw new Error("PermissionDeniedError")}"extension-loaded"==e&&(le.screen.chromeMediaSource="desktop",le.screen.onScreenCapturingExtensionAvailable&&(le.screen.onScreenCapturingExtensionAvailable(),le.screen.onScreenCapturingExtensionAvailable=null)),e.sourceId&&(le.screen.sourceId=e.sourceId,n&&n(le.screen.sourceId))}},getChromeExtensionStatus:function(e,n){function t(e){le.screen.status=e,n(e)}if(z)return t("not-chrome");2!=arguments.length&&(n=e,e=this.extensionid);var i=document.createElement("img");i.src="chrome-extension://"+e+"/icon.png",i.onload=function(){le.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){t("screen"==le.screen.chromeMediaSource?"desktop"==le.screen.chromeMediaSource?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},i.onerror=function(){t("not-installed")}}}}(),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.addEventListener("message",function(e){e.origin==window.location.origin&&le.screen.onMessageCallback(e.data)}),attachEventListener=function(e,n,t,i){e.addEventListener(n,t,i)};var fe=window.PluginRTC||{};window.onPluginRTCInitialized=function(e){fe=e,me=fe.MediaStreamTrack,N=fe.RTCPeerConnection,_=fe.RTCIceCandidate,F=fe.RTCSessionDescription,p(Q?"Java-Applet":"ActiveX","plugin has been loaded.")},c(fe)||window.onPluginRTCInitialized(fe),Q&&M("Plugin.EveryWhere.js")}();
var CanvasDesigner=function(){function e(e){t&&t.contentWindow.postMessage({canvasDesignerSyncData:e},"*")}function n(){event.data&&event.data.canvasDesignerSyncData&&s(event.data.canvasDesignerSyncData)}var t,a={line:!0,pencil:!0,dragSingle:!0,dragMultiple:!0,eraser:!0,rectangle:!0,arc:!0,bezier:!0,quadratic:!0,text:!0},i="pencil",s=function(e){},c=window.addEventListener?"addEventListener":"attachEvent",d=window[c],r="attachEvent"==c?"onmessage":"message";return d(r,function(e){console.log("parent received message!:  ",e.data),e.data&&e.data.canvasDesignerSyncData&&s(e.data.canvasDesignerSyncData)},!1),{appendTo:function(e){t=document.createElement("iframe"),t.id="drawboard",t.src="widget.html?tools="+JSON.stringify(a)+"&selectedIcon="+i,t.style.width="100%",t.style.height="40%",t.style.border=0,e.appendChild(t)},destroy:function(){t&&t.parentNode.removeChild(t),window.removeEventListener("message",n)},addSyncListener:function(e){s=e},syncData:e,setTools:function(e){a=e},setSelected:function(e){"undefined"!=typeof a[e]&&(i=e)}}}();
function shownotification(e){alert(e)}function getElement(e){return document.querySelector(e)}function getRandomColor(){for(var e="0123456789ABCDEF".split(""),t="#",n=0;6>n;n++)t+=e[Math.round(15*Math.random())];return t}function getUserinfo(e,t){return e?'<video src="'+e+'" autoplay></vide>':'<img src="'+t+'">'}function fireClickEvent(e){var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}function bytesToSize(e){var t=["Bytes","KB","MB","GB","TB"];if(0==e)return"0 Bytes";var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,n),2)+" "+t[n]}function startcall(){rtcMultiConnection.extra={username:t,color:"ffffff",useremail:n};var e="/";socket=io.connect(e),socket.on("presence",function(e){e?(shownotification("Joing an existing session "),rtcMultiConnection.connect()):(shownotification("Making a new session "),rtcMultiConnection.open())}),socket.emit("presence",{channel:rtcMultiConnection.channel,useremail:n,username:t}),rtcMultiConnection.openSignalingChannel=function(t){var n=t.channel||this.channel;io.connect(e).emit("new-channel",{channel:n,sender:rtcMultiConnection.userid});var s=io.connect(e+n);s.channel=n,s.on("connect",function(){t.callback&&t.callback(s)}),s.send=function(e){s.emit("message",{sender:rtcMultiConnection.userid,data:e})},s.on("message",t.onmessage),s.on("disconnect","datalost")}}function addNewMessage(e){if(console.log("add new message ",e),""!=e.message&&" "!=e.message){var t=document.createElement("div");t.style["float"]="left",t.className="user-activity user-activity-left",t.setAttribute("style","background-color:rgba(6, 25, 255, 0.67)"),t.innerHTML='<div class="chatusername">'+e.header+"</div>";var n=document.createElement("div");n.className="userchatmsg",n.setAttribute("style","color:white"),t.appendChild(n),n.innerHTML=e.message,document.getElementById("all-messages").appendChild(t),$(".popup-messages").scrollTop($(".popup-messages")[0].scrollHeight)}}function addNewMessagelocal(e){if(""!=e.message&&" "!=e.message){var t=document.createElement("div");t.style["float"]="right",t.className="user-activity user-activity-right",t.setAttribute("style","background-color:rgba(20, 147, 47, 0.67)"),t.innerHTML='<div class="chatusername">'+e.header+"</div>";var n=document.createElement("div");n.className="userchatmsg",t.appendChild(n),n.innerHTML=e.message,n.setAttribute("style","color:white"),document.getElementById("all-messages").appendChild(t),$(".popup-messages").scrollTop($(".popup-messages")[0].scrollHeight)}}function addNewFileLocal(e){if(alert("add new message ",e),""!=e.message&&" "!=e.message){var t=document.createElement("div");t.style["float"]="left",t.className="user-activity ",t.setAttribute("style","    background-color: rgba(251, 255, 6, 0.37); line-height: 1.28;     padding: 9px;    margin: 2px;    width: 20%;    min-height: 20px;    height: 41px;"),t.innerHTML='<div class="chatusername">'+e.header+"</div>";var n=document.createElement("div");n.className="userchatmsg",n.setAttribute("style","color:white"),t.appendChild(n),n.innerHTML=e.message,document.getElementById("widget-filesharing1").appendChild(t)}}function addNewFileRemote(e){if(console.log("add new message ",e),""!=e.message&&" "!=e.message){var t=document.createElement("div");t.style["float"]="left",t.className="user-activity",t.setAttribute("style","    background-color: rgba(251, 255, 6, 0.37); line-height: 1.28;     padding: 9px;    margin: 2px;    width: 20%;    min-height: 20px;    height: 41px;"),t.setAttribute("style","background-color:rgba(6, 25, 255, 0.67)"),t.innerHTML='<div class="chatusername">'+e.header+"</div>";var n=document.createElement("div");n.className="userchatmsg",n.setAttribute("style","color:white"),t.appendChild(n),n.innerHTML=e.message,document.getElementById("widget-filesharing2").appendChild(t)}}function updateLabel(e,t){if(-1!=e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}function getSmileys(e){return e}var t=username,o="/",e=null,n=useremail,rtcMultiConnection=new RTCMultiConnection;rtcMultiConnection.session={video:!0,audio:!0,data:!0},rtcMultiConnection.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},rtcMultiConnection.customStreams={},rtcMultiConnection.autoCloseEntireSession=!1,rtcMultiConnection.autoTranslateText=!1,rtcMultiConnection.maxParticipantsAllowed=3,rtcMultiConnection.setDefaultEventsForMediaElement=!1,rtcMultiConnection.onopen=function(e){alert(e.extra.username+" Joined the conversation."),startsessionTimer(),numbersOfUsers.innerHTML=parseInt(numbersOfUsers.innerHTML)+1};var whoIsTyping=document.querySelector("#who-is-typing");rtcMultiConnection.onmessage=function(e){e.data.typing?void(whoIsTyping.innerHTML=e.extra.username+" is typing ..."):e.data.stoppedTyping?void(whoIsTyping.innerHTML=""):"chat"==e.data.type?(whoIsTyping.innerHTML="",addNewMessage({header:e.extra.username,message:linkify(e.data.message),userinfo:getUserinfo(rtcMultiConnection.blobURLs[e.userid],"chat-message.png"),color:e.extra.color}),void(document.title=e.data.message)):"file"==e.data.type?addNewMessage({header:e.extra.username,message:e.data.message,userinfo:getUserinfo(rtcMultiConnection.blobURLs[e.userid],"chat-message.png"),color:e.extra.color}):"canvas"==e.data.type&&CanvasDesigner.syncData(e.data.draw)};var sessions={};rtcMultiConnection.onNewSession=function(e){sessions[e.sessionid]||(sessions[e.sessionid]=e,e.join())},rtcMultiConnection.onRequest=function(e){rtcMultiConnection.accept(e)},rtcMultiConnection.onCustomMessage=function(e){if(e.hasCamera||e.hasScreen){var t=e.extra.username+" enabled webcam.";e.hasScreen&&(e.session.oneway=!0,rtcMultiConnection.sendMessage({renegotiate:!0,streamid:e.streamid,session:e.session}),t=e.extra.username+" is ready to share screen.")}if(e.hasMic&&(e.session.oneway=!0,rtcMultiConnection.sendMessage({renegotiate:!0,streamid:e.streamid,session:e.session})),e.renegotiate){var n=rtcMultiConnection.customStreams[e.streamid];n&&rtcMultiConnection.peers[e.userid].renegotiate(n,e.session)}},rtcMultiConnection.blobURLs={};var islocalStream=1;rtcMultiConnection.onstream=function(e){e.stream.getVideoTracks().length&&(rtcMultiConnection.blobURLs[e.userid]=e.blobURL);var t=e.mediaElement;if(t.setAttribute("preload","none"),e.isScreen){1==islocalStream&&(t.setAttribute("class","local"),islocalStream=0);var n=document.createElement("div");n.setAttribute("id",e.userid+"_screen"),n.setAttribute("class","col-xs-6 col-sm-4 videoContainer"),n.appendChild(t),usersContainer.appendChild(n)}else{1==islocalStream&&(t.setAttribute("class","local"),islocalStream=0);var n=document.createElement("div");n.setAttribute("id",e.userid),n.setAttribute("class","col-xs-6 col-sm-4 videoContainer"),n.appendChild(t),usersContainer.appendChild(n)}},rtcMultiConnection.onstreamended=function(e){e.isScreen?$("#"+e.userid+"_screen").remove():$("#"+e.userid).remove()},rtcMultiConnection.sendMessage=function(e){e.userid=rtcMultiConnection.userid,e.extra=rtcMultiConnection.extra,rtcMultiConnection.sendCustomMessage(e)},rtcMultiConnection.onclose=rtcMultiConnection.onleave=function(e){addNewMessage({header:e.extra.username,message:e.extra.username+" left session.",userinfo:getUserinfo(rtcMultiConnection.blobURLs[e.userid],"info.png"),color:e.extra.color}),$("#"+e.userid).remove(),shownotification(e.extra.username+" left the conversation."),rtcMultiConnection.playRoleOfInitiator()};var isShiftKeyPressed=!1;getElement(".main-input-box input").onkeydown=function(e){16==e.keyCode&&(isShiftKeyPressed=!0)};var numberOfKeys=0;getElement(".main-input-box input").onkeyup=function(e){if(numberOfKeys++,numberOfKeys>3&&(numberOfKeys=0),!numberOfKeys){if(8==e.keyCode)return rtcMultiConnection.send({stoppedTyping:!0});rtcMultiConnection.send({typing:!0})}return isShiftKeyPressed?void(16==e.keyCode&&(isShiftKeyPressed=!1)):void(13==e.keyCode&&(addNewMessagelocal({header:rtcMultiConnection.extra.username,message:linkify(this.value),userinfo:getUserinfo(rtcMultiConnection.blobURLs[rtcMultiConnection.userid],"chat-message.png"),color:rtcMultiConnection.extra.color}),rtcMultiConnection.send({type:"chat",message:this.value}),this.value=""))},document.getElementById("send").onclick=function(){var e=getElement(".main-input-box input").value;return addNewMessagelocal({header:rtcMultiConnection.extra.username,message:linkify(e),userinfo:getUserinfo(rtcMultiConnection.blobURLs[rtcMultiConnection.userid],"chat-message.png"),color:rtcMultiConnection.extra.color}),rtcMultiConnection.send({type:"chat",message:e}),this.value="",!1};var progressHelper={};rtcMultiConnection.onFileStart=function(e){addNewFileLocal({header:" User local ",message:" File shared ",userinfo:getUserinfo(rtcMultiConnection.blobURLs[rtcMultiConnection.userid],"images/share-files.png"),callback:function(e){}});var t=document.createElement("div");t.title=e.name,t.innerHTML="<label>0%</label><progress></progress>",document.getElementById("widget-filesharing1").appendChild(t),progressHelper[e.uuid]={div:t,progress:t.querySelector("progress"),label:t.querySelector("label")},progressHelper[e.uuid].progress.max=e.maxChunks},rtcMultiConnection.onFileProgress=function(e){var t=progressHelper[e.uuid];t&&(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,updateLabel(t.progress,t.label))},rtcMultiConnection.onFileEnd=function(e){if(!progressHelper[e.uuid])return void console.error("No such progress-helper element exists.",e);var t=progressHelper[e.uuid].div;t.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download '+e.name+" </a>",document.getElementById("widget-filesharing-container").innerHTML=document.getElementById("widget-filesharing-container").innerHTML+e.type.indexOf("image")?'<img src="'+e.url+'" title="'+e.name+'">':'<iframe src="'+e.url+'" title="'+e.name+'" style="width: 69%;border: 0;border-left: 1px solid black;height: inherit;"></iframe>',setTimeout(function(){t=t.parentNode.parentNode.parentNode,t.querySelector(".user-info").style.height=t.querySelector(".user-activity").clientHeight+"px"},10)},document.getElementById("file").onchange=function(){var e=this.files[0];rtcMultiConnection.send(e)},window.linkify=function(){var e="[a-z\\d.-]+://",t="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",n="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",s="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",i="(?:"+n+s+"|"+t+")",r="(?:[;/][^#?<>\\s]*)?",o="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",a="\\b"+e+"[^<>\\s]+",c="\\b"+i+r+o+"(?!\\w)",l="mailto:",u="(?:"+l+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+i+o+"(?!\\w)",d=new RegExp("(?:"+a+"|"+c+"|"+u+")","ig"),m=new RegExp("^"+e,"i"),g={"'":"`",">":"<",")":"(","]":"[","}":"{","»":"«","›":"‹"},p={callback:function(e,t){return t?'<a href="'+t+'" title="'+t+'" target="_blank">'+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(e,t){e=getSmileys(e),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />"),t=t||{};var n,s,i,r,o,a,c,u,h,f,b,v,y="",M=[];for(s in p)void 0===t[s]&&(t[s]=p[s]);for(;n=d.exec(e);)if(i=n[0],a=d.lastIndex,c=a-i.length,!/[\/:]/.test(e.charAt(c-1))){do u=i,v=i.substr(-1),b=g[v],b&&(h=i.match(new RegExp("\\"+b+"(?!$)","g")),f=i.match(new RegExp("\\"+v,"g")),(h?h.length:0)<(f?f.length:0)&&(i=i.substr(0,i.length-1),a--)),t.punct_regexp&&(i=i.replace(t.punct_regexp,function(e){return a-=e.length,""}));while(i.length&&i!==u);r=i,m.test(r)||(r=(-1!==r.indexOf("@")?r.indexOf(l)?l:"":r.indexOf("irc.")?r.indexOf("ftp.")?"http://":"ftp://":"irc://")+r),o!=c&&(M.push([e.slice(o,c)]),o=a),M.push([i,r])}for(M.push([e.substr(o)]),s=0;s<M.length;s++)y+=t.callback.apply(window,M[s]);return y||e}}();var usersList=document.getElementById("userslist"),numbersOfUsers=document.getElementById("numbersofusers");numbersOfUsers.innerHTML=1;var usersContainer=document.getElementById("usersContainer");CanvasDesigner.addSyncListener(function(e){rtcMultiConnection.send({type:"canvas",draw:e})}),CanvasDesigner.setSelected("pencil"),CanvasDesigner.setTools({pencil:!0,eraser:!0}),CanvasDesigner.appendTo(document.getElementById("widget-container")),$("document").ready(function(){startcall()});